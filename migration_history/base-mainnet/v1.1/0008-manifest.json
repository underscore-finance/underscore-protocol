{
  "contracts": {
    "WalletBackpack": {
      "address": "0x10099b1386b434Ea4da1967d952931b645Df6250",
      "abi": [
        {
          "name": "PendingBackpackItemAdded",
          "inputs": [
            {
              "name": "backpackType",
              "type": "uint256",
              "indexed": false
            },
            {
              "name": "addr",
              "type": "address",
              "indexed": true
            },
            {
              "name": "actionId",
              "type": "uint256",
              "indexed": false
            },
            {
              "name": "confirmationBlock",
              "type": "uint256",
              "indexed": false
            },
            {
              "name": "addedBy",
              "type": "address",
              "indexed": true
            }
          ],
          "anonymous": false,
          "type": "event"
        },
        {
          "name": "BackpackItemConfirmed",
          "inputs": [
            {
              "name": "backpackType",
              "type": "uint256",
              "indexed": false
            },
            {
              "name": "addr",
              "type": "address",
              "indexed": true
            },
            {
              "name": "actionId",
              "type": "uint256",
              "indexed": false
            },
            {
              "name": "confirmedBy",
              "type": "address",
              "indexed": true
            }
          ],
          "anonymous": false,
          "type": "event"
        },
        {
          "name": "PendingBackpackItemCancelled",
          "inputs": [
            {
              "name": "backpackType",
              "type": "uint256",
              "indexed": false
            },
            {
              "name": "addr",
              "type": "address",
              "indexed": true
            },
            {
              "name": "actionId",
              "type": "uint256",
              "indexed": false
            },
            {
              "name": "cancelledBy",
              "type": "address",
              "indexed": true
            }
          ],
          "anonymous": false,
          "type": "event"
        },
        {
          "name": "GovChangeTimeLockModified",
          "inputs": [
            {
              "name": "prevTimeLock",
              "type": "uint256",
              "indexed": false
            },
            {
              "name": "newTimeLock",
              "type": "uint256",
              "indexed": false
            }
          ],
          "anonymous": false,
          "type": "event"
        },
        {
          "name": "ExpirationSet",
          "inputs": [
            {
              "name": "expiration",
              "type": "uint256",
              "indexed": false
            }
          ],
          "anonymous": false,
          "type": "event"
        },
        {
          "name": "ActionTimeLockSet",
          "inputs": [
            {
              "name": "newTimeLock",
              "type": "uint256",
              "indexed": false
            },
            {
              "name": "prevTimeLock",
              "type": "uint256",
              "indexed": false
            }
          ],
          "anonymous": false,
          "type": "event"
        },
        {
          "name": "GovChangeStarted",
          "inputs": [
            {
              "name": "prevGov",
              "type": "address",
              "indexed": true
            },
            {
              "name": "newGov",
              "type": "address",
              "indexed": true
            },
            {
              "name": "confirmBlock",
              "type": "uint256",
              "indexed": false
            }
          ],
          "anonymous": false,
          "type": "event"
        },
        {
          "name": "GovChangeConfirmed",
          "inputs": [
            {
              "name": "prevGov",
              "type": "address",
              "indexed": true
            },
            {
              "name": "newGov",
              "type": "address",
              "indexed": true
            },
            {
              "name": "initiatedBlock",
              "type": "uint256",
              "indexed": false
            },
            {
              "name": "confirmBlock",
              "type": "uint256",
              "indexed": false
            }
          ],
          "anonymous": false,
          "type": "event"
        },
        {
          "name": "GovChangeCancelled",
          "inputs": [
            {
              "name": "cancelledGov",
              "type": "address",
              "indexed": true
            },
            {
              "name": "initiatedBlock",
              "type": "uint256",
              "indexed": false
            },
            {
              "name": "confirmBlock",
              "type": "uint256",
              "indexed": false
            }
          ],
          "anonymous": false,
          "type": "event"
        },
        {
          "name": "GovRelinquished",
          "inputs": [
            {
              "name": "prevGov",
              "type": "address",
              "indexed": true
            }
          ],
          "anonymous": false,
          "type": "event"
        },
        {
          "name": "UndyHqSetupFinished",
          "inputs": [
            {
              "name": "prevGov",
              "type": "address",
              "indexed": true
            },
            {
              "name": "newGov",
              "type": "address",
              "indexed": true
            },
            {
              "name": "timeLock",
              "type": "uint256",
              "indexed": false
            }
          ],
          "anonymous": false,
          "type": "event"
        },
        {
          "name": "DepartmentPauseModified",
          "inputs": [
            {
              "name": "isPaused",
              "type": "bool",
              "indexed": false
            }
          ],
          "anonymous": false,
          "type": "event"
        },
        {
          "name": "DepartmentFundsRecovered",
          "inputs": [
            {
              "name": "asset",
              "type": "address",
              "indexed": true
            },
            {
              "name": "recipient",
              "type": "address",
              "indexed": true
            },
            {
              "name": "balance",
              "type": "uint256",
              "indexed": false
            }
          ],
          "anonymous": false,
          "type": "event"
        },
        {
          "stateMutability": "view",
          "type": "function",
          "name": "getUndyHqFromGov",
          "inputs": [],
          "outputs": [
            {
              "name": "",
              "type": "address"
            }
          ]
        },
        {
          "stateMutability": "view",
          "type": "function",
          "name": "canGovern",
          "inputs": [
            {
              "name": "_addr",
              "type": "address"
            }
          ],
          "outputs": [
            {
              "name": "",
              "type": "bool"
            }
          ]
        },
        {
          "stateMutability": "view",
          "type": "function",
          "name": "getGovernors",
          "inputs": [],
          "outputs": [
            {
              "name": "",
              "type": "address[]"
            }
          ]
        },
        {
          "stateMutability": "view",
          "type": "function",
          "name": "hasPendingGovChange",
          "inputs": [],
          "outputs": [
            {
              "name": "",
              "type": "bool"
            }
          ]
        },
        {
          "stateMutability": "nonpayable",
          "type": "function",
          "name": "startGovernanceChange",
          "inputs": [
            {
              "name": "_newGov",
              "type": "address"
            }
          ],
          "outputs": []
        },
        {
          "stateMutability": "nonpayable",
          "type": "function",
          "name": "confirmGovernanceChange",
          "inputs": [],
          "outputs": []
        },
        {
          "stateMutability": "nonpayable",
          "type": "function",
          "name": "cancelGovernanceChange",
          "inputs": [],
          "outputs": []
        },
        {
          "stateMutability": "nonpayable",
          "type": "function",
          "name": "relinquishGov",
          "inputs": [],
          "outputs": []
        },
        {
          "stateMutability": "nonpayable",
          "type": "function",
          "name": "setGovTimeLock",
          "inputs": [
            {
              "name": "_numBlocks",
              "type": "uint256"
            }
          ],
          "outputs": [
            {
              "name": "",
              "type": "bool"
            }
          ]
        },
        {
          "stateMutability": "view",
          "type": "function",
          "name": "isValidGovTimeLock",
          "inputs": [
            {
              "name": "_newTimeLock",
              "type": "uint256"
            }
          ],
          "outputs": [
            {
              "name": "",
              "type": "bool"
            }
          ]
        },
        {
          "stateMutability": "view",
          "type": "function",
          "name": "minGovChangeTimeLock",
          "inputs": [],
          "outputs": [
            {
              "name": "",
              "type": "uint256"
            }
          ]
        },
        {
          "stateMutability": "view",
          "type": "function",
          "name": "maxGovChangeTimeLock",
          "inputs": [],
          "outputs": [
            {
              "name": "",
              "type": "uint256"
            }
          ]
        },
        {
          "stateMutability": "nonpayable",
          "type": "function",
          "name": "finishUndyHqSetup",
          "inputs": [
            {
              "name": "_newGov",
              "type": "address"
            }
          ],
          "outputs": [
            {
              "name": "",
              "type": "bool"
            }
          ]
        },
        {
          "stateMutability": "nonpayable",
          "type": "function",
          "name": "finishUndyHqSetup",
          "inputs": [
            {
              "name": "_newGov",
              "type": "address"
            },
            {
              "name": "_timeLock",
              "type": "uint256"
            }
          ],
          "outputs": [
            {
              "name": "",
              "type": "bool"
            }
          ]
        },
        {
          "stateMutability": "view",
          "type": "function",
          "name": "governance",
          "inputs": [],
          "outputs": [
            {
              "name": "",
              "type": "address"
            }
          ]
        },
        {
          "stateMutability": "view",
          "type": "function",
          "name": "pendingGov",
          "inputs": [],
          "outputs": [
            {
              "name": "",
              "type": "tuple",
              "components": [
                {
                  "name": "newGov",
                  "type": "address"
                },
                {
                  "name": "initiatedBlock",
                  "type": "uint256"
                },
                {
                  "name": "confirmBlock",
                  "type": "uint256"
                }
              ]
            }
          ]
        },
        {
          "stateMutability": "view",
          "type": "function",
          "name": "numGovChanges",
          "inputs": [],
          "outputs": [
            {
              "name": "",
              "type": "uint256"
            }
          ]
        },
        {
          "stateMutability": "view",
          "type": "function",
          "name": "govChangeTimeLock",
          "inputs": [],
          "outputs": [
            {
              "name": "",
              "type": "uint256"
            }
          ]
        },
        {
          "stateMutability": "view",
          "type": "function",
          "name": "getAddys",
          "inputs": [],
          "outputs": [
            {
              "name": "",
              "type": "tuple",
              "components": [
                {
                  "name": "hq",
                  "type": "address"
                },
                {
                  "name": "undyToken",
                  "type": "address"
                },
                {
                  "name": "ledger",
                  "type": "address"
                },
                {
                  "name": "missionControl",
                  "type": "address"
                },
                {
                  "name": "legoBook",
                  "type": "address"
                },
                {
                  "name": "switchboard",
                  "type": "address"
                },
                {
                  "name": "hatchery",
                  "type": "address"
                },
                {
                  "name": "lootDistributor",
                  "type": "address"
                },
                {
                  "name": "appraiser",
                  "type": "address"
                },
                {
                  "name": "walletBackpack",
                  "type": "address"
                },
                {
                  "name": "billing",
                  "type": "address"
                },
                {
                  "name": "vaultRegistry",
                  "type": "address"
                }
              ]
            }
          ]
        },
        {
          "stateMutability": "view",
          "type": "function",
          "name": "getUndyHq",
          "inputs": [],
          "outputs": [
            {
              "name": "",
              "type": "address"
            }
          ]
        },
        {
          "stateMutability": "view",
          "type": "function",
          "name": "canMintUndy",
          "inputs": [],
          "outputs": [
            {
              "name": "",
              "type": "bool"
            }
          ]
        },
        {
          "stateMutability": "nonpayable",
          "type": "function",
          "name": "pause",
          "inputs": [
            {
              "name": "_shouldPause",
              "type": "bool"
            }
          ],
          "outputs": []
        },
        {
          "stateMutability": "nonpayable",
          "type": "function",
          "name": "recoverFunds",
          "inputs": [
            {
              "name": "_recipient",
              "type": "address"
            },
            {
              "name": "_asset",
              "type": "address"
            }
          ],
          "outputs": []
        },
        {
          "stateMutability": "nonpayable",
          "type": "function",
          "name": "recoverFundsMany",
          "inputs": [
            {
              "name": "_recipient",
              "type": "address"
            },
            {
              "name": "_assets",
              "type": "address[]"
            }
          ],
          "outputs": []
        },
        {
          "stateMutability": "view",
          "type": "function",
          "name": "isPaused",
          "inputs": [],
          "outputs": [
            {
              "name": "",
              "type": "bool"
            }
          ]
        },
        {
          "stateMutability": "view",
          "type": "function",
          "name": "canConfirmAction",
          "inputs": [
            {
              "name": "_actionId",
              "type": "uint256"
            }
          ],
          "outputs": [
            {
              "name": "",
              "type": "bool"
            }
          ]
        },
        {
          "stateMutability": "view",
          "type": "function",
          "name": "isExpired",
          "inputs": [
            {
              "name": "_actionId",
              "type": "uint256"
            }
          ],
          "outputs": [
            {
              "name": "",
              "type": "bool"
            }
          ]
        },
        {
          "stateMutability": "view",
          "type": "function",
          "name": "hasPendingAction",
          "inputs": [
            {
              "name": "_actionId",
              "type": "uint256"
            }
          ],
          "outputs": [
            {
              "name": "",
              "type": "bool"
            }
          ]
        },
        {
          "stateMutability": "view",
          "type": "function",
          "name": "getActionConfirmationBlock",
          "inputs": [
            {
              "name": "_actionId",
              "type": "uint256"
            }
          ],
          "outputs": [
            {
              "name": "",
              "type": "uint256"
            }
          ]
        },
        {
          "stateMutability": "nonpayable",
          "type": "function",
          "name": "setActionTimeLock",
          "inputs": [
            {
              "name": "_newTimeLock",
              "type": "uint256"
            }
          ],
          "outputs": [
            {
              "name": "",
              "type": "bool"
            }
          ]
        },
        {
          "stateMutability": "view",
          "type": "function",
          "name": "isValidActionTimeLock",
          "inputs": [
            {
              "name": "_newTimeLock",
              "type": "uint256"
            }
          ],
          "outputs": [
            {
              "name": "",
              "type": "bool"
            }
          ]
        },
        {
          "stateMutability": "view",
          "type": "function",
          "name": "minActionTimeLock",
          "inputs": [],
          "outputs": [
            {
              "name": "",
              "type": "uint256"
            }
          ]
        },
        {
          "stateMutability": "view",
          "type": "function",
          "name": "maxActionTimeLock",
          "inputs": [],
          "outputs": [
            {
              "name": "",
              "type": "uint256"
            }
          ]
        },
        {
          "stateMutability": "nonpayable",
          "type": "function",
          "name": "setExpiration",
          "inputs": [
            {
              "name": "_expiration",
              "type": "uint256"
            }
          ],
          "outputs": [
            {
              "name": "",
              "type": "bool"
            }
          ]
        },
        {
          "stateMutability": "nonpayable",
          "type": "function",
          "name": "setActionTimeLockAfterSetup",
          "inputs": [],
          "outputs": [
            {
              "name": "",
              "type": "bool"
            }
          ]
        },
        {
          "stateMutability": "nonpayable",
          "type": "function",
          "name": "setActionTimeLockAfterSetup",
          "inputs": [
            {
              "name": "_newTimeLock",
              "type": "uint256"
            }
          ],
          "outputs": [
            {
              "name": "",
              "type": "bool"
            }
          ]
        },
        {
          "stateMutability": "view",
          "type": "function",
          "name": "pendingActions",
          "inputs": [
            {
              "name": "arg0",
              "type": "uint256"
            }
          ],
          "outputs": [
            {
              "name": "",
              "type": "tuple",
              "components": [
                {
                  "name": "initiatedBlock",
                  "type": "uint256"
                },
                {
                  "name": "confirmBlock",
                  "type": "uint256"
                },
                {
                  "name": "expiration",
                  "type": "uint256"
                }
              ]
            }
          ]
        },
        {
          "stateMutability": "view",
          "type": "function",
          "name": "actionId",
          "inputs": [],
          "outputs": [
            {
              "name": "",
              "type": "uint256"
            }
          ]
        },
        {
          "stateMutability": "view",
          "type": "function",
          "name": "actionTimeLock",
          "inputs": [],
          "outputs": [
            {
              "name": "",
              "type": "uint256"
            }
          ]
        },
        {
          "stateMutability": "view",
          "type": "function",
          "name": "expiration",
          "inputs": [],
          "outputs": [
            {
              "name": "",
              "type": "uint256"
            }
          ]
        },
        {
          "stateMutability": "nonpayable",
          "type": "function",
          "name": "addPendingKernel",
          "inputs": [
            {
              "name": "_addr",
              "type": "address"
            }
          ],
          "outputs": [
            {
              "name": "",
              "type": "bool"
            }
          ]
        },
        {
          "stateMutability": "nonpayable",
          "type": "function",
          "name": "addPendingSentinel",
          "inputs": [
            {
              "name": "_addr",
              "type": "address"
            }
          ],
          "outputs": [
            {
              "name": "",
              "type": "bool"
            }
          ]
        },
        {
          "stateMutability": "nonpayable",
          "type": "function",
          "name": "addPendingHighCommand",
          "inputs": [
            {
              "name": "_addr",
              "type": "address"
            }
          ],
          "outputs": [
            {
              "name": "",
              "type": "bool"
            }
          ]
        },
        {
          "stateMutability": "nonpayable",
          "type": "function",
          "name": "addPendingPaymaster",
          "inputs": [
            {
              "name": "_addr",
              "type": "address"
            }
          ],
          "outputs": [
            {
              "name": "",
              "type": "bool"
            }
          ]
        },
        {
          "stateMutability": "nonpayable",
          "type": "function",
          "name": "addPendingChequeBook",
          "inputs": [
            {
              "name": "_addr",
              "type": "address"
            }
          ],
          "outputs": [
            {
              "name": "",
              "type": "bool"
            }
          ]
        },
        {
          "stateMutability": "nonpayable",
          "type": "function",
          "name": "addPendingMigrator",
          "inputs": [
            {
              "name": "_addr",
              "type": "address"
            }
          ],
          "outputs": [
            {
              "name": "",
              "type": "bool"
            }
          ]
        },
        {
          "stateMutability": "view",
          "type": "function",
          "name": "canAddBackpackItem",
          "inputs": [
            {
              "name": "_backpackType",
              "type": "uint256"
            },
            {
              "name": "_addr",
              "type": "address"
            }
          ],
          "outputs": [
            {
              "name": "",
              "type": "bool"
            }
          ]
        },
        {
          "stateMutability": "nonpayable",
          "type": "function",
          "name": "confirmPendingKernel",
          "inputs": [],
          "outputs": [
            {
              "name": "",
              "type": "bool"
            }
          ]
        },
        {
          "stateMutability": "nonpayable",
          "type": "function",
          "name": "confirmPendingSentinel",
          "inputs": [],
          "outputs": [
            {
              "name": "",
              "type": "bool"
            }
          ]
        },
        {
          "stateMutability": "nonpayable",
          "type": "function",
          "name": "confirmPendingHighCommand",
          "inputs": [],
          "outputs": [
            {
              "name": "",
              "type": "bool"
            }
          ]
        },
        {
          "stateMutability": "nonpayable",
          "type": "function",
          "name": "confirmPendingPaymaster",
          "inputs": [],
          "outputs": [
            {
              "name": "",
              "type": "bool"
            }
          ]
        },
        {
          "stateMutability": "nonpayable",
          "type": "function",
          "name": "confirmPendingChequeBook",
          "inputs": [],
          "outputs": [
            {
              "name": "",
              "type": "bool"
            }
          ]
        },
        {
          "stateMutability": "nonpayable",
          "type": "function",
          "name": "confirmPendingMigrator",
          "inputs": [],
          "outputs": [
            {
              "name": "",
              "type": "bool"
            }
          ]
        },
        {
          "stateMutability": "nonpayable",
          "type": "function",
          "name": "cancelPendingKernel",
          "inputs": [],
          "outputs": [
            {
              "name": "",
              "type": "bool"
            }
          ]
        },
        {
          "stateMutability": "nonpayable",
          "type": "function",
          "name": "cancelPendingSentinel",
          "inputs": [],
          "outputs": [
            {
              "name": "",
              "type": "bool"
            }
          ]
        },
        {
          "stateMutability": "nonpayable",
          "type": "function",
          "name": "cancelPendingHighCommand",
          "inputs": [],
          "outputs": [
            {
              "name": "",
              "type": "bool"
            }
          ]
        },
        {
          "stateMutability": "nonpayable",
          "type": "function",
          "name": "cancelPendingPaymaster",
          "inputs": [],
          "outputs": [
            {
              "name": "",
              "type": "bool"
            }
          ]
        },
        {
          "stateMutability": "nonpayable",
          "type": "function",
          "name": "cancelPendingChequeBook",
          "inputs": [],
          "outputs": [
            {
              "name": "",
              "type": "bool"
            }
          ]
        },
        {
          "stateMutability": "nonpayable",
          "type": "function",
          "name": "cancelPendingMigrator",
          "inputs": [],
          "outputs": [
            {
              "name": "",
              "type": "bool"
            }
          ]
        },
        {
          "stateMutability": "view",
          "type": "function",
          "name": "isRegisteredBackpackItem",
          "inputs": [
            {
              "name": "_addr",
              "type": "address"
            }
          ],
          "outputs": [
            {
              "name": "",
              "type": "bool"
            }
          ]
        },
        {
          "stateMutability": "view",
          "type": "function",
          "name": "kernel",
          "inputs": [],
          "outputs": [
            {
              "name": "",
              "type": "address"
            }
          ]
        },
        {
          "stateMutability": "view",
          "type": "function",
          "name": "sentinel",
          "inputs": [],
          "outputs": [
            {
              "name": "",
              "type": "address"
            }
          ]
        },
        {
          "stateMutability": "view",
          "type": "function",
          "name": "highCommand",
          "inputs": [],
          "outputs": [
            {
              "name": "",
              "type": "address"
            }
          ]
        },
        {
          "stateMutability": "view",
          "type": "function",
          "name": "paymaster",
          "inputs": [],
          "outputs": [
            {
              "name": "",
              "type": "address"
            }
          ]
        },
        {
          "stateMutability": "view",
          "type": "function",
          "name": "chequeBook",
          "inputs": [],
          "outputs": [
            {
              "name": "",
              "type": "address"
            }
          ]
        },
        {
          "stateMutability": "view",
          "type": "function",
          "name": "migrator",
          "inputs": [],
          "outputs": [
            {
              "name": "",
              "type": "address"
            }
          ]
        },
        {
          "stateMutability": "view",
          "type": "function",
          "name": "pendingUpdates",
          "inputs": [
            {
              "name": "arg0",
              "type": "uint256"
            }
          ],
          "outputs": [
            {
              "name": "",
              "type": "tuple",
              "components": [
                {
                  "name": "actionId",
                  "type": "uint256"
                },
                {
                  "name": "addr",
                  "type": "address"
                }
              ]
            }
          ]
        },
        {
          "stateMutability": "nonpayable",
          "type": "constructor",
          "inputs": [
            {
              "name": "_undyHq",
              "type": "address"
            },
            {
              "name": "_tempGov",
              "type": "address"
            },
            {
              "name": "_minTimeLock",
              "type": "uint256"
            },
            {
              "name": "_maxTimeLock",
              "type": "uint256"
            }
          ],
          "outputs": []
        }
      ],
      "solc_json": {
        "language": "Vyper",
        "sources": {
          "contracts/modules/LocalGov.vy": {
            "content": "#     Underscore Protocol License: https://github.com/underscore-finance/underscore-protocol/blob/master/LICENSE.md\n\n# @version 0.4.3\n\ninterface UndyHq:\n    def minGovChangeTimeLock() -> uint256: view\n    def maxGovChangeTimeLock() -> uint256: view\n    def governance() -> address: view\n\nstruct PendingGovernance:\n    newGov: address\n    initiatedBlock: uint256\n    confirmBlock: uint256\n\nevent GovChangeStarted:\n    prevGov: indexed(address)\n    newGov: indexed(address)\n    confirmBlock: uint256\n\nevent GovChangeConfirmed:\n    prevGov: indexed(address)\n    newGov: indexed(address)\n    initiatedBlock: uint256\n    confirmBlock: uint256\n\nevent GovChangeCancelled:\n    cancelledGov: indexed(address)\n    initiatedBlock: uint256\n    confirmBlock: uint256\n\nevent GovRelinquished:\n    prevGov: indexed(address)\n\nevent GovChangeTimeLockModified:\n    prevTimeLock: uint256\n    newTimeLock: uint256\n\nevent UndyHqSetupFinished:\n    prevGov: indexed(address)\n    newGov: indexed(address)\n    timeLock: uint256\n\n# governance\ngovernance: public(address)\npendingGov: public(PendingGovernance)\nnumGovChanges: public(uint256)\n\n# time lock\ngovChangeTimeLock: public(uint256)\n\n# config\nUNDY_HQ_FOR_GOV: immutable(address)\nMIN_GOV_TIME_LOCK: immutable(uint256)\nMAX_GOV_TIME_LOCK: immutable(uint256)\n\n\n@deploy\ndef __init__(\n    _undyHq: address,\n    _initialGov: address,\n    _minTimeLock: uint256,\n    _maxTimeLock: uint256,\n    _initialTimeLock: uint256,\n):\n    UNDY_HQ_FOR_GOV = _undyHq\n    self.governance = _initialGov\n\n    # undy hq\n    if _undyHq == empty(address):\n        assert _initialGov != empty(address) # dev: undy hq must have gov\n\n    # local gov (department, other smart contracts)\n    else:\n        hqGov: address = staticcall UndyHq(_undyHq).governance()\n        assert hqGov != empty(address) # dev: undy hq must have gov\n        assert _initialGov != hqGov # dev: undy hq cannot set same gov\n\n    # time locks\n    minTimeLock: uint256 = _minTimeLock\n    maxTimeLock: uint256 = _maxTimeLock\n    if minTimeLock == 0 or maxTimeLock == 0:\n        assert _undyHq != empty(address) # dev: need undy hq if no time locks\n        minTimeLock = staticcall UndyHq(_undyHq).minGovChangeTimeLock()\n        maxTimeLock = staticcall UndyHq(_undyHq).maxGovChangeTimeLock()\n\n    # set min and max time locks\n    assert minTimeLock < maxTimeLock # dev: invalid time lock\n    assert minTimeLock != 0 and maxTimeLock != max_value(uint256) # dev: invalid time lock\n    MIN_GOV_TIME_LOCK = minTimeLock\n    MAX_GOV_TIME_LOCK = maxTimeLock\n\n    # this contract is top level governance from Undy HQ -- not setting initial time lock during setup\n    if _undyHq == empty(address):\n        return\n\n    # set initial time lock (for local gov)\n    initialTimeLock: uint256 = max(minTimeLock, _initialTimeLock)\n    assert self._setGovTimeLock(initialTimeLock) # dev: invalid time lock\n\n\n@view\n@external\ndef getUndyHqFromGov() -> address:\n    return self._getUndyHqFromGov()\n\n\n@view\n@internal\ndef _getUndyHqFromGov() -> address:\n    return UNDY_HQ_FOR_GOV\n\n\n##############\n# Gov Access #\n##############\n\n\n@view\n@external\ndef canGovern(_addr: address) -> bool:\n    return self._canGovern(_addr)\n\n\n@view\n@internal\ndef _canGovern(_addr: address) -> bool:\n    if _addr == empty(address):\n        return False\n    return _addr in self._getGovernors()\n\n\n@view\n@external\ndef getGovernors() -> DynArray[address, 2]:\n    return self._getGovernors()\n\n\n@view\n@internal\ndef _getGovernors() -> DynArray[address, 2]:\n    governors: DynArray[address, 2] = []\n\n    # local governance\n    localGov: address = self.governance\n    if localGov != empty(address):\n        governors.append(localGov)\n\n    # undy hq governance\n    undyHq: address = UNDY_HQ_FOR_GOV\n    if undyHq == empty(address):\n        return governors\n\n    hqGov: address = staticcall UndyHq(undyHq).governance()\n    if hqGov != empty(address):\n        governors.append(hqGov)\n\n    return governors\n\n\n######################\n# Governance Changes #\n######################\n\n\n@view\n@external\ndef hasPendingGovChange() -> bool:\n    return self.pendingGov.confirmBlock != 0\n\n\n@view\n@internal\ndef _isUndyHq() -> bool:\n    return UNDY_HQ_FOR_GOV == empty(address)\n\n\n# start gov change\n\n\n@external\ndef startGovernanceChange(_newGov: address):\n    governors: DynArray[address, 2] = self._getGovernors()\n    assert msg.sender in governors # dev: no perms\n\n    # validation\n    if _newGov != empty(address):\n        assert _newGov not in governors # dev: invalid _newGov\n        assert _newGov.is_contract # dev: _newGov must be a contract\n    else:\n        assert not self._isUndyHq() # dev: undy hq cannot set 0x0\n\n    confirmBlock: uint256 = block.number + self.govChangeTimeLock\n    self.pendingGov = PendingGovernance(\n        newGov= _newGov,\n        initiatedBlock= block.number,\n        confirmBlock= confirmBlock,\n    )\n    log GovChangeStarted(prevGov=self.governance, newGov=_newGov, confirmBlock=confirmBlock)\n\n\n# confirm gov change\n\n\n@external\ndef confirmGovernanceChange():\n    data: PendingGovernance = self.pendingGov\n    assert data.confirmBlock != 0 and block.number >= data.confirmBlock # dev: time lock not reached\n\n    # check permissions\n    if data.newGov != empty(address):\n        assert msg.sender == data.newGov # dev: only new gov can confirm\n    else:\n        assert self._canGovern(msg.sender) # dev: no perms\n        assert not self._isUndyHq() # dev: undy hq cannot set 0x0\n\n    # set new governance\n    prevGov: address = self.governance\n    self.governance = data.newGov\n    self.numGovChanges += 1\n    self.pendingGov = empty(PendingGovernance)\n    log GovChangeConfirmed(prevGov=prevGov, newGov=data.newGov, initiatedBlock=data.initiatedBlock, confirmBlock=data.confirmBlock)\n\n\n# cancel gov change\n\n\n@external\ndef cancelGovernanceChange():\n    assert self._canGovern(msg.sender) # dev: no perms\n    data: PendingGovernance = self.pendingGov\n    assert data.confirmBlock != 0 # dev: no pending change\n    self.pendingGov = empty(PendingGovernance)\n    log GovChangeCancelled(cancelledGov=data.newGov, initiatedBlock=data.initiatedBlock, confirmBlock=data.confirmBlock)\n\n\n# relinquish gov (only for local gov)\n\n\n@external\ndef relinquishGov():\n    assert msg.sender == self.governance # dev: no perms\n    assert not self._isUndyHq() # dev: undy hq cannot relinquish gov\n\n    self.governance = empty(address)\n    self.numGovChanges += 1\n    log GovRelinquished(prevGov=msg.sender)\n\n\n####################\n# Time Lock Config #\n####################\n\n\n# set time lock\n\n\n@external\ndef setGovTimeLock(_numBlocks: uint256) -> bool:\n    assert self._canGovern(msg.sender) # dev: no perms\n    return self._setGovTimeLock(_numBlocks)\n\n\n@internal\ndef _setGovTimeLock(_numBlocks: uint256) -> bool:\n    prevTimeLock: uint256 = self.govChangeTimeLock\n    assert self._isValidGovTimeLock(_numBlocks, prevTimeLock) # dev: invalid time lock\n    self.govChangeTimeLock = _numBlocks\n    log GovChangeTimeLockModified(prevTimeLock=prevTimeLock, newTimeLock=_numBlocks)\n    return True\n\n\n# validation\n\n\n@view\n@external\ndef isValidGovTimeLock(_newTimeLock: uint256) -> bool:\n    return self._isValidGovTimeLock(_newTimeLock, self.govChangeTimeLock)\n\n\n@view\n@internal\ndef _isValidGovTimeLock(_newTimeLock: uint256, _prevTimeLock: uint256) -> bool:\n    if _newTimeLock == _prevTimeLock:\n        return False # no change\n    if self.pendingGov.confirmBlock != 0:\n        return False # cannot change while pending gov change\n    return _newTimeLock >= MIN_GOV_TIME_LOCK and _newTimeLock <= MAX_GOV_TIME_LOCK\n\n\n# utils\n\n\n@view\n@external\ndef minGovChangeTimeLock() -> uint256:\n    return MIN_GOV_TIME_LOCK\n\n\n@view\n@external\ndef maxGovChangeTimeLock() -> uint256:\n    return MAX_GOV_TIME_LOCK\n\n\n#################\n# Undy Hq Setup #\n#################\n\n\n@external\ndef finishUndyHqSetup(_newGov: address, _timeLock: uint256 = 0) -> bool:\n    assert self._isUndyHq() # dev: only undy hq\n    assert msg.sender == self.governance # dev: no perms\n    assert self.numGovChanges == 0 # dev: already changed gov\n\n    # validation\n    assert _newGov != empty(address) and _newGov.is_contract # dev: invalid _newGov\n    prevGov: address = self.governance\n\n    # set new gov\n    self.governance = _newGov\n    self.numGovChanges += 1\n\n    # set time lock\n    timeLock: uint256 = _timeLock\n    if timeLock == 0:\n        timeLock = MIN_GOV_TIME_LOCK\n    assert self._setGovTimeLock(timeLock) # dev: invalid time lock\n\n    log UndyHqSetupFinished(prevGov=prevGov, newGov=_newGov, timeLock=timeLock)\n    return True",
            "sha256sum": "c41aa3e0d0d96b512171813377ea277e2c7da690c3cd9b4662733b3f11f705b0"
          },
          "contracts/modules/Addys.vy": {
            "content": "#     Underscore Protocol License: https://github.com/underscore-finance/underscore-protocol/blob/master/LICENSE.md\n\n# @version 0.4.3\n\ninterface UndyHq:\n    def isValidAddr(_addr: address) -> bool: view\n    def getAddr(_regId: uint256) -> address: view\n    def undyToken() -> address: view\n\ninterface Switchboard:\n    def isSwitchboardAddr(_addr: address) -> bool: view\n\ninterface LegoBook:\n    def isLegoAddr(_addr: address) -> bool: view\n\nstruct Addys:\n    hq: address\n    undyToken: address\n    ledger: address\n    missionControl: address\n    legoBook: address\n    switchboard: address\n    hatchery: address\n    lootDistributor: address\n    appraiser: address\n    walletBackpack: address\n    billing: address\n    vaultRegistry: address\n\n# hq\nUNDY_HQ_FOR_ADDYS: immutable(address)\n\n# core addys\nLEDGER_ID: constant(uint256) = 1\nMISSION_CONTROL_ID: constant(uint256) = 2\nLEGO_BOOK_ID: constant(uint256) = 3\nSWITCHBOARD_ID: constant(uint256) = 4\nHATCHERY_ID: constant(uint256) = 5\nLOOT_DISTRIBUTOR_ID: constant(uint256) = 6\nAPPRAISER_ID: constant(uint256) = 7\nWALLET_BACKPACK_ID: constant(uint256) = 8\nBILLING_ID: constant(uint256) = 9\nVAULT_REGISTRY_ID: constant(uint256) = 10\n\n\n@deploy\ndef __init__(_undyHq: address):\n    assert _undyHq != empty(address) # dev: invalid undy hq\n    UNDY_HQ_FOR_ADDYS = _undyHq\n\n\n########\n# Core #\n########\n\n\n@view\n@external\ndef getAddys() -> Addys:\n    return self._generateAddys()\n\n\n@view\n@internal\ndef _getAddys(_addys: Addys = empty(Addys)) -> Addys:\n    if _addys.hq != empty(address):\n        return _addys\n    return self._generateAddys()\n\n\n@view\n@internal\ndef _generateAddys() -> Addys:\n    hq: address = UNDY_HQ_FOR_ADDYS\n    return Addys(\n        hq = hq,\n        undyToken = staticcall UndyHq(hq).undyToken(),\n        ledger = staticcall UndyHq(hq).getAddr(LEDGER_ID),\n        missionControl = staticcall UndyHq(hq).getAddr(MISSION_CONTROL_ID),\n        legoBook = staticcall UndyHq(hq).getAddr(LEGO_BOOK_ID),\n        switchboard = staticcall UndyHq(hq).getAddr(SWITCHBOARD_ID),\n        hatchery = staticcall UndyHq(hq).getAddr(HATCHERY_ID),\n        lootDistributor = staticcall UndyHq(hq).getAddr(LOOT_DISTRIBUTOR_ID),\n        appraiser = staticcall UndyHq(hq).getAddr(APPRAISER_ID),\n        walletBackpack = staticcall UndyHq(hq).getAddr(WALLET_BACKPACK_ID),\n        billing = staticcall UndyHq(hq).getAddr(BILLING_ID),\n        vaultRegistry = staticcall UndyHq(hq).getAddr(VAULT_REGISTRY_ID),\n    )\n\n\n##########\n# Tokens #\n##########\n\n\n@view\n@internal\ndef _getUndyToken() -> address:\n    return staticcall UndyHq(UNDY_HQ_FOR_ADDYS).undyToken()\n\n\n###########\n# Helpers #\n###########\n\n\n# undy hq\n\n\n@view\n@external\ndef getUndyHq() -> address:\n    return self._getUndyHq()\n\n\n@view\n@internal\ndef _getUndyHq() -> address:\n    return UNDY_HQ_FOR_ADDYS\n\n\n# utils\n\n\n@view\n@internal\ndef _isValidUndyAddr(_addr: address, _hq: address = empty(address)) -> bool:\n    hq: address = _hq\n    if _hq == empty(address):\n        hq = UNDY_HQ_FOR_ADDYS\n    \n    # core departments\n    if staticcall UndyHq(hq).isValidAddr(_addr):\n        return True\n\n    # lego book\n    legoBook: address = staticcall UndyHq(hq).getAddr(LEGO_BOOK_ID)\n    if legoBook != empty(address) and staticcall LegoBook(legoBook).isLegoAddr(_addr):\n        return True\n\n    # switchboard config\n    switchboard: address = staticcall UndyHq(hq).getAddr(SWITCHBOARD_ID)\n    if switchboard != empty(address) and staticcall Switchboard(switchboard).isSwitchboardAddr(_addr):\n        return True\n\n    return False\n\n\n@view\n@internal\ndef _isSwitchboardAddr(_addr: address) -> bool:\n    switchboard: address = staticcall UndyHq(UNDY_HQ_FOR_ADDYS).getAddr(SWITCHBOARD_ID)\n    if switchboard == empty(address):\n        return False\n    return staticcall Switchboard(switchboard).isSwitchboardAddr(_addr)\n\n\n@view\n@internal\ndef _isLegoBookAddr(_addr: address) -> bool:\n    legoBook: address = staticcall UndyHq(UNDY_HQ_FOR_ADDYS).getAddr(LEGO_BOOK_ID)\n    if legoBook == empty(address):\n        return False\n    return staticcall LegoBook(legoBook).isLegoAddr(_addr)\n\n\n###############\n# Departments #\n###############\n\n\n# ledger\n\n\n@view\n@internal\ndef _getLedgerId() -> uint256:\n    return LEDGER_ID\n\n\n@view\n@internal\ndef _getLedgerAddr() -> address:\n    return staticcall UndyHq(UNDY_HQ_FOR_ADDYS).getAddr(LEDGER_ID)\n\n\n# mission control\n\n\n@view\n@internal\ndef _getMissionControlId() -> uint256:\n    return MISSION_CONTROL_ID\n\n\n@view\n@internal\ndef _getMissionControlAddr() -> address:\n    return staticcall UndyHq(UNDY_HQ_FOR_ADDYS).getAddr(MISSION_CONTROL_ID)\n\n\n# lego book\n\n\n@view\n@internal\ndef _getLegoBookId() -> uint256:\n    return LEGO_BOOK_ID\n\n\n@view\n@internal\ndef _getLegoBookAddr() -> address:\n    return staticcall UndyHq(UNDY_HQ_FOR_ADDYS).getAddr(LEGO_BOOK_ID)\n\n\n# switchboard\n\n\n@view\n@internal\ndef _getSwitchboardId() -> uint256:\n    return SWITCHBOARD_ID\n\n\n@view\n@internal\ndef _getSwitchboardAddr() -> address:\n    return staticcall UndyHq(UNDY_HQ_FOR_ADDYS).getAddr(SWITCHBOARD_ID)\n\n\n# hatchery\n\n\n@view\n@internal\ndef _getHatcheryId() -> uint256:\n    return HATCHERY_ID\n\n\n@view\n@internal\ndef _getHatcheryAddr() -> address:\n    return staticcall UndyHq(UNDY_HQ_FOR_ADDYS).getAddr(HATCHERY_ID)\n\n\n# loot distributor\n\n\n@view\n@internal\ndef _getLootDistributorId() -> uint256:\n    return LOOT_DISTRIBUTOR_ID\n\n\n@view\n@internal\ndef _getLootDistributorAddr() -> address:\n    return staticcall UndyHq(UNDY_HQ_FOR_ADDYS).getAddr(LOOT_DISTRIBUTOR_ID)\n\n\n# appraiser\n\n\n@view\n@internal\ndef _getAppraiserId() -> uint256:\n    return APPRAISER_ID\n\n\n@view\n@internal\ndef _getAppraiserAddr() -> address:\n    return staticcall UndyHq(UNDY_HQ_FOR_ADDYS).getAddr(APPRAISER_ID)\n\n\n# wallet backpack\n\n\n@view\n@internal\ndef _getWalletBackpackId() -> uint256:\n    return WALLET_BACKPACK_ID\n\n\n@view\n@internal\ndef _getWalletBackpackAddr() -> address:\n    return staticcall UndyHq(UNDY_HQ_FOR_ADDYS).getAddr(WALLET_BACKPACK_ID)\n\n\n# billing\n\n\n@view\n@internal\ndef _getBillingId() -> uint256:\n    return BILLING_ID\n\n\n@view\n@internal\ndef _getBillingAddr() -> address:\n    return staticcall UndyHq(UNDY_HQ_FOR_ADDYS).getAddr(BILLING_ID)\n\n\n# vault registry\n\n\n@view\n@internal\ndef _getVaultRegistryId() -> uint256:\n    return VAULT_REGISTRY_ID\n\n\n@view\n@internal\ndef _getVaultRegistryAddr() -> address:\n    return staticcall UndyHq(UNDY_HQ_FOR_ADDYS).getAddr(VAULT_REGISTRY_ID)",
            "sha256sum": "4df6b72db9bb417d1af81660175be1450cfb7b3575f3d17a5b8a130bff87b781"
          },
          "interfaces/Department.vyi": {
            "content": "# @version 0.4.3\n\n\n###########\n# Minting #\n###########\n\n\n@view\n@external\ndef canMintUndy() -> bool:\n    # used in UndyHq.vy\n    ...\n\n\n########\n# Undy #\n########\n\n\n@view\n@external\ndef isPaused() -> bool:\n    ...\n\n\n@external\ndef pause(_shouldPause: bool):\n    ...\n\n\n@external\ndef recoverFunds(_recipient: address, _asset: address):\n    ...\n\n@external\ndef recoverFundsMany(_recipient: address, _assets: DynArray[address, 20]):\n    ...",
            "sha256sum": "53e48da591c4ee36045a8950c9d3a01458456b471b797df536e9a9f54404e721"
          },
          "contracts/modules/DeptBasics.vy": {
            "content": "#     Underscore Protocol License: https://github.com/underscore-finance/underscore-protocol/blob/master/LICENSE.md\n\n# @version 0.4.3\n\nuses: addys\nimplements: dept\n\nimport contracts.modules.Addys as addys\nimport interfaces.Department as dept\nfrom ethereum.ercs import IERC20\n\nevent DepartmentPauseModified:\n    isPaused: bool\n\nevent DepartmentFundsRecovered:\n    asset: indexed(address)\n    recipient: indexed(address)\n    balance: uint256\n\nisPaused: public(bool)\n\nCAN_MINT_UNDY: immutable(bool)\nMAX_RECOVER_ASSETS: constant(uint256) = 20\n\n\n@deploy\ndef __init__(_shouldPause: bool, _canMintUndy: bool):\n    self.isPaused = _shouldPause\n    CAN_MINT_UNDY = _canMintUndy\n\n\n###########\n# Minting #\n###########\n\n\n@view\n@external\ndef canMintUndy() -> bool:\n    return CAN_MINT_UNDY\n\n\n########\n# Undy #\n########\n\n\n# activate\n\n\n@external\ndef pause(_shouldPause: bool):\n    assert addys._isSwitchboardAddr(msg.sender) # dev: no perms\n    assert _shouldPause != self.isPaused # dev: no change\n    self.isPaused = _shouldPause\n    log DepartmentPauseModified(isPaused=_shouldPause)\n\n\n# recover funds\n\n\n@external\ndef recoverFunds(_recipient: address, _asset: address):\n    assert addys._isSwitchboardAddr(msg.sender) # dev: no perms\n    self._recoverFunds(_recipient, _asset)\n\n\n@external\ndef recoverFundsMany(_recipient: address, _assets: DynArray[address, MAX_RECOVER_ASSETS]):\n    assert addys._isSwitchboardAddr(msg.sender) # dev: no perms\n    for a: address in _assets:\n        self._recoverFunds(_recipient, a)\n\n\n@internal\ndef _recoverFunds(_recipient: address, _asset: address):\n    assert empty(address) not in [_recipient, _asset] # dev: invalid recipient or asset\n    balance: uint256 = staticcall IERC20(_asset).balanceOf(self)\n    assert balance != 0 # dev: nothing to recover\n\n    assert extcall IERC20(_asset).transfer(_recipient, balance, default_return_value=True) # dev: recovery failed\n    log DepartmentFundsRecovered(asset=_asset, recipient=_recipient, balance=balance)\n",
            "sha256sum": "976a50a3807bcf71f3f1c57de5cd7a59fe4e8f27b4d4560e774073962f44d1ac"
          },
          "contracts/modules/TimeLock.vy": {
            "content": "#     Underscore Protocol License: https://github.com/underscore-finance/underscore-protocol/blob/master/LICENSE.md\n\n# @version 0.4.3\n\nuses: gov\nimport contracts.modules.LocalGov as gov\n\nstruct PendingAction:\n    initiatedBlock: uint256\n    confirmBlock: uint256\n    expiration: uint256\n\nevent ActionTimeLockSet:\n    newTimeLock: uint256\n    prevTimeLock: uint256\n\nevent ExpirationSet:\n    expiration: uint256\n\n# core data\npendingActions: public(HashMap[uint256, PendingAction])\nactionId: public(uint256)\n\n# config\nactionTimeLock: public(uint256)\nexpiration: public(uint256)\n\nMIN_ACTION_TIMELOCK: immutable(uint256)\nMAX_ACTION_TIMELOCK: immutable(uint256)\n\n\n@deploy\ndef __init__(\n    _minActionTimeLock: uint256,\n    _maxActionTimeLock: uint256,\n    _initialTimeLock: uint256,\n    _expiration: uint256,\n):\n    # start at 1 index\n    self.actionId = 1\n\n    # set time lock boundaries\n    assert _minActionTimeLock < _maxActionTimeLock # dev: invalid time lock boundaries\n    assert _minActionTimeLock != 0 and _maxActionTimeLock != max_value(uint256) # dev: invalid time lock boundaries\n    MIN_ACTION_TIMELOCK = _minActionTimeLock\n    MAX_ACTION_TIMELOCK = _maxActionTimeLock\n\n    # set expiration time\n    self._setExpiration(_expiration, _initialTimeLock)\n\n    # set initial time lock\n    if _initialTimeLock != 0:\n        assert self._setActionTimeLock(_initialTimeLock, 0) # dev: failed to set initial time lock\n\n\n########\n# Core #\n########\n\n\n# initiate\n\n\n@internal\ndef _initiateAction() -> uint256:\n    actionId: uint256 = self.actionId\n    confirmBlock: uint256 = block.number + self.actionTimeLock\n    self.pendingActions[actionId] = PendingAction(\n        initiatedBlock= block.number,\n        confirmBlock= confirmBlock,\n        expiration= confirmBlock + self.expiration,\n    )\n    self.actionId += 1\n    return actionId\n\n\n# confirm\n\n\n@internal\ndef _confirmAction(_actionId: uint256) -> bool:\n    if not self._canConfirmAction(_actionId):\n        return False\n    self.pendingActions[_actionId] = empty(PendingAction)\n    return True\n\n\n# cancel\n\n\n@internal\ndef _cancelAction(_actionId: uint256) -> bool:\n    data: PendingAction = self.pendingActions[_actionId]\n    if data.confirmBlock == 0:\n        return False\n    self.pendingActions[_actionId] = empty(PendingAction)\n    return True\n\n\n#########\n# Utils #\n#########\n\n\n# can confirm\n\n\n@view\n@external\ndef canConfirmAction(_actionId: uint256) -> bool:\n    return self._canConfirmAction(_actionId)\n\n\n@view\n@internal\ndef _canConfirmAction(_actionId: uint256) -> bool:\n    data: PendingAction = self.pendingActions[_actionId]\n    if data.confirmBlock == 0 or block.number < data.confirmBlock:\n        return False\n    if block.number >= data.expiration:\n        return False\n    return True\n\n\n# is expired\n\n\n@view\n@external\ndef isExpired(_actionId: uint256) -> bool:\n    return self._isExpired(_actionId)\n\n\n@view\n@internal\ndef _isExpired(_actionId: uint256) -> bool:\n    data: PendingAction = self.pendingActions[_actionId]\n    if data.confirmBlock == 0:\n        return False\n    return block.number >= data.expiration\n\n\n# pending action\n\n\n@view\n@external\ndef hasPendingAction(_actionId: uint256) -> bool:\n    return self._hasPendingAction(_actionId)\n\n\n@view\n@internal\ndef _hasPendingAction(_actionId: uint256) -> bool:\n    return self.pendingActions[_actionId].confirmBlock != 0\n\n\n# confirmation block\n\n\n@view\n@external\ndef getActionConfirmationBlock(_actionId: uint256) -> uint256:\n    return self._getActionConfirmationBlock(_actionId)\n\n\n@view\n@internal\ndef _getActionConfirmationBlock(_actionId: uint256) -> uint256:\n    return self.pendingActions[_actionId].confirmBlock\n\n\n######################\n# Config - Time Lock #\n######################\n\n\n@external\ndef setActionTimeLock(_newTimeLock: uint256) -> bool:\n    assert gov._canGovern(msg.sender) # dev: no perms\n    return self._setActionTimeLock(_newTimeLock, self.actionTimeLock)\n\n\n@internal\ndef _setActionTimeLock(_newTimeLock: uint256, _prevTimeLock: uint256) -> bool:\n    assert self._isValidActionTimeLock(_newTimeLock, _prevTimeLock) # dev: invalid time lock\n    self.actionTimeLock = _newTimeLock\n    log ActionTimeLockSet(newTimeLock=_newTimeLock, prevTimeLock=_prevTimeLock)\n    return True\n\n\n# validation\n\n\n@view\n@external\ndef isValidActionTimeLock(_newTimeLock: uint256) -> bool:\n    return self._isValidActionTimeLock(_newTimeLock, self.actionTimeLock)\n\n\n@view\n@internal\ndef _isValidActionTimeLock(_newTimeLock: uint256, _prevTimeLock: uint256) -> bool:\n    if _newTimeLock == _prevTimeLock:\n        return False # no change\n    return _newTimeLock >= MIN_ACTION_TIMELOCK and _newTimeLock <= MAX_ACTION_TIMELOCK\n\n\n# utils\n\n\n@view\n@external\ndef minActionTimeLock() -> uint256:\n    return MIN_ACTION_TIMELOCK\n\n\n@view\n@external\ndef maxActionTimeLock() -> uint256:\n    return MAX_ACTION_TIMELOCK\n\n\n#######################\n# Config - Expiration #\n#######################\n\n\n@external\ndef setExpiration(_expiration: uint256) -> bool:\n    assert gov._canGovern(msg.sender) # dev: no perms\n    return self._setExpiration(_expiration, self.actionTimeLock)\n\n\n@internal\ndef _setExpiration(_expiration: uint256, _timeLock: uint256) -> bool:\n    assert self._isValidExpiration(_expiration, _timeLock) # dev: invalid expiration\n    self.expiration = _expiration\n    log ExpirationSet(expiration=_expiration)\n    return True\n\n\n# validation\n\n\n@view\n@internal\ndef _isValidExpiration(_expiration: uint256, _timeLock: uint256) -> bool:\n    if _expiration == 0 or _expiration == max_value(uint256):\n        return False\n    if _expiration < _timeLock:\n        return False\n    return True\n\n\n################\n# Finish Setup #\n################\n\n\n@external\ndef setActionTimeLockAfterSetup(_newTimeLock: uint256 = 0) -> bool:\n    assert gov._canGovern(msg.sender) # dev: no perms\n\n    prevTimeLock: uint256 = self.actionTimeLock\n    assert prevTimeLock == 0 # dev: already set\n\n    timeLock: uint256 = _newTimeLock\n    if timeLock == 0:\n        timeLock = MIN_ACTION_TIMELOCK\n    return self._setActionTimeLock(timeLock, prevTimeLock)",
            "sha256sum": "80ec25619b21a5ac9791a94ca96d5ee38a887cb59d0e9368e23ea4a2de75da8e"
          },
          "interfaces/WalletConfigStructs.vyi": {
            "content": "# @version 0.4.3\n\nMAX_CONFIG_ASSETS: constant(uint256) = 40\nMAX_CONFIG_LEGOS: constant(uint256) = 25\nMAX_ALLOWED_PAYEES: constant(uint256) = 40\n\nflag WhitelistAction:\n    ADD_PENDING\n    CONFIRM_WHITELIST\n    CANCEL_WHITELIST\n    REMOVE_WHITELIST\n\nflag BackpackType:\n    WALLET_KERNEL\n    WALLET_SENTINEL\n    WALLET_HIGH_COMMAND\n    WALLET_PAYMASTER\n    WALLET_CHEQUE_BOOK\n    WALLET_MIGRATOR\n\n# payees\n\nstruct PayeeData:\n    numTxsInPeriod: uint256\n    totalUnitsInPeriod: uint256\n    totalUsdValueInPeriod: uint256\n    totalNumTxs: uint256\n    totalUnits: uint256\n    totalUsdValue: uint256\n    lastTxBlock: uint256\n    periodStartBlock: uint256\n\nstruct PayeeSettings:\n    startBlock: uint256\n    expiryBlock: uint256\n    canPull: bool\n    periodLength: uint256\n    maxNumTxsPerPeriod: uint256\n    txCooldownBlocks: uint256\n    failOnZeroPrice: bool\n    primaryAsset: address\n    onlyPrimaryAsset: bool\n    unitLimits: PayeeLimits\n    usdLimits: PayeeLimits\n\nstruct GlobalPayeeSettings:\n    defaultPeriodLength: uint256\n    startDelay: uint256\n    activationLength: uint256\n    maxNumTxsPerPeriod: uint256\n    txCooldownBlocks: uint256\n    failOnZeroPrice: bool\n    usdLimits: PayeeLimits\n    canPayOwner: bool\n    canPull: bool\n\nstruct PayeeLimits:\n    perTxCap: uint256\n    perPeriodCap: uint256\n    lifetimeCap: uint256\n\nstruct PendingPayee:\n    settings: PayeeSettings\n    initiatedBlock: uint256\n    confirmBlock: uint256\n    currentOwner: address\n\nstruct PayeeManagementBundle:\n    owner: address\n    wallet: address\n    isRegisteredPayee: bool\n    isWhitelisted: bool\n    isExistingCheque: bool\n    payeeSettings: PayeeSettings\n    globalPayeeSettings: GlobalPayeeSettings\n    timeLock: uint256\n    walletConfig: address\n\nstruct RecipientConfigBundle:\n    isWhitelisted: bool\n    isOwner: bool\n    isPayee: bool\n    config: PayeeSettings\n    globalConfig: GlobalPayeeSettings\n    data: PayeeData\n\nstruct WhitelistConfigBundle:\n    owner: address\n    wallet: address\n    isWhitelisted: bool\n    pendingWhitelist: PendingWhitelist\n    isExistingPayee: bool\n    isExistingCheque: bool\n    timeLock: uint256\n    walletConfig: address\n    isManager: bool\n    isOwner: bool\n    whitelistPerms: WhitelistPerms\n    globalWhitelistPerms: WhitelistPerms\n\nstruct PendingWhitelist:\n    initiatedBlock: uint256\n    confirmBlock: uint256\n    currentOwner: address\n\n# cheques\n\nstruct Cheque:\n    recipient: address\n    asset: address\n    amount: uint256\n    creationBlock: uint256\n    unlockBlock: uint256\n    expiryBlock: uint256\n    usdValueOnCreation: uint256\n    canManagerPay: bool\n    canBePulled: bool\n    creator: address\n    active: bool\n\nstruct ChequeSettings:\n    maxNumActiveCheques: uint256\n    maxChequeUsdValue: uint256\n    instantUsdThreshold: uint256\n    perPeriodPaidUsdCap: uint256\n    maxNumChequesPaidPerPeriod: uint256\n    payCooldownBlocks: uint256\n    perPeriodCreatedUsdCap: uint256\n    maxNumChequesCreatedPerPeriod: uint256\n    createCooldownBlocks: uint256\n    periodLength: uint256\n    expensiveDelayBlocks: uint256\n    defaultExpiryBlocks: uint256\n    allowedAssets: DynArray[address, MAX_CONFIG_ASSETS]\n    canManagersCreateCheques: bool\n    canManagerPay: bool\n    canBePulled: bool\n\nstruct ChequeData:\n    numChequesPaidInPeriod: uint256\n    totalUsdValuePaidInPeriod: uint256\n    totalNumChequesPaid: uint256\n    totalUsdValuePaid: uint256\n    lastChequePaidBlock: uint256\n    numChequesCreatedInPeriod: uint256\n    totalUsdValueCreatedInPeriod: uint256\n    totalNumChequesCreated: uint256\n    totalUsdValueCreated: uint256\n    lastChequeCreatedBlock: uint256\n    periodStartBlock: uint256\n\nstruct ChequeManagementBundle:\n    wallet: address\n    walletConfig: address\n    owner: address\n    isRecipientOnWhitelist: bool\n    isCreatorManager: bool\n    managerSettings: ManagerSettings\n    chequeSettings: ChequeSettings\n    chequeData: ChequeData\n    isExistingCheque: bool\n    numActiveCheques: uint256\n    isExistingPayee: bool\n    timeLock: uint256\n\n# managers\n\nstruct ManagerData:\n    numTxsInPeriod: uint256\n    totalUsdValueInPeriod: uint256\n    totalNumTxs: uint256\n    totalUsdValue: uint256\n    lastTxBlock: uint256\n    periodStartBlock: uint256\n    numSwapsInPeriod: uint256\n\nstruct ManagerSettings:\n    startBlock: uint256\n    expiryBlock: uint256\n    limits: ManagerLimits\n    legoPerms: LegoPerms\n    swapPerms: SwapPerms\n    whitelistPerms: WhitelistPerms\n    transferPerms: TransferPerms\n    allowedAssets: DynArray[address, MAX_CONFIG_ASSETS]\n    canClaimLoot: bool\n\nstruct GlobalManagerSettings:\n    managerPeriod: uint256\n    startDelay: uint256\n    activationLength: uint256\n    canOwnerManage: bool\n    limits: ManagerLimits\n    legoPerms: LegoPerms\n    swapPerms: SwapPerms\n    whitelistPerms: WhitelistPerms\n    transferPerms: TransferPerms\n    allowedAssets: DynArray[address, MAX_CONFIG_ASSETS]\n\nstruct ManagerLimits:\n    maxUsdValuePerTx: uint256\n    maxUsdValuePerPeriod: uint256\n    maxUsdValueLifetime: uint256\n    maxNumTxsPerPeriod: uint256\n    txCooldownBlocks: uint256\n    failOnZeroPrice: bool\n\nstruct LegoPerms:\n    canManageYield: bool\n    canBuyAndSell: bool\n    canManageDebt: bool\n    canManageLiq: bool\n    canClaimRewards: bool\n    onlyApprovedYieldOpps: bool\n    allowedLegos: DynArray[uint256, MAX_CONFIG_LEGOS]\n\nstruct SwapPerms:\n    mustHaveUsdValue: bool\n    maxNumSwapsPerPeriod: uint256\n    maxSlippage: uint256\n\nstruct WhitelistPerms:\n    canAddPending: bool\n    canConfirm: bool\n    canCancel: bool\n    canRemove: bool\n\nstruct TransferPerms:\n    canTransfer: bool\n    canCreateCheque: bool\n    canAddPendingPayee: bool\n    allowedPayees: DynArray[address, MAX_ALLOWED_PAYEES]\n\nstruct ManagerConfigBundle:\n    isOwner: bool\n    isManager: bool\n    config: ManagerSettings\n    globalConfig: GlobalManagerSettings\n    data: ManagerData\n    payee: address\n\nstruct ManagerSettingsBundle:\n    owner: address\n    isManager: bool\n    timeLock: uint256\n    walletConfig: address\n    legoBook: address\n    globalManagerSettings: GlobalManagerSettings\n\n# migration\n\nstruct MigrationConfigBundle:\n    owner: address\n    isFrozen: bool\n    numPayees: uint256\n    numWhitelisted: uint256\n    numManagers: uint256\n    startingAgent: address\n    startingAgentIndex: uint256\n    hasPendingOwnerChange: bool\n    groupId: uint256\n    numActiveCheques: uint256\n",
            "sha256sum": "31165468feeac632a1376c70970ce5124f8951392c4deaa01a26176c7f26718a"
          },
          "interfaces/WalletStructs.vyi": {
            "content": "# @version 0.4.3\n\nflag ActionType:\n    TRANSFER\n    EARN_DEPOSIT\n    EARN_WITHDRAW\n    EARN_REBALANCE\n    SWAP\n    MINT_REDEEM\n    CONFIRM_MINT_REDEEM\n    ADD_COLLATERAL\n    REMOVE_COLLATERAL\n    BORROW\n    REPAY_DEBT\n    REWARDS\n    ETH_TO_WETH\n    WETH_TO_ETH\n    ADD_LIQ\n    REMOVE_LIQ\n    ADD_LIQ_CONC\n    REMOVE_LIQ_CONC\n    PAY_CHEQUE\n\nstruct WalletAssetData:\n    assetBalance: uint256\n    usdValue: uint256\n    isYieldAsset: bool\n    lastPricePerShare: uint256\n\nstruct ActionData:\n    ledger: address\n    missionControl: address\n    legoBook: address\n    hatchery: address\n    lootDistributor: address\n    appraiser: address\n    billing: address\n    vaultRegistry: address\n    wallet: address\n    walletConfig: address\n    walletOwner: address\n    inEjectMode: bool\n    isFrozen: bool\n    lastTotalUsdValue: uint256\n    signer: address\n    isManager: bool\n    legoId: uint256\n    legoAddr: address\n    eth: address\n    weth: address\n\nstruct MiniAddys:\n    ledger: address\n    missionControl: address\n    legoBook: address\n    appraiser: address",
            "sha256sum": "466493c129135c95470aaf70eeddc936632f7b0f813396e5a7ddc03bea9da518"
          },
          "contracts/registries/WalletBackpack.vy": {
            "content": "#\n#     _____  _____  _____  __ ___ _____  _____  _____  __ ___\n#    /  _  \\/  _  \\/     \\|  |  //  _  \\/  _  \\/     \\|  |  /\n#    |  _  <|  _  ||  |--||  _ < |   __/|  _  ||  |--||  _ < \n#    \\_____/\\__|__/\\_____/|__|__\\\\__/   \\__|__/\\_____/|__|__\\\n#                                                        \n#     \u2554\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2557\n#     \u2551  ** Wallet Backpack **                              \u2551\n#     \u2551  Registry for all wallet-related support contracts. \u2551\n#     \u255a\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u255d\n#\n#     Underscore Protocol License: https://github.com/underscore-finance/underscore-protocol/blob/master/LICENSE.md\n\n# @version 0.4.3\n\nimplements: Department\n\nexports: gov.__interface__\nexports: addys.__interface__\nexports: deptBasics.__interface__\nexports: timeLock.__interface__\n\ninitializes: gov\ninitializes: addys\ninitializes: deptBasics[addys := addys]\ninitializes: timeLock[gov := gov]\n\nimport contracts.modules.LocalGov as gov\nimport contracts.modules.Addys as addys\nimport contracts.modules.DeptBasics as deptBasics\nimport contracts.modules.TimeLock as timeLock\nfrom interfaces import Department\n\nfrom interfaces import WalletConfigStructs as wcs\nfrom interfaces import WalletStructs as ws\n\ninterface Sentinel:\n    def canSignerPerformActionWithConfig(_isOwner: bool, _isManager: bool, _data: wcs.ManagerData, _config: wcs.ManagerSettings, _globalConfig: wcs.GlobalManagerSettings, _action: ws.ActionType, _assets: DynArray[address, MAX_ASSETS] = [], _legoIds: DynArray[uint256, MAX_LEGOS] = [], _payee: address = empty(address)) -> bool: view\n    def checkManagerLimitsPostTx(_txUsdValue: uint256, _specificLimits: wcs.ManagerLimits, _globalLimits: wcs.ManagerLimits, _managerPeriod: uint256, _data: wcs.ManagerData, _needsVaultApproval: bool, _underlyingAsset: address, _vaultToken: address, _isSwap: bool, _specificSwapPerms: wcs.SwapPerms, _globalSwapPerms: wcs.SwapPerms, _fromAssetUsdValue: uint256, _toAssetUsdValue: uint256, _vaultRegistry: address) -> (bool, wcs.ManagerData): view\n    def isValidPayeeAndGetData(_isWhitelisted: bool, _isOwner: bool, _isPayee: bool, _asset: address, _amount: uint256, _txUsdValue: uint256, _config: wcs.PayeeSettings, _globalConfig: wcs.GlobalPayeeSettings, _data: wcs.PayeeData) -> (bool, wcs.PayeeData): view\n    def isValidChequeAndGetData(_asset: address, _amount: uint256, _txUsdValue: uint256, _cheque: wcs.Cheque, _globalConfig: wcs.ChequeSettings, _chequeData: wcs.ChequeData, _isManager: bool) -> (bool, wcs.ChequeData): view\n\ninterface Ledger:\n    def isRegisteredBackpackItem(_addr: address) -> bool: view\n    def registerBackpackItem(_addr: address): nonpayable\n\nstruct PendingBackpackItem:\n    actionId: uint256\n    addr: address\n\nevent PendingBackpackItemAdded:\n    backpackType: wcs.BackpackType\n    addr: indexed(address)\n    actionId: uint256\n    confirmationBlock: uint256\n    addedBy: indexed(address)\n\nevent BackpackItemConfirmed:\n    backpackType: wcs.BackpackType\n    addr: indexed(address)\n    actionId: uint256\n    confirmedBy: indexed(address)\n\nevent PendingBackpackItemCancelled:\n    backpackType: wcs.BackpackType\n    addr: indexed(address)\n    actionId: uint256\n    cancelledBy: indexed(address)\n\n# current implementations\nkernel: public(address)\nsentinel: public(address)\nhighCommand: public(address)\npaymaster: public(address)\nchequeBook: public(address)\nmigrator: public(address)\n\n# pending changes\npendingUpdates: public(HashMap[wcs.BackpackType, PendingBackpackItem]) # type -> config\n\nMAX_ASSETS: constant(uint256) = 10\nMAX_LEGOS: constant(uint256) = 10\n\n\n@deploy\ndef __init__(\n    _undyHq: address,\n    _tempGov: address,\n    _minTimeLock: uint256,\n    _maxTimeLock: uint256,\n):\n    gov.__init__(_undyHq, _tempGov, 0, 0, 0)\n    addys.__init__(_undyHq)\n    deptBasics.__init__(False, False)\n    timeLock.__init__(_minTimeLock, _maxTimeLock, 0, _maxTimeLock)\n\n\n####################\n# Add Pending Item #\n####################\n\n\n@external\ndef addPendingKernel(_addr: address) -> bool:\n    assert self._canPerformAction(msg.sender) # dev: no perms\n    return self._addPendingBackpackItem(wcs.BackpackType.WALLET_KERNEL, _addr)\n\n\n@external\ndef addPendingSentinel(_addr: address) -> bool:\n    assert self._canPerformAction(msg.sender) # dev: no perms\n    return self._addPendingBackpackItem(wcs.BackpackType.WALLET_SENTINEL, _addr)\n\n\n@external\ndef addPendingHighCommand(_addr: address) -> bool:\n    assert self._canPerformAction(msg.sender) # dev: no perms\n    return self._addPendingBackpackItem(wcs.BackpackType.WALLET_HIGH_COMMAND, _addr)\n\n\n@external\ndef addPendingPaymaster(_addr: address) -> bool:\n    assert self._canPerformAction(msg.sender) # dev: no perms\n    return self._addPendingBackpackItem(wcs.BackpackType.WALLET_PAYMASTER, _addr)\n\n\n@external\ndef addPendingChequeBook(_addr: address) -> bool:\n    assert self._canPerformAction(msg.sender) # dev: no perms\n    return self._addPendingBackpackItem(wcs.BackpackType.WALLET_CHEQUE_BOOK, _addr)\n\n\n@external\ndef addPendingMigrator(_addr: address) -> bool:\n    assert self._canPerformAction(msg.sender) # dev: no perms\n    return self._addPendingBackpackItem(wcs.BackpackType.WALLET_MIGRATOR, _addr)\n\n\n# add item\n\n\n@internal\ndef _addPendingBackpackItem(_backpackType: wcs.BackpackType, _addr: address) -> bool:\n    assert self.pendingUpdates[_backpackType].actionId == 0 # dev: already pending\n    assert self._canAddBackpackItem(_backpackType, _addr) # dev: invalid item\n\n    aid: uint256 = timeLock._initiateAction()\n    self.pendingUpdates[_backpackType] = PendingBackpackItem(actionId=aid, addr=_addr)\n\n    log PendingBackpackItemAdded(\n        backpackType=_backpackType,\n        addr=_addr,\n        actionId=aid,\n        confirmationBlock=timeLock._getActionConfirmationBlock(aid),\n        addedBy=msg.sender,\n    )\n    return True\n\n\n# validation\n\n\n@view\n@external\ndef canAddBackpackItem(_backpackType: wcs.BackpackType, _addr: address) -> bool:\n    return self._canAddBackpackItem(_backpackType, _addr)\n\n\n@view\n@internal\ndef _canAddBackpackItem(_backpackType: wcs.BackpackType, _addr: address) -> bool:\n    if _backpackType == wcs.BackpackType.WALLET_KERNEL:\n        return self._isValidAddr(_addr, self.kernel)\n    if _backpackType == wcs.BackpackType.WALLET_SENTINEL:\n        return self._isValidSentinel(_addr)\n    elif _backpackType == wcs.BackpackType.WALLET_HIGH_COMMAND:\n        return self._isValidAddr(_addr, self.highCommand)\n    elif _backpackType == wcs.BackpackType.WALLET_PAYMASTER:\n        return self._isValidAddr(_addr, self.paymaster)\n    elif _backpackType == wcs.BackpackType.WALLET_CHEQUE_BOOK:\n        return self._isValidAddr(_addr, self.chequeBook)\n    elif _backpackType == wcs.BackpackType.WALLET_MIGRATOR:\n        return self._isValidAddr(_addr, self.migrator)\n    return False\n\n\n@view\n@internal\ndef _isValidSentinel(_addr: address) -> bool:\n    if not self._isValidAddr(_addr, self.sentinel):\n        return False\n\n    # make sure has all the important interfaces\n    isValid: bool = staticcall Sentinel(_addr).canSignerPerformActionWithConfig(\n        False,\n        False,\n        empty(wcs.ManagerData),\n        empty(wcs.ManagerSettings),\n        empty(wcs.GlobalManagerSettings),\n        ws.ActionType.EARN_DEPOSIT,\n        [],\n        [],\n        empty(address),\n    )\n\n    payeeData: wcs.PayeeData = empty(wcs.PayeeData)\n    isValid, payeeData = staticcall Sentinel(_addr).isValidPayeeAndGetData(\n        False,\n        False,\n        False,\n        empty(address),\n        0,\n        0,\n        empty(wcs.PayeeSettings),\n        empty(wcs.GlobalPayeeSettings),\n        empty(wcs.PayeeData),\n    )\n\n    managerData: wcs.ManagerData = empty(wcs.ManagerData)\n    isValid, managerData = staticcall Sentinel(_addr).checkManagerLimitsPostTx(\n        0,\n        empty(wcs.ManagerLimits),\n        empty(wcs.ManagerLimits),\n        0,\n        empty(wcs.ManagerData),\n        False,\n        empty(address),\n        empty(address),\n        False,\n        empty(wcs.SwapPerms),\n        empty(wcs.SwapPerms),\n        0,\n        0,\n        empty(address),\n    )\n\n    chequeData: wcs.ChequeData = empty(wcs.ChequeData)\n    isValid, chequeData = staticcall Sentinel(_addr).isValidChequeAndGetData(\n        empty(address),\n        0,\n        0,\n        empty(wcs.Cheque),\n        empty(wcs.ChequeSettings),\n        empty(wcs.ChequeData),\n        False,\n    )\n    return True\n\n\n@view\n@internal\ndef _isValidAddr(_addr: address, _prevAddr: address) -> bool:\n    if not _addr.is_contract or _addr == empty(address):\n        return False\n    return _addr != _prevAddr\n\n\n########################\n# Confirm Pending Item #\n########################\n\n\n@external\ndef confirmPendingKernel() -> bool:\n    assert self._canPerformAction(msg.sender) # dev: no perms\n    return self._confirmBackpackItem(wcs.BackpackType.WALLET_KERNEL, msg.sender)\n\n\n@external\ndef confirmPendingSentinel() -> bool:\n    assert self._canPerformAction(msg.sender) # dev: no perms\n    return self._confirmBackpackItem(wcs.BackpackType.WALLET_SENTINEL, msg.sender)\n\n\n@external\ndef confirmPendingHighCommand() -> bool:\n    assert self._canPerformAction(msg.sender) # dev: no perms\n    return self._confirmBackpackItem(wcs.BackpackType.WALLET_HIGH_COMMAND, msg.sender)\n\n\n@external\ndef confirmPendingPaymaster() -> bool:\n    assert self._canPerformAction(msg.sender) # dev: no perms\n    return self._confirmBackpackItem(wcs.BackpackType.WALLET_PAYMASTER, msg.sender)\n\n\n@external\ndef confirmPendingChequeBook() -> bool:\n    assert self._canPerformAction(msg.sender) # dev: no perms\n    return self._confirmBackpackItem(wcs.BackpackType.WALLET_CHEQUE_BOOK, msg.sender)\n\n\n@external\ndef confirmPendingMigrator() -> bool:\n    assert self._canPerformAction(msg.sender) # dev: no perms\n    return self._confirmBackpackItem(wcs.BackpackType.WALLET_MIGRATOR, msg.sender)\n\n\n# confirm new item\n\n\n@internal\ndef _confirmBackpackItem(_backpackType: wcs.BackpackType, _caller: address) -> bool:\n    d: PendingBackpackItem = self.pendingUpdates[_backpackType]\n    assert d.addr != empty(address) # dev: no pending item\n\n    # validate again\n    if not self._canAddBackpackItem(_backpackType, d.addr):\n        self._cancelPendingBackpackItem(_backpackType, _caller)\n        return False\n\n    # check time lock\n    assert timeLock._confirmAction(d.actionId) # dev: time lock not reached\n\n    # zero out pending item\n    self.pendingUpdates[_backpackType] = empty(PendingBackpackItem)\n    self._setBackpackItem(_backpackType, d.addr)\n\n    log BackpackItemConfirmed(\n        backpackType=_backpackType,\n        addr=d.addr,\n        actionId=d.actionId,\n        confirmedBy=_caller,\n    )\n    return True\n\n\n@internal\ndef _setBackpackItem(_backpackType: wcs.BackpackType, _addr: address):\n    if _backpackType == wcs.BackpackType.WALLET_KERNEL:\n        self.kernel = _addr\n    elif _backpackType == wcs.BackpackType.WALLET_SENTINEL:\n        self.sentinel = _addr\n    elif _backpackType == wcs.BackpackType.WALLET_HIGH_COMMAND:\n        self.highCommand = _addr\n    elif _backpackType == wcs.BackpackType.WALLET_PAYMASTER:\n        self.paymaster = _addr\n    elif _backpackType == wcs.BackpackType.WALLET_CHEQUE_BOOK:\n        self.chequeBook = _addr\n    elif _backpackType == wcs.BackpackType.WALLET_MIGRATOR:\n        self.migrator = _addr\n\n    # register in ledger\n    extcall Ledger(addys._getLedgerAddr()).registerBackpackItem(_addr)\n\n\n#######################\n# Cancel Pending Item #\n#######################\n\n\n@external\ndef cancelPendingKernel() -> bool:\n    assert self._canPerformAction(msg.sender) # dev: no perms\n    return self._cancelPendingBackpackItem(wcs.BackpackType.WALLET_KERNEL, msg.sender)\n\n\n@external\ndef cancelPendingSentinel() -> bool:\n    assert self._canPerformAction(msg.sender) # dev: no perms\n    return self._cancelPendingBackpackItem(wcs.BackpackType.WALLET_SENTINEL, msg.sender)\n\n\n@external\ndef cancelPendingHighCommand() -> bool:\n    assert self._canPerformAction(msg.sender) # dev: no perms\n    return self._cancelPendingBackpackItem(wcs.BackpackType.WALLET_HIGH_COMMAND, msg.sender)\n\n\n@external\ndef cancelPendingPaymaster() -> bool:\n    assert self._canPerformAction(msg.sender) # dev: no perms\n    return self._cancelPendingBackpackItem(wcs.BackpackType.WALLET_PAYMASTER, msg.sender)\n\n\n@external\ndef cancelPendingChequeBook() -> bool:\n    assert self._canPerformAction(msg.sender) # dev: no perms\n    return self._cancelPendingBackpackItem(wcs.BackpackType.WALLET_CHEQUE_BOOK, msg.sender)\n\n\n@external\ndef cancelPendingMigrator() -> bool:\n    assert self._canPerformAction(msg.sender) # dev: no perms\n    return self._cancelPendingBackpackItem(wcs.BackpackType.WALLET_MIGRATOR, msg.sender)\n\n\n# cancel pending item\n\n\n@internal\ndef _cancelPendingBackpackItem(_backpackType: wcs.BackpackType, _caller: address) -> bool:\n    d: PendingBackpackItem = self.pendingUpdates[_backpackType]\n\n    assert timeLock._cancelAction(d.actionId) # dev: cannot cancel action\n    self.pendingUpdates[_backpackType] = empty(PendingBackpackItem)\n\n    log PendingBackpackItemCancelled(\n        backpackType=_backpackType,\n        addr=d.addr,\n        actionId=d.actionId,\n        cancelledBy=_caller,\n    )\n    return True\n\n\n#############\n# Utilities #\n#############\n\n\n@view\n@internal\ndef _canPerformAction(_caller: address) -> bool:\n    return gov._canGovern(_caller) and not deptBasics.isPaused\n\n\n@view\n@external\ndef isRegisteredBackpackItem(_addr: address) -> bool:\n    return staticcall Ledger(addys._getLedgerAddr()).isRegisteredBackpackItem(_addr)",
            "sha256sum": "a13782e98768586639859978902c0c89c16a5382ac9af21fae32123ec8b3e553"
          }
        },
        "settings": {
          "outputSelection": {
            "contracts/registries/WalletBackpack.vy": [
              "*"
            ]
          },
          "search_paths": [
            "."
          ]
        },
        "compiler_version": "v0.4.3+commit.bff19ea2",
        "integrity": "c247f325e1f9648aa4ded0846de7933c0e8d8ef0de9d441760703bffbb793df3"
      },
      "args": "00000000000000000000000044cf3c4f000dfd76a35d03298049d37be688d6f90000000000000000000000003ed8174065c00fe511a91850cf8f45d161e8ee150000000000000000000000000000000000000000000000000000000000000e10000000000000000000000000000000000000000000000000000000000013c680",
      "file": "contracts/registries/WalletBackpack.vy"
    },
    "Kernel": {
      "address": "0xAdED981a6Dfc6C3e3E4DbBa54362375FDcF7B389",
      "abi": [
        {
          "name": "WhitelistAddrPending",
          "inputs": [
            {
              "name": "user",
              "type": "address",
              "indexed": true
            },
            {
              "name": "addr",
              "type": "address",
              "indexed": true
            },
            {
              "name": "confirmBlock",
              "type": "uint256",
              "indexed": false
            },
            {
              "name": "addedBy",
              "type": "address",
              "indexed": true
            }
          ],
          "anonymous": false,
          "type": "event"
        },
        {
          "name": "WhitelistAddrConfirmed",
          "inputs": [
            {
              "name": "user",
              "type": "address",
              "indexed": true
            },
            {
              "name": "addr",
              "type": "address",
              "indexed": true
            },
            {
              "name": "initiatedBlock",
              "type": "uint256",
              "indexed": false
            },
            {
              "name": "confirmBlock",
              "type": "uint256",
              "indexed": false
            },
            {
              "name": "confirmedBy",
              "type": "address",
              "indexed": true
            }
          ],
          "anonymous": false,
          "type": "event"
        },
        {
          "name": "WhitelistAddrCancelled",
          "inputs": [
            {
              "name": "user",
              "type": "address",
              "indexed": true
            },
            {
              "name": "addr",
              "type": "address",
              "indexed": true
            },
            {
              "name": "initiatedBlock",
              "type": "uint256",
              "indexed": false
            },
            {
              "name": "confirmBlock",
              "type": "uint256",
              "indexed": false
            },
            {
              "name": "cancelledBy",
              "type": "address",
              "indexed": true
            }
          ],
          "anonymous": false,
          "type": "event"
        },
        {
          "name": "WhitelistAddrRemoved",
          "inputs": [
            {
              "name": "user",
              "type": "address",
              "indexed": true
            },
            {
              "name": "addr",
              "type": "address",
              "indexed": true
            },
            {
              "name": "removedBy",
              "type": "address",
              "indexed": true
            }
          ],
          "anonymous": false,
          "type": "event"
        },
        {
          "stateMutability": "nonpayable",
          "type": "function",
          "name": "addPendingWhitelistAddr",
          "inputs": [
            {
              "name": "_userWallet",
              "type": "address"
            },
            {
              "name": "_whitelistAddr",
              "type": "address"
            }
          ],
          "outputs": []
        },
        {
          "stateMutability": "nonpayable",
          "type": "function",
          "name": "confirmWhitelistAddr",
          "inputs": [
            {
              "name": "_userWallet",
              "type": "address"
            },
            {
              "name": "_whitelistAddr",
              "type": "address"
            }
          ],
          "outputs": []
        },
        {
          "stateMutability": "nonpayable",
          "type": "function",
          "name": "cancelPendingWhitelistAddr",
          "inputs": [
            {
              "name": "_userWallet",
              "type": "address"
            },
            {
              "name": "_whitelistAddr",
              "type": "address"
            }
          ],
          "outputs": []
        },
        {
          "stateMutability": "nonpayable",
          "type": "function",
          "name": "removeWhitelistAddr",
          "inputs": [
            {
              "name": "_userWallet",
              "type": "address"
            },
            {
              "name": "_whitelistAddr",
              "type": "address"
            }
          ],
          "outputs": []
        },
        {
          "stateMutability": "view",
          "type": "function",
          "name": "canManageWhitelist",
          "inputs": [
            {
              "name": "_userWallet",
              "type": "address"
            },
            {
              "name": "_caller",
              "type": "address"
            },
            {
              "name": "_action",
              "type": "uint256"
            }
          ],
          "outputs": [
            {
              "name": "",
              "type": "bool"
            }
          ]
        },
        {
          "stateMutability": "view",
          "type": "function",
          "name": "getWhitelistConfig",
          "inputs": [
            {
              "name": "_userWallet",
              "type": "address"
            },
            {
              "name": "_whitelistAddr",
              "type": "address"
            },
            {
              "name": "_caller",
              "type": "address"
            }
          ],
          "outputs": [
            {
              "name": "",
              "type": "tuple",
              "components": [
                {
                  "name": "owner",
                  "type": "address"
                },
                {
                  "name": "wallet",
                  "type": "address"
                },
                {
                  "name": "isWhitelisted",
                  "type": "bool"
                },
                {
                  "name": "pendingWhitelist",
                  "type": "tuple",
                  "components": [
                    {
                      "name": "initiatedBlock",
                      "type": "uint256"
                    },
                    {
                      "name": "confirmBlock",
                      "type": "uint256"
                    },
                    {
                      "name": "currentOwner",
                      "type": "address"
                    }
                  ]
                },
                {
                  "name": "isExistingPayee",
                  "type": "bool"
                },
                {
                  "name": "isExistingCheque",
                  "type": "bool"
                },
                {
                  "name": "timeLock",
                  "type": "uint256"
                },
                {
                  "name": "walletConfig",
                  "type": "address"
                },
                {
                  "name": "isManager",
                  "type": "bool"
                },
                {
                  "name": "isOwner",
                  "type": "bool"
                },
                {
                  "name": "whitelistPerms",
                  "type": "tuple",
                  "components": [
                    {
                      "name": "canAddPending",
                      "type": "bool"
                    },
                    {
                      "name": "canConfirm",
                      "type": "bool"
                    },
                    {
                      "name": "canCancel",
                      "type": "bool"
                    },
                    {
                      "name": "canRemove",
                      "type": "bool"
                    }
                  ]
                },
                {
                  "name": "globalWhitelistPerms",
                  "type": "tuple",
                  "components": [
                    {
                      "name": "canAddPending",
                      "type": "bool"
                    },
                    {
                      "name": "canConfirm",
                      "type": "bool"
                    },
                    {
                      "name": "canCancel",
                      "type": "bool"
                    },
                    {
                      "name": "canRemove",
                      "type": "bool"
                    }
                  ]
                }
              ]
            }
          ]
        },
        {
          "stateMutability": "view",
          "type": "function",
          "name": "UNDY_HQ",
          "inputs": [],
          "outputs": [
            {
              "name": "",
              "type": "address"
            }
          ]
        },
        {
          "stateMutability": "nonpayable",
          "type": "constructor",
          "inputs": [
            {
              "name": "_undyHq",
              "type": "address"
            }
          ],
          "outputs": []
        }
      ],
      "solc_json": {
        "language": "Vyper",
        "sources": {
          "interfaces/WalletConfigStructs.vyi": {
            "content": "# @version 0.4.3\n\nMAX_CONFIG_ASSETS: constant(uint256) = 40\nMAX_CONFIG_LEGOS: constant(uint256) = 25\nMAX_ALLOWED_PAYEES: constant(uint256) = 40\n\nflag WhitelistAction:\n    ADD_PENDING\n    CONFIRM_WHITELIST\n    CANCEL_WHITELIST\n    REMOVE_WHITELIST\n\nflag BackpackType:\n    WALLET_KERNEL\n    WALLET_SENTINEL\n    WALLET_HIGH_COMMAND\n    WALLET_PAYMASTER\n    WALLET_CHEQUE_BOOK\n    WALLET_MIGRATOR\n\n# payees\n\nstruct PayeeData:\n    numTxsInPeriod: uint256\n    totalUnitsInPeriod: uint256\n    totalUsdValueInPeriod: uint256\n    totalNumTxs: uint256\n    totalUnits: uint256\n    totalUsdValue: uint256\n    lastTxBlock: uint256\n    periodStartBlock: uint256\n\nstruct PayeeSettings:\n    startBlock: uint256\n    expiryBlock: uint256\n    canPull: bool\n    periodLength: uint256\n    maxNumTxsPerPeriod: uint256\n    txCooldownBlocks: uint256\n    failOnZeroPrice: bool\n    primaryAsset: address\n    onlyPrimaryAsset: bool\n    unitLimits: PayeeLimits\n    usdLimits: PayeeLimits\n\nstruct GlobalPayeeSettings:\n    defaultPeriodLength: uint256\n    startDelay: uint256\n    activationLength: uint256\n    maxNumTxsPerPeriod: uint256\n    txCooldownBlocks: uint256\n    failOnZeroPrice: bool\n    usdLimits: PayeeLimits\n    canPayOwner: bool\n    canPull: bool\n\nstruct PayeeLimits:\n    perTxCap: uint256\n    perPeriodCap: uint256\n    lifetimeCap: uint256\n\nstruct PendingPayee:\n    settings: PayeeSettings\n    initiatedBlock: uint256\n    confirmBlock: uint256\n    currentOwner: address\n\nstruct PayeeManagementBundle:\n    owner: address\n    wallet: address\n    isRegisteredPayee: bool\n    isWhitelisted: bool\n    isExistingCheque: bool\n    payeeSettings: PayeeSettings\n    globalPayeeSettings: GlobalPayeeSettings\n    timeLock: uint256\n    walletConfig: address\n\nstruct RecipientConfigBundle:\n    isWhitelisted: bool\n    isOwner: bool\n    isPayee: bool\n    config: PayeeSettings\n    globalConfig: GlobalPayeeSettings\n    data: PayeeData\n\nstruct WhitelistConfigBundle:\n    owner: address\n    wallet: address\n    isWhitelisted: bool\n    pendingWhitelist: PendingWhitelist\n    isExistingPayee: bool\n    isExistingCheque: bool\n    timeLock: uint256\n    walletConfig: address\n    isManager: bool\n    isOwner: bool\n    whitelistPerms: WhitelistPerms\n    globalWhitelistPerms: WhitelistPerms\n\nstruct PendingWhitelist:\n    initiatedBlock: uint256\n    confirmBlock: uint256\n    currentOwner: address\n\n# cheques\n\nstruct Cheque:\n    recipient: address\n    asset: address\n    amount: uint256\n    creationBlock: uint256\n    unlockBlock: uint256\n    expiryBlock: uint256\n    usdValueOnCreation: uint256\n    canManagerPay: bool\n    canBePulled: bool\n    creator: address\n    active: bool\n\nstruct ChequeSettings:\n    maxNumActiveCheques: uint256\n    maxChequeUsdValue: uint256\n    instantUsdThreshold: uint256\n    perPeriodPaidUsdCap: uint256\n    maxNumChequesPaidPerPeriod: uint256\n    payCooldownBlocks: uint256\n    perPeriodCreatedUsdCap: uint256\n    maxNumChequesCreatedPerPeriod: uint256\n    createCooldownBlocks: uint256\n    periodLength: uint256\n    expensiveDelayBlocks: uint256\n    defaultExpiryBlocks: uint256\n    allowedAssets: DynArray[address, MAX_CONFIG_ASSETS]\n    canManagersCreateCheques: bool\n    canManagerPay: bool\n    canBePulled: bool\n\nstruct ChequeData:\n    numChequesPaidInPeriod: uint256\n    totalUsdValuePaidInPeriod: uint256\n    totalNumChequesPaid: uint256\n    totalUsdValuePaid: uint256\n    lastChequePaidBlock: uint256\n    numChequesCreatedInPeriod: uint256\n    totalUsdValueCreatedInPeriod: uint256\n    totalNumChequesCreated: uint256\n    totalUsdValueCreated: uint256\n    lastChequeCreatedBlock: uint256\n    periodStartBlock: uint256\n\nstruct ChequeManagementBundle:\n    wallet: address\n    walletConfig: address\n    owner: address\n    isRecipientOnWhitelist: bool\n    isCreatorManager: bool\n    managerSettings: ManagerSettings\n    chequeSettings: ChequeSettings\n    chequeData: ChequeData\n    isExistingCheque: bool\n    numActiveCheques: uint256\n    isExistingPayee: bool\n    timeLock: uint256\n\n# managers\n\nstruct ManagerData:\n    numTxsInPeriod: uint256\n    totalUsdValueInPeriod: uint256\n    totalNumTxs: uint256\n    totalUsdValue: uint256\n    lastTxBlock: uint256\n    periodStartBlock: uint256\n    numSwapsInPeriod: uint256\n\nstruct ManagerSettings:\n    startBlock: uint256\n    expiryBlock: uint256\n    limits: ManagerLimits\n    legoPerms: LegoPerms\n    swapPerms: SwapPerms\n    whitelistPerms: WhitelistPerms\n    transferPerms: TransferPerms\n    allowedAssets: DynArray[address, MAX_CONFIG_ASSETS]\n    canClaimLoot: bool\n\nstruct GlobalManagerSettings:\n    managerPeriod: uint256\n    startDelay: uint256\n    activationLength: uint256\n    canOwnerManage: bool\n    limits: ManagerLimits\n    legoPerms: LegoPerms\n    swapPerms: SwapPerms\n    whitelistPerms: WhitelistPerms\n    transferPerms: TransferPerms\n    allowedAssets: DynArray[address, MAX_CONFIG_ASSETS]\n\nstruct ManagerLimits:\n    maxUsdValuePerTx: uint256\n    maxUsdValuePerPeriod: uint256\n    maxUsdValueLifetime: uint256\n    maxNumTxsPerPeriod: uint256\n    txCooldownBlocks: uint256\n    failOnZeroPrice: bool\n\nstruct LegoPerms:\n    canManageYield: bool\n    canBuyAndSell: bool\n    canManageDebt: bool\n    canManageLiq: bool\n    canClaimRewards: bool\n    onlyApprovedYieldOpps: bool\n    allowedLegos: DynArray[uint256, MAX_CONFIG_LEGOS]\n\nstruct SwapPerms:\n    mustHaveUsdValue: bool\n    maxNumSwapsPerPeriod: uint256\n    maxSlippage: uint256\n\nstruct WhitelistPerms:\n    canAddPending: bool\n    canConfirm: bool\n    canCancel: bool\n    canRemove: bool\n\nstruct TransferPerms:\n    canTransfer: bool\n    canCreateCheque: bool\n    canAddPendingPayee: bool\n    allowedPayees: DynArray[address, MAX_ALLOWED_PAYEES]\n\nstruct ManagerConfigBundle:\n    isOwner: bool\n    isManager: bool\n    config: ManagerSettings\n    globalConfig: GlobalManagerSettings\n    data: ManagerData\n    payee: address\n\nstruct ManagerSettingsBundle:\n    owner: address\n    isManager: bool\n    timeLock: uint256\n    walletConfig: address\n    legoBook: address\n    globalManagerSettings: GlobalManagerSettings\n\n# migration\n\nstruct MigrationConfigBundle:\n    owner: address\n    isFrozen: bool\n    numPayees: uint256\n    numWhitelisted: uint256\n    numManagers: uint256\n    startingAgent: address\n    startingAgentIndex: uint256\n    hasPendingOwnerChange: bool\n    groupId: uint256\n    numActiveCheques: uint256\n",
            "sha256sum": "31165468feeac632a1376c70970ce5124f8951392c4deaa01a26176c7f26718a"
          },
          "contracts/core/walletBackpack/Kernel.vy": {
            "content": "#    \u2513 \u250f  \u2513\u2513   \n#    \u2503\u2503\u2503\u250f\u2513\u2503\u2503\u250f\u2513\u254b\n#    \u2517\u253b\u251b\u2517\u253b\u2517\u2517\u2517 \u2517\n#     __  __   ______   ______   __   __   ______   __        \n#    /\\ \\/ /  /\\  ___\\ /\\  == \\ /\\ \"-.\\ \\ /\\  ___\\ /\\ \\       \n#    \\ \\  _\"-.\\ \\  __\\ \\ \\  __< \\ \\ \\-.  \\\\ \\  __\\ \\ \\ \\____  \n#     \\ \\_\\ \\_\\\\ \\_____\\\\ \\_\\ \\_\\\\ \\_\\\\\"\\_\\\\ \\_____\\\\ \\_____\\ \n#      \\/_/\\/_/ \\/_____/ \\/_/ /_/ \\/_/ \\/_/ \\/_____/ \\/_____/ \n#                                                         \n#     \u2554\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2557\n#     \u2551  ** Kernel **                             \u2551\n#     \u2551  Whitelist management for user wallets.   \u2551\n#     \u255a\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u255d\n#\n#     Underscore Protocol License: https://github.com/underscore-finance/underscore-protocol/blob/master/LICENSE.md\n\n# @version 0.4.3\n\nfrom interfaces import WalletConfigStructs as wcs\n\ninterface UserWalletConfig:\n    def addPendingWhitelistAddr(_addr: address, _pending: wcs.PendingWhitelist): nonpayable\n    def pendingWhitelist(_addr: address) -> wcs.PendingWhitelist: view\n    def managerSettings(_addr: address) -> wcs.ManagerSettings: view\n    def globalManagerSettings() -> wcs.GlobalManagerSettings: view\n    def cancelPendingWhitelistAddr(_addr: address): nonpayable\n    def indexOfWhitelist(_addr: address) -> uint256: view\n    def confirmWhitelistAddr(_addr: address): nonpayable\n    def removeWhitelistAddr(_addr: address): nonpayable\n    def indexOfManager(_addr: address) -> uint256: view\n    def indexOfPayee(_addr: address) -> uint256: view\n    def cheques(_addr: address) -> wcs.Cheque: view\n    def timeLock() -> uint256: view\n    def wallet() -> address: view\n    def owner() -> address: view\n\ninterface MissionControl:\n    def canPerformSecurityAction(_addr: address) -> bool: view\n\ninterface Ledger:\n    def isUserWallet(_user: address) -> bool: view\n\ninterface Registry:\n    def getAddr(_regId: uint256) -> address: view\n\ninterface UserWallet:\n    def walletConfig() -> address: view\n\nevent WhitelistAddrPending:\n    user: indexed(address)\n    addr: indexed(address)\n    confirmBlock: uint256\n    addedBy: indexed(address)\n\nevent WhitelistAddrConfirmed:\n    user: indexed(address)\n    addr: indexed(address)\n    initiatedBlock: uint256\n    confirmBlock: uint256\n    confirmedBy: indexed(address)\n\nevent WhitelistAddrCancelled:\n    user: indexed(address)\n    addr: indexed(address)\n    initiatedBlock: uint256\n    confirmBlock: uint256\n    cancelledBy: indexed(address)\n\nevent WhitelistAddrRemoved:\n    user: indexed(address)\n    addr: indexed(address)\n    removedBy: indexed(address)\n\nUNDY_HQ: public(immutable(address))\nLEDGER_ID: constant(uint256) = 1\nMISSION_CONTROL_ID: constant(uint256) = 2\n\n\n@deploy\ndef __init__(_undyHq: address):\n    assert _undyHq != empty(address) # dev: invalid undy hq\n    UNDY_HQ = _undyHq\n\n\n########################\n# Whitelist Management #\n########################\n\n\n# add whitelist\n\n\n@external\ndef addPendingWhitelistAddr(_userWallet: address, _whitelistAddr: address):\n    assert self._isValidUserWallet(_userWallet) # dev: invalid user wallet\n\n    # validate permissions\n    c: wcs.WhitelistConfigBundle = self._getWhitelistConfig(_userWallet, _whitelistAddr, msg.sender)\n    assert self._canManageWhitelist(c.isOwner, c.isManager, wcs.WhitelistAction.ADD_PENDING, c.whitelistPerms, c.globalWhitelistPerms) # dev: no perms\n\n    # validate input\n    assert _whitelistAddr not in [empty(address), c.wallet, c.owner, c.walletConfig] # dev: invalid addr\n    assert not c.isWhitelisted # dev: already whitelisted\n    assert c.pendingWhitelist.initiatedBlock == 0 # dev: pending whitelist already exists\n\n    # cannot whitelist payee or active cheque recipient\n    assert not c.isExistingPayee # dev: already payee\n    assert not c.isExistingCheque # dev: already cheque recipient\n\n    # under time lock\n    confirmBlock: uint256 = block.number + c.timeLock\n    c.pendingWhitelist = wcs.PendingWhitelist(\n        initiatedBlock = block.number,\n        confirmBlock = confirmBlock,\n        currentOwner = c.owner,\n    )\n    extcall UserWalletConfig(c.walletConfig).addPendingWhitelistAddr(_whitelistAddr, c.pendingWhitelist)\n\n    log WhitelistAddrPending(user = _userWallet, addr = _whitelistAddr, confirmBlock = confirmBlock, addedBy = msg.sender)\n\n\n# confirm whitelist\n\n\n@external\ndef confirmWhitelistAddr(_userWallet: address, _whitelistAddr: address):\n    assert self._isValidUserWallet(_userWallet) # dev: invalid user wallet\n\n    c: wcs.WhitelistConfigBundle = self._getWhitelistConfig(_userWallet, _whitelistAddr, msg.sender)\n    assert self._canManageWhitelist(c.isOwner, c.isManager, wcs.WhitelistAction.CONFIRM_WHITELIST, c.whitelistPerms, c.globalWhitelistPerms) # dev: no perms\n\n    assert c.pendingWhitelist.initiatedBlock != 0 # dev: no pending whitelist\n    assert c.pendingWhitelist.confirmBlock != 0 and block.number >= c.pendingWhitelist.confirmBlock # dev: time delay not reached\n    assert c.pendingWhitelist.currentOwner == c.owner # dev: owner must match\n\n    # cannot whitelist payee or active cheque recipient\n    assert not c.isExistingPayee # dev: already payee\n    assert not c.isExistingCheque # dev: already cheque recipient\n\n    extcall UserWalletConfig(c.walletConfig).confirmWhitelistAddr(_whitelistAddr)\n    log WhitelistAddrConfirmed(user = _userWallet, addr = _whitelistAddr, initiatedBlock = c.pendingWhitelist.initiatedBlock, confirmBlock = c.pendingWhitelist.confirmBlock, confirmedBy = msg.sender)\n\n\n# cancel pending whitelist\n\n\n@external\ndef cancelPendingWhitelistAddr(_userWallet: address, _whitelistAddr: address):\n    assert self._isValidUserWallet(_userWallet) # dev: invalid user wallet\n\n    c: wcs.WhitelistConfigBundle = self._getWhitelistConfig(_userWallet, _whitelistAddr, msg.sender)\n    if not self._canManageWhitelist(c.isOwner, c.isManager, wcs.WhitelistAction.CANCEL_WHITELIST, c.whitelistPerms, c.globalWhitelistPerms):\n        assert self._canPerformSecurityAction(msg.sender) # dev: no perms\n\n    assert c.pendingWhitelist.initiatedBlock != 0 # dev: no pending whitelist\n    extcall UserWalletConfig(c.walletConfig).cancelPendingWhitelistAddr(_whitelistAddr)\n\n    log WhitelistAddrCancelled(user = _userWallet, addr = _whitelistAddr, initiatedBlock = c.pendingWhitelist.initiatedBlock, confirmBlock = c.pendingWhitelist.confirmBlock, cancelledBy = msg.sender)\n\n\n# remove whitelist\n\n\n@external\ndef removeWhitelistAddr(_userWallet: address, _whitelistAddr: address):\n    assert self._isValidUserWallet(_userWallet) # dev: invalid user wallet\n\n    c: wcs.WhitelistConfigBundle = self._getWhitelistConfig(_userWallet, _whitelistAddr, msg.sender)\n    if not self._canManageWhitelist(c.isOwner, c.isManager, wcs.WhitelistAction.REMOVE_WHITELIST, c.whitelistPerms, c.globalWhitelistPerms):\n        assert self._canPerformSecurityAction(msg.sender) # dev: no perms\n\n    assert c.isWhitelisted # dev: not whitelisted\n    extcall UserWalletConfig(c.walletConfig).removeWhitelistAddr(_whitelistAddr)\n\n    log WhitelistAddrRemoved(user = _userWallet, addr = _whitelistAddr, removedBy = msg.sender)\n\n\n# can manage whitelist\n\n\n@view\n@external\ndef canManageWhitelist(\n    _userWallet: address,\n    _caller: address,\n    _action: wcs.WhitelistAction,\n) -> bool:\n    c: wcs.WhitelistConfigBundle = self._getWhitelistConfig(_userWallet, empty(address), _caller)\n    return self._canManageWhitelist(c.isOwner, c.isManager, _action, c.whitelistPerms, c.globalWhitelistPerms)\n\n\n@view\n@internal\ndef _canManageWhitelist(\n    _isOwner: bool,\n    _isManager: bool,\n    _action: wcs.WhitelistAction,\n    _config: wcs.WhitelistPerms,\n    _globalConfig: wcs.WhitelistPerms,\n) -> bool:\n\n    # owner can manage whitelist\n    if _isOwner:\n        return True\n\n    # if not a manager, cannot manage whitelist\n    if not _isManager:\n        return False \n\n    # add to whitelist\n    if _action == wcs.WhitelistAction.ADD_PENDING:\n        return _config.canAddPending and _globalConfig.canAddPending\n\n    # confirm whitelist\n    elif _action == wcs.WhitelistAction.CONFIRM_WHITELIST:\n        return _config.canConfirm and _globalConfig.canConfirm\n\n    # cancel whitelist\n    elif _action == wcs.WhitelistAction.CANCEL_WHITELIST:\n        return _config.canCancel and _globalConfig.canCancel\n\n    # remove from whitelist\n    elif _action == wcs.WhitelistAction.REMOVE_WHITELIST:\n        return _config.canRemove and _globalConfig.canRemove\n\n    # invalid action\n    else:\n        return False\n\n\n# get whitelist config\n\n\n@view\n@external\ndef getWhitelistConfig(_userWallet: address, _whitelistAddr: address, _caller: address) -> wcs.WhitelistConfigBundle:\n    return self._getWhitelistConfig(_userWallet, _whitelistAddr, _caller)\n\n\n@view\n@internal\ndef _getWhitelistConfig(_userWallet: address, _whitelistAddr: address, _caller: address) -> wcs.WhitelistConfigBundle:\n    walletConfig: address = staticcall UserWallet(_userWallet).walletConfig()\n    managerSettings: wcs.ManagerSettings = staticcall UserWalletConfig(walletConfig).managerSettings(_caller)\n    globalManagerSettings: wcs.GlobalManagerSettings = staticcall UserWalletConfig(walletConfig).globalManagerSettings()\n    owner: address = staticcall UserWalletConfig(walletConfig).owner()\n\n    cheque: wcs.Cheque = staticcall UserWalletConfig(walletConfig).cheques(_whitelistAddr)\n    return wcs.WhitelistConfigBundle(\n        owner = owner,\n        wallet = staticcall UserWalletConfig(walletConfig).wallet(),\n        isWhitelisted = staticcall UserWalletConfig(walletConfig).indexOfWhitelist(_whitelistAddr) != 0,\n        pendingWhitelist = staticcall UserWalletConfig(walletConfig).pendingWhitelist(_whitelistAddr),\n        isExistingPayee = staticcall UserWalletConfig(walletConfig).indexOfPayee(_whitelistAddr) != 0,\n        isExistingCheque = cheque.active,\n        timeLock = staticcall UserWalletConfig(walletConfig).timeLock(),\n        walletConfig = walletConfig,\n        isManager = staticcall UserWalletConfig(walletConfig).indexOfManager(_caller) != 0,\n        isOwner = _caller == owner,\n        whitelistPerms = managerSettings.whitelistPerms,\n        globalWhitelistPerms = globalManagerSettings.whitelistPerms,\n    )\n\n\n#############\n# Utilities #\n#############\n\n\n# is valid user wallet\n\n\n@view\n@internal\ndef _isValidUserWallet(_userWallet: address) -> bool:\n    ledger: address = staticcall Registry(UNDY_HQ).getAddr(LEDGER_ID)\n    return staticcall Ledger(ledger).isUserWallet(_userWallet)\n\n\n# can perform security action\n\n\n@view\n@internal\ndef _canPerformSecurityAction(_addr: address) -> bool:\n    missionControl: address = staticcall Registry(UNDY_HQ).getAddr(MISSION_CONTROL_ID)\n    if missionControl == empty(address):\n        return False\n    return staticcall MissionControl(missionControl).canPerformSecurityAction(_addr)\n",
            "sha256sum": "7b6b73ade605e6a07faa8aae0d95f376bddfb259ae6a52881ebd00fb78f936f9"
          }
        },
        "settings": {
          "outputSelection": {
            "contracts/core/walletBackpack/Kernel.vy": [
              "*"
            ]
          },
          "search_paths": [
            "."
          ]
        },
        "compiler_version": "v0.4.3+commit.bff19ea2",
        "integrity": "62a97a689e9521df25c39df81f1e5c8635b2bb9131a2b343736c3ecce521d44d"
      },
      "args": "00000000000000000000000044cf3c4f000dfd76a35d03298049d37be688d6f9",
      "file": "contracts/core/walletBackpack/Kernel.vy"
    },
    "HighCommand": {
      "address": "0x06492EA8F83B3a61d71B61FEEF7F167aDD9A78EC",
      "abi": [
        {
          "name": "GlobalManagerSettingsModified",
          "inputs": [
            {
              "name": "user",
              "type": "address",
              "indexed": true
            },
            {
              "name": "managerPeriod",
              "type": "uint256",
              "indexed": false
            },
            {
              "name": "startDelay",
              "type": "uint256",
              "indexed": false
            },
            {
              "name": "activationLength",
              "type": "uint256",
              "indexed": false
            },
            {
              "name": "canOwnerManage",
              "type": "bool",
              "indexed": false
            },
            {
              "name": "maxUsdValuePerTx",
              "type": "uint256",
              "indexed": false
            },
            {
              "name": "maxUsdValuePerPeriod",
              "type": "uint256",
              "indexed": false
            },
            {
              "name": "maxUsdValueLifetime",
              "type": "uint256",
              "indexed": false
            },
            {
              "name": "maxNumTxsPerPeriod",
              "type": "uint256",
              "indexed": false
            },
            {
              "name": "txCooldownBlocks",
              "type": "uint256",
              "indexed": false
            },
            {
              "name": "failOnZeroPrice",
              "type": "bool",
              "indexed": false
            },
            {
              "name": "canManageYield",
              "type": "bool",
              "indexed": false
            },
            {
              "name": "canBuyAndSell",
              "type": "bool",
              "indexed": false
            },
            {
              "name": "canManageDebt",
              "type": "bool",
              "indexed": false
            },
            {
              "name": "canManageLiq",
              "type": "bool",
              "indexed": false
            },
            {
              "name": "canClaimRewards",
              "type": "bool",
              "indexed": false
            },
            {
              "name": "numAllowedLegos",
              "type": "uint256",
              "indexed": false
            },
            {
              "name": "canAddPendingWhitelist",
              "type": "bool",
              "indexed": false
            },
            {
              "name": "canConfirmWhitelist",
              "type": "bool",
              "indexed": false
            },
            {
              "name": "canCancelWhitelist",
              "type": "bool",
              "indexed": false
            },
            {
              "name": "canRemoveWhitelist",
              "type": "bool",
              "indexed": false
            },
            {
              "name": "canTransfer",
              "type": "bool",
              "indexed": false
            },
            {
              "name": "canCreateCheque",
              "type": "bool",
              "indexed": false
            },
            {
              "name": "canAddPendingPayee",
              "type": "bool",
              "indexed": false
            },
            {
              "name": "numAllowedRecipients",
              "type": "uint256",
              "indexed": false
            },
            {
              "name": "numAllowedAssets",
              "type": "uint256",
              "indexed": false
            }
          ],
          "anonymous": false,
          "type": "event"
        },
        {
          "name": "ManagerSettingsModified",
          "inputs": [
            {
              "name": "user",
              "type": "address",
              "indexed": true
            },
            {
              "name": "manager",
              "type": "address",
              "indexed": true
            },
            {
              "name": "startBlock",
              "type": "uint256",
              "indexed": false
            },
            {
              "name": "expiryBlock",
              "type": "uint256",
              "indexed": false
            },
            {
              "name": "maxUsdValuePerTx",
              "type": "uint256",
              "indexed": false
            },
            {
              "name": "maxUsdValuePerPeriod",
              "type": "uint256",
              "indexed": false
            },
            {
              "name": "maxUsdValueLifetime",
              "type": "uint256",
              "indexed": false
            },
            {
              "name": "maxNumTxsPerPeriod",
              "type": "uint256",
              "indexed": false
            },
            {
              "name": "txCooldownBlocks",
              "type": "uint256",
              "indexed": false
            },
            {
              "name": "failOnZeroPrice",
              "type": "bool",
              "indexed": false
            },
            {
              "name": "canManageYield",
              "type": "bool",
              "indexed": false
            },
            {
              "name": "canBuyAndSell",
              "type": "bool",
              "indexed": false
            },
            {
              "name": "canManageDebt",
              "type": "bool",
              "indexed": false
            },
            {
              "name": "canManageLiq",
              "type": "bool",
              "indexed": false
            },
            {
              "name": "canClaimRewards",
              "type": "bool",
              "indexed": false
            },
            {
              "name": "numAllowedLegos",
              "type": "uint256",
              "indexed": false
            },
            {
              "name": "canAddPendingWhitelist",
              "type": "bool",
              "indexed": false
            },
            {
              "name": "canConfirmWhitelist",
              "type": "bool",
              "indexed": false
            },
            {
              "name": "canCancelWhitelist",
              "type": "bool",
              "indexed": false
            },
            {
              "name": "canRemoveWhitelist",
              "type": "bool",
              "indexed": false
            },
            {
              "name": "canTransfer",
              "type": "bool",
              "indexed": false
            },
            {
              "name": "canCreateCheque",
              "type": "bool",
              "indexed": false
            },
            {
              "name": "canAddPendingPayee",
              "type": "bool",
              "indexed": false
            },
            {
              "name": "numAllowedRecipients",
              "type": "uint256",
              "indexed": false
            },
            {
              "name": "numAllowedAssets",
              "type": "uint256",
              "indexed": false
            },
            {
              "name": "canClaimLoot",
              "type": "bool",
              "indexed": false
            }
          ],
          "anonymous": false,
          "type": "event"
        },
        {
          "name": "ManagerRemoved",
          "inputs": [
            {
              "name": "user",
              "type": "address",
              "indexed": true
            },
            {
              "name": "manager",
              "type": "address",
              "indexed": true
            }
          ],
          "anonymous": false,
          "type": "event"
        },
        {
          "name": "ManagerActivationLengthAdjusted",
          "inputs": [
            {
              "name": "user",
              "type": "address",
              "indexed": true
            },
            {
              "name": "manager",
              "type": "address",
              "indexed": true
            },
            {
              "name": "activationLength",
              "type": "uint256",
              "indexed": false
            },
            {
              "name": "didRestart",
              "type": "bool",
              "indexed": false
            }
          ],
          "anonymous": false,
          "type": "event"
        },
        {
          "stateMutability": "nonpayable",
          "type": "function",
          "name": "addManager",
          "inputs": [
            {
              "name": "_userWallet",
              "type": "address"
            },
            {
              "name": "_manager",
              "type": "address"
            },
            {
              "name": "_limits",
              "type": "tuple",
              "components": [
                {
                  "name": "maxUsdValuePerTx",
                  "type": "uint256"
                },
                {
                  "name": "maxUsdValuePerPeriod",
                  "type": "uint256"
                },
                {
                  "name": "maxUsdValueLifetime",
                  "type": "uint256"
                },
                {
                  "name": "maxNumTxsPerPeriod",
                  "type": "uint256"
                },
                {
                  "name": "txCooldownBlocks",
                  "type": "uint256"
                },
                {
                  "name": "failOnZeroPrice",
                  "type": "bool"
                }
              ]
            },
            {
              "name": "_legoPerms",
              "type": "tuple",
              "components": [
                {
                  "name": "canManageYield",
                  "type": "bool"
                },
                {
                  "name": "canBuyAndSell",
                  "type": "bool"
                },
                {
                  "name": "canManageDebt",
                  "type": "bool"
                },
                {
                  "name": "canManageLiq",
                  "type": "bool"
                },
                {
                  "name": "canClaimRewards",
                  "type": "bool"
                },
                {
                  "name": "onlyApprovedYieldOpps",
                  "type": "bool"
                },
                {
                  "name": "allowedLegos",
                  "type": "uint256[]"
                }
              ]
            },
            {
              "name": "_swapPerms",
              "type": "tuple",
              "components": [
                {
                  "name": "mustHaveUsdValue",
                  "type": "bool"
                },
                {
                  "name": "maxNumSwapsPerPeriod",
                  "type": "uint256"
                },
                {
                  "name": "maxSlippage",
                  "type": "uint256"
                }
              ]
            },
            {
              "name": "_whitelistPerms",
              "type": "tuple",
              "components": [
                {
                  "name": "canAddPending",
                  "type": "bool"
                },
                {
                  "name": "canConfirm",
                  "type": "bool"
                },
                {
                  "name": "canCancel",
                  "type": "bool"
                },
                {
                  "name": "canRemove",
                  "type": "bool"
                }
              ]
            },
            {
              "name": "_transferPerms",
              "type": "tuple",
              "components": [
                {
                  "name": "canTransfer",
                  "type": "bool"
                },
                {
                  "name": "canCreateCheque",
                  "type": "bool"
                },
                {
                  "name": "canAddPendingPayee",
                  "type": "bool"
                },
                {
                  "name": "allowedPayees",
                  "type": "address[]"
                }
              ]
            },
            {
              "name": "_allowedAssets",
              "type": "address[]"
            },
            {
              "name": "_canClaimLoot",
              "type": "bool"
            }
          ],
          "outputs": [
            {
              "name": "",
              "type": "bool"
            }
          ]
        },
        {
          "stateMutability": "nonpayable",
          "type": "function",
          "name": "addManager",
          "inputs": [
            {
              "name": "_userWallet",
              "type": "address"
            },
            {
              "name": "_manager",
              "type": "address"
            },
            {
              "name": "_limits",
              "type": "tuple",
              "components": [
                {
                  "name": "maxUsdValuePerTx",
                  "type": "uint256"
                },
                {
                  "name": "maxUsdValuePerPeriod",
                  "type": "uint256"
                },
                {
                  "name": "maxUsdValueLifetime",
                  "type": "uint256"
                },
                {
                  "name": "maxNumTxsPerPeriod",
                  "type": "uint256"
                },
                {
                  "name": "txCooldownBlocks",
                  "type": "uint256"
                },
                {
                  "name": "failOnZeroPrice",
                  "type": "bool"
                }
              ]
            },
            {
              "name": "_legoPerms",
              "type": "tuple",
              "components": [
                {
                  "name": "canManageYield",
                  "type": "bool"
                },
                {
                  "name": "canBuyAndSell",
                  "type": "bool"
                },
                {
                  "name": "canManageDebt",
                  "type": "bool"
                },
                {
                  "name": "canManageLiq",
                  "type": "bool"
                },
                {
                  "name": "canClaimRewards",
                  "type": "bool"
                },
                {
                  "name": "onlyApprovedYieldOpps",
                  "type": "bool"
                },
                {
                  "name": "allowedLegos",
                  "type": "uint256[]"
                }
              ]
            },
            {
              "name": "_swapPerms",
              "type": "tuple",
              "components": [
                {
                  "name": "mustHaveUsdValue",
                  "type": "bool"
                },
                {
                  "name": "maxNumSwapsPerPeriod",
                  "type": "uint256"
                },
                {
                  "name": "maxSlippage",
                  "type": "uint256"
                }
              ]
            },
            {
              "name": "_whitelistPerms",
              "type": "tuple",
              "components": [
                {
                  "name": "canAddPending",
                  "type": "bool"
                },
                {
                  "name": "canConfirm",
                  "type": "bool"
                },
                {
                  "name": "canCancel",
                  "type": "bool"
                },
                {
                  "name": "canRemove",
                  "type": "bool"
                }
              ]
            },
            {
              "name": "_transferPerms",
              "type": "tuple",
              "components": [
                {
                  "name": "canTransfer",
                  "type": "bool"
                },
                {
                  "name": "canCreateCheque",
                  "type": "bool"
                },
                {
                  "name": "canAddPendingPayee",
                  "type": "bool"
                },
                {
                  "name": "allowedPayees",
                  "type": "address[]"
                }
              ]
            },
            {
              "name": "_allowedAssets",
              "type": "address[]"
            },
            {
              "name": "_canClaimLoot",
              "type": "bool"
            },
            {
              "name": "_startDelay",
              "type": "uint256"
            }
          ],
          "outputs": [
            {
              "name": "",
              "type": "bool"
            }
          ]
        },
        {
          "stateMutability": "nonpayable",
          "type": "function",
          "name": "addManager",
          "inputs": [
            {
              "name": "_userWallet",
              "type": "address"
            },
            {
              "name": "_manager",
              "type": "address"
            },
            {
              "name": "_limits",
              "type": "tuple",
              "components": [
                {
                  "name": "maxUsdValuePerTx",
                  "type": "uint256"
                },
                {
                  "name": "maxUsdValuePerPeriod",
                  "type": "uint256"
                },
                {
                  "name": "maxUsdValueLifetime",
                  "type": "uint256"
                },
                {
                  "name": "maxNumTxsPerPeriod",
                  "type": "uint256"
                },
                {
                  "name": "txCooldownBlocks",
                  "type": "uint256"
                },
                {
                  "name": "failOnZeroPrice",
                  "type": "bool"
                }
              ]
            },
            {
              "name": "_legoPerms",
              "type": "tuple",
              "components": [
                {
                  "name": "canManageYield",
                  "type": "bool"
                },
                {
                  "name": "canBuyAndSell",
                  "type": "bool"
                },
                {
                  "name": "canManageDebt",
                  "type": "bool"
                },
                {
                  "name": "canManageLiq",
                  "type": "bool"
                },
                {
                  "name": "canClaimRewards",
                  "type": "bool"
                },
                {
                  "name": "onlyApprovedYieldOpps",
                  "type": "bool"
                },
                {
                  "name": "allowedLegos",
                  "type": "uint256[]"
                }
              ]
            },
            {
              "name": "_swapPerms",
              "type": "tuple",
              "components": [
                {
                  "name": "mustHaveUsdValue",
                  "type": "bool"
                },
                {
                  "name": "maxNumSwapsPerPeriod",
                  "type": "uint256"
                },
                {
                  "name": "maxSlippage",
                  "type": "uint256"
                }
              ]
            },
            {
              "name": "_whitelistPerms",
              "type": "tuple",
              "components": [
                {
                  "name": "canAddPending",
                  "type": "bool"
                },
                {
                  "name": "canConfirm",
                  "type": "bool"
                },
                {
                  "name": "canCancel",
                  "type": "bool"
                },
                {
                  "name": "canRemove",
                  "type": "bool"
                }
              ]
            },
            {
              "name": "_transferPerms",
              "type": "tuple",
              "components": [
                {
                  "name": "canTransfer",
                  "type": "bool"
                },
                {
                  "name": "canCreateCheque",
                  "type": "bool"
                },
                {
                  "name": "canAddPendingPayee",
                  "type": "bool"
                },
                {
                  "name": "allowedPayees",
                  "type": "address[]"
                }
              ]
            },
            {
              "name": "_allowedAssets",
              "type": "address[]"
            },
            {
              "name": "_canClaimLoot",
              "type": "bool"
            },
            {
              "name": "_startDelay",
              "type": "uint256"
            },
            {
              "name": "_activationLength",
              "type": "uint256"
            }
          ],
          "outputs": [
            {
              "name": "",
              "type": "bool"
            }
          ]
        },
        {
          "stateMutability": "nonpayable",
          "type": "function",
          "name": "updateManager",
          "inputs": [
            {
              "name": "_userWallet",
              "type": "address"
            },
            {
              "name": "_manager",
              "type": "address"
            },
            {
              "name": "_limits",
              "type": "tuple",
              "components": [
                {
                  "name": "maxUsdValuePerTx",
                  "type": "uint256"
                },
                {
                  "name": "maxUsdValuePerPeriod",
                  "type": "uint256"
                },
                {
                  "name": "maxUsdValueLifetime",
                  "type": "uint256"
                },
                {
                  "name": "maxNumTxsPerPeriod",
                  "type": "uint256"
                },
                {
                  "name": "txCooldownBlocks",
                  "type": "uint256"
                },
                {
                  "name": "failOnZeroPrice",
                  "type": "bool"
                }
              ]
            },
            {
              "name": "_legoPerms",
              "type": "tuple",
              "components": [
                {
                  "name": "canManageYield",
                  "type": "bool"
                },
                {
                  "name": "canBuyAndSell",
                  "type": "bool"
                },
                {
                  "name": "canManageDebt",
                  "type": "bool"
                },
                {
                  "name": "canManageLiq",
                  "type": "bool"
                },
                {
                  "name": "canClaimRewards",
                  "type": "bool"
                },
                {
                  "name": "onlyApprovedYieldOpps",
                  "type": "bool"
                },
                {
                  "name": "allowedLegos",
                  "type": "uint256[]"
                }
              ]
            },
            {
              "name": "_swapPerms",
              "type": "tuple",
              "components": [
                {
                  "name": "mustHaveUsdValue",
                  "type": "bool"
                },
                {
                  "name": "maxNumSwapsPerPeriod",
                  "type": "uint256"
                },
                {
                  "name": "maxSlippage",
                  "type": "uint256"
                }
              ]
            },
            {
              "name": "_whitelistPerms",
              "type": "tuple",
              "components": [
                {
                  "name": "canAddPending",
                  "type": "bool"
                },
                {
                  "name": "canConfirm",
                  "type": "bool"
                },
                {
                  "name": "canCancel",
                  "type": "bool"
                },
                {
                  "name": "canRemove",
                  "type": "bool"
                }
              ]
            },
            {
              "name": "_transferPerms",
              "type": "tuple",
              "components": [
                {
                  "name": "canTransfer",
                  "type": "bool"
                },
                {
                  "name": "canCreateCheque",
                  "type": "bool"
                },
                {
                  "name": "canAddPendingPayee",
                  "type": "bool"
                },
                {
                  "name": "allowedPayees",
                  "type": "address[]"
                }
              ]
            },
            {
              "name": "_allowedAssets",
              "type": "address[]"
            },
            {
              "name": "_canClaimLoot",
              "type": "bool"
            }
          ],
          "outputs": [
            {
              "name": "",
              "type": "bool"
            }
          ]
        },
        {
          "stateMutability": "nonpayable",
          "type": "function",
          "name": "removeManager",
          "inputs": [
            {
              "name": "_userWallet",
              "type": "address"
            },
            {
              "name": "_manager",
              "type": "address"
            }
          ],
          "outputs": [
            {
              "name": "",
              "type": "bool"
            }
          ]
        },
        {
          "stateMutability": "nonpayable",
          "type": "function",
          "name": "adjustManagerActivationLength",
          "inputs": [
            {
              "name": "_userWallet",
              "type": "address"
            },
            {
              "name": "_manager",
              "type": "address"
            },
            {
              "name": "_activationLength",
              "type": "uint256"
            }
          ],
          "outputs": [
            {
              "name": "",
              "type": "bool"
            }
          ]
        },
        {
          "stateMutability": "nonpayable",
          "type": "function",
          "name": "adjustManagerActivationLength",
          "inputs": [
            {
              "name": "_userWallet",
              "type": "address"
            },
            {
              "name": "_manager",
              "type": "address"
            },
            {
              "name": "_activationLength",
              "type": "uint256"
            },
            {
              "name": "_shouldResetStartBlock",
              "type": "bool"
            }
          ],
          "outputs": [
            {
              "name": "",
              "type": "bool"
            }
          ]
        },
        {
          "stateMutability": "nonpayable",
          "type": "function",
          "name": "setGlobalManagerSettings",
          "inputs": [
            {
              "name": "_userWallet",
              "type": "address"
            },
            {
              "name": "_managerPeriod",
              "type": "uint256"
            },
            {
              "name": "_startDelay",
              "type": "uint256"
            },
            {
              "name": "_activationLength",
              "type": "uint256"
            },
            {
              "name": "_canOwnerManage",
              "type": "bool"
            },
            {
              "name": "_limits",
              "type": "tuple",
              "components": [
                {
                  "name": "maxUsdValuePerTx",
                  "type": "uint256"
                },
                {
                  "name": "maxUsdValuePerPeriod",
                  "type": "uint256"
                },
                {
                  "name": "maxUsdValueLifetime",
                  "type": "uint256"
                },
                {
                  "name": "maxNumTxsPerPeriod",
                  "type": "uint256"
                },
                {
                  "name": "txCooldownBlocks",
                  "type": "uint256"
                },
                {
                  "name": "failOnZeroPrice",
                  "type": "bool"
                }
              ]
            },
            {
              "name": "_legoPerms",
              "type": "tuple",
              "components": [
                {
                  "name": "canManageYield",
                  "type": "bool"
                },
                {
                  "name": "canBuyAndSell",
                  "type": "bool"
                },
                {
                  "name": "canManageDebt",
                  "type": "bool"
                },
                {
                  "name": "canManageLiq",
                  "type": "bool"
                },
                {
                  "name": "canClaimRewards",
                  "type": "bool"
                },
                {
                  "name": "onlyApprovedYieldOpps",
                  "type": "bool"
                },
                {
                  "name": "allowedLegos",
                  "type": "uint256[]"
                }
              ]
            },
            {
              "name": "_swapPerms",
              "type": "tuple",
              "components": [
                {
                  "name": "mustHaveUsdValue",
                  "type": "bool"
                },
                {
                  "name": "maxNumSwapsPerPeriod",
                  "type": "uint256"
                },
                {
                  "name": "maxSlippage",
                  "type": "uint256"
                }
              ]
            },
            {
              "name": "_whitelistPerms",
              "type": "tuple",
              "components": [
                {
                  "name": "canAddPending",
                  "type": "bool"
                },
                {
                  "name": "canConfirm",
                  "type": "bool"
                },
                {
                  "name": "canCancel",
                  "type": "bool"
                },
                {
                  "name": "canRemove",
                  "type": "bool"
                }
              ]
            },
            {
              "name": "_transferPerms",
              "type": "tuple",
              "components": [
                {
                  "name": "canTransfer",
                  "type": "bool"
                },
                {
                  "name": "canCreateCheque",
                  "type": "bool"
                },
                {
                  "name": "canAddPendingPayee",
                  "type": "bool"
                },
                {
                  "name": "allowedPayees",
                  "type": "address[]"
                }
              ]
            },
            {
              "name": "_allowedAssets",
              "type": "address[]"
            }
          ],
          "outputs": [
            {
              "name": "",
              "type": "bool"
            }
          ]
        },
        {
          "stateMutability": "view",
          "type": "function",
          "name": "isValidNewManager",
          "inputs": [
            {
              "name": "_userWallet",
              "type": "address"
            },
            {
              "name": "_manager",
              "type": "address"
            },
            {
              "name": "_startDelay",
              "type": "uint256"
            },
            {
              "name": "_activationLength",
              "type": "uint256"
            },
            {
              "name": "_limits",
              "type": "tuple",
              "components": [
                {
                  "name": "maxUsdValuePerTx",
                  "type": "uint256"
                },
                {
                  "name": "maxUsdValuePerPeriod",
                  "type": "uint256"
                },
                {
                  "name": "maxUsdValueLifetime",
                  "type": "uint256"
                },
                {
                  "name": "maxNumTxsPerPeriod",
                  "type": "uint256"
                },
                {
                  "name": "txCooldownBlocks",
                  "type": "uint256"
                },
                {
                  "name": "failOnZeroPrice",
                  "type": "bool"
                }
              ]
            },
            {
              "name": "_legoPerms",
              "type": "tuple",
              "components": [
                {
                  "name": "canManageYield",
                  "type": "bool"
                },
                {
                  "name": "canBuyAndSell",
                  "type": "bool"
                },
                {
                  "name": "canManageDebt",
                  "type": "bool"
                },
                {
                  "name": "canManageLiq",
                  "type": "bool"
                },
                {
                  "name": "canClaimRewards",
                  "type": "bool"
                },
                {
                  "name": "onlyApprovedYieldOpps",
                  "type": "bool"
                },
                {
                  "name": "allowedLegos",
                  "type": "uint256[]"
                }
              ]
            },
            {
              "name": "_swapPerms",
              "type": "tuple",
              "components": [
                {
                  "name": "mustHaveUsdValue",
                  "type": "bool"
                },
                {
                  "name": "maxNumSwapsPerPeriod",
                  "type": "uint256"
                },
                {
                  "name": "maxSlippage",
                  "type": "uint256"
                }
              ]
            },
            {
              "name": "_whitelistPerms",
              "type": "tuple",
              "components": [
                {
                  "name": "canAddPending",
                  "type": "bool"
                },
                {
                  "name": "canConfirm",
                  "type": "bool"
                },
                {
                  "name": "canCancel",
                  "type": "bool"
                },
                {
                  "name": "canRemove",
                  "type": "bool"
                }
              ]
            },
            {
              "name": "_transferPerms",
              "type": "tuple",
              "components": [
                {
                  "name": "canTransfer",
                  "type": "bool"
                },
                {
                  "name": "canCreateCheque",
                  "type": "bool"
                },
                {
                  "name": "canAddPendingPayee",
                  "type": "bool"
                },
                {
                  "name": "allowedPayees",
                  "type": "address[]"
                }
              ]
            },
            {
              "name": "_allowedAssets",
              "type": "address[]"
            },
            {
              "name": "_canClaimLoot",
              "type": "bool"
            }
          ],
          "outputs": [
            {
              "name": "",
              "type": "bool"
            }
          ]
        },
        {
          "stateMutability": "view",
          "type": "function",
          "name": "validateManagerOnUpdate",
          "inputs": [
            {
              "name": "_userWallet",
              "type": "address"
            },
            {
              "name": "_manager",
              "type": "address"
            },
            {
              "name": "_limits",
              "type": "tuple",
              "components": [
                {
                  "name": "maxUsdValuePerTx",
                  "type": "uint256"
                },
                {
                  "name": "maxUsdValuePerPeriod",
                  "type": "uint256"
                },
                {
                  "name": "maxUsdValueLifetime",
                  "type": "uint256"
                },
                {
                  "name": "maxNumTxsPerPeriod",
                  "type": "uint256"
                },
                {
                  "name": "txCooldownBlocks",
                  "type": "uint256"
                },
                {
                  "name": "failOnZeroPrice",
                  "type": "bool"
                }
              ]
            },
            {
              "name": "_legoPerms",
              "type": "tuple",
              "components": [
                {
                  "name": "canManageYield",
                  "type": "bool"
                },
                {
                  "name": "canBuyAndSell",
                  "type": "bool"
                },
                {
                  "name": "canManageDebt",
                  "type": "bool"
                },
                {
                  "name": "canManageLiq",
                  "type": "bool"
                },
                {
                  "name": "canClaimRewards",
                  "type": "bool"
                },
                {
                  "name": "onlyApprovedYieldOpps",
                  "type": "bool"
                },
                {
                  "name": "allowedLegos",
                  "type": "uint256[]"
                }
              ]
            },
            {
              "name": "_swapPerms",
              "type": "tuple",
              "components": [
                {
                  "name": "mustHaveUsdValue",
                  "type": "bool"
                },
                {
                  "name": "maxNumSwapsPerPeriod",
                  "type": "uint256"
                },
                {
                  "name": "maxSlippage",
                  "type": "uint256"
                }
              ]
            },
            {
              "name": "_whitelistPerms",
              "type": "tuple",
              "components": [
                {
                  "name": "canAddPending",
                  "type": "bool"
                },
                {
                  "name": "canConfirm",
                  "type": "bool"
                },
                {
                  "name": "canCancel",
                  "type": "bool"
                },
                {
                  "name": "canRemove",
                  "type": "bool"
                }
              ]
            },
            {
              "name": "_transferPerms",
              "type": "tuple",
              "components": [
                {
                  "name": "canTransfer",
                  "type": "bool"
                },
                {
                  "name": "canCreateCheque",
                  "type": "bool"
                },
                {
                  "name": "canAddPendingPayee",
                  "type": "bool"
                },
                {
                  "name": "allowedPayees",
                  "type": "address[]"
                }
              ]
            },
            {
              "name": "_allowedAssets",
              "type": "address[]"
            },
            {
              "name": "_canClaimLoot",
              "type": "bool"
            }
          ],
          "outputs": [
            {
              "name": "",
              "type": "bool"
            }
          ]
        },
        {
          "stateMutability": "view",
          "type": "function",
          "name": "validateGlobalManagerSettings",
          "inputs": [
            {
              "name": "_userWallet",
              "type": "address"
            },
            {
              "name": "_managerPeriod",
              "type": "uint256"
            },
            {
              "name": "_startDelay",
              "type": "uint256"
            },
            {
              "name": "_activationLength",
              "type": "uint256"
            },
            {
              "name": "_canOwnerManage",
              "type": "bool"
            },
            {
              "name": "_limits",
              "type": "tuple",
              "components": [
                {
                  "name": "maxUsdValuePerTx",
                  "type": "uint256"
                },
                {
                  "name": "maxUsdValuePerPeriod",
                  "type": "uint256"
                },
                {
                  "name": "maxUsdValueLifetime",
                  "type": "uint256"
                },
                {
                  "name": "maxNumTxsPerPeriod",
                  "type": "uint256"
                },
                {
                  "name": "txCooldownBlocks",
                  "type": "uint256"
                },
                {
                  "name": "failOnZeroPrice",
                  "type": "bool"
                }
              ]
            },
            {
              "name": "_legoPerms",
              "type": "tuple",
              "components": [
                {
                  "name": "canManageYield",
                  "type": "bool"
                },
                {
                  "name": "canBuyAndSell",
                  "type": "bool"
                },
                {
                  "name": "canManageDebt",
                  "type": "bool"
                },
                {
                  "name": "canManageLiq",
                  "type": "bool"
                },
                {
                  "name": "canClaimRewards",
                  "type": "bool"
                },
                {
                  "name": "onlyApprovedYieldOpps",
                  "type": "bool"
                },
                {
                  "name": "allowedLegos",
                  "type": "uint256[]"
                }
              ]
            },
            {
              "name": "_swapPerms",
              "type": "tuple",
              "components": [
                {
                  "name": "mustHaveUsdValue",
                  "type": "bool"
                },
                {
                  "name": "maxNumSwapsPerPeriod",
                  "type": "uint256"
                },
                {
                  "name": "maxSlippage",
                  "type": "uint256"
                }
              ]
            },
            {
              "name": "_whitelistPerms",
              "type": "tuple",
              "components": [
                {
                  "name": "canAddPending",
                  "type": "bool"
                },
                {
                  "name": "canConfirm",
                  "type": "bool"
                },
                {
                  "name": "canCancel",
                  "type": "bool"
                },
                {
                  "name": "canRemove",
                  "type": "bool"
                }
              ]
            },
            {
              "name": "_transferPerms",
              "type": "tuple",
              "components": [
                {
                  "name": "canTransfer",
                  "type": "bool"
                },
                {
                  "name": "canCreateCheque",
                  "type": "bool"
                },
                {
                  "name": "canAddPendingPayee",
                  "type": "bool"
                },
                {
                  "name": "allowedPayees",
                  "type": "address[]"
                }
              ]
            },
            {
              "name": "_allowedAssets",
              "type": "address[]"
            }
          ],
          "outputs": [
            {
              "name": "",
              "type": "bool"
            }
          ]
        },
        {
          "stateMutability": "view",
          "type": "function",
          "name": "createDefaultGlobalManagerSettings",
          "inputs": [
            {
              "name": "_managerPeriod",
              "type": "uint256"
            },
            {
              "name": "_minTimeLock",
              "type": "uint256"
            },
            {
              "name": "_defaultActivationLength",
              "type": "uint256"
            },
            {
              "name": "_mustHaveUsdValueOnSwaps",
              "type": "bool"
            },
            {
              "name": "_maxNumSwapsPerPeriod",
              "type": "uint256"
            },
            {
              "name": "_maxSlippageOnSwaps",
              "type": "uint256"
            },
            {
              "name": "_onlyApprovedYieldOpps",
              "type": "bool"
            }
          ],
          "outputs": [
            {
              "name": "",
              "type": "tuple",
              "components": [
                {
                  "name": "managerPeriod",
                  "type": "uint256"
                },
                {
                  "name": "startDelay",
                  "type": "uint256"
                },
                {
                  "name": "activationLength",
                  "type": "uint256"
                },
                {
                  "name": "canOwnerManage",
                  "type": "bool"
                },
                {
                  "name": "limits",
                  "type": "tuple",
                  "components": [
                    {
                      "name": "maxUsdValuePerTx",
                      "type": "uint256"
                    },
                    {
                      "name": "maxUsdValuePerPeriod",
                      "type": "uint256"
                    },
                    {
                      "name": "maxUsdValueLifetime",
                      "type": "uint256"
                    },
                    {
                      "name": "maxNumTxsPerPeriod",
                      "type": "uint256"
                    },
                    {
                      "name": "txCooldownBlocks",
                      "type": "uint256"
                    },
                    {
                      "name": "failOnZeroPrice",
                      "type": "bool"
                    }
                  ]
                },
                {
                  "name": "legoPerms",
                  "type": "tuple",
                  "components": [
                    {
                      "name": "canManageYield",
                      "type": "bool"
                    },
                    {
                      "name": "canBuyAndSell",
                      "type": "bool"
                    },
                    {
                      "name": "canManageDebt",
                      "type": "bool"
                    },
                    {
                      "name": "canManageLiq",
                      "type": "bool"
                    },
                    {
                      "name": "canClaimRewards",
                      "type": "bool"
                    },
                    {
                      "name": "onlyApprovedYieldOpps",
                      "type": "bool"
                    },
                    {
                      "name": "allowedLegos",
                      "type": "uint256[]"
                    }
                  ]
                },
                {
                  "name": "swapPerms",
                  "type": "tuple",
                  "components": [
                    {
                      "name": "mustHaveUsdValue",
                      "type": "bool"
                    },
                    {
                      "name": "maxNumSwapsPerPeriod",
                      "type": "uint256"
                    },
                    {
                      "name": "maxSlippage",
                      "type": "uint256"
                    }
                  ]
                },
                {
                  "name": "whitelistPerms",
                  "type": "tuple",
                  "components": [
                    {
                      "name": "canAddPending",
                      "type": "bool"
                    },
                    {
                      "name": "canConfirm",
                      "type": "bool"
                    },
                    {
                      "name": "canCancel",
                      "type": "bool"
                    },
                    {
                      "name": "canRemove",
                      "type": "bool"
                    }
                  ]
                },
                {
                  "name": "transferPerms",
                  "type": "tuple",
                  "components": [
                    {
                      "name": "canTransfer",
                      "type": "bool"
                    },
                    {
                      "name": "canCreateCheque",
                      "type": "bool"
                    },
                    {
                      "name": "canAddPendingPayee",
                      "type": "bool"
                    },
                    {
                      "name": "allowedPayees",
                      "type": "address[]"
                    }
                  ]
                },
                {
                  "name": "allowedAssets",
                  "type": "address[]"
                }
              ]
            }
          ]
        },
        {
          "stateMutability": "view",
          "type": "function",
          "name": "createStarterAgentSettings",
          "inputs": [
            {
              "name": "_startingAgentActivationLength",
              "type": "uint256"
            }
          ],
          "outputs": [
            {
              "name": "",
              "type": "tuple",
              "components": [
                {
                  "name": "startBlock",
                  "type": "uint256"
                },
                {
                  "name": "expiryBlock",
                  "type": "uint256"
                },
                {
                  "name": "limits",
                  "type": "tuple",
                  "components": [
                    {
                      "name": "maxUsdValuePerTx",
                      "type": "uint256"
                    },
                    {
                      "name": "maxUsdValuePerPeriod",
                      "type": "uint256"
                    },
                    {
                      "name": "maxUsdValueLifetime",
                      "type": "uint256"
                    },
                    {
                      "name": "maxNumTxsPerPeriod",
                      "type": "uint256"
                    },
                    {
                      "name": "txCooldownBlocks",
                      "type": "uint256"
                    },
                    {
                      "name": "failOnZeroPrice",
                      "type": "bool"
                    }
                  ]
                },
                {
                  "name": "legoPerms",
                  "type": "tuple",
                  "components": [
                    {
                      "name": "canManageYield",
                      "type": "bool"
                    },
                    {
                      "name": "canBuyAndSell",
                      "type": "bool"
                    },
                    {
                      "name": "canManageDebt",
                      "type": "bool"
                    },
                    {
                      "name": "canManageLiq",
                      "type": "bool"
                    },
                    {
                      "name": "canClaimRewards",
                      "type": "bool"
                    },
                    {
                      "name": "onlyApprovedYieldOpps",
                      "type": "bool"
                    },
                    {
                      "name": "allowedLegos",
                      "type": "uint256[]"
                    }
                  ]
                },
                {
                  "name": "swapPerms",
                  "type": "tuple",
                  "components": [
                    {
                      "name": "mustHaveUsdValue",
                      "type": "bool"
                    },
                    {
                      "name": "maxNumSwapsPerPeriod",
                      "type": "uint256"
                    },
                    {
                      "name": "maxSlippage",
                      "type": "uint256"
                    }
                  ]
                },
                {
                  "name": "whitelistPerms",
                  "type": "tuple",
                  "components": [
                    {
                      "name": "canAddPending",
                      "type": "bool"
                    },
                    {
                      "name": "canConfirm",
                      "type": "bool"
                    },
                    {
                      "name": "canCancel",
                      "type": "bool"
                    },
                    {
                      "name": "canRemove",
                      "type": "bool"
                    }
                  ]
                },
                {
                  "name": "transferPerms",
                  "type": "tuple",
                  "components": [
                    {
                      "name": "canTransfer",
                      "type": "bool"
                    },
                    {
                      "name": "canCreateCheque",
                      "type": "bool"
                    },
                    {
                      "name": "canAddPendingPayee",
                      "type": "bool"
                    },
                    {
                      "name": "allowedPayees",
                      "type": "address[]"
                    }
                  ]
                },
                {
                  "name": "allowedAssets",
                  "type": "address[]"
                },
                {
                  "name": "canClaimLoot",
                  "type": "bool"
                }
              ]
            }
          ]
        },
        {
          "stateMutability": "view",
          "type": "function",
          "name": "getManagerSettingsBundle",
          "inputs": [
            {
              "name": "_userWallet",
              "type": "address"
            },
            {
              "name": "_manager",
              "type": "address"
            }
          ],
          "outputs": [
            {
              "name": "",
              "type": "tuple",
              "components": [
                {
                  "name": "owner",
                  "type": "address"
                },
                {
                  "name": "isManager",
                  "type": "bool"
                },
                {
                  "name": "timeLock",
                  "type": "uint256"
                },
                {
                  "name": "walletConfig",
                  "type": "address"
                },
                {
                  "name": "legoBook",
                  "type": "address"
                },
                {
                  "name": "globalManagerSettings",
                  "type": "tuple",
                  "components": [
                    {
                      "name": "managerPeriod",
                      "type": "uint256"
                    },
                    {
                      "name": "startDelay",
                      "type": "uint256"
                    },
                    {
                      "name": "activationLength",
                      "type": "uint256"
                    },
                    {
                      "name": "canOwnerManage",
                      "type": "bool"
                    },
                    {
                      "name": "limits",
                      "type": "tuple",
                      "components": [
                        {
                          "name": "maxUsdValuePerTx",
                          "type": "uint256"
                        },
                        {
                          "name": "maxUsdValuePerPeriod",
                          "type": "uint256"
                        },
                        {
                          "name": "maxUsdValueLifetime",
                          "type": "uint256"
                        },
                        {
                          "name": "maxNumTxsPerPeriod",
                          "type": "uint256"
                        },
                        {
                          "name": "txCooldownBlocks",
                          "type": "uint256"
                        },
                        {
                          "name": "failOnZeroPrice",
                          "type": "bool"
                        }
                      ]
                    },
                    {
                      "name": "legoPerms",
                      "type": "tuple",
                      "components": [
                        {
                          "name": "canManageYield",
                          "type": "bool"
                        },
                        {
                          "name": "canBuyAndSell",
                          "type": "bool"
                        },
                        {
                          "name": "canManageDebt",
                          "type": "bool"
                        },
                        {
                          "name": "canManageLiq",
                          "type": "bool"
                        },
                        {
                          "name": "canClaimRewards",
                          "type": "bool"
                        },
                        {
                          "name": "onlyApprovedYieldOpps",
                          "type": "bool"
                        },
                        {
                          "name": "allowedLegos",
                          "type": "uint256[]"
                        }
                      ]
                    },
                    {
                      "name": "swapPerms",
                      "type": "tuple",
                      "components": [
                        {
                          "name": "mustHaveUsdValue",
                          "type": "bool"
                        },
                        {
                          "name": "maxNumSwapsPerPeriod",
                          "type": "uint256"
                        },
                        {
                          "name": "maxSlippage",
                          "type": "uint256"
                        }
                      ]
                    },
                    {
                      "name": "whitelistPerms",
                      "type": "tuple",
                      "components": [
                        {
                          "name": "canAddPending",
                          "type": "bool"
                        },
                        {
                          "name": "canConfirm",
                          "type": "bool"
                        },
                        {
                          "name": "canCancel",
                          "type": "bool"
                        },
                        {
                          "name": "canRemove",
                          "type": "bool"
                        }
                      ]
                    },
                    {
                      "name": "transferPerms",
                      "type": "tuple",
                      "components": [
                        {
                          "name": "canTransfer",
                          "type": "bool"
                        },
                        {
                          "name": "canCreateCheque",
                          "type": "bool"
                        },
                        {
                          "name": "canAddPendingPayee",
                          "type": "bool"
                        },
                        {
                          "name": "allowedPayees",
                          "type": "address[]"
                        }
                      ]
                    },
                    {
                      "name": "allowedAssets",
                      "type": "address[]"
                    }
                  ]
                }
              ]
            }
          ]
        },
        {
          "stateMutability": "view",
          "type": "function",
          "name": "UNDY_HQ",
          "inputs": [],
          "outputs": [
            {
              "name": "",
              "type": "address"
            }
          ]
        },
        {
          "stateMutability": "view",
          "type": "function",
          "name": "MIN_MANAGER_PERIOD",
          "inputs": [],
          "outputs": [
            {
              "name": "",
              "type": "uint256"
            }
          ]
        },
        {
          "stateMutability": "view",
          "type": "function",
          "name": "MAX_MANAGER_PERIOD",
          "inputs": [],
          "outputs": [
            {
              "name": "",
              "type": "uint256"
            }
          ]
        },
        {
          "stateMutability": "view",
          "type": "function",
          "name": "MAX_START_DELAY",
          "inputs": [],
          "outputs": [
            {
              "name": "",
              "type": "uint256"
            }
          ]
        },
        {
          "stateMutability": "view",
          "type": "function",
          "name": "MIN_ACTIVATION_LENGTH",
          "inputs": [],
          "outputs": [
            {
              "name": "",
              "type": "uint256"
            }
          ]
        },
        {
          "stateMutability": "view",
          "type": "function",
          "name": "MAX_ACTIVATION_LENGTH",
          "inputs": [],
          "outputs": [
            {
              "name": "",
              "type": "uint256"
            }
          ]
        },
        {
          "stateMutability": "nonpayable",
          "type": "constructor",
          "inputs": [
            {
              "name": "_undyHq",
              "type": "address"
            },
            {
              "name": "_minManagerPeriod",
              "type": "uint256"
            },
            {
              "name": "_maxManagerPeriod",
              "type": "uint256"
            },
            {
              "name": "_minActivationLength",
              "type": "uint256"
            },
            {
              "name": "_maxActivationLength",
              "type": "uint256"
            },
            {
              "name": "_maxStartDelay",
              "type": "uint256"
            }
          ],
          "outputs": []
        }
      ],
      "solc_json": {
        "language": "Vyper",
        "sources": {
          "interfaces/WalletConfigStructs.vyi": {
            "content": "# @version 0.4.3\n\nMAX_CONFIG_ASSETS: constant(uint256) = 40\nMAX_CONFIG_LEGOS: constant(uint256) = 25\nMAX_ALLOWED_PAYEES: constant(uint256) = 40\n\nflag WhitelistAction:\n    ADD_PENDING\n    CONFIRM_WHITELIST\n    CANCEL_WHITELIST\n    REMOVE_WHITELIST\n\nflag BackpackType:\n    WALLET_KERNEL\n    WALLET_SENTINEL\n    WALLET_HIGH_COMMAND\n    WALLET_PAYMASTER\n    WALLET_CHEQUE_BOOK\n    WALLET_MIGRATOR\n\n# payees\n\nstruct PayeeData:\n    numTxsInPeriod: uint256\n    totalUnitsInPeriod: uint256\n    totalUsdValueInPeriod: uint256\n    totalNumTxs: uint256\n    totalUnits: uint256\n    totalUsdValue: uint256\n    lastTxBlock: uint256\n    periodStartBlock: uint256\n\nstruct PayeeSettings:\n    startBlock: uint256\n    expiryBlock: uint256\n    canPull: bool\n    periodLength: uint256\n    maxNumTxsPerPeriod: uint256\n    txCooldownBlocks: uint256\n    failOnZeroPrice: bool\n    primaryAsset: address\n    onlyPrimaryAsset: bool\n    unitLimits: PayeeLimits\n    usdLimits: PayeeLimits\n\nstruct GlobalPayeeSettings:\n    defaultPeriodLength: uint256\n    startDelay: uint256\n    activationLength: uint256\n    maxNumTxsPerPeriod: uint256\n    txCooldownBlocks: uint256\n    failOnZeroPrice: bool\n    usdLimits: PayeeLimits\n    canPayOwner: bool\n    canPull: bool\n\nstruct PayeeLimits:\n    perTxCap: uint256\n    perPeriodCap: uint256\n    lifetimeCap: uint256\n\nstruct PendingPayee:\n    settings: PayeeSettings\n    initiatedBlock: uint256\n    confirmBlock: uint256\n    currentOwner: address\n\nstruct PayeeManagementBundle:\n    owner: address\n    wallet: address\n    isRegisteredPayee: bool\n    isWhitelisted: bool\n    isExistingCheque: bool\n    payeeSettings: PayeeSettings\n    globalPayeeSettings: GlobalPayeeSettings\n    timeLock: uint256\n    walletConfig: address\n\nstruct RecipientConfigBundle:\n    isWhitelisted: bool\n    isOwner: bool\n    isPayee: bool\n    config: PayeeSettings\n    globalConfig: GlobalPayeeSettings\n    data: PayeeData\n\nstruct WhitelistConfigBundle:\n    owner: address\n    wallet: address\n    isWhitelisted: bool\n    pendingWhitelist: PendingWhitelist\n    isExistingPayee: bool\n    isExistingCheque: bool\n    timeLock: uint256\n    walletConfig: address\n    isManager: bool\n    isOwner: bool\n    whitelistPerms: WhitelistPerms\n    globalWhitelistPerms: WhitelistPerms\n\nstruct PendingWhitelist:\n    initiatedBlock: uint256\n    confirmBlock: uint256\n    currentOwner: address\n\n# cheques\n\nstruct Cheque:\n    recipient: address\n    asset: address\n    amount: uint256\n    creationBlock: uint256\n    unlockBlock: uint256\n    expiryBlock: uint256\n    usdValueOnCreation: uint256\n    canManagerPay: bool\n    canBePulled: bool\n    creator: address\n    active: bool\n\nstruct ChequeSettings:\n    maxNumActiveCheques: uint256\n    maxChequeUsdValue: uint256\n    instantUsdThreshold: uint256\n    perPeriodPaidUsdCap: uint256\n    maxNumChequesPaidPerPeriod: uint256\n    payCooldownBlocks: uint256\n    perPeriodCreatedUsdCap: uint256\n    maxNumChequesCreatedPerPeriod: uint256\n    createCooldownBlocks: uint256\n    periodLength: uint256\n    expensiveDelayBlocks: uint256\n    defaultExpiryBlocks: uint256\n    allowedAssets: DynArray[address, MAX_CONFIG_ASSETS]\n    canManagersCreateCheques: bool\n    canManagerPay: bool\n    canBePulled: bool\n\nstruct ChequeData:\n    numChequesPaidInPeriod: uint256\n    totalUsdValuePaidInPeriod: uint256\n    totalNumChequesPaid: uint256\n    totalUsdValuePaid: uint256\n    lastChequePaidBlock: uint256\n    numChequesCreatedInPeriod: uint256\n    totalUsdValueCreatedInPeriod: uint256\n    totalNumChequesCreated: uint256\n    totalUsdValueCreated: uint256\n    lastChequeCreatedBlock: uint256\n    periodStartBlock: uint256\n\nstruct ChequeManagementBundle:\n    wallet: address\n    walletConfig: address\n    owner: address\n    isRecipientOnWhitelist: bool\n    isCreatorManager: bool\n    managerSettings: ManagerSettings\n    chequeSettings: ChequeSettings\n    chequeData: ChequeData\n    isExistingCheque: bool\n    numActiveCheques: uint256\n    isExistingPayee: bool\n    timeLock: uint256\n\n# managers\n\nstruct ManagerData:\n    numTxsInPeriod: uint256\n    totalUsdValueInPeriod: uint256\n    totalNumTxs: uint256\n    totalUsdValue: uint256\n    lastTxBlock: uint256\n    periodStartBlock: uint256\n    numSwapsInPeriod: uint256\n\nstruct ManagerSettings:\n    startBlock: uint256\n    expiryBlock: uint256\n    limits: ManagerLimits\n    legoPerms: LegoPerms\n    swapPerms: SwapPerms\n    whitelistPerms: WhitelistPerms\n    transferPerms: TransferPerms\n    allowedAssets: DynArray[address, MAX_CONFIG_ASSETS]\n    canClaimLoot: bool\n\nstruct GlobalManagerSettings:\n    managerPeriod: uint256\n    startDelay: uint256\n    activationLength: uint256\n    canOwnerManage: bool\n    limits: ManagerLimits\n    legoPerms: LegoPerms\n    swapPerms: SwapPerms\n    whitelistPerms: WhitelistPerms\n    transferPerms: TransferPerms\n    allowedAssets: DynArray[address, MAX_CONFIG_ASSETS]\n\nstruct ManagerLimits:\n    maxUsdValuePerTx: uint256\n    maxUsdValuePerPeriod: uint256\n    maxUsdValueLifetime: uint256\n    maxNumTxsPerPeriod: uint256\n    txCooldownBlocks: uint256\n    failOnZeroPrice: bool\n\nstruct LegoPerms:\n    canManageYield: bool\n    canBuyAndSell: bool\n    canManageDebt: bool\n    canManageLiq: bool\n    canClaimRewards: bool\n    onlyApprovedYieldOpps: bool\n    allowedLegos: DynArray[uint256, MAX_CONFIG_LEGOS]\n\nstruct SwapPerms:\n    mustHaveUsdValue: bool\n    maxNumSwapsPerPeriod: uint256\n    maxSlippage: uint256\n\nstruct WhitelistPerms:\n    canAddPending: bool\n    canConfirm: bool\n    canCancel: bool\n    canRemove: bool\n\nstruct TransferPerms:\n    canTransfer: bool\n    canCreateCheque: bool\n    canAddPendingPayee: bool\n    allowedPayees: DynArray[address, MAX_ALLOWED_PAYEES]\n\nstruct ManagerConfigBundle:\n    isOwner: bool\n    isManager: bool\n    config: ManagerSettings\n    globalConfig: GlobalManagerSettings\n    data: ManagerData\n    payee: address\n\nstruct ManagerSettingsBundle:\n    owner: address\n    isManager: bool\n    timeLock: uint256\n    walletConfig: address\n    legoBook: address\n    globalManagerSettings: GlobalManagerSettings\n\n# migration\n\nstruct MigrationConfigBundle:\n    owner: address\n    isFrozen: bool\n    numPayees: uint256\n    numWhitelisted: uint256\n    numManagers: uint256\n    startingAgent: address\n    startingAgentIndex: uint256\n    hasPendingOwnerChange: bool\n    groupId: uint256\n    numActiveCheques: uint256\n",
            "sha256sum": "31165468feeac632a1376c70970ce5124f8951392c4deaa01a26176c7f26718a"
          },
          "contracts/core/walletBackpack/HighCommand.vy": {
            "content": "#    \u2513 \u250f  \u2513\u2513   \n#    \u2503\u2503\u2503\u250f\u2513\u2503\u2503\u250f\u2513\u254b\n#    \u2517\u253b\u251b\u2517\u253b\u2517\u2517\u2517 \u2517\n#     __  __   __   ______   __  __       ______   ______   __    __   __    __   ______   __   __   _____    \n#    /\\ \\_\\ \\ /\\ \\ /\\  ___\\ /\\ \\_\\ \\     /\\  ___\\ /\\  __ \\ /\\ \"-./  \\ /\\ \"-./  \\ /\\  __ \\ /\\ \"-.\\ \\ /\\  __-.  \n#    \\ \\  __ \\\\ \\ \\\\ \\ \\__ \\\\ \\  __ \\    \\ \\ \\____\\ \\ \\/\\ \\\\ \\ \\-./\\ \\\\ \\ \\-./\\ \\\\ \\  __ \\\\ \\ \\-.  \\\\ \\ \\/\\ \\ \n#     \\ \\_\\ \\_\\\\ \\_\\\\ \\_____\\\\ \\_\\ \\_\\    \\ \\_____\\\\ \\_____\\\\ \\_\\ \\ \\_\\\\ \\_\\ \\ \\_\\\\ \\_\\ \\_\\\\ \\_\\\\\"\\_\\\\ \\____- \n#      \\/_/\\/_/ \\/_/ \\/_____/ \\/_/\\/_/     \\/_____/ \\/_____/ \\/_/  \\/_/ \\/_/  \\/_/ \\/_/\\/_/ \\/_/ \\/_/ \\/____/ \n#                                                                                                \n#     \u2554\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2557\n#     \u2551  ** High Command **                                \u2551\n#     \u2551  Manager settings / functionality for user wallets \u2551\n#     \u255a\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u255d\n#\n#     Underscore Protocol License: https://github.com/underscore-finance/underscore-protocol/blob/master/LICENSE.md\n\n# @version 0.4.3\n\nfrom interfaces import WalletConfigStructs as wcs\n\ninterface UserWalletConfig:\n    def updateManager(_manager: address, _config: wcs.ManagerSettings): nonpayable\n    def setGlobalManagerSettings(_config: wcs.GlobalManagerSettings): nonpayable\n    def addManager(_manager: address, _config: wcs.ManagerSettings): nonpayable\n    def managerSettings(_manager: address) -> wcs.ManagerSettings: view\n    def globalManagerSettings() -> wcs.GlobalManagerSettings: view\n    def indexOfManager(_addr: address) -> uint256: view\n    def indexOfPayee(_payee: address) -> uint256: view\n    def removeManager(_manager: address): nonpayable\n    def timeLock() -> uint256: view\n    def owner() -> address: view\n\ninterface Registry:\n    def isValidRegId(_regId: uint256) -> bool: view\n    def getAddr(_regId: uint256) -> address: view\n\ninterface MissionControl:\n    def canPerformSecurityAction(_addr: address) -> bool: view\n\ninterface Ledger:\n    def isUserWallet(_user: address) -> bool: view\n\ninterface UserWallet:\n    def walletConfig() -> address: view\n\nevent GlobalManagerSettingsModified:\n    user: indexed(address)\n    managerPeriod: uint256\n    startDelay: uint256\n    activationLength: uint256\n    canOwnerManage: bool\n    maxUsdValuePerTx: uint256\n    maxUsdValuePerPeriod: uint256\n    maxUsdValueLifetime: uint256\n    maxNumTxsPerPeriod: uint256\n    txCooldownBlocks: uint256\n    failOnZeroPrice: bool\n    canManageYield: bool\n    canBuyAndSell: bool\n    canManageDebt: bool\n    canManageLiq: bool\n    canClaimRewards: bool\n    numAllowedLegos: uint256\n    canAddPendingWhitelist: bool\n    canConfirmWhitelist: bool\n    canCancelWhitelist: bool\n    canRemoveWhitelist: bool\n    canTransfer: bool\n    canCreateCheque: bool\n    canAddPendingPayee: bool\n    numAllowedRecipients: uint256\n    numAllowedAssets: uint256\n\nevent ManagerSettingsModified:\n    user: indexed(address)\n    manager: indexed(address)\n    startBlock: uint256\n    expiryBlock: uint256\n    maxUsdValuePerTx: uint256\n    maxUsdValuePerPeriod: uint256\n    maxUsdValueLifetime: uint256\n    maxNumTxsPerPeriod: uint256\n    txCooldownBlocks: uint256\n    failOnZeroPrice: bool\n    canManageYield: bool\n    canBuyAndSell: bool\n    canManageDebt: bool\n    canManageLiq: bool\n    canClaimRewards: bool\n    numAllowedLegos: uint256\n    canAddPendingWhitelist: bool\n    canConfirmWhitelist: bool\n    canCancelWhitelist: bool\n    canRemoveWhitelist: bool\n    canTransfer: bool\n    canCreateCheque: bool\n    canAddPendingPayee: bool\n    numAllowedRecipients: uint256\n    numAllowedAssets: uint256\n    canClaimLoot: bool\n\nevent ManagerRemoved:\n    user: indexed(address)\n    manager: indexed(address)\n\nevent ManagerActivationLengthAdjusted:\n    user: indexed(address)\n    manager: indexed(address)\n    activationLength: uint256\n    didRestart: bool\n\nUNDY_HQ: public(immutable(address))\nLEDGER_ID: constant(uint256) = 1\nMISSION_CONTROL_ID: constant(uint256) = 2\nLEGO_BOOK_ID: constant(uint256) = 3\n\nMAX_CONFIG_ASSETS: constant(uint256) = 40\nMAX_CONFIG_LEGOS: constant(uint256) = 25\nMAX_ALLOWED_PAYEES: constant(uint256) = 40\n\n# manager validation bounds\nMIN_MANAGER_PERIOD: public(immutable(uint256))\nMAX_MANAGER_PERIOD: public(immutable(uint256))\nMAX_START_DELAY: public(immutable(uint256))\nMIN_ACTIVATION_LENGTH: public(immutable(uint256))\nMAX_ACTIVATION_LENGTH: public(immutable(uint256))\n\n\n@deploy\ndef __init__(\n    _undyHq: address,\n    _minManagerPeriod: uint256,\n    _maxManagerPeriod: uint256,\n    _minActivationLength: uint256,\n    _maxActivationLength: uint256,\n    _maxStartDelay: uint256,\n):\n    assert _undyHq != empty(address) # dev: invalid undy hq\n    UNDY_HQ = _undyHq\n\n    assert _minManagerPeriod != 0 and _minManagerPeriod < _maxManagerPeriod # dev: invalid manager periods\n    MIN_MANAGER_PERIOD = _minManagerPeriod\n    MAX_MANAGER_PERIOD = _maxManagerPeriod\n\n    assert _minActivationLength != 0 and _minActivationLength < _maxActivationLength # dev: invalid activation length\n    MIN_ACTIVATION_LENGTH = _minActivationLength\n    MAX_ACTIVATION_LENGTH = _maxActivationLength\n\n    assert _maxStartDelay != 0 # dev: invalid start delay\n    MAX_START_DELAY = _maxStartDelay\n\n\n####################\n# Manager Settings #\n####################\n\n\n# add manager\n\n\n@external\ndef addManager(\n    _userWallet: address,\n    _manager: address,\n    _limits: wcs.ManagerLimits,\n    _legoPerms: wcs.LegoPerms,\n    _swapPerms: wcs.SwapPerms,\n    _whitelistPerms: wcs.WhitelistPerms,\n    _transferPerms: wcs.TransferPerms,\n    _allowedAssets: DynArray[address, MAX_CONFIG_ASSETS],\n    _canClaimLoot: bool,\n    _startDelay: uint256 = 0,\n    _activationLength: uint256 = 0,\n) -> bool:\n    assert self._isValidUserWallet(_userWallet) # dev: invalid user wallet\n\n    config: wcs.ManagerSettingsBundle = self._getManagerSettingsBundle(_userWallet, _manager)\n    assert msg.sender == config.owner # dev: no perms\n    assert _manager not in [empty(address), config.owner, config.walletConfig, _userWallet] # dev: invalid manager\n\n    isValid: bool = False\n    settings: wcs.ManagerSettings = empty(wcs.ManagerSettings)\n    isValid, settings = self._isValidNewManager(config.isManager, _startDelay, _activationLength, _limits, _legoPerms, _swapPerms, _whitelistPerms, _transferPerms, _allowedAssets, _canClaimLoot, config.globalManagerSettings, config.timeLock, config.legoBook, config.walletConfig)\n    assert isValid # dev: invalid manager\n\n    extcall UserWalletConfig(config.walletConfig).addManager(_manager, settings)\n    log ManagerSettingsModified(\n        user = _userWallet,\n        manager = _manager,\n        startBlock = settings.startBlock,\n        expiryBlock = settings.expiryBlock,\n        maxUsdValuePerTx = _limits.maxUsdValuePerTx,\n        maxUsdValuePerPeriod = _limits.maxUsdValuePerPeriod,\n        maxUsdValueLifetime = _limits.maxUsdValueLifetime,\n        maxNumTxsPerPeriod = _limits.maxNumTxsPerPeriod,\n        txCooldownBlocks = _limits.txCooldownBlocks,\n        failOnZeroPrice = _limits.failOnZeroPrice,\n        canManageYield = _legoPerms.canManageYield,\n        canBuyAndSell = _legoPerms.canBuyAndSell,\n        canManageDebt = _legoPerms.canManageDebt,\n        canManageLiq = _legoPerms.canManageLiq,\n        canClaimRewards = _legoPerms.canClaimRewards,\n        numAllowedLegos = len(_legoPerms.allowedLegos),\n        canAddPendingWhitelist = _whitelistPerms.canAddPending,\n        canConfirmWhitelist = _whitelistPerms.canConfirm,\n        canCancelWhitelist = _whitelistPerms.canCancel,\n        canRemoveWhitelist = _whitelistPerms.canRemove,\n        canTransfer = _transferPerms.canTransfer,\n        canCreateCheque = _transferPerms.canCreateCheque,\n        canAddPendingPayee = _transferPerms.canAddPendingPayee,\n        numAllowedRecipients = len(_transferPerms.allowedPayees),\n        numAllowedAssets = len(_allowedAssets),\n        canClaimLoot = _canClaimLoot,\n    )\n    return True\n\n\n# update existing manager\n\n\n@external\ndef updateManager(\n    _userWallet: address,\n    _manager: address,\n    _limits: wcs.ManagerLimits,\n    _legoPerms: wcs.LegoPerms,\n    _swapPerms: wcs.SwapPerms,\n    _whitelistPerms: wcs.WhitelistPerms,\n    _transferPerms: wcs.TransferPerms,\n    _allowedAssets: DynArray[address, MAX_CONFIG_ASSETS],\n    _canClaimLoot: bool,\n) -> bool:\n    assert self._isValidUserWallet(_userWallet) # dev: invalid user wallet\n\n    config: wcs.ManagerSettingsBundle = self._getManagerSettingsBundle(_userWallet, _manager)\n    assert msg.sender == config.owner # dev: no perms\n\n    # validate inputs\n    assert self._validateManagerOnUpdate(config.isManager, _limits, _legoPerms, _swapPerms, _whitelistPerms, _transferPerms, _allowedAssets, _canClaimLoot, config.globalManagerSettings.managerPeriod, config.legoBook, config.walletConfig) # dev: invalid settings\n\n    # update config\n    settings: wcs.ManagerSettings = staticcall UserWalletConfig(config.walletConfig).managerSettings(_manager)\n    settings.limits = _limits\n    settings.legoPerms = _legoPerms\n    settings.swapPerms = _swapPerms\n    settings.whitelistPerms = _whitelistPerms\n    settings.transferPerms = _transferPerms\n    settings.allowedAssets = _allowedAssets\n    settings.canClaimLoot = _canClaimLoot\n    extcall UserWalletConfig(config.walletConfig).updateManager(_manager, settings)\n\n    log ManagerSettingsModified(\n        user = _userWallet,\n        manager = _manager,\n        startBlock = settings.startBlock,\n        expiryBlock = settings.expiryBlock,\n        maxUsdValuePerTx = _limits.maxUsdValuePerTx,\n        maxUsdValuePerPeriod = _limits.maxUsdValuePerPeriod,\n        maxUsdValueLifetime = _limits.maxUsdValueLifetime,\n        maxNumTxsPerPeriod = _limits.maxNumTxsPerPeriod,\n        txCooldownBlocks = _limits.txCooldownBlocks,\n        failOnZeroPrice = _limits.failOnZeroPrice,\n        canManageYield = _legoPerms.canManageYield,\n        canBuyAndSell = _legoPerms.canBuyAndSell,\n        canManageDebt = _legoPerms.canManageDebt,\n        canManageLiq = _legoPerms.canManageLiq,\n        canClaimRewards = _legoPerms.canClaimRewards,\n        numAllowedLegos = len(_legoPerms.allowedLegos),\n        canAddPendingWhitelist = _whitelistPerms.canAddPending,\n        canConfirmWhitelist = _whitelistPerms.canConfirm,\n        canCancelWhitelist = _whitelistPerms.canCancel,\n        canRemoveWhitelist = _whitelistPerms.canRemove,\n        canTransfer = _transferPerms.canTransfer,\n        canCreateCheque = _transferPerms.canCreateCheque,\n        canAddPendingPayee = _transferPerms.canAddPendingPayee,\n        numAllowedRecipients = len(_transferPerms.allowedPayees),\n        numAllowedAssets = len(_allowedAssets),\n        canClaimLoot = _canClaimLoot,\n    )\n    return True\n\n\n# remove manager\n\n\n@external\ndef removeManager(_userWallet: address, _manager: address) -> bool:\n    assert self._isValidUserWallet(_userWallet) # dev: invalid user wallet\n\n    config: wcs.ManagerSettingsBundle = self._getManagerSettingsBundle(_userWallet, _manager)\n    if msg.sender not in [config.owner, _manager]:\n        assert self._canPerformSecurityAction(msg.sender) # dev: no perms\n    assert config.isManager # dev: manager not found\n\n    extcall UserWalletConfig(config.walletConfig).removeManager(_manager)\n    log ManagerRemoved(user = _userWallet, manager = _manager)\n    return True\n\n\n# adjust activation length\n\n\n@external\ndef adjustManagerActivationLength(\n    _userWallet: address,\n    _manager: address,\n    _activationLength: uint256,\n    _shouldResetStartBlock: bool = False,\n) -> bool:\n    assert self._isValidUserWallet(_userWallet) # dev: invalid user wallet\n\n    config: wcs.ManagerSettingsBundle = self._getManagerSettingsBundle(_userWallet, _manager)\n    assert msg.sender == config.owner # dev: no perms\n    assert config.isManager # dev: no manager found\n\n    # validation\n    settings: wcs.ManagerSettings = staticcall UserWalletConfig(config.walletConfig).managerSettings(_manager)\n    assert settings.startBlock < block.number # dev: manager not active yet\n    assert self._validateActivationLength(_activationLength) # dev: invalid activation length\n\n    # update config\n    didRestart: bool = False\n    if _shouldResetStartBlock or settings.expiryBlock < block.number:\n        settings.startBlock = block.number\n        didRestart = True\n\n    settings.expiryBlock = settings.startBlock + _activationLength\n    assert settings.expiryBlock > block.number # dev: invalid expiry block\n    extcall UserWalletConfig(config.walletConfig).updateManager(_manager, settings)\n\n    log ManagerActivationLengthAdjusted(\n        user = _userWallet,\n        manager = _manager,\n        activationLength = _activationLength,\n        didRestart = didRestart,\n    )\n    return True\n\n\n###########################\n# Global Manager Settings #\n###########################\n\n\n@external\ndef setGlobalManagerSettings(\n    _userWallet: address,\n    _managerPeriod: uint256,\n    _startDelay: uint256,\n    _activationLength: uint256,\n    _canOwnerManage: bool,\n    _limits: wcs.ManagerLimits,\n    _legoPerms: wcs.LegoPerms,\n    _swapPerms: wcs.SwapPerms,\n    _whitelistPerms: wcs.WhitelistPerms,\n    _transferPerms: wcs.TransferPerms,\n    _allowedAssets: DynArray[address, MAX_CONFIG_ASSETS],\n) -> bool:\n    assert self._isValidUserWallet(_userWallet) # dev: invalid user wallet\n\n    config: wcs.ManagerSettingsBundle = self._getManagerSettingsBundle(_userWallet, empty(address))\n    assert msg.sender == config.owner # dev: no perms\n\n    # validate inputs\n    assert self._validateGlobalManagerSettings(_managerPeriod, _startDelay, _activationLength, _canOwnerManage, _limits, _legoPerms, _swapPerms, _whitelistPerms, _transferPerms, _allowedAssets, config.timeLock, config.legoBook, config.walletConfig) # dev: invalid settings\n\n    # update config\n    settings: wcs.GlobalManagerSettings = wcs.GlobalManagerSettings(\n        managerPeriod = _managerPeriod,\n        startDelay = _startDelay,\n        activationLength = _activationLength,\n        canOwnerManage = _canOwnerManage,\n        limits = _limits,\n        legoPerms = _legoPerms,\n        swapPerms = _swapPerms,\n        whitelistPerms = _whitelistPerms,\n        transferPerms = _transferPerms,\n        allowedAssets = _allowedAssets,\n    )\n    extcall UserWalletConfig(config.walletConfig).setGlobalManagerSettings(settings)\n\n    log GlobalManagerSettingsModified(\n        user = _userWallet,\n        managerPeriod = _managerPeriod,\n        startDelay = _startDelay,\n        activationLength = _activationLength,\n        canOwnerManage = _canOwnerManage,\n        maxUsdValuePerTx = _limits.maxUsdValuePerTx,\n        maxUsdValuePerPeriod = _limits.maxUsdValuePerPeriod,\n        maxUsdValueLifetime = _limits.maxUsdValueLifetime,\n        maxNumTxsPerPeriod = _limits.maxNumTxsPerPeriod,\n        txCooldownBlocks = _limits.txCooldownBlocks,\n        failOnZeroPrice = _limits.failOnZeroPrice,\n        canManageYield = _legoPerms.canManageYield,\n        canBuyAndSell = _legoPerms.canBuyAndSell,\n        canManageDebt = _legoPerms.canManageDebt,\n        canManageLiq = _legoPerms.canManageLiq,\n        canClaimRewards = _legoPerms.canClaimRewards,\n        numAllowedLegos = len(_legoPerms.allowedLegos),\n        canAddPendingWhitelist = _whitelistPerms.canAddPending,\n        canConfirmWhitelist = _whitelistPerms.canConfirm,\n        canCancelWhitelist = _whitelistPerms.canCancel,\n        canRemoveWhitelist = _whitelistPerms.canRemove,\n        canTransfer = _transferPerms.canTransfer,\n        canCreateCheque = _transferPerms.canCreateCheque,\n        canAddPendingPayee = _transferPerms.canAddPendingPayee,\n        numAllowedRecipients = len(_transferPerms.allowedPayees),\n        numAllowedAssets = len(_allowedAssets),\n    )\n    return True\n\n\n######################\n# Manager Validation #\n######################\n\n\n# validate on add new\n\n\n@view\n@external\ndef isValidNewManager(\n    _userWallet: address,\n    _manager: address,\n    _startDelay: uint256,\n    _activationLength: uint256,\n    _limits: wcs.ManagerLimits,\n    _legoPerms: wcs.LegoPerms,\n    _swapPerms: wcs.SwapPerms,\n    _whitelistPerms: wcs.WhitelistPerms,\n    _transferPerms: wcs.TransferPerms,\n    _allowedAssets: DynArray[address, MAX_CONFIG_ASSETS],\n    _canClaimLoot: bool,\n) -> bool:\n    config: wcs.ManagerSettingsBundle = self._getManagerSettingsBundle(_userWallet, _manager)\n    isValid: bool = False\n    na: wcs.ManagerSettings = empty(wcs.ManagerSettings)\n    isValid, na = self._isValidNewManager(config.isManager, _startDelay, _activationLength, _limits, _legoPerms, _swapPerms, _whitelistPerms, _transferPerms, _allowedAssets, _canClaimLoot, config.globalManagerSettings, config.timeLock, config.legoBook, config.walletConfig)\n    return isValid\n\n\n@view\n@internal\ndef _isValidNewManager(\n    _isManager: bool,\n    _startDelay: uint256,\n    _activationLength: uint256,\n    _limits: wcs.ManagerLimits,\n    _legoPerms: wcs.LegoPerms,\n    _swapPerms: wcs.SwapPerms,\n    _whitelistPerms: wcs.WhitelistPerms,\n    _transferPerms: wcs.TransferPerms,\n    _allowedAssets: DynArray[address, MAX_CONFIG_ASSETS],\n    _canClaimLoot: bool,\n    _globalConfig: wcs.GlobalManagerSettings,\n    _currentTimeLock: uint256,\n    _legoBookAddr: address,\n    _walletConfig: address,\n) -> (bool, wcs.ManagerSettings):\n\n    # already a manager\n    if _isManager:\n        return False, empty(wcs.ManagerSettings)\n\n    # start delay\n    startDelay: uint256 = max(_globalConfig.startDelay, _currentTimeLock)\n    if _startDelay != 0:\n        startDelay = max(startDelay, _startDelay) # using max here as extra protection\n\n    # activation length\n    activationLength: uint256 = _globalConfig.activationLength\n    if _activationLength != 0:\n        activationLength = min(activationLength, _activationLength)\n\n    # start delay\n    if not self._validateStartDelay(startDelay, _currentTimeLock):\n        return False, empty(wcs.ManagerSettings)\n\n    # activation length\n    if not self._validateActivationLength(activationLength):\n        return False, empty(wcs.ManagerSettings)\n\n    # validate limits\n    if not self._validateManagerLimits(_limits, _globalConfig.managerPeriod):\n        return False, empty(wcs.ManagerSettings)\n\n    # validate lego perms\n    if not self._validateLegoPerms(_legoPerms, _legoBookAddr):\n        return False, empty(wcs.ManagerSettings)\n\n    # validate swap perms\n    if not self._validateSwapPerms(_swapPerms):\n        return False, empty(wcs.ManagerSettings)\n\n    # validate transfer perms\n    if not self._validateTransferPerms(_transferPerms, _walletConfig):\n        return False, empty(wcs.ManagerSettings)\n\n    # validate allowed assets\n    if not self._validateAllowedAssets(_allowedAssets):\n        return False, empty(wcs.ManagerSettings)\n\n    # create settings\n    settings: wcs.ManagerSettings = wcs.ManagerSettings(\n        startBlock = block.number + startDelay,\n        expiryBlock = block.number + startDelay + activationLength,\n        limits = _limits,\n        legoPerms = _legoPerms,\n        swapPerms = _swapPerms,\n        whitelistPerms = _whitelistPerms,\n        transferPerms = _transferPerms,\n        allowedAssets = _allowedAssets,\n        canClaimLoot = _canClaimLoot,\n    )\n    return True, settings\n\n\n# validate on update\n\n\n@view\n@external\ndef validateManagerOnUpdate(\n    _userWallet: address,\n    _manager: address,\n    _limits: wcs.ManagerLimits,\n    _legoPerms: wcs.LegoPerms,\n    _swapPerms: wcs.SwapPerms,\n    _whitelistPerms: wcs.WhitelistPerms,\n    _transferPerms: wcs.TransferPerms,\n    _allowedAssets: DynArray[address, MAX_CONFIG_ASSETS],\n    _canClaimLoot: bool,\n) -> bool:\n    config: wcs.ManagerSettingsBundle = self._getManagerSettingsBundle(_userWallet, _manager)\n    return self._validateManagerOnUpdate(config.isManager, _limits, _legoPerms, _swapPerms, _whitelistPerms, _transferPerms, _allowedAssets, _canClaimLoot, config.globalManagerSettings.managerPeriod, config.legoBook, config.walletConfig)\n\n\n@view\n@internal\ndef _validateManagerOnUpdate(\n    _isManager: bool,\n    _limits: wcs.ManagerLimits,\n    _legoPerms: wcs.LegoPerms,\n    _swapPerms: wcs.SwapPerms,\n    _whitelistPerms: wcs.WhitelistPerms,\n    _transferPerms: wcs.TransferPerms,\n    _allowedAssets: DynArray[address, MAX_CONFIG_ASSETS],\n    _canClaimLoot: bool,\n    _managerPeriod: uint256,\n    _legoBookAddr: address,\n    _walletConfig: address,\n) -> bool:\n    # must already be a manager\n    if not _isManager:\n        return False\n\n    # validate limits\n    if not self._validateManagerLimits(_limits, _managerPeriod):\n        return False\n\n    # validate lego perms\n    if not self._validateLegoPerms(_legoPerms, _legoBookAddr):\n        return False\n\n    # validate swap perms\n    if not self._validateSwapPerms(_swapPerms):\n        return False\n\n    # validate transfer perms\n    if not self._validateTransferPerms(_transferPerms, _walletConfig):\n        return False\n\n    # validate allowed assets\n    if not self._validateAllowedAssets(_allowedAssets):\n        return False\n\n    return True\n\n\n# validate global manager settings\n\n\n@view\n@external\ndef validateGlobalManagerSettings(\n    _userWallet: address,\n    _managerPeriod: uint256,\n    _startDelay: uint256,\n    _activationLength: uint256,\n    _canOwnerManage: bool,\n    _limits: wcs.ManagerLimits,\n    _legoPerms: wcs.LegoPerms,\n    _swapPerms: wcs.SwapPerms,\n    _whitelistPerms: wcs.WhitelistPerms,\n    _transferPerms: wcs.TransferPerms,\n    _allowedAssets: DynArray[address, MAX_CONFIG_ASSETS],\n) -> bool:\n    config: wcs.ManagerSettingsBundle = self._getManagerSettingsBundle(_userWallet, empty(address))\n    return self._validateGlobalManagerSettings(_managerPeriod, _startDelay, _activationLength, _canOwnerManage, _limits, _legoPerms, _swapPerms, _whitelistPerms, _transferPerms, _allowedAssets, config.timeLock, config.legoBook, config.walletConfig)\n\n\n@view\n@internal\ndef _validateGlobalManagerSettings(\n    _managerPeriod: uint256,\n    _startDelay: uint256,\n    _activationLength: uint256,\n    _canOwnerManage: bool,\n    _limits: wcs.ManagerLimits,\n    _legoPerms: wcs.LegoPerms,\n    _swapPerms: wcs.SwapPerms,\n    _whitelistPerms: wcs.WhitelistPerms,\n    _transferPerms: wcs.TransferPerms,\n    _allowedAssets: DynArray[address, MAX_CONFIG_ASSETS],\n    _currentTimeLock: uint256,\n    _legoBookAddr: address,\n    _walletConfig: address,\n) -> bool:\n\n    # manager period\n    if not self._validateManagerPeriod(_managerPeriod):\n        return False\n\n    # default start delay\n    if not self._validateStartDelay(_startDelay, _currentTimeLock):\n        return False\n\n    # default activation length\n    if not self._validateActivationLength(_activationLength):\n        return False\n\n    # validate limits\n    if not self._validateManagerLimits(_limits, _managerPeriod):\n        return False\n\n    # validate lego perms\n    if not self._validateLegoPerms(_legoPerms, _legoBookAddr):\n        return False\n\n    # validate swap perms\n    if not self._validateSwapPerms(_swapPerms):\n        return False\n\n    # validate transfer perms\n    if not self._validateTransferPerms(_transferPerms, _walletConfig):\n        return False\n\n    # validate allowed assets\n    if not self._validateAllowedAssets(_allowedAssets):\n        return False\n\n    return True\n\n\n############################\n# Manager Validation Utils #\n############################\n\n\n@view\n@internal\ndef _validateManagerPeriod(_managerPeriod: uint256) -> bool:\n    return _managerPeriod >= MIN_MANAGER_PERIOD and _managerPeriod <= MAX_MANAGER_PERIOD\n\n\n@view\n@internal\ndef _validateStartDelay(_startDelay: uint256, _currentTimeLock: uint256) -> bool:\n    return _startDelay <= MAX_START_DELAY and _startDelay >= _currentTimeLock\n\n\n@view\n@internal\ndef _validateActivationLength(_activationLength: uint256) -> bool:\n    return _activationLength >= MIN_ACTIVATION_LENGTH and _activationLength <= MAX_ACTIVATION_LENGTH\n\n\n@pure\n@internal\ndef _validateManagerLimits(_limits: wcs.ManagerLimits, _managerPeriod: uint256) -> bool:\n    # NOTE: 0 values are treated as \"unlimited\" throughout this validation\n\n    # validate if both values are non-zero (not unlimited)\n    if _limits.maxUsdValuePerTx != 0 and _limits.maxUsdValuePerPeriod != 0:\n        if _limits.maxUsdValuePerTx > _limits.maxUsdValuePerPeriod:\n            return False\n\n    # validate per-period is not less than lifetime (when both are set)\n    if _limits.maxUsdValuePerPeriod != 0 and _limits.maxUsdValueLifetime != 0:\n        if _limits.maxUsdValuePerPeriod > _limits.maxUsdValueLifetime:\n            return False\n\n    # cooldown cannot exceed period length (unless cooldown is 0 = no cooldown)\n    if _limits.txCooldownBlocks != 0 and _limits.txCooldownBlocks > _managerPeriod:\n        return False\n\n    # if any USD limits are set, failOnZeroPrice must be True\n    # to prevent bypassing limits when price data is unavailable\n    hasUsdLimits: bool = (\n        _limits.maxUsdValuePerTx != 0 or\n        _limits.maxUsdValuePerPeriod != 0 or\n        _limits.maxUsdValueLifetime != 0\n    )\n    if hasUsdLimits and not _limits.failOnZeroPrice:\n        return False\n\n    return True\n\n\n@view\n@internal\ndef _validateLegoPerms(_legoPerms: wcs.LegoPerms, _legoBookAddr: address) -> bool:\n    if len(_legoPerms.allowedLegos) == 0:\n        return True\n\n    canDoAnything: bool = (_legoPerms.canManageYield or \n                          _legoPerms.canBuyAndSell or \n                          _legoPerms.canManageDebt or \n                          _legoPerms.canManageLiq or \n                          _legoPerms.canClaimRewards)\n\n    # allowedLegos should be empty if there are no permissions\n    if not canDoAnything:\n        return False\n\n    # validate lego book address\n    if _legoBookAddr == empty(address):\n        return False\n\n    # check for duplicates and validate each lego ID\n    checkedLegos: DynArray[uint256, MAX_CONFIG_LEGOS] = []\n    for legoId: uint256 in _legoPerms.allowedLegos:\n        if not staticcall Registry(_legoBookAddr).isValidRegId(legoId):\n            return False\n        if legoId in checkedLegos:\n            return False\n        checkedLegos.append(legoId)\n\n    return True\n\n\n@view\n@internal\ndef _validateTransferPerms(_transferPerms: wcs.TransferPerms, _walletConfig: address) -> bool:\n    if len(_transferPerms.allowedPayees) == 0:\n        return True\n\n    # canTransfer should be True if there are allowed payees\n    if not _transferPerms.canTransfer:\n        return False\n\n    # validate each payee\n    checkedPayees: DynArray[address, MAX_ALLOWED_PAYEES] = []\n    for payee: address in _transferPerms.allowedPayees:\n        if payee == empty(address):\n            return False\n\n        # check if payee is valid\n        if staticcall UserWalletConfig(_walletConfig).indexOfPayee(payee) == 0:\n            return False\n\n        # check for duplicates\n        if payee in checkedPayees:\n            return False\n\n        checkedPayees.append(payee)\n\n    return True\n\n\n@pure\n@internal\ndef _validateSwapPerms(_swapPerms: wcs.SwapPerms) -> bool:\n    # maxSlippage is in basis points where 10000 = 100%\n    # cannot set slippage limit greater than 100%\n    if _swapPerms.maxSlippage > 100_00:\n        return False\n\n    # if slippage limit is configured, mustHaveUsdValue must be True\n    # (cannot validate slippage without USD values)\n    if _swapPerms.maxSlippage != 0 and not _swapPerms.mustHaveUsdValue:\n        return False\n\n    return True\n\n\n@pure\n@internal\ndef _validateAllowedAssets(_allowedAssets: DynArray[address, MAX_CONFIG_ASSETS]) -> bool:\n    if len(_allowedAssets) == 0:\n        return True\n\n    checkedAssets: DynArray[address, MAX_CONFIG_ASSETS] = []\n    for asset: address in _allowedAssets:\n        if asset == empty(address):\n            return False\n\n        # check for duplicates\n        if asset in checkedAssets:\n            return False\n        checkedAssets.append(asset)\n\n    return True\n\n\n###################\n# Wallet Defaults #\n###################\n\n\n# global manager settings\n\n\n@view\n@external\ndef createDefaultGlobalManagerSettings(\n    _managerPeriod: uint256,\n    _minTimeLock: uint256,\n    _defaultActivationLength: uint256,\n    _mustHaveUsdValueOnSwaps: bool,\n    _maxNumSwapsPerPeriod: uint256,\n    _maxSlippageOnSwaps: uint256,\n    _onlyApprovedYieldOpps: bool,\n) -> wcs.GlobalManagerSettings:\n    config: wcs.GlobalManagerSettings = empty(wcs.GlobalManagerSettings)\n    config.managerPeriod = _managerPeriod\n    config.startDelay = _minTimeLock\n    config.activationLength = _defaultActivationLength\n    config.canOwnerManage = True\n    config.legoPerms, config.swapPerms, config.whitelistPerms, config.transferPerms = self._createHappyManagerDefaults(_mustHaveUsdValueOnSwaps, _maxNumSwapsPerPeriod, _maxSlippageOnSwaps, _onlyApprovedYieldOpps)\n    return config\n\n\n# starter agent settings\n\n\n@view\n@external\ndef createStarterAgentSettings(_startingAgentActivationLength: uint256) -> wcs.ManagerSettings:\n    config: wcs.ManagerSettings = wcs.ManagerSettings(\n        startBlock = block.number,\n        expiryBlock = block.number + _startingAgentActivationLength,\n        limits = empty(wcs.ManagerLimits),\n        legoPerms = empty(wcs.LegoPerms),\n        swapPerms = empty(wcs.SwapPerms),\n        whitelistPerms = empty(wcs.WhitelistPerms),\n        transferPerms = empty(wcs.TransferPerms),\n        allowedAssets = [],\n        canClaimLoot = True,\n    )\n    config.legoPerms, config.swapPerms, config.whitelistPerms, config.transferPerms = self._createHappyManagerDefaults(False, 0, 0, False)\n    return config\n\n\n# happy defaults\n\n\n@pure\n@internal\ndef _createHappyManagerDefaults(\n    _mustHaveUsdValueOnSwaps: bool,\n    _maxNumSwapsPerPeriod: uint256,\n    _maxSlippageOnSwaps: uint256,\n    _onlyApprovedYieldOpps: bool,\n) -> (wcs.LegoPerms, wcs.SwapPerms, wcs.WhitelistPerms, wcs.TransferPerms):\n    return wcs.LegoPerms(\n        canManageYield = True,\n        canBuyAndSell = True,\n        canManageDebt = True,\n        canManageLiq = True,\n        canClaimRewards = True,\n        onlyApprovedYieldOpps = _onlyApprovedYieldOpps,\n        allowedLegos = [],\n    ), wcs.SwapPerms(\n        mustHaveUsdValue = _mustHaveUsdValueOnSwaps,\n        maxNumSwapsPerPeriod = _maxNumSwapsPerPeriod,\n        maxSlippage = _maxSlippageOnSwaps,\n    ), wcs.WhitelistPerms(\n        canAddPending = False,\n        canConfirm = True,\n        canCancel = True,\n        canRemove = False,\n    ), wcs.TransferPerms(\n        canTransfer = True,\n        canCreateCheque = True,\n        canAddPendingPayee = True,\n        allowedPayees = [],\n    )\n\n\n#############\n# Utilities #\n#############\n\n\n# is valid user wallet\n\n\n@view\n@internal\ndef _isValidUserWallet(_userWallet: address) -> bool:\n    ledger: address = staticcall Registry(UNDY_HQ).getAddr(LEDGER_ID)\n    return staticcall Ledger(ledger).isUserWallet(_userWallet)\n\n\n# can perform security action\n\n\n@view\n@internal\ndef _canPerformSecurityAction(_addr: address) -> bool:\n    missionControl: address = staticcall Registry(UNDY_HQ).getAddr(MISSION_CONTROL_ID)\n    if missionControl == empty(address):\n        return False\n    return staticcall MissionControl(missionControl).canPerformSecurityAction(_addr)\n\n\n# manager settings bundle\n\n\n@view\n@external\ndef getManagerSettingsBundle(_userWallet: address, _manager: address) -> wcs.ManagerSettingsBundle:\n    return self._getManagerSettingsBundle(_userWallet, _manager)\n\n\n@view\n@internal\ndef _getManagerSettingsBundle(_userWallet: address, _manager: address) -> wcs.ManagerSettingsBundle:\n    walletConfig: address = staticcall UserWallet(_userWallet).walletConfig()\n    return wcs.ManagerSettingsBundle(\n        owner = staticcall UserWalletConfig(walletConfig).owner(),\n        isManager = staticcall UserWalletConfig(walletConfig).indexOfManager(_manager) != 0,\n        timeLock = staticcall UserWalletConfig(walletConfig).timeLock(),\n        walletConfig = walletConfig,\n        legoBook = staticcall Registry(UNDY_HQ).getAddr(LEGO_BOOK_ID),\n        globalManagerSettings = staticcall UserWalletConfig(walletConfig).globalManagerSettings(),\n    )\n",
            "sha256sum": "4f0cb92a1f731631c085b26ab21ea8d664658594cd0c329fce8450816df0a1ca"
          }
        },
        "settings": {
          "outputSelection": {
            "contracts/core/walletBackpack/HighCommand.vy": [
              "*"
            ]
          },
          "search_paths": [
            "."
          ]
        },
        "compiler_version": "v0.4.3+commit.bff19ea2",
        "integrity": "2a9fee4b266eba06f4e1a831f5cc8131bcff51489b1768d8fcf7940c693590da"
      },
      "args": "00000000000000000000000044cf3c4f000dfd76a35d03298049d37be688d6f9000000000000000000000000000000000000000000000000000000000000a8c00000000000000000000000000000000000000000000000000000000001e13380000000000000000000000000000000000000000000000000000000000000a8c00000000000000000000000000000000000000000000000000000000005a39a8000000000000000000000000000000000000000000000000000000000003b5380",
      "file": "contracts/core/walletBackpack/HighCommand.vy"
    },
    "Paymaster": {
      "address": "0x80bf71E098Dc328D87456c34675C2B4C10a1AFCb",
      "abi": [
        {
          "name": "PayeeAdded",
          "inputs": [
            {
              "name": "user",
              "type": "address",
              "indexed": true
            },
            {
              "name": "payee",
              "type": "address",
              "indexed": true
            },
            {
              "name": "startBlock",
              "type": "uint256",
              "indexed": false
            },
            {
              "name": "expiryBlock",
              "type": "uint256",
              "indexed": false
            },
            {
              "name": "canPull",
              "type": "bool",
              "indexed": false
            },
            {
              "name": "periodLength",
              "type": "uint256",
              "indexed": false
            },
            {
              "name": "maxNumTxsPerPeriod",
              "type": "uint256",
              "indexed": false
            },
            {
              "name": "txCooldownBlocks",
              "type": "uint256",
              "indexed": false
            },
            {
              "name": "failOnZeroPrice",
              "type": "bool",
              "indexed": false
            },
            {
              "name": "primaryAsset",
              "type": "address",
              "indexed": false
            },
            {
              "name": "onlyPrimaryAsset",
              "type": "bool",
              "indexed": false
            },
            {
              "name": "unitPerTxCap",
              "type": "uint256",
              "indexed": false
            },
            {
              "name": "unitPerPeriodCap",
              "type": "uint256",
              "indexed": false
            },
            {
              "name": "unitLifetimeCap",
              "type": "uint256",
              "indexed": false
            },
            {
              "name": "usdPerTxCap",
              "type": "uint256",
              "indexed": false
            },
            {
              "name": "usdPerPeriodCap",
              "type": "uint256",
              "indexed": false
            },
            {
              "name": "usdLifetimeCap",
              "type": "uint256",
              "indexed": false
            }
          ],
          "anonymous": false,
          "type": "event"
        },
        {
          "name": "PayeeUpdated",
          "inputs": [
            {
              "name": "user",
              "type": "address",
              "indexed": true
            },
            {
              "name": "payee",
              "type": "address",
              "indexed": true
            },
            {
              "name": "startBlock",
              "type": "uint256",
              "indexed": false
            },
            {
              "name": "expiryBlock",
              "type": "uint256",
              "indexed": false
            },
            {
              "name": "canPull",
              "type": "bool",
              "indexed": false
            },
            {
              "name": "periodLength",
              "type": "uint256",
              "indexed": false
            },
            {
              "name": "maxNumTxsPerPeriod",
              "type": "uint256",
              "indexed": false
            },
            {
              "name": "txCooldownBlocks",
              "type": "uint256",
              "indexed": false
            },
            {
              "name": "failOnZeroPrice",
              "type": "bool",
              "indexed": false
            },
            {
              "name": "primaryAsset",
              "type": "address",
              "indexed": false
            },
            {
              "name": "onlyPrimaryAsset",
              "type": "bool",
              "indexed": false
            },
            {
              "name": "unitPerTxCap",
              "type": "uint256",
              "indexed": false
            },
            {
              "name": "unitPerPeriodCap",
              "type": "uint256",
              "indexed": false
            },
            {
              "name": "unitLifetimeCap",
              "type": "uint256",
              "indexed": false
            },
            {
              "name": "usdPerTxCap",
              "type": "uint256",
              "indexed": false
            },
            {
              "name": "usdPerPeriodCap",
              "type": "uint256",
              "indexed": false
            },
            {
              "name": "usdLifetimeCap",
              "type": "uint256",
              "indexed": false
            }
          ],
          "anonymous": false,
          "type": "event"
        },
        {
          "name": "PayeeRemoved",
          "inputs": [
            {
              "name": "user",
              "type": "address",
              "indexed": true
            },
            {
              "name": "payee",
              "type": "address",
              "indexed": true
            },
            {
              "name": "removedBy",
              "type": "address",
              "indexed": true
            }
          ],
          "anonymous": false,
          "type": "event"
        },
        {
          "name": "GlobalPayeeSettingsModified",
          "inputs": [
            {
              "name": "user",
              "type": "address",
              "indexed": true
            },
            {
              "name": "defaultPeriodLength",
              "type": "uint256",
              "indexed": false
            },
            {
              "name": "startDelay",
              "type": "uint256",
              "indexed": false
            },
            {
              "name": "activationLength",
              "type": "uint256",
              "indexed": false
            },
            {
              "name": "maxNumTxsPerPeriod",
              "type": "uint256",
              "indexed": false
            },
            {
              "name": "txCooldownBlocks",
              "type": "uint256",
              "indexed": false
            },
            {
              "name": "failOnZeroPrice",
              "type": "bool",
              "indexed": false
            },
            {
              "name": "canPayOwner",
              "type": "bool",
              "indexed": false
            },
            {
              "name": "canPull",
              "type": "bool",
              "indexed": false
            },
            {
              "name": "usdPerTxCap",
              "type": "uint256",
              "indexed": false
            },
            {
              "name": "usdPerPeriodCap",
              "type": "uint256",
              "indexed": false
            },
            {
              "name": "usdLifetimeCap",
              "type": "uint256",
              "indexed": false
            }
          ],
          "anonymous": false,
          "type": "event"
        },
        {
          "name": "PayeePending",
          "inputs": [
            {
              "name": "user",
              "type": "address",
              "indexed": true
            },
            {
              "name": "payee",
              "type": "address",
              "indexed": true
            },
            {
              "name": "confirmBlock",
              "type": "uint256",
              "indexed": false
            },
            {
              "name": "addedBy",
              "type": "address",
              "indexed": true
            },
            {
              "name": "canPull",
              "type": "bool",
              "indexed": false
            },
            {
              "name": "periodLength",
              "type": "uint256",
              "indexed": false
            },
            {
              "name": "maxNumTxsPerPeriod",
              "type": "uint256",
              "indexed": false
            },
            {
              "name": "txCooldownBlocks",
              "type": "uint256",
              "indexed": false
            },
            {
              "name": "failOnZeroPrice",
              "type": "bool",
              "indexed": false
            },
            {
              "name": "primaryAsset",
              "type": "address",
              "indexed": false
            },
            {
              "name": "onlyPrimaryAsset",
              "type": "bool",
              "indexed": false
            },
            {
              "name": "unitPerTxCap",
              "type": "uint256",
              "indexed": false
            },
            {
              "name": "unitPerPeriodCap",
              "type": "uint256",
              "indexed": false
            },
            {
              "name": "unitLifetimeCap",
              "type": "uint256",
              "indexed": false
            },
            {
              "name": "usdPerTxCap",
              "type": "uint256",
              "indexed": false
            },
            {
              "name": "usdPerPeriodCap",
              "type": "uint256",
              "indexed": false
            },
            {
              "name": "usdLifetimeCap",
              "type": "uint256",
              "indexed": false
            }
          ],
          "anonymous": false,
          "type": "event"
        },
        {
          "name": "PayeePendingConfirmed",
          "inputs": [
            {
              "name": "user",
              "type": "address",
              "indexed": true
            },
            {
              "name": "payee",
              "type": "address",
              "indexed": true
            },
            {
              "name": "initiatedBlock",
              "type": "uint256",
              "indexed": false
            },
            {
              "name": "confirmBlock",
              "type": "uint256",
              "indexed": false
            },
            {
              "name": "confirmedBy",
              "type": "address",
              "indexed": true
            }
          ],
          "anonymous": false,
          "type": "event"
        },
        {
          "name": "PayeePendingCancelled",
          "inputs": [
            {
              "name": "user",
              "type": "address",
              "indexed": true
            },
            {
              "name": "payee",
              "type": "address",
              "indexed": true
            },
            {
              "name": "initiatedBlock",
              "type": "uint256",
              "indexed": false
            },
            {
              "name": "confirmBlock",
              "type": "uint256",
              "indexed": false
            },
            {
              "name": "cancelledBy",
              "type": "address",
              "indexed": true
            }
          ],
          "anonymous": false,
          "type": "event"
        },
        {
          "stateMutability": "nonpayable",
          "type": "function",
          "name": "setGlobalPayeeSettings",
          "inputs": [
            {
              "name": "_userWallet",
              "type": "address"
            },
            {
              "name": "_defaultPeriodLength",
              "type": "uint256"
            },
            {
              "name": "_startDelay",
              "type": "uint256"
            },
            {
              "name": "_activationLength",
              "type": "uint256"
            },
            {
              "name": "_maxNumTxsPerPeriod",
              "type": "uint256"
            },
            {
              "name": "_txCooldownBlocks",
              "type": "uint256"
            },
            {
              "name": "_failOnZeroPrice",
              "type": "bool"
            },
            {
              "name": "_usdLimits",
              "type": "tuple",
              "components": [
                {
                  "name": "perTxCap",
                  "type": "uint256"
                },
                {
                  "name": "perPeriodCap",
                  "type": "uint256"
                },
                {
                  "name": "lifetimeCap",
                  "type": "uint256"
                }
              ]
            },
            {
              "name": "_canPayOwner",
              "type": "bool"
            },
            {
              "name": "_canPull",
              "type": "bool"
            }
          ],
          "outputs": [
            {
              "name": "",
              "type": "bool"
            }
          ]
        },
        {
          "stateMutability": "nonpayable",
          "type": "function",
          "name": "addPayee",
          "inputs": [
            {
              "name": "_userWallet",
              "type": "address"
            },
            {
              "name": "_payee",
              "type": "address"
            },
            {
              "name": "_canPull",
              "type": "bool"
            },
            {
              "name": "_periodLength",
              "type": "uint256"
            },
            {
              "name": "_maxNumTxsPerPeriod",
              "type": "uint256"
            },
            {
              "name": "_txCooldownBlocks",
              "type": "uint256"
            },
            {
              "name": "_failOnZeroPrice",
              "type": "bool"
            },
            {
              "name": "_primaryAsset",
              "type": "address"
            },
            {
              "name": "_onlyPrimaryAsset",
              "type": "bool"
            },
            {
              "name": "_unitLimits",
              "type": "tuple",
              "components": [
                {
                  "name": "perTxCap",
                  "type": "uint256"
                },
                {
                  "name": "perPeriodCap",
                  "type": "uint256"
                },
                {
                  "name": "lifetimeCap",
                  "type": "uint256"
                }
              ]
            },
            {
              "name": "_usdLimits",
              "type": "tuple",
              "components": [
                {
                  "name": "perTxCap",
                  "type": "uint256"
                },
                {
                  "name": "perPeriodCap",
                  "type": "uint256"
                },
                {
                  "name": "lifetimeCap",
                  "type": "uint256"
                }
              ]
            }
          ],
          "outputs": [
            {
              "name": "",
              "type": "bool"
            }
          ]
        },
        {
          "stateMutability": "nonpayable",
          "type": "function",
          "name": "addPayee",
          "inputs": [
            {
              "name": "_userWallet",
              "type": "address"
            },
            {
              "name": "_payee",
              "type": "address"
            },
            {
              "name": "_canPull",
              "type": "bool"
            },
            {
              "name": "_periodLength",
              "type": "uint256"
            },
            {
              "name": "_maxNumTxsPerPeriod",
              "type": "uint256"
            },
            {
              "name": "_txCooldownBlocks",
              "type": "uint256"
            },
            {
              "name": "_failOnZeroPrice",
              "type": "bool"
            },
            {
              "name": "_primaryAsset",
              "type": "address"
            },
            {
              "name": "_onlyPrimaryAsset",
              "type": "bool"
            },
            {
              "name": "_unitLimits",
              "type": "tuple",
              "components": [
                {
                  "name": "perTxCap",
                  "type": "uint256"
                },
                {
                  "name": "perPeriodCap",
                  "type": "uint256"
                },
                {
                  "name": "lifetimeCap",
                  "type": "uint256"
                }
              ]
            },
            {
              "name": "_usdLimits",
              "type": "tuple",
              "components": [
                {
                  "name": "perTxCap",
                  "type": "uint256"
                },
                {
                  "name": "perPeriodCap",
                  "type": "uint256"
                },
                {
                  "name": "lifetimeCap",
                  "type": "uint256"
                }
              ]
            },
            {
              "name": "_startDelay",
              "type": "uint256"
            }
          ],
          "outputs": [
            {
              "name": "",
              "type": "bool"
            }
          ]
        },
        {
          "stateMutability": "nonpayable",
          "type": "function",
          "name": "addPayee",
          "inputs": [
            {
              "name": "_userWallet",
              "type": "address"
            },
            {
              "name": "_payee",
              "type": "address"
            },
            {
              "name": "_canPull",
              "type": "bool"
            },
            {
              "name": "_periodLength",
              "type": "uint256"
            },
            {
              "name": "_maxNumTxsPerPeriod",
              "type": "uint256"
            },
            {
              "name": "_txCooldownBlocks",
              "type": "uint256"
            },
            {
              "name": "_failOnZeroPrice",
              "type": "bool"
            },
            {
              "name": "_primaryAsset",
              "type": "address"
            },
            {
              "name": "_onlyPrimaryAsset",
              "type": "bool"
            },
            {
              "name": "_unitLimits",
              "type": "tuple",
              "components": [
                {
                  "name": "perTxCap",
                  "type": "uint256"
                },
                {
                  "name": "perPeriodCap",
                  "type": "uint256"
                },
                {
                  "name": "lifetimeCap",
                  "type": "uint256"
                }
              ]
            },
            {
              "name": "_usdLimits",
              "type": "tuple",
              "components": [
                {
                  "name": "perTxCap",
                  "type": "uint256"
                },
                {
                  "name": "perPeriodCap",
                  "type": "uint256"
                },
                {
                  "name": "lifetimeCap",
                  "type": "uint256"
                }
              ]
            },
            {
              "name": "_startDelay",
              "type": "uint256"
            },
            {
              "name": "_activationLength",
              "type": "uint256"
            }
          ],
          "outputs": [
            {
              "name": "",
              "type": "bool"
            }
          ]
        },
        {
          "stateMutability": "nonpayable",
          "type": "function",
          "name": "updatePayee",
          "inputs": [
            {
              "name": "_userWallet",
              "type": "address"
            },
            {
              "name": "_payee",
              "type": "address"
            },
            {
              "name": "_canPull",
              "type": "bool"
            },
            {
              "name": "_periodLength",
              "type": "uint256"
            },
            {
              "name": "_maxNumTxsPerPeriod",
              "type": "uint256"
            },
            {
              "name": "_txCooldownBlocks",
              "type": "uint256"
            },
            {
              "name": "_failOnZeroPrice",
              "type": "bool"
            },
            {
              "name": "_primaryAsset",
              "type": "address"
            },
            {
              "name": "_onlyPrimaryAsset",
              "type": "bool"
            },
            {
              "name": "_unitLimits",
              "type": "tuple",
              "components": [
                {
                  "name": "perTxCap",
                  "type": "uint256"
                },
                {
                  "name": "perPeriodCap",
                  "type": "uint256"
                },
                {
                  "name": "lifetimeCap",
                  "type": "uint256"
                }
              ]
            },
            {
              "name": "_usdLimits",
              "type": "tuple",
              "components": [
                {
                  "name": "perTxCap",
                  "type": "uint256"
                },
                {
                  "name": "perPeriodCap",
                  "type": "uint256"
                },
                {
                  "name": "lifetimeCap",
                  "type": "uint256"
                }
              ]
            }
          ],
          "outputs": [
            {
              "name": "",
              "type": "bool"
            }
          ]
        },
        {
          "stateMutability": "nonpayable",
          "type": "function",
          "name": "removePayee",
          "inputs": [
            {
              "name": "_userWallet",
              "type": "address"
            },
            {
              "name": "_payee",
              "type": "address"
            }
          ],
          "outputs": [
            {
              "name": "",
              "type": "bool"
            }
          ]
        },
        {
          "stateMutability": "nonpayable",
          "type": "function",
          "name": "addPendingPayee",
          "inputs": [
            {
              "name": "_userWallet",
              "type": "address"
            },
            {
              "name": "_payee",
              "type": "address"
            },
            {
              "name": "_canPull",
              "type": "bool"
            },
            {
              "name": "_periodLength",
              "type": "uint256"
            },
            {
              "name": "_maxNumTxsPerPeriod",
              "type": "uint256"
            },
            {
              "name": "_txCooldownBlocks",
              "type": "uint256"
            },
            {
              "name": "_failOnZeroPrice",
              "type": "bool"
            },
            {
              "name": "_primaryAsset",
              "type": "address"
            },
            {
              "name": "_onlyPrimaryAsset",
              "type": "bool"
            },
            {
              "name": "_unitLimits",
              "type": "tuple",
              "components": [
                {
                  "name": "perTxCap",
                  "type": "uint256"
                },
                {
                  "name": "perPeriodCap",
                  "type": "uint256"
                },
                {
                  "name": "lifetimeCap",
                  "type": "uint256"
                }
              ]
            },
            {
              "name": "_usdLimits",
              "type": "tuple",
              "components": [
                {
                  "name": "perTxCap",
                  "type": "uint256"
                },
                {
                  "name": "perPeriodCap",
                  "type": "uint256"
                },
                {
                  "name": "lifetimeCap",
                  "type": "uint256"
                }
              ]
            }
          ],
          "outputs": [
            {
              "name": "",
              "type": "bool"
            }
          ]
        },
        {
          "stateMutability": "nonpayable",
          "type": "function",
          "name": "addPendingPayee",
          "inputs": [
            {
              "name": "_userWallet",
              "type": "address"
            },
            {
              "name": "_payee",
              "type": "address"
            },
            {
              "name": "_canPull",
              "type": "bool"
            },
            {
              "name": "_periodLength",
              "type": "uint256"
            },
            {
              "name": "_maxNumTxsPerPeriod",
              "type": "uint256"
            },
            {
              "name": "_txCooldownBlocks",
              "type": "uint256"
            },
            {
              "name": "_failOnZeroPrice",
              "type": "bool"
            },
            {
              "name": "_primaryAsset",
              "type": "address"
            },
            {
              "name": "_onlyPrimaryAsset",
              "type": "bool"
            },
            {
              "name": "_unitLimits",
              "type": "tuple",
              "components": [
                {
                  "name": "perTxCap",
                  "type": "uint256"
                },
                {
                  "name": "perPeriodCap",
                  "type": "uint256"
                },
                {
                  "name": "lifetimeCap",
                  "type": "uint256"
                }
              ]
            },
            {
              "name": "_usdLimits",
              "type": "tuple",
              "components": [
                {
                  "name": "perTxCap",
                  "type": "uint256"
                },
                {
                  "name": "perPeriodCap",
                  "type": "uint256"
                },
                {
                  "name": "lifetimeCap",
                  "type": "uint256"
                }
              ]
            },
            {
              "name": "_startDelay",
              "type": "uint256"
            }
          ],
          "outputs": [
            {
              "name": "",
              "type": "bool"
            }
          ]
        },
        {
          "stateMutability": "nonpayable",
          "type": "function",
          "name": "addPendingPayee",
          "inputs": [
            {
              "name": "_userWallet",
              "type": "address"
            },
            {
              "name": "_payee",
              "type": "address"
            },
            {
              "name": "_canPull",
              "type": "bool"
            },
            {
              "name": "_periodLength",
              "type": "uint256"
            },
            {
              "name": "_maxNumTxsPerPeriod",
              "type": "uint256"
            },
            {
              "name": "_txCooldownBlocks",
              "type": "uint256"
            },
            {
              "name": "_failOnZeroPrice",
              "type": "bool"
            },
            {
              "name": "_primaryAsset",
              "type": "address"
            },
            {
              "name": "_onlyPrimaryAsset",
              "type": "bool"
            },
            {
              "name": "_unitLimits",
              "type": "tuple",
              "components": [
                {
                  "name": "perTxCap",
                  "type": "uint256"
                },
                {
                  "name": "perPeriodCap",
                  "type": "uint256"
                },
                {
                  "name": "lifetimeCap",
                  "type": "uint256"
                }
              ]
            },
            {
              "name": "_usdLimits",
              "type": "tuple",
              "components": [
                {
                  "name": "perTxCap",
                  "type": "uint256"
                },
                {
                  "name": "perPeriodCap",
                  "type": "uint256"
                },
                {
                  "name": "lifetimeCap",
                  "type": "uint256"
                }
              ]
            },
            {
              "name": "_startDelay",
              "type": "uint256"
            },
            {
              "name": "_activationLength",
              "type": "uint256"
            }
          ],
          "outputs": [
            {
              "name": "",
              "type": "bool"
            }
          ]
        },
        {
          "stateMutability": "nonpayable",
          "type": "function",
          "name": "confirmPendingPayee",
          "inputs": [
            {
              "name": "_userWallet",
              "type": "address"
            },
            {
              "name": "_payee",
              "type": "address"
            }
          ],
          "outputs": [
            {
              "name": "",
              "type": "bool"
            }
          ]
        },
        {
          "stateMutability": "nonpayable",
          "type": "function",
          "name": "cancelPendingPayee",
          "inputs": [
            {
              "name": "_userWallet",
              "type": "address"
            },
            {
              "name": "_payee",
              "type": "address"
            }
          ],
          "outputs": [
            {
              "name": "",
              "type": "bool"
            }
          ]
        },
        {
          "stateMutability": "view",
          "type": "function",
          "name": "isValidNewPayee",
          "inputs": [
            {
              "name": "_userWallet",
              "type": "address"
            },
            {
              "name": "_payee",
              "type": "address"
            },
            {
              "name": "_canPull",
              "type": "bool"
            },
            {
              "name": "_periodLength",
              "type": "uint256"
            },
            {
              "name": "_maxNumTxsPerPeriod",
              "type": "uint256"
            },
            {
              "name": "_txCooldownBlocks",
              "type": "uint256"
            },
            {
              "name": "_failOnZeroPrice",
              "type": "bool"
            },
            {
              "name": "_primaryAsset",
              "type": "address"
            },
            {
              "name": "_onlyPrimaryAsset",
              "type": "bool"
            },
            {
              "name": "_unitLimits",
              "type": "tuple",
              "components": [
                {
                  "name": "perTxCap",
                  "type": "uint256"
                },
                {
                  "name": "perPeriodCap",
                  "type": "uint256"
                },
                {
                  "name": "lifetimeCap",
                  "type": "uint256"
                }
              ]
            },
            {
              "name": "_usdLimits",
              "type": "tuple",
              "components": [
                {
                  "name": "perTxCap",
                  "type": "uint256"
                },
                {
                  "name": "perPeriodCap",
                  "type": "uint256"
                },
                {
                  "name": "lifetimeCap",
                  "type": "uint256"
                }
              ]
            }
          ],
          "outputs": [
            {
              "name": "",
              "type": "bool"
            }
          ]
        },
        {
          "stateMutability": "view",
          "type": "function",
          "name": "isValidNewPayee",
          "inputs": [
            {
              "name": "_userWallet",
              "type": "address"
            },
            {
              "name": "_payee",
              "type": "address"
            },
            {
              "name": "_canPull",
              "type": "bool"
            },
            {
              "name": "_periodLength",
              "type": "uint256"
            },
            {
              "name": "_maxNumTxsPerPeriod",
              "type": "uint256"
            },
            {
              "name": "_txCooldownBlocks",
              "type": "uint256"
            },
            {
              "name": "_failOnZeroPrice",
              "type": "bool"
            },
            {
              "name": "_primaryAsset",
              "type": "address"
            },
            {
              "name": "_onlyPrimaryAsset",
              "type": "bool"
            },
            {
              "name": "_unitLimits",
              "type": "tuple",
              "components": [
                {
                  "name": "perTxCap",
                  "type": "uint256"
                },
                {
                  "name": "perPeriodCap",
                  "type": "uint256"
                },
                {
                  "name": "lifetimeCap",
                  "type": "uint256"
                }
              ]
            },
            {
              "name": "_usdLimits",
              "type": "tuple",
              "components": [
                {
                  "name": "perTxCap",
                  "type": "uint256"
                },
                {
                  "name": "perPeriodCap",
                  "type": "uint256"
                },
                {
                  "name": "lifetimeCap",
                  "type": "uint256"
                }
              ]
            },
            {
              "name": "_startDelay",
              "type": "uint256"
            }
          ],
          "outputs": [
            {
              "name": "",
              "type": "bool"
            }
          ]
        },
        {
          "stateMutability": "view",
          "type": "function",
          "name": "isValidNewPayee",
          "inputs": [
            {
              "name": "_userWallet",
              "type": "address"
            },
            {
              "name": "_payee",
              "type": "address"
            },
            {
              "name": "_canPull",
              "type": "bool"
            },
            {
              "name": "_periodLength",
              "type": "uint256"
            },
            {
              "name": "_maxNumTxsPerPeriod",
              "type": "uint256"
            },
            {
              "name": "_txCooldownBlocks",
              "type": "uint256"
            },
            {
              "name": "_failOnZeroPrice",
              "type": "bool"
            },
            {
              "name": "_primaryAsset",
              "type": "address"
            },
            {
              "name": "_onlyPrimaryAsset",
              "type": "bool"
            },
            {
              "name": "_unitLimits",
              "type": "tuple",
              "components": [
                {
                  "name": "perTxCap",
                  "type": "uint256"
                },
                {
                  "name": "perPeriodCap",
                  "type": "uint256"
                },
                {
                  "name": "lifetimeCap",
                  "type": "uint256"
                }
              ]
            },
            {
              "name": "_usdLimits",
              "type": "tuple",
              "components": [
                {
                  "name": "perTxCap",
                  "type": "uint256"
                },
                {
                  "name": "perPeriodCap",
                  "type": "uint256"
                },
                {
                  "name": "lifetimeCap",
                  "type": "uint256"
                }
              ]
            },
            {
              "name": "_startDelay",
              "type": "uint256"
            },
            {
              "name": "_activationLength",
              "type": "uint256"
            }
          ],
          "outputs": [
            {
              "name": "",
              "type": "bool"
            }
          ]
        },
        {
          "stateMutability": "view",
          "type": "function",
          "name": "isValidPayeeUpdate",
          "inputs": [
            {
              "name": "_userWallet",
              "type": "address"
            },
            {
              "name": "_payee",
              "type": "address"
            },
            {
              "name": "_canPull",
              "type": "bool"
            },
            {
              "name": "_periodLength",
              "type": "uint256"
            },
            {
              "name": "_maxNumTxsPerPeriod",
              "type": "uint256"
            },
            {
              "name": "_txCooldownBlocks",
              "type": "uint256"
            },
            {
              "name": "_failOnZeroPrice",
              "type": "bool"
            },
            {
              "name": "_primaryAsset",
              "type": "address"
            },
            {
              "name": "_onlyPrimaryAsset",
              "type": "bool"
            },
            {
              "name": "_unitLimits",
              "type": "tuple",
              "components": [
                {
                  "name": "perTxCap",
                  "type": "uint256"
                },
                {
                  "name": "perPeriodCap",
                  "type": "uint256"
                },
                {
                  "name": "lifetimeCap",
                  "type": "uint256"
                }
              ]
            },
            {
              "name": "_usdLimits",
              "type": "tuple",
              "components": [
                {
                  "name": "perTxCap",
                  "type": "uint256"
                },
                {
                  "name": "perPeriodCap",
                  "type": "uint256"
                },
                {
                  "name": "lifetimeCap",
                  "type": "uint256"
                }
              ]
            }
          ],
          "outputs": [
            {
              "name": "",
              "type": "bool"
            }
          ]
        },
        {
          "stateMutability": "view",
          "type": "function",
          "name": "canAddPendingPayee",
          "inputs": [
            {
              "name": "_userWallet",
              "type": "address"
            },
            {
              "name": "_payee",
              "type": "address"
            },
            {
              "name": "_caller",
              "type": "address"
            }
          ],
          "outputs": [
            {
              "name": "",
              "type": "bool"
            }
          ]
        },
        {
          "stateMutability": "view",
          "type": "function",
          "name": "isValidGlobalPayeeSettings",
          "inputs": [
            {
              "name": "_userWallet",
              "type": "address"
            },
            {
              "name": "_defaultPeriodLength",
              "type": "uint256"
            },
            {
              "name": "_startDelay",
              "type": "uint256"
            },
            {
              "name": "_activationLength",
              "type": "uint256"
            },
            {
              "name": "_maxNumTxsPerPeriod",
              "type": "uint256"
            },
            {
              "name": "_txCooldownBlocks",
              "type": "uint256"
            },
            {
              "name": "_failOnZeroPrice",
              "type": "bool"
            },
            {
              "name": "_usdLimits",
              "type": "tuple",
              "components": [
                {
                  "name": "perTxCap",
                  "type": "uint256"
                },
                {
                  "name": "perPeriodCap",
                  "type": "uint256"
                },
                {
                  "name": "lifetimeCap",
                  "type": "uint256"
                }
              ]
            },
            {
              "name": "_canPayOwner",
              "type": "bool"
            },
            {
              "name": "_canPull",
              "type": "bool"
            }
          ],
          "outputs": [
            {
              "name": "",
              "type": "bool"
            }
          ]
        },
        {
          "stateMutability": "view",
          "type": "function",
          "name": "getPayeeConfig",
          "inputs": [
            {
              "name": "_userWallet",
              "type": "address"
            },
            {
              "name": "_payee",
              "type": "address"
            }
          ],
          "outputs": [
            {
              "name": "",
              "type": "tuple",
              "components": [
                {
                  "name": "owner",
                  "type": "address"
                },
                {
                  "name": "wallet",
                  "type": "address"
                },
                {
                  "name": "isRegisteredPayee",
                  "type": "bool"
                },
                {
                  "name": "isWhitelisted",
                  "type": "bool"
                },
                {
                  "name": "isExistingCheque",
                  "type": "bool"
                },
                {
                  "name": "payeeSettings",
                  "type": "tuple",
                  "components": [
                    {
                      "name": "startBlock",
                      "type": "uint256"
                    },
                    {
                      "name": "expiryBlock",
                      "type": "uint256"
                    },
                    {
                      "name": "canPull",
                      "type": "bool"
                    },
                    {
                      "name": "periodLength",
                      "type": "uint256"
                    },
                    {
                      "name": "maxNumTxsPerPeriod",
                      "type": "uint256"
                    },
                    {
                      "name": "txCooldownBlocks",
                      "type": "uint256"
                    },
                    {
                      "name": "failOnZeroPrice",
                      "type": "bool"
                    },
                    {
                      "name": "primaryAsset",
                      "type": "address"
                    },
                    {
                      "name": "onlyPrimaryAsset",
                      "type": "bool"
                    },
                    {
                      "name": "unitLimits",
                      "type": "tuple",
                      "components": [
                        {
                          "name": "perTxCap",
                          "type": "uint256"
                        },
                        {
                          "name": "perPeriodCap",
                          "type": "uint256"
                        },
                        {
                          "name": "lifetimeCap",
                          "type": "uint256"
                        }
                      ]
                    },
                    {
                      "name": "usdLimits",
                      "type": "tuple",
                      "components": [
                        {
                          "name": "perTxCap",
                          "type": "uint256"
                        },
                        {
                          "name": "perPeriodCap",
                          "type": "uint256"
                        },
                        {
                          "name": "lifetimeCap",
                          "type": "uint256"
                        }
                      ]
                    }
                  ]
                },
                {
                  "name": "globalPayeeSettings",
                  "type": "tuple",
                  "components": [
                    {
                      "name": "defaultPeriodLength",
                      "type": "uint256"
                    },
                    {
                      "name": "startDelay",
                      "type": "uint256"
                    },
                    {
                      "name": "activationLength",
                      "type": "uint256"
                    },
                    {
                      "name": "maxNumTxsPerPeriod",
                      "type": "uint256"
                    },
                    {
                      "name": "txCooldownBlocks",
                      "type": "uint256"
                    },
                    {
                      "name": "failOnZeroPrice",
                      "type": "bool"
                    },
                    {
                      "name": "usdLimits",
                      "type": "tuple",
                      "components": [
                        {
                          "name": "perTxCap",
                          "type": "uint256"
                        },
                        {
                          "name": "perPeriodCap",
                          "type": "uint256"
                        },
                        {
                          "name": "lifetimeCap",
                          "type": "uint256"
                        }
                      ]
                    },
                    {
                      "name": "canPayOwner",
                      "type": "bool"
                    },
                    {
                      "name": "canPull",
                      "type": "bool"
                    }
                  ]
                },
                {
                  "name": "timeLock",
                  "type": "uint256"
                },
                {
                  "name": "walletConfig",
                  "type": "address"
                }
              ]
            }
          ]
        },
        {
          "stateMutability": "view",
          "type": "function",
          "name": "createDefaultGlobalPayeeSettings",
          "inputs": [
            {
              "name": "_defaultPeriodLength",
              "type": "uint256"
            },
            {
              "name": "_startDelay",
              "type": "uint256"
            },
            {
              "name": "_activationLength",
              "type": "uint256"
            }
          ],
          "outputs": [
            {
              "name": "",
              "type": "tuple",
              "components": [
                {
                  "name": "defaultPeriodLength",
                  "type": "uint256"
                },
                {
                  "name": "startDelay",
                  "type": "uint256"
                },
                {
                  "name": "activationLength",
                  "type": "uint256"
                },
                {
                  "name": "maxNumTxsPerPeriod",
                  "type": "uint256"
                },
                {
                  "name": "txCooldownBlocks",
                  "type": "uint256"
                },
                {
                  "name": "failOnZeroPrice",
                  "type": "bool"
                },
                {
                  "name": "usdLimits",
                  "type": "tuple",
                  "components": [
                    {
                      "name": "perTxCap",
                      "type": "uint256"
                    },
                    {
                      "name": "perPeriodCap",
                      "type": "uint256"
                    },
                    {
                      "name": "lifetimeCap",
                      "type": "uint256"
                    }
                  ]
                },
                {
                  "name": "canPayOwner",
                  "type": "bool"
                },
                {
                  "name": "canPull",
                  "type": "bool"
                }
              ]
            }
          ]
        },
        {
          "stateMutability": "view",
          "type": "function",
          "name": "UNDY_HQ",
          "inputs": [],
          "outputs": [
            {
              "name": "",
              "type": "address"
            }
          ]
        },
        {
          "stateMutability": "view",
          "type": "function",
          "name": "MIN_PAYEE_PERIOD",
          "inputs": [],
          "outputs": [
            {
              "name": "",
              "type": "uint256"
            }
          ]
        },
        {
          "stateMutability": "view",
          "type": "function",
          "name": "MAX_PAYEE_PERIOD",
          "inputs": [],
          "outputs": [
            {
              "name": "",
              "type": "uint256"
            }
          ]
        },
        {
          "stateMutability": "view",
          "type": "function",
          "name": "MIN_ACTIVATION_LENGTH",
          "inputs": [],
          "outputs": [
            {
              "name": "",
              "type": "uint256"
            }
          ]
        },
        {
          "stateMutability": "view",
          "type": "function",
          "name": "MAX_ACTIVATION_LENGTH",
          "inputs": [],
          "outputs": [
            {
              "name": "",
              "type": "uint256"
            }
          ]
        },
        {
          "stateMutability": "view",
          "type": "function",
          "name": "MAX_START_DELAY",
          "inputs": [],
          "outputs": [
            {
              "name": "",
              "type": "uint256"
            }
          ]
        },
        {
          "stateMutability": "nonpayable",
          "type": "constructor",
          "inputs": [
            {
              "name": "_undyHq",
              "type": "address"
            },
            {
              "name": "_minPayeePeriod",
              "type": "uint256"
            },
            {
              "name": "_maxPayeePeriod",
              "type": "uint256"
            },
            {
              "name": "_minActivationLength",
              "type": "uint256"
            },
            {
              "name": "_maxActivationLength",
              "type": "uint256"
            },
            {
              "name": "_maxStartDelay",
              "type": "uint256"
            }
          ],
          "outputs": []
        }
      ],
      "solc_json": {
        "language": "Vyper",
        "sources": {
          "interfaces/WalletConfigStructs.vyi": {
            "content": "# @version 0.4.3\n\nMAX_CONFIG_ASSETS: constant(uint256) = 40\nMAX_CONFIG_LEGOS: constant(uint256) = 25\nMAX_ALLOWED_PAYEES: constant(uint256) = 40\n\nflag WhitelistAction:\n    ADD_PENDING\n    CONFIRM_WHITELIST\n    CANCEL_WHITELIST\n    REMOVE_WHITELIST\n\nflag BackpackType:\n    WALLET_KERNEL\n    WALLET_SENTINEL\n    WALLET_HIGH_COMMAND\n    WALLET_PAYMASTER\n    WALLET_CHEQUE_BOOK\n    WALLET_MIGRATOR\n\n# payees\n\nstruct PayeeData:\n    numTxsInPeriod: uint256\n    totalUnitsInPeriod: uint256\n    totalUsdValueInPeriod: uint256\n    totalNumTxs: uint256\n    totalUnits: uint256\n    totalUsdValue: uint256\n    lastTxBlock: uint256\n    periodStartBlock: uint256\n\nstruct PayeeSettings:\n    startBlock: uint256\n    expiryBlock: uint256\n    canPull: bool\n    periodLength: uint256\n    maxNumTxsPerPeriod: uint256\n    txCooldownBlocks: uint256\n    failOnZeroPrice: bool\n    primaryAsset: address\n    onlyPrimaryAsset: bool\n    unitLimits: PayeeLimits\n    usdLimits: PayeeLimits\n\nstruct GlobalPayeeSettings:\n    defaultPeriodLength: uint256\n    startDelay: uint256\n    activationLength: uint256\n    maxNumTxsPerPeriod: uint256\n    txCooldownBlocks: uint256\n    failOnZeroPrice: bool\n    usdLimits: PayeeLimits\n    canPayOwner: bool\n    canPull: bool\n\nstruct PayeeLimits:\n    perTxCap: uint256\n    perPeriodCap: uint256\n    lifetimeCap: uint256\n\nstruct PendingPayee:\n    settings: PayeeSettings\n    initiatedBlock: uint256\n    confirmBlock: uint256\n    currentOwner: address\n\nstruct PayeeManagementBundle:\n    owner: address\n    wallet: address\n    isRegisteredPayee: bool\n    isWhitelisted: bool\n    isExistingCheque: bool\n    payeeSettings: PayeeSettings\n    globalPayeeSettings: GlobalPayeeSettings\n    timeLock: uint256\n    walletConfig: address\n\nstruct RecipientConfigBundle:\n    isWhitelisted: bool\n    isOwner: bool\n    isPayee: bool\n    config: PayeeSettings\n    globalConfig: GlobalPayeeSettings\n    data: PayeeData\n\nstruct WhitelistConfigBundle:\n    owner: address\n    wallet: address\n    isWhitelisted: bool\n    pendingWhitelist: PendingWhitelist\n    isExistingPayee: bool\n    isExistingCheque: bool\n    timeLock: uint256\n    walletConfig: address\n    isManager: bool\n    isOwner: bool\n    whitelistPerms: WhitelistPerms\n    globalWhitelistPerms: WhitelistPerms\n\nstruct PendingWhitelist:\n    initiatedBlock: uint256\n    confirmBlock: uint256\n    currentOwner: address\n\n# cheques\n\nstruct Cheque:\n    recipient: address\n    asset: address\n    amount: uint256\n    creationBlock: uint256\n    unlockBlock: uint256\n    expiryBlock: uint256\n    usdValueOnCreation: uint256\n    canManagerPay: bool\n    canBePulled: bool\n    creator: address\n    active: bool\n\nstruct ChequeSettings:\n    maxNumActiveCheques: uint256\n    maxChequeUsdValue: uint256\n    instantUsdThreshold: uint256\n    perPeriodPaidUsdCap: uint256\n    maxNumChequesPaidPerPeriod: uint256\n    payCooldownBlocks: uint256\n    perPeriodCreatedUsdCap: uint256\n    maxNumChequesCreatedPerPeriod: uint256\n    createCooldownBlocks: uint256\n    periodLength: uint256\n    expensiveDelayBlocks: uint256\n    defaultExpiryBlocks: uint256\n    allowedAssets: DynArray[address, MAX_CONFIG_ASSETS]\n    canManagersCreateCheques: bool\n    canManagerPay: bool\n    canBePulled: bool\n\nstruct ChequeData:\n    numChequesPaidInPeriod: uint256\n    totalUsdValuePaidInPeriod: uint256\n    totalNumChequesPaid: uint256\n    totalUsdValuePaid: uint256\n    lastChequePaidBlock: uint256\n    numChequesCreatedInPeriod: uint256\n    totalUsdValueCreatedInPeriod: uint256\n    totalNumChequesCreated: uint256\n    totalUsdValueCreated: uint256\n    lastChequeCreatedBlock: uint256\n    periodStartBlock: uint256\n\nstruct ChequeManagementBundle:\n    wallet: address\n    walletConfig: address\n    owner: address\n    isRecipientOnWhitelist: bool\n    isCreatorManager: bool\n    managerSettings: ManagerSettings\n    chequeSettings: ChequeSettings\n    chequeData: ChequeData\n    isExistingCheque: bool\n    numActiveCheques: uint256\n    isExistingPayee: bool\n    timeLock: uint256\n\n# managers\n\nstruct ManagerData:\n    numTxsInPeriod: uint256\n    totalUsdValueInPeriod: uint256\n    totalNumTxs: uint256\n    totalUsdValue: uint256\n    lastTxBlock: uint256\n    periodStartBlock: uint256\n    numSwapsInPeriod: uint256\n\nstruct ManagerSettings:\n    startBlock: uint256\n    expiryBlock: uint256\n    limits: ManagerLimits\n    legoPerms: LegoPerms\n    swapPerms: SwapPerms\n    whitelistPerms: WhitelistPerms\n    transferPerms: TransferPerms\n    allowedAssets: DynArray[address, MAX_CONFIG_ASSETS]\n    canClaimLoot: bool\n\nstruct GlobalManagerSettings:\n    managerPeriod: uint256\n    startDelay: uint256\n    activationLength: uint256\n    canOwnerManage: bool\n    limits: ManagerLimits\n    legoPerms: LegoPerms\n    swapPerms: SwapPerms\n    whitelistPerms: WhitelistPerms\n    transferPerms: TransferPerms\n    allowedAssets: DynArray[address, MAX_CONFIG_ASSETS]\n\nstruct ManagerLimits:\n    maxUsdValuePerTx: uint256\n    maxUsdValuePerPeriod: uint256\n    maxUsdValueLifetime: uint256\n    maxNumTxsPerPeriod: uint256\n    txCooldownBlocks: uint256\n    failOnZeroPrice: bool\n\nstruct LegoPerms:\n    canManageYield: bool\n    canBuyAndSell: bool\n    canManageDebt: bool\n    canManageLiq: bool\n    canClaimRewards: bool\n    onlyApprovedYieldOpps: bool\n    allowedLegos: DynArray[uint256, MAX_CONFIG_LEGOS]\n\nstruct SwapPerms:\n    mustHaveUsdValue: bool\n    maxNumSwapsPerPeriod: uint256\n    maxSlippage: uint256\n\nstruct WhitelistPerms:\n    canAddPending: bool\n    canConfirm: bool\n    canCancel: bool\n    canRemove: bool\n\nstruct TransferPerms:\n    canTransfer: bool\n    canCreateCheque: bool\n    canAddPendingPayee: bool\n    allowedPayees: DynArray[address, MAX_ALLOWED_PAYEES]\n\nstruct ManagerConfigBundle:\n    isOwner: bool\n    isManager: bool\n    config: ManagerSettings\n    globalConfig: GlobalManagerSettings\n    data: ManagerData\n    payee: address\n\nstruct ManagerSettingsBundle:\n    owner: address\n    isManager: bool\n    timeLock: uint256\n    walletConfig: address\n    legoBook: address\n    globalManagerSettings: GlobalManagerSettings\n\n# migration\n\nstruct MigrationConfigBundle:\n    owner: address\n    isFrozen: bool\n    numPayees: uint256\n    numWhitelisted: uint256\n    numManagers: uint256\n    startingAgent: address\n    startingAgentIndex: uint256\n    hasPendingOwnerChange: bool\n    groupId: uint256\n    numActiveCheques: uint256\n",
            "sha256sum": "31165468feeac632a1376c70970ce5124f8951392c4deaa01a26176c7f26718a"
          },
          "contracts/core/walletBackpack/Paymaster.vy": {
            "content": "#    \u2513 \u250f  \u2513\u2513   \n#    \u2503\u2503\u2503\u250f\u2513\u2503\u2503\u250f\u2513\u254b\n#    \u2517\u253b\u251b\u2517\u253b\u2517\u2517\u2517 \u2517\n#     ______  ______   __  __   __    __   ______   ______   ______  ______   ______    \n#    /\\  == \\/\\  __ \\ /\\ \\_\\ \\ /\\ \"-./  \\ /\\  __ \\ /\\  ___\\ /\\__  _\\/\\  ___\\ /\\  == \\   \n#    \\ \\  _-/\\ \\  __ \\\\ \\____ \\\\ \\ \\-./\\ \\\\ \\  __ \\\\ \\___  \\\\/_/\\ \\/\\ \\  __\\ \\ \\  __<   \n#     \\ \\_\\   \\ \\_\\ \\_\\\\/\\_____\\\\ \\_\\ \\ \\_\\\\ \\_\\ \\_\\\\/\\_____\\  \\ \\_\\ \\ \\_____\\\\ \\_\\ \\_\\ \n#      \\/_/    \\/_/\\/_/ \\/_____/ \\/_/  \\/_/ \\/_/\\/_/ \\/_____/   \\/_/  \\/_____/ \\/_/ /_/ \n#                                                                                                \n#     \u2554\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2557\n#     \u2551  ** Paymaster **                      \u2551\n#     \u2551  Payee management for user wallets.   \u2551\n#     \u255a\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u255d\n#\n#     Underscore Protocol License: https://github.com/underscore-finance/underscore-protocol/blob/master/LICENSE.md\n\n# @version 0.4.3\n\nfrom interfaces import WalletConfigStructs as wcs\n\ninterface UserWalletConfig:\n    def addPendingPayee(_payee: address, _pending: wcs.PendingPayee): nonpayable\n    def updatePayee(_payee: address, _config: wcs.PayeeSettings): nonpayable\n    def setGlobalPayeeSettings(_config: wcs.GlobalPayeeSettings): nonpayable\n    def addPayee(_payee: address, _config: wcs.PayeeSettings): nonpayable\n    def managerSettings(_addr: address) -> wcs.ManagerSettings: view\n    def globalManagerSettings() -> wcs.GlobalManagerSettings: view\n    def payeeSettings(_payee: address) -> wcs.PayeeSettings: view\n    def pendingPayees(_payee: address) -> wcs.PendingPayee: view\n    def globalPayeeSettings() -> wcs.GlobalPayeeSettings: view\n    def indexOfWhitelist(_addr: address) -> uint256: view\n    def confirmPendingPayee(_payee: address): nonpayable\n    def cancelPendingPayee(_payee: address): nonpayable\n    def indexOfManager(_addr: address) -> uint256: view\n    def indexOfPayee(_payee: address) -> uint256: view\n    def cheques(_addr: address) -> wcs.Cheque: view\n    def removePayee(_payee: address): nonpayable\n    def timeLock() -> uint256: view\n    def owner() -> address: view\n\ninterface MissionControl:\n    def canPerformSecurityAction(_addr: address) -> bool: view\n\ninterface Ledger:\n    def isUserWallet(_user: address) -> bool: view\n\ninterface Registry:\n    def getAddr(_regId: uint256) -> address: view\n\ninterface UserWallet:\n    def walletConfig() -> address: view\n\nevent PayeeAdded:\n    user: indexed(address)\n    payee: indexed(address)\n    startBlock: uint256\n    expiryBlock: uint256\n    canPull: bool\n    periodLength: uint256\n    maxNumTxsPerPeriod: uint256\n    txCooldownBlocks: uint256\n    failOnZeroPrice: bool\n    primaryAsset: address\n    onlyPrimaryAsset: bool\n    unitPerTxCap: uint256\n    unitPerPeriodCap: uint256\n    unitLifetimeCap: uint256\n    usdPerTxCap: uint256\n    usdPerPeriodCap: uint256\n    usdLifetimeCap: uint256\n\nevent PayeeUpdated:\n    user: indexed(address)\n    payee: indexed(address)\n    startBlock: uint256\n    expiryBlock: uint256\n    canPull: bool\n    periodLength: uint256\n    maxNumTxsPerPeriod: uint256\n    txCooldownBlocks: uint256\n    failOnZeroPrice: bool\n    primaryAsset: address\n    onlyPrimaryAsset: bool\n    unitPerTxCap: uint256\n    unitPerPeriodCap: uint256\n    unitLifetimeCap: uint256\n    usdPerTxCap: uint256\n    usdPerPeriodCap: uint256\n    usdLifetimeCap: uint256\n\nevent PayeeRemoved:\n    user: indexed(address)\n    payee: indexed(address)\n    removedBy: indexed(address)\n\nevent GlobalPayeeSettingsModified:\n    user: indexed(address)\n    defaultPeriodLength: uint256\n    startDelay: uint256\n    activationLength: uint256\n    maxNumTxsPerPeriod: uint256\n    txCooldownBlocks: uint256\n    failOnZeroPrice: bool\n    canPayOwner: bool\n    canPull: bool\n    usdPerTxCap: uint256\n    usdPerPeriodCap: uint256\n    usdLifetimeCap: uint256\n\nevent PayeePending:\n    user: indexed(address)\n    payee: indexed(address)\n    confirmBlock: uint256\n    addedBy: indexed(address)\n    canPull: bool\n    periodLength: uint256\n    maxNumTxsPerPeriod: uint256\n    txCooldownBlocks: uint256\n    failOnZeroPrice: bool\n    primaryAsset: address\n    onlyPrimaryAsset: bool\n    unitPerTxCap: uint256\n    unitPerPeriodCap: uint256\n    unitLifetimeCap: uint256\n    usdPerTxCap: uint256\n    usdPerPeriodCap: uint256\n    usdLifetimeCap: uint256\n\nevent PayeePendingConfirmed:\n    user: indexed(address)\n    payee: indexed(address)\n    initiatedBlock: uint256\n    confirmBlock: uint256\n    confirmedBy: indexed(address)\n\nevent PayeePendingCancelled:\n    user: indexed(address)\n    payee: indexed(address)\n    initiatedBlock: uint256\n    confirmBlock: uint256\n    cancelledBy: indexed(address)\n\nUNDY_HQ: public(immutable(address))\nLEDGER_ID: constant(uint256) = 1\nMISSION_CONTROL_ID: constant(uint256) = 2\n\nMIN_PAYEE_PERIOD: public(immutable(uint256))\nMAX_PAYEE_PERIOD: public(immutable(uint256))\nMIN_ACTIVATION_LENGTH: public(immutable(uint256))\nMAX_ACTIVATION_LENGTH: public(immutable(uint256))\nMAX_START_DELAY: public(immutable(uint256))\n\n\n@deploy\ndef __init__(\n    _undyHq: address,\n    _minPayeePeriod: uint256,\n    _maxPayeePeriod: uint256,\n    _minActivationLength: uint256,\n    _maxActivationLength: uint256,\n    _maxStartDelay: uint256,\n):\n    assert _undyHq != empty(address) # dev: invalid undy hq\n    UNDY_HQ = _undyHq\n\n    assert _minPayeePeriod != 0 and _minPayeePeriod < _maxPayeePeriod # dev: invalid payee period\n    MIN_PAYEE_PERIOD = _minPayeePeriod\n    MAX_PAYEE_PERIOD = _maxPayeePeriod\n\n    assert _minActivationLength != 0 and _minActivationLength < _maxActivationLength # dev: invalid activation length\n    MIN_ACTIVATION_LENGTH = _minActivationLength\n    MAX_ACTIVATION_LENGTH = _maxActivationLength\n\n    assert _maxStartDelay != 0 # dev: invalid start delay\n    MAX_START_DELAY = _maxStartDelay\n\n\n#########################\n# Global Payee Settings #\n#########################\n\n\n@external\ndef setGlobalPayeeSettings(\n    _userWallet: address,\n    _defaultPeriodLength: uint256,\n    _startDelay: uint256,\n    _activationLength: uint256,\n    _maxNumTxsPerPeriod: uint256,\n    _txCooldownBlocks: uint256,\n    _failOnZeroPrice: bool,\n    _usdLimits: wcs.PayeeLimits,\n    _canPayOwner: bool,\n    _canPull: bool,\n) -> bool:\n    assert self._isValidUserWallet(_userWallet) # dev: invalid user wallet\n\n    # only owner can set global payee settings\n    config: wcs.PayeeManagementBundle = self._getPayeeConfig(_userWallet, empty(address))\n    assert msg.sender == config.owner # dev: no perms\n\n    # validate global settings\n    assert self._isValidGlobalPayeeSettings(_defaultPeriodLength, _startDelay, _activationLength, _maxNumTxsPerPeriod, _txCooldownBlocks, _failOnZeroPrice, _usdLimits, _canPayOwner, _canPull, config.timeLock) # dev: invalid settings\n\n    # update global settings in wallet config\n    settings: wcs.GlobalPayeeSettings = wcs.GlobalPayeeSettings(\n        defaultPeriodLength = _defaultPeriodLength,\n        startDelay = _startDelay,\n        activationLength = _activationLength,\n        maxNumTxsPerPeriod = _maxNumTxsPerPeriod,\n        txCooldownBlocks = _txCooldownBlocks,\n        failOnZeroPrice = _failOnZeroPrice,\n        usdLimits = _usdLimits,\n        canPayOwner = _canPayOwner,\n        canPull = _canPull,\n    )\n    extcall UserWalletConfig(config.walletConfig).setGlobalPayeeSettings(settings)\n\n    log GlobalPayeeSettingsModified(\n        user = _userWallet,\n        defaultPeriodLength = _defaultPeriodLength,\n        startDelay = _startDelay,\n        activationLength = _activationLength,\n        maxNumTxsPerPeriod = _maxNumTxsPerPeriod,\n        txCooldownBlocks = _txCooldownBlocks,\n        failOnZeroPrice = _failOnZeroPrice,\n        canPayOwner = _canPayOwner,\n        canPull = _canPull,\n        usdPerTxCap = _usdLimits.perTxCap,\n        usdPerPeriodCap = _usdLimits.perPeriodCap,\n        usdLifetimeCap = _usdLimits.lifetimeCap,\n    )\n    return True\n\n\n####################\n# Payee Management #\n####################\n\n\n# add payee\n\n\n@external\ndef addPayee(\n    _userWallet: address,\n    _payee: address,\n    _canPull: bool,\n    _periodLength: uint256,\n    _maxNumTxsPerPeriod: uint256,\n    _txCooldownBlocks: uint256,\n    _failOnZeroPrice: bool,\n    _primaryAsset: address,\n    _onlyPrimaryAsset: bool,\n    _unitLimits: wcs.PayeeLimits,\n    _usdLimits: wcs.PayeeLimits,\n    _startDelay: uint256 = 0,\n    _activationLength: uint256 = 0,\n) -> bool:\n    assert self._isValidUserWallet(_userWallet) # dev: invalid user wallet\n\n    # only owner can add payee\n    config: wcs.PayeeManagementBundle = self._getPayeeConfig(_userWallet, _payee)\n    assert msg.sender == config.owner # dev: no perms\n\n    # validate and prepare payee settings\n    isValid: bool = False\n    settings: wcs.PayeeSettings = empty(wcs.PayeeSettings)\n    isValid, settings = self._isValidNewPayee(_payee, config, _canPull, _periodLength, _maxNumTxsPerPeriod, _txCooldownBlocks, _failOnZeroPrice, _primaryAsset, _onlyPrimaryAsset, _unitLimits, _usdLimits, _startDelay, _activationLength)\n    assert isValid # dev: invalid payee settings\n\n    extcall UserWalletConfig(config.walletConfig).addPayee(_payee, settings)\n    log PayeeAdded(\n        user = _userWallet,\n        payee = _payee,\n        startBlock = settings.startBlock,\n        expiryBlock = settings.expiryBlock,\n        canPull = settings.canPull,\n        periodLength = settings.periodLength,\n        maxNumTxsPerPeriod = settings.maxNumTxsPerPeriod,\n        txCooldownBlocks = settings.txCooldownBlocks,\n        failOnZeroPrice = settings.failOnZeroPrice,\n        primaryAsset = settings.primaryAsset,\n        onlyPrimaryAsset = settings.onlyPrimaryAsset,\n        unitPerTxCap = settings.unitLimits.perTxCap,\n        unitPerPeriodCap = settings.unitLimits.perPeriodCap,\n        unitLifetimeCap = settings.unitLimits.lifetimeCap,\n        usdPerTxCap = settings.usdLimits.perTxCap,\n        usdPerPeriodCap = settings.usdLimits.perPeriodCap,\n        usdLifetimeCap = settings.usdLimits.lifetimeCap,\n    )\n    return True\n\n\n# update existing payee\n\n\n@external\ndef updatePayee(\n    _userWallet: address,\n    _payee: address,\n    _canPull: bool,\n    _periodLength: uint256,\n    _maxNumTxsPerPeriod: uint256,\n    _txCooldownBlocks: uint256,\n    _failOnZeroPrice: bool,\n    _primaryAsset: address,\n    _onlyPrimaryAsset: bool,\n    _unitLimits: wcs.PayeeLimits,\n    _usdLimits: wcs.PayeeLimits,\n) -> bool:\n    assert self._isValidUserWallet(_userWallet) # dev: invalid user wallet\n\n    # only owner can update payee\n    config: wcs.PayeeManagementBundle = self._getPayeeConfig(_userWallet, _payee)\n    assert msg.sender == config.owner # dev: no perms\n\n    # validate payee settings\n    assert self._isValidPayeeUpdate(config.isRegisteredPayee, _canPull, config.globalPayeeSettings.canPull, _periodLength, _maxNumTxsPerPeriod, _txCooldownBlocks, _failOnZeroPrice, _primaryAsset, _onlyPrimaryAsset, _unitLimits, _usdLimits) # dev: invalid payee settings\n\n    # update config while preserving start/expiry blocks\n    settings: wcs.PayeeSettings = wcs.PayeeSettings(\n        startBlock = config.payeeSettings.startBlock,\n        expiryBlock = config.payeeSettings.expiryBlock,\n        canPull = _canPull,\n        periodLength = _periodLength,\n        maxNumTxsPerPeriod = _maxNumTxsPerPeriod,\n        txCooldownBlocks = _txCooldownBlocks,\n        failOnZeroPrice = _failOnZeroPrice,\n        primaryAsset = _primaryAsset,\n        onlyPrimaryAsset = _onlyPrimaryAsset,\n        unitLimits = _unitLimits,\n        usdLimits = _usdLimits,\n    )\n\n    extcall UserWalletConfig(config.walletConfig).updatePayee(_payee, settings)\n    log PayeeUpdated(\n        user = _userWallet,\n        payee = _payee,\n        startBlock = settings.startBlock,\n        expiryBlock = settings.expiryBlock,\n        canPull = _canPull,\n        periodLength = _periodLength,\n        maxNumTxsPerPeriod = _maxNumTxsPerPeriod,\n        txCooldownBlocks = _txCooldownBlocks,\n        failOnZeroPrice = _failOnZeroPrice,\n        primaryAsset = _primaryAsset,\n        onlyPrimaryAsset = _onlyPrimaryAsset,\n        unitPerTxCap = _unitLimits.perTxCap,\n        unitPerPeriodCap = _unitLimits.perPeriodCap,\n        unitLifetimeCap = _unitLimits.lifetimeCap,\n        usdPerTxCap = _usdLimits.perTxCap,\n        usdPerPeriodCap = _usdLimits.perPeriodCap,\n        usdLifetimeCap = _usdLimits.lifetimeCap,\n    )\n    return True\n\n\n# remove payee\n\n\n@external\ndef removePayee(_userWallet: address, _payee: address) -> bool:\n    assert self._isValidUserWallet(_userWallet) # dev: invalid user wallet\n\n    # only owner or payee can remove payee\n    config: wcs.PayeeManagementBundle = self._getPayeeConfig(_userWallet, _payee)\n    if msg.sender not in [config.owner, _payee]:\n        assert self._canPerformSecurityAction(msg.sender) # dev: no perms\n\n    # validate payee exists\n    assert config.isRegisteredPayee # dev: payee not found\n\n    # remove payee from wallet config\n    extcall UserWalletConfig(config.walletConfig).removePayee(_payee)\n    log PayeeRemoved(user = _userWallet, payee = _payee, removedBy = msg.sender)\n    return True\n\n\n##################\n# Pending Payees #\n##################\n\n\n# add pending payee (for managers)\n\n\n@external\ndef addPendingPayee(\n    _userWallet: address,\n    _payee: address,\n    _canPull: bool,\n    _periodLength: uint256,\n    _maxNumTxsPerPeriod: uint256,\n    _txCooldownBlocks: uint256,\n    _failOnZeroPrice: bool,\n    _primaryAsset: address,\n    _onlyPrimaryAsset: bool,\n    _unitLimits: wcs.PayeeLimits,\n    _usdLimits: wcs.PayeeLimits,\n    _startDelay: uint256 = 0,\n    _activationLength: uint256 = 0,\n) -> bool:\n    assert self._isValidUserWallet(_userWallet) # dev: invalid user wallet\n\n    # check if caller has permission to add pending payee\n    config: wcs.PayeeManagementBundle = self._getPayeeConfig(_userWallet, _payee)\n    assert self._canAddPendingPayee(msg.sender, _payee, config.owner, config.walletConfig) # dev: no permission to add pending payee\n\n    # validate and prepare payee settings\n    isValid: bool = False\n    settings: wcs.PayeeSettings = empty(wcs.PayeeSettings)\n    isValid, settings = self._isValidNewPayee(_payee, config, _canPull, _periodLength, _maxNumTxsPerPeriod, _txCooldownBlocks, _failOnZeroPrice, _primaryAsset, _onlyPrimaryAsset, _unitLimits, _usdLimits, _startDelay, _activationLength)\n    assert isValid # dev: invalid payee settings\n\n    # create pending payee with timelock\n    confirmBlock: uint256 = block.number + config.timeLock\n    pending: wcs.PendingPayee = wcs.PendingPayee(\n        settings = settings,\n        initiatedBlock = block.number,\n        confirmBlock = confirmBlock,\n        currentOwner = config.owner,\n    )\n    extcall UserWalletConfig(config.walletConfig).addPendingPayee(_payee, pending)\n\n    log PayeePending(\n        user = _userWallet,\n        payee = _payee,\n        confirmBlock = confirmBlock,\n        addedBy = msg.sender,\n        canPull = settings.canPull,\n        periodLength = settings.periodLength,\n        maxNumTxsPerPeriod = settings.maxNumTxsPerPeriod,\n        txCooldownBlocks = settings.txCooldownBlocks,\n        failOnZeroPrice = settings.failOnZeroPrice,\n        primaryAsset = settings.primaryAsset,\n        onlyPrimaryAsset = settings.onlyPrimaryAsset,\n        unitPerTxCap = settings.unitLimits.perTxCap,\n        unitPerPeriodCap = settings.unitLimits.perPeriodCap,\n        unitLifetimeCap = settings.unitLimits.lifetimeCap,\n        usdPerTxCap = settings.usdLimits.perTxCap,\n        usdPerPeriodCap = settings.usdLimits.perPeriodCap,\n        usdLifetimeCap = settings.usdLimits.lifetimeCap,\n    )\n    return True\n\n\n# confirm pending payee (for owner)\n\n\n@external\ndef confirmPendingPayee(_userWallet: address, _payee: address) -> bool:\n    assert self._isValidUserWallet(_userWallet) # dev: invalid user wallet\n\n    # only owner can confirm pending payee\n    config: wcs.PayeeManagementBundle = self._getPayeeConfig(_userWallet, _payee)\n    assert msg.sender == config.owner # dev: no perms\n\n    # get pending payee\n    pendingPayee: wcs.PendingPayee = staticcall UserWalletConfig(config.walletConfig).pendingPayees(_payee)\n    assert pendingPayee.initiatedBlock != 0 # dev: no pending payee\n    assert pendingPayee.confirmBlock != 0 and block.number >= pendingPayee.confirmBlock # dev: time delay not reached\n    assert pendingPayee.currentOwner == config.owner # dev: must be same owner\n\n    # confirm the pending payee\n    extcall UserWalletConfig(config.walletConfig).confirmPendingPayee(_payee)\n    log PayeePendingConfirmed(\n        user = _userWallet,\n        payee = _payee,\n        initiatedBlock = pendingPayee.initiatedBlock,\n        confirmBlock = pendingPayee.confirmBlock,\n        confirmedBy = msg.sender\n    )\n    return True\n\n\n# cancel pending payee\n\n\n@external\ndef cancelPendingPayee(_userWallet: address, _payee: address) -> bool:\n    assert self._isValidUserWallet(_userWallet) # dev: invalid user wallet\n\n    # only owner or payee can cancel pending payee\n    config: wcs.PayeeManagementBundle = self._getPayeeConfig(_userWallet, _payee)\n    if msg.sender not in [config.owner, _payee]:\n        assert self._canPerformSecurityAction(msg.sender) # dev: no perms\n\n    # get pending payee\n    pendingPayee: wcs.PendingPayee = staticcall UserWalletConfig(config.walletConfig).pendingPayees(_payee)\n    assert pendingPayee.initiatedBlock != 0 # dev: no pending payee\n\n    # cancel the pending payee\n    extcall UserWalletConfig(config.walletConfig).cancelPendingPayee(_payee)\n    log PayeePendingCancelled(\n        user = _userWallet,\n        payee = _payee,\n        initiatedBlock = pendingPayee.initiatedBlock,\n        confirmBlock = pendingPayee.confirmBlock,\n        cancelledBy = msg.sender\n    )\n    return True\n\n\n####################\n# Payee Validation #\n####################\n\n\n# is valid new payee\n\n\n@view\n@external\ndef isValidNewPayee(\n    _userWallet: address,\n    _payee: address,\n    _canPull: bool,\n    _periodLength: uint256,\n    _maxNumTxsPerPeriod: uint256,\n    _txCooldownBlocks: uint256,\n    _failOnZeroPrice: bool,\n    _primaryAsset: address,\n    _onlyPrimaryAsset: bool,\n    _unitLimits: wcs.PayeeLimits,\n    _usdLimits: wcs.PayeeLimits,\n    _startDelay: uint256 = 0,\n    _activationLength: uint256 = 0,\n) -> bool:\n    config: wcs.PayeeManagementBundle = self._getPayeeConfig(_userWallet, _payee)\n    isValid: bool = False\n    na: wcs.PayeeSettings = empty(wcs.PayeeSettings)\n    isValid, na = self._isValidNewPayee(_payee, config, _canPull, _periodLength, _maxNumTxsPerPeriod, _txCooldownBlocks, _failOnZeroPrice, _primaryAsset, _onlyPrimaryAsset, _unitLimits, _usdLimits, _startDelay, _activationLength)\n    return isValid\n\n\n@view\n@internal\ndef _isValidNewPayee(\n    _payee: address,\n    _config: wcs.PayeeManagementBundle,\n    _canPull: bool,\n    _periodLength: uint256,\n    _maxNumTxsPerPeriod: uint256,\n    _txCooldownBlocks: uint256,\n    _failOnZeroPrice: bool,\n    _primaryAsset: address,\n    _onlyPrimaryAsset: bool,\n    _unitLimits: wcs.PayeeLimits,\n    _usdLimits: wcs.PayeeLimits,\n    _startDelay: uint256,\n    _activationLength: uint256,\n) -> (bool, wcs.PayeeSettings):\n\n    # invalid payee\n    if _payee in [empty(address), _config.owner, _config.wallet, _config.walletConfig]:\n        return False, empty(wcs.PayeeSettings)\n\n    # payee already exists\n    if _config.isRegisteredPayee:\n        return False, empty(wcs.PayeeSettings)\n\n    # payee is already whitelisted\n    if _config.isWhitelisted:\n        return False, empty(wcs.PayeeSettings)\n\n    # cannot add payee if they have an active cheque\n    if _config.isExistingCheque:\n        return False, empty(wcs.PayeeSettings)\n\n    # calculate start delay\n    startDelay: uint256 = max(_config.globalPayeeSettings.startDelay, _config.timeLock)\n    if _startDelay != 0:\n        startDelay = max(startDelay, _startDelay)\n\n    # calculate activation length\n    activationLength: uint256 = _config.globalPayeeSettings.activationLength\n    if _activationLength != 0:\n        activationLength = min(activationLength, _activationLength)\n\n    # use global default period length if not specified\n    periodLength: uint256 = _periodLength\n    if periodLength == 0:\n        periodLength = _config.globalPayeeSettings.defaultPeriodLength\n\n    # validate start delay\n    if not self._validateStartDelay(startDelay, _config.timeLock):\n        return False, empty(wcs.PayeeSettings)\n\n    # validate period length\n    if not self._validatePayeePeriod(periodLength):\n        return False, empty(wcs.PayeeSettings)\n\n    # validate activation length\n    if not self._validateActivationLength(activationLength):\n        return False, empty(wcs.PayeeSettings)\n\n    # validate cooldown\n    if not self._validatePayeeCooldown(_txCooldownBlocks, periodLength):\n        return False, empty(wcs.PayeeSettings)\n\n    # validate primary asset\n    if not self._validatePrimaryAsset(_primaryAsset, _onlyPrimaryAsset):\n        return False, empty(wcs.PayeeSettings)\n\n    # validate unit limits\n    if not self._validatePayeeLimits(_unitLimits):\n        return False, empty(wcs.PayeeSettings)\n\n    # validate usd limits\n    if not self._validatePayeeLimits(_usdLimits):\n        return False, empty(wcs.PayeeSettings)\n\n    # validate failOnZeroPrice when USD limits are set\n    if not self._validateFailOnZeroPriceWithUsdLimits(_failOnZeroPrice, _usdLimits):\n        return False, empty(wcs.PayeeSettings)\n\n    # validate pull payee\n    if not self._validatePullPayee(_canPull, _config.globalPayeeSettings.canPull, _unitLimits, _usdLimits):\n        return False, empty(wcs.PayeeSettings)\n\n    # create start and expiry blocks\n    startBlock: uint256 = block.number + startDelay\n    expiryBlock: uint256 = startBlock + activationLength\n\n    settings: wcs.PayeeSettings = wcs.PayeeSettings(\n        startBlock = startBlock,\n        expiryBlock = expiryBlock,\n        canPull = _canPull,\n        periodLength = periodLength,\n        maxNumTxsPerPeriod = _maxNumTxsPerPeriod,\n        txCooldownBlocks = _txCooldownBlocks,\n        failOnZeroPrice = _failOnZeroPrice,\n        primaryAsset = _primaryAsset,\n        onlyPrimaryAsset = _onlyPrimaryAsset,\n        unitLimits = _unitLimits,\n        usdLimits = _usdLimits,\n    )\n    return True, settings\n\n\n# is valid payee update\n\n\n@view\n@external\ndef isValidPayeeUpdate(\n    _userWallet: address,\n    _payee: address,\n    _canPull: bool,\n    _periodLength: uint256,\n    _maxNumTxsPerPeriod: uint256,\n    _txCooldownBlocks: uint256,\n    _failOnZeroPrice: bool,\n    _primaryAsset: address,\n    _onlyPrimaryAsset: bool,\n    _unitLimits: wcs.PayeeLimits,\n    _usdLimits: wcs.PayeeLimits,\n) -> bool:\n    config: wcs.PayeeManagementBundle = self._getPayeeConfig(_userWallet, _payee)\n    return self._isValidPayeeUpdate(config.isRegisteredPayee, _canPull, config.globalPayeeSettings.canPull, _periodLength, _maxNumTxsPerPeriod, _txCooldownBlocks, _failOnZeroPrice, _primaryAsset, _onlyPrimaryAsset, _unitLimits, _usdLimits)\n\n\n@view\n@internal\ndef _isValidPayeeUpdate(\n    _isRegisteredPayee: bool,\n    _canPull: bool,\n    _globalCanPull: bool,\n    _periodLength: uint256,\n    _maxNumTxsPerPeriod: uint256,\n    _txCooldownBlocks: uint256,\n    _failOnZeroPrice: bool,\n    _primaryAsset: address,\n    _onlyPrimaryAsset: bool,\n    _unitLimits: wcs.PayeeLimits,\n    _usdLimits: wcs.PayeeLimits,\n) -> bool:\n\n    # payee not found\n    if not _isRegisteredPayee:\n        return False\n\n    # validate period length\n    if not self._validatePayeePeriod(_periodLength):\n        return False\n\n    # validate cooldown\n    if not self._validatePayeeCooldown(_txCooldownBlocks, _periodLength):\n        return False\n\n    # validate primary asset\n    if not self._validatePrimaryAsset(_primaryAsset, _onlyPrimaryAsset):\n        return False\n\n    # validate unit limits\n    if not self._validatePayeeLimits(_unitLimits):\n        return False\n\n    # validate usd limits\n    if not self._validatePayeeLimits(_usdLimits):\n        return False\n\n    # validate failOnZeroPrice when USD limits are set\n    if not self._validateFailOnZeroPriceWithUsdLimits(_failOnZeroPrice, _usdLimits):\n        return False\n\n    # validate pull payee\n    if not self._validatePullPayee(_canPull, _globalCanPull, _unitLimits, _usdLimits):\n        return False\n\n    return True\n\n\n# validate pending payee\n\n\n@view\n@external\ndef canAddPendingPayee(_userWallet: address, _payee: address, _caller: address) -> bool:\n    config: wcs.PayeeManagementBundle = self._getPayeeConfig(_userWallet, _payee)\n    return self._canAddPendingPayee(_caller, _payee, config.owner, config.walletConfig)\n\n\n@view\n@internal\ndef _canAddPendingPayee(_caller: address, _payee: address, _owner: address, _walletConfig: address) -> bool:\n    # owner can always add payees directly (not pending)\n    if _caller == _owner:\n        return False\n\n    # check if caller is a manager\n    if staticcall UserWalletConfig(_walletConfig).indexOfManager(_caller) == 0:\n        return False\n\n    pendingPayee: wcs.PendingPayee = staticcall UserWalletConfig(_walletConfig).pendingPayees(_payee)\n    if pendingPayee.initiatedBlock != 0:\n        return False\n\n    # check if manager is active\n    managerSettings: wcs.ManagerSettings = staticcall UserWalletConfig(_walletConfig).managerSettings(_caller)\n    if managerSettings.startBlock > block.number or managerSettings.expiryBlock <= block.number:\n        return False\n\n    # check if manager has permission\n    globalManagerSettings: wcs.GlobalManagerSettings = staticcall UserWalletConfig(_walletConfig).globalManagerSettings()\n    return managerSettings.transferPerms.canAddPendingPayee and globalManagerSettings.transferPerms.canAddPendingPayee\n\n\n# validate global payee settings\n\n\n@view\n@external\ndef isValidGlobalPayeeSettings(\n    _userWallet: address,\n    _defaultPeriodLength: uint256,\n    _startDelay: uint256,\n    _activationLength: uint256,\n    _maxNumTxsPerPeriod: uint256,\n    _txCooldownBlocks: uint256,\n    _failOnZeroPrice: bool,\n    _usdLimits: wcs.PayeeLimits,\n    _canPayOwner: bool,\n    _canPull: bool,\n) -> bool:\n    config: wcs.PayeeManagementBundle = self._getPayeeConfig(_userWallet, empty(address))\n    return self._isValidGlobalPayeeSettings(_defaultPeriodLength, _startDelay, _activationLength, _maxNumTxsPerPeriod, _txCooldownBlocks, _failOnZeroPrice, _usdLimits, _canPayOwner, _canPull, config.timeLock)\n\n\n@view\n@internal\ndef _isValidGlobalPayeeSettings(\n    _defaultPeriodLength: uint256,\n    _startDelay: uint256,\n    _activationLength: uint256,\n    _maxNumTxsPerPeriod: uint256,\n    _txCooldownBlocks: uint256,\n    _failOnZeroPrice: bool,\n    _usdLimits: wcs.PayeeLimits,\n    _canPayOwner: bool,\n    _canPull: bool,\n    _timeLock: uint256,\n) -> bool:\n\n    # validate period length\n    if not self._validatePayeePeriod(_defaultPeriodLength):\n        return False\n\n    # validate cooldown\n    if not self._validatePayeeCooldown(_txCooldownBlocks, _defaultPeriodLength):\n        return False\n\n    # validate usd limits\n    if not self._validatePayeeLimits(_usdLimits):\n        return False\n\n    # validate failOnZeroPrice when USD limits are set\n    if not self._validateFailOnZeroPriceWithUsdLimits(_failOnZeroPrice, _usdLimits):\n        return False\n\n    # validate activation length\n    if not self._validateActivationLength(_activationLength):\n        return False\n\n    if not self._validateStartDelay(_startDelay, _timeLock):\n        return False\n\n    return True\n\n\n##########################\n# Payee Validation Utils #\n##########################\n\n\n@view\n@internal\ndef _validateStartDelay(_startDelay: uint256, _currentTimeLock: uint256) -> bool:\n    return _startDelay <= MAX_START_DELAY and _startDelay >= _currentTimeLock\n\n\n@view\n@internal\ndef _validatePayeePeriod(_periodLength: uint256) -> bool:\n    return _periodLength >= MIN_PAYEE_PERIOD and _periodLength <= MAX_PAYEE_PERIOD\n\n\n@view\n@internal\ndef _validateActivationLength(_activationLength: uint256) -> bool:\n    return _activationLength >= MIN_ACTIVATION_LENGTH and _activationLength <= MAX_ACTIVATION_LENGTH\n\n\n@pure\n@internal\ndef _validatePayeeCooldown(_txCooldownBlocks: uint256, _periodLength: uint256) -> bool:\n    # 0 means no cooldown, which is valid\n    if _txCooldownBlocks == 0:\n        return True\n    return _txCooldownBlocks <= _periodLength\n\n\n@pure\n@internal\ndef _validatePrimaryAsset(_primaryAsset: address, _onlyPrimaryAsset: bool) -> bool:\n    # if onlyPrimaryAsset is true, primaryAsset must be set\n    if _onlyPrimaryAsset and _primaryAsset == empty(address):\n        return False\n    return True\n\n\n@pure\n@internal\ndef _validatePullPayee(\n    _canPull: bool,\n    _globalCanPull: bool,\n    _unitLimits: wcs.PayeeLimits,\n    _usdLimits: wcs.PayeeLimits,\n) -> bool:\n    if not _canPull:\n        return True # not a pull payee, no additional validation needed\n\n    # if global canPull is false, payee cannot pull\n    if not _globalCanPull:\n        return False\n\n    # pull payees must have at least one type of limit\n    hasUnitLimits: bool = (\n        _unitLimits.perTxCap != 0 or \n        _unitLimits.perPeriodCap != 0 or \n        _unitLimits.lifetimeCap != 0\n    )\n    hasUsdLimits: bool = (\n        _usdLimits.perTxCap != 0 or \n        _usdLimits.perPeriodCap != 0 or \n        _usdLimits.lifetimeCap != 0\n    )\n    return hasUnitLimits or hasUsdLimits\n\n\n@pure\n@internal\ndef _validatePayeeLimits(_limits: wcs.PayeeLimits) -> bool:\n    # NOTE: 0 values are treated as \"unlimited\"\n\n    # validate per-tx cap does not exceed per-period cap (when both are set)\n    if _limits.perTxCap != 0 and _limits.perPeriodCap != 0:\n        if _limits.perTxCap > _limits.perPeriodCap:\n            return False\n\n    # validate per-period cap does not exceed lifetime cap (when both are set)\n    if _limits.perPeriodCap != 0 and _limits.lifetimeCap != 0:\n        if _limits.perPeriodCap > _limits.lifetimeCap:\n            return False\n\n    # validate per-tx cap does not exceed lifetime cap (when both are set)\n    if _limits.perTxCap != 0 and _limits.lifetimeCap != 0:\n        if _limits.perTxCap > _limits.lifetimeCap:\n            return False\n\n    return True\n\n\n@pure\n@internal\ndef _validateFailOnZeroPriceWithUsdLimits(\n    _failOnZeroPrice: bool,\n    _usdLimits: wcs.PayeeLimits\n) -> bool:\n    # if any USD limits are set (non-zero = limit is active)\n    hasUsdLimits: bool = (\n        _usdLimits.perTxCap != 0 or\n        _usdLimits.perPeriodCap != 0 or\n        _usdLimits.lifetimeCap != 0\n    )\n\n    # If USD limits are set, failOnZeroPrice must be True\n    # to prevent bypassing limits when price data is unavailable\n    if hasUsdLimits and not _failOnZeroPrice:\n        return False\n\n    return True\n\n\n#############\n# Utilities #\n#############\n\n\n# get payee management bundle\n\n\n@view\n@external\ndef getPayeeConfig(_userWallet: address, _payee: address) -> wcs.PayeeManagementBundle:\n    return self._getPayeeConfig(_userWallet, _payee)\n\n\n@view\n@internal\ndef _getPayeeConfig(_userWallet: address, _payee: address) -> wcs.PayeeManagementBundle:\n    walletConfig: address = staticcall UserWallet(_userWallet).walletConfig()\n    owner: address = staticcall UserWalletConfig(walletConfig).owner()\n    cheque: wcs.Cheque = staticcall UserWalletConfig(walletConfig).cheques(_payee)\n    return wcs.PayeeManagementBundle(\n        owner = owner,\n        wallet = _userWallet,\n        isRegisteredPayee = staticcall UserWalletConfig(walletConfig).indexOfPayee(_payee) != 0,\n        isWhitelisted = staticcall UserWalletConfig(walletConfig).indexOfWhitelist(_payee) != 0,\n        isExistingCheque = cheque.active,\n        payeeSettings = staticcall UserWalletConfig(walletConfig).payeeSettings(_payee),\n        globalPayeeSettings = staticcall UserWalletConfig(walletConfig).globalPayeeSettings(),\n        timeLock = staticcall UserWalletConfig(walletConfig).timeLock(),\n        walletConfig = walletConfig,\n    )\n\n\n# is valid user wallet\n\n\n@view\n@internal\ndef _isValidUserWallet(_userWallet: address) -> bool:\n    ledger: address = staticcall Registry(UNDY_HQ).getAddr(LEDGER_ID)\n    return staticcall Ledger(ledger).isUserWallet(_userWallet)\n\n\n# can perform security action\n\n\n@view\n@internal\ndef _canPerformSecurityAction(_addr: address) -> bool:\n    missionControl: address = staticcall Registry(UNDY_HQ).getAddr(MISSION_CONTROL_ID)\n    if missionControl == empty(address):\n        return False\n    return staticcall MissionControl(missionControl).canPerformSecurityAction(_addr)\n\n\n# default global payee settings\n\n\n@view\n@external\ndef createDefaultGlobalPayeeSettings(\n    _defaultPeriodLength: uint256,\n    _startDelay: uint256,\n    _activationLength: uint256,\n) -> wcs.GlobalPayeeSettings:\n    return wcs.GlobalPayeeSettings(\n        defaultPeriodLength = _defaultPeriodLength,\n        startDelay = _startDelay,\n        activationLength = _activationLength,\n        maxNumTxsPerPeriod = 0,\n        txCooldownBlocks = 0,\n        failOnZeroPrice = False,\n        usdLimits = empty(wcs.PayeeLimits),\n        canPayOwner = True,\n        canPull = False,\n    )\n",
            "sha256sum": "2d898d5ff3784854347bf449a2c723f011dd1ba9a020e8ed256f2c2996c89736"
          }
        },
        "settings": {
          "outputSelection": {
            "contracts/core/walletBackpack/Paymaster.vy": [
              "*"
            ]
          },
          "search_paths": [
            "."
          ]
        },
        "compiler_version": "v0.4.3+commit.bff19ea2",
        "integrity": "38c24c4315997cda873943b54f66bfd64f93ddf701565e837d6ab4a33a7bd577"
      },
      "args": "00000000000000000000000044cf3c4f000dfd76a35d03298049d37be688d6f9000000000000000000000000000000000000000000000000000000000000a8c00000000000000000000000000000000000000000000000000000000001e13380000000000000000000000000000000000000000000000000000000000000a8c00000000000000000000000000000000000000000000000000000000005a39a8000000000000000000000000000000000000000000000000000000000003b5380",
      "file": "contracts/core/walletBackpack/Paymaster.vy"
    },
    "ChequeBook": {
      "address": "0xcC939d6b16C6a5f07cde6Bc2bD23cb9B8b7a0Dc9",
      "abi": [
        {
          "name": "ChequeCreated",
          "inputs": [
            {
              "name": "user",
              "type": "address",
              "indexed": true
            },
            {
              "name": "recipient",
              "type": "address",
              "indexed": true
            },
            {
              "name": "asset",
              "type": "address",
              "indexed": false
            },
            {
              "name": "amount",
              "type": "uint256",
              "indexed": false
            },
            {
              "name": "usdValue",
              "type": "uint256",
              "indexed": false
            },
            {
              "name": "unlockBlock",
              "type": "uint256",
              "indexed": false
            },
            {
              "name": "expiryBlock",
              "type": "uint256",
              "indexed": false
            },
            {
              "name": "canManagerPay",
              "type": "bool",
              "indexed": false
            },
            {
              "name": "canBePulled",
              "type": "bool",
              "indexed": false
            },
            {
              "name": "creator",
              "type": "address",
              "indexed": true
            }
          ],
          "anonymous": false,
          "type": "event"
        },
        {
          "name": "ChequeCancelled",
          "inputs": [
            {
              "name": "user",
              "type": "address",
              "indexed": true
            },
            {
              "name": "recipient",
              "type": "address",
              "indexed": true
            },
            {
              "name": "asset",
              "type": "address",
              "indexed": false
            },
            {
              "name": "amount",
              "type": "uint256",
              "indexed": false
            },
            {
              "name": "usdValue",
              "type": "uint256",
              "indexed": false
            },
            {
              "name": "unlockBlock",
              "type": "uint256",
              "indexed": false
            },
            {
              "name": "expiryBlock",
              "type": "uint256",
              "indexed": false
            },
            {
              "name": "canManagerPay",
              "type": "bool",
              "indexed": false
            },
            {
              "name": "canBePulled",
              "type": "bool",
              "indexed": false
            },
            {
              "name": "cancelledBy",
              "type": "address",
              "indexed": true
            }
          ],
          "anonymous": false,
          "type": "event"
        },
        {
          "name": "ChequeSettingsModified",
          "inputs": [
            {
              "name": "user",
              "type": "address",
              "indexed": true
            },
            {
              "name": "maxNumActiveCheques",
              "type": "uint256",
              "indexed": false
            },
            {
              "name": "maxChequeUsdValue",
              "type": "uint256",
              "indexed": false
            },
            {
              "name": "instantUsdThreshold",
              "type": "uint256",
              "indexed": false
            },
            {
              "name": "perPeriodPaidUsdCap",
              "type": "uint256",
              "indexed": false
            },
            {
              "name": "maxNumChequesPaidPerPeriod",
              "type": "uint256",
              "indexed": false
            },
            {
              "name": "payCooldownBlocks",
              "type": "uint256",
              "indexed": false
            },
            {
              "name": "perPeriodCreatedUsdCap",
              "type": "uint256",
              "indexed": false
            },
            {
              "name": "maxNumChequesCreatedPerPeriod",
              "type": "uint256",
              "indexed": false
            },
            {
              "name": "createCooldownBlocks",
              "type": "uint256",
              "indexed": false
            },
            {
              "name": "periodLength",
              "type": "uint256",
              "indexed": false
            },
            {
              "name": "expensiveDelayBlocks",
              "type": "uint256",
              "indexed": false
            },
            {
              "name": "defaultExpiryBlocks",
              "type": "uint256",
              "indexed": false
            },
            {
              "name": "canManagersCreateCheques",
              "type": "bool",
              "indexed": false
            },
            {
              "name": "canManagerPay",
              "type": "bool",
              "indexed": false
            },
            {
              "name": "canBePulled",
              "type": "bool",
              "indexed": false
            }
          ],
          "anonymous": false,
          "type": "event"
        },
        {
          "stateMutability": "nonpayable",
          "type": "function",
          "name": "createCheque",
          "inputs": [
            {
              "name": "_userWallet",
              "type": "address"
            },
            {
              "name": "_recipient",
              "type": "address"
            },
            {
              "name": "_asset",
              "type": "address"
            },
            {
              "name": "_amount",
              "type": "uint256"
            },
            {
              "name": "_unlockNumBlocks",
              "type": "uint256"
            },
            {
              "name": "_expiryNumBlocks",
              "type": "uint256"
            },
            {
              "name": "_canManagerPay",
              "type": "bool"
            },
            {
              "name": "_canBePulled",
              "type": "bool"
            }
          ],
          "outputs": [
            {
              "name": "",
              "type": "bool"
            }
          ]
        },
        {
          "stateMutability": "view",
          "type": "function",
          "name": "canCreateCheque",
          "inputs": [
            {
              "name": "_isCreatorOwner",
              "type": "bool"
            },
            {
              "name": "_isCreatorManager",
              "type": "bool"
            },
            {
              "name": "_canManagersCreateCheques",
              "type": "bool"
            },
            {
              "name": "_managerSettings",
              "type": "tuple",
              "components": [
                {
                  "name": "startBlock",
                  "type": "uint256"
                },
                {
                  "name": "expiryBlock",
                  "type": "uint256"
                },
                {
                  "name": "limits",
                  "type": "tuple",
                  "components": [
                    {
                      "name": "maxUsdValuePerTx",
                      "type": "uint256"
                    },
                    {
                      "name": "maxUsdValuePerPeriod",
                      "type": "uint256"
                    },
                    {
                      "name": "maxUsdValueLifetime",
                      "type": "uint256"
                    },
                    {
                      "name": "maxNumTxsPerPeriod",
                      "type": "uint256"
                    },
                    {
                      "name": "txCooldownBlocks",
                      "type": "uint256"
                    },
                    {
                      "name": "failOnZeroPrice",
                      "type": "bool"
                    }
                  ]
                },
                {
                  "name": "legoPerms",
                  "type": "tuple",
                  "components": [
                    {
                      "name": "canManageYield",
                      "type": "bool"
                    },
                    {
                      "name": "canBuyAndSell",
                      "type": "bool"
                    },
                    {
                      "name": "canManageDebt",
                      "type": "bool"
                    },
                    {
                      "name": "canManageLiq",
                      "type": "bool"
                    },
                    {
                      "name": "canClaimRewards",
                      "type": "bool"
                    },
                    {
                      "name": "onlyApprovedYieldOpps",
                      "type": "bool"
                    },
                    {
                      "name": "allowedLegos",
                      "type": "uint256[]"
                    }
                  ]
                },
                {
                  "name": "swapPerms",
                  "type": "tuple",
                  "components": [
                    {
                      "name": "mustHaveUsdValue",
                      "type": "bool"
                    },
                    {
                      "name": "maxNumSwapsPerPeriod",
                      "type": "uint256"
                    },
                    {
                      "name": "maxSlippage",
                      "type": "uint256"
                    }
                  ]
                },
                {
                  "name": "whitelistPerms",
                  "type": "tuple",
                  "components": [
                    {
                      "name": "canAddPending",
                      "type": "bool"
                    },
                    {
                      "name": "canConfirm",
                      "type": "bool"
                    },
                    {
                      "name": "canCancel",
                      "type": "bool"
                    },
                    {
                      "name": "canRemove",
                      "type": "bool"
                    }
                  ]
                },
                {
                  "name": "transferPerms",
                  "type": "tuple",
                  "components": [
                    {
                      "name": "canTransfer",
                      "type": "bool"
                    },
                    {
                      "name": "canCreateCheque",
                      "type": "bool"
                    },
                    {
                      "name": "canAddPendingPayee",
                      "type": "bool"
                    },
                    {
                      "name": "allowedPayees",
                      "type": "address[]"
                    }
                  ]
                },
                {
                  "name": "allowedAssets",
                  "type": "address[]"
                },
                {
                  "name": "canClaimLoot",
                  "type": "bool"
                }
              ]
            }
          ],
          "outputs": [
            {
              "name": "",
              "type": "bool"
            }
          ]
        },
        {
          "stateMutability": "view",
          "type": "function",
          "name": "isValidNewCheque",
          "inputs": [
            {
              "name": "_wallet",
              "type": "address"
            },
            {
              "name": "_walletConfig",
              "type": "address"
            },
            {
              "name": "_owner",
              "type": "address"
            },
            {
              "name": "_isRecipientOnWhitelist",
              "type": "bool"
            },
            {
              "name": "_chequeSettings",
              "type": "tuple",
              "components": [
                {
                  "name": "maxNumActiveCheques",
                  "type": "uint256"
                },
                {
                  "name": "maxChequeUsdValue",
                  "type": "uint256"
                },
                {
                  "name": "instantUsdThreshold",
                  "type": "uint256"
                },
                {
                  "name": "perPeriodPaidUsdCap",
                  "type": "uint256"
                },
                {
                  "name": "maxNumChequesPaidPerPeriod",
                  "type": "uint256"
                },
                {
                  "name": "payCooldownBlocks",
                  "type": "uint256"
                },
                {
                  "name": "perPeriodCreatedUsdCap",
                  "type": "uint256"
                },
                {
                  "name": "maxNumChequesCreatedPerPeriod",
                  "type": "uint256"
                },
                {
                  "name": "createCooldownBlocks",
                  "type": "uint256"
                },
                {
                  "name": "periodLength",
                  "type": "uint256"
                },
                {
                  "name": "expensiveDelayBlocks",
                  "type": "uint256"
                },
                {
                  "name": "defaultExpiryBlocks",
                  "type": "uint256"
                },
                {
                  "name": "allowedAssets",
                  "type": "address[]"
                },
                {
                  "name": "canManagersCreateCheques",
                  "type": "bool"
                },
                {
                  "name": "canManagerPay",
                  "type": "bool"
                },
                {
                  "name": "canBePulled",
                  "type": "bool"
                }
              ]
            },
            {
              "name": "_chequeData",
              "type": "tuple",
              "components": [
                {
                  "name": "numChequesPaidInPeriod",
                  "type": "uint256"
                },
                {
                  "name": "totalUsdValuePaidInPeriod",
                  "type": "uint256"
                },
                {
                  "name": "totalNumChequesPaid",
                  "type": "uint256"
                },
                {
                  "name": "totalUsdValuePaid",
                  "type": "uint256"
                },
                {
                  "name": "lastChequePaidBlock",
                  "type": "uint256"
                },
                {
                  "name": "numChequesCreatedInPeriod",
                  "type": "uint256"
                },
                {
                  "name": "totalUsdValueCreatedInPeriod",
                  "type": "uint256"
                },
                {
                  "name": "totalNumChequesCreated",
                  "type": "uint256"
                },
                {
                  "name": "totalUsdValueCreated",
                  "type": "uint256"
                },
                {
                  "name": "lastChequeCreatedBlock",
                  "type": "uint256"
                },
                {
                  "name": "periodStartBlock",
                  "type": "uint256"
                }
              ]
            },
            {
              "name": "_isExistingCheque",
              "type": "bool"
            },
            {
              "name": "_numActiveCheques",
              "type": "uint256"
            },
            {
              "name": "_isExistingPayee",
              "type": "bool"
            },
            {
              "name": "_timeLock",
              "type": "uint256"
            },
            {
              "name": "_recipient",
              "type": "address"
            },
            {
              "name": "_asset",
              "type": "address"
            },
            {
              "name": "_amount",
              "type": "uint256"
            },
            {
              "name": "_unlockNumBlocks",
              "type": "uint256"
            },
            {
              "name": "_expiryNumBlocks",
              "type": "uint256"
            },
            {
              "name": "_canManagerPay",
              "type": "bool"
            },
            {
              "name": "_canBePulled",
              "type": "bool"
            },
            {
              "name": "_creator",
              "type": "address"
            },
            {
              "name": "_usdValue",
              "type": "uint256"
            }
          ],
          "outputs": [
            {
              "name": "",
              "type": "bool"
            }
          ]
        },
        {
          "stateMutability": "nonpayable",
          "type": "function",
          "name": "cancelCheque",
          "inputs": [
            {
              "name": "_userWallet",
              "type": "address"
            },
            {
              "name": "_recipient",
              "type": "address"
            }
          ],
          "outputs": [
            {
              "name": "",
              "type": "bool"
            }
          ]
        },
        {
          "stateMutability": "nonpayable",
          "type": "function",
          "name": "setChequeSettings",
          "inputs": [
            {
              "name": "_userWallet",
              "type": "address"
            },
            {
              "name": "_maxNumActiveCheques",
              "type": "uint256"
            },
            {
              "name": "_maxChequeUsdValue",
              "type": "uint256"
            },
            {
              "name": "_instantUsdThreshold",
              "type": "uint256"
            },
            {
              "name": "_perPeriodPaidUsdCap",
              "type": "uint256"
            },
            {
              "name": "_maxNumChequesPaidPerPeriod",
              "type": "uint256"
            },
            {
              "name": "_payCooldownBlocks",
              "type": "uint256"
            },
            {
              "name": "_perPeriodCreatedUsdCap",
              "type": "uint256"
            },
            {
              "name": "_maxNumChequesCreatedPerPeriod",
              "type": "uint256"
            },
            {
              "name": "_createCooldownBlocks",
              "type": "uint256"
            },
            {
              "name": "_periodLength",
              "type": "uint256"
            },
            {
              "name": "_expensiveDelayBlocks",
              "type": "uint256"
            },
            {
              "name": "_defaultExpiryBlocks",
              "type": "uint256"
            },
            {
              "name": "_allowedAssets",
              "type": "address[]"
            },
            {
              "name": "_canManagersCreateCheques",
              "type": "bool"
            },
            {
              "name": "_canManagerPay",
              "type": "bool"
            },
            {
              "name": "_canBePulled",
              "type": "bool"
            }
          ],
          "outputs": [
            {
              "name": "",
              "type": "bool"
            }
          ]
        },
        {
          "stateMutability": "view",
          "type": "function",
          "name": "isValidChequeSettings",
          "inputs": [
            {
              "name": "_maxNumActiveCheques",
              "type": "uint256"
            },
            {
              "name": "_maxChequeUsdValue",
              "type": "uint256"
            },
            {
              "name": "_instantUsdThreshold",
              "type": "uint256"
            },
            {
              "name": "_perPeriodPaidUsdCap",
              "type": "uint256"
            },
            {
              "name": "_maxNumChequesPaidPerPeriod",
              "type": "uint256"
            },
            {
              "name": "_payCooldownBlocks",
              "type": "uint256"
            },
            {
              "name": "_perPeriodCreatedUsdCap",
              "type": "uint256"
            },
            {
              "name": "_maxNumChequesCreatedPerPeriod",
              "type": "uint256"
            },
            {
              "name": "_createCooldownBlocks",
              "type": "uint256"
            },
            {
              "name": "_periodLength",
              "type": "uint256"
            },
            {
              "name": "_expensiveDelayBlocks",
              "type": "uint256"
            },
            {
              "name": "_defaultExpiryBlocks",
              "type": "uint256"
            },
            {
              "name": "_timeLock",
              "type": "uint256"
            }
          ],
          "outputs": [
            {
              "name": "",
              "type": "bool"
            }
          ]
        },
        {
          "stateMutability": "view",
          "type": "function",
          "name": "getChequeConfig",
          "inputs": [
            {
              "name": "_userWallet",
              "type": "address"
            },
            {
              "name": "_creator",
              "type": "address"
            },
            {
              "name": "_recipient",
              "type": "address"
            }
          ],
          "outputs": [
            {
              "name": "",
              "type": "tuple",
              "components": [
                {
                  "name": "wallet",
                  "type": "address"
                },
                {
                  "name": "walletConfig",
                  "type": "address"
                },
                {
                  "name": "owner",
                  "type": "address"
                },
                {
                  "name": "isRecipientOnWhitelist",
                  "type": "bool"
                },
                {
                  "name": "isCreatorManager",
                  "type": "bool"
                },
                {
                  "name": "managerSettings",
                  "type": "tuple",
                  "components": [
                    {
                      "name": "startBlock",
                      "type": "uint256"
                    },
                    {
                      "name": "expiryBlock",
                      "type": "uint256"
                    },
                    {
                      "name": "limits",
                      "type": "tuple",
                      "components": [
                        {
                          "name": "maxUsdValuePerTx",
                          "type": "uint256"
                        },
                        {
                          "name": "maxUsdValuePerPeriod",
                          "type": "uint256"
                        },
                        {
                          "name": "maxUsdValueLifetime",
                          "type": "uint256"
                        },
                        {
                          "name": "maxNumTxsPerPeriod",
                          "type": "uint256"
                        },
                        {
                          "name": "txCooldownBlocks",
                          "type": "uint256"
                        },
                        {
                          "name": "failOnZeroPrice",
                          "type": "bool"
                        }
                      ]
                    },
                    {
                      "name": "legoPerms",
                      "type": "tuple",
                      "components": [
                        {
                          "name": "canManageYield",
                          "type": "bool"
                        },
                        {
                          "name": "canBuyAndSell",
                          "type": "bool"
                        },
                        {
                          "name": "canManageDebt",
                          "type": "bool"
                        },
                        {
                          "name": "canManageLiq",
                          "type": "bool"
                        },
                        {
                          "name": "canClaimRewards",
                          "type": "bool"
                        },
                        {
                          "name": "onlyApprovedYieldOpps",
                          "type": "bool"
                        },
                        {
                          "name": "allowedLegos",
                          "type": "uint256[]"
                        }
                      ]
                    },
                    {
                      "name": "swapPerms",
                      "type": "tuple",
                      "components": [
                        {
                          "name": "mustHaveUsdValue",
                          "type": "bool"
                        },
                        {
                          "name": "maxNumSwapsPerPeriod",
                          "type": "uint256"
                        },
                        {
                          "name": "maxSlippage",
                          "type": "uint256"
                        }
                      ]
                    },
                    {
                      "name": "whitelistPerms",
                      "type": "tuple",
                      "components": [
                        {
                          "name": "canAddPending",
                          "type": "bool"
                        },
                        {
                          "name": "canConfirm",
                          "type": "bool"
                        },
                        {
                          "name": "canCancel",
                          "type": "bool"
                        },
                        {
                          "name": "canRemove",
                          "type": "bool"
                        }
                      ]
                    },
                    {
                      "name": "transferPerms",
                      "type": "tuple",
                      "components": [
                        {
                          "name": "canTransfer",
                          "type": "bool"
                        },
                        {
                          "name": "canCreateCheque",
                          "type": "bool"
                        },
                        {
                          "name": "canAddPendingPayee",
                          "type": "bool"
                        },
                        {
                          "name": "allowedPayees",
                          "type": "address[]"
                        }
                      ]
                    },
                    {
                      "name": "allowedAssets",
                      "type": "address[]"
                    },
                    {
                      "name": "canClaimLoot",
                      "type": "bool"
                    }
                  ]
                },
                {
                  "name": "chequeSettings",
                  "type": "tuple",
                  "components": [
                    {
                      "name": "maxNumActiveCheques",
                      "type": "uint256"
                    },
                    {
                      "name": "maxChequeUsdValue",
                      "type": "uint256"
                    },
                    {
                      "name": "instantUsdThreshold",
                      "type": "uint256"
                    },
                    {
                      "name": "perPeriodPaidUsdCap",
                      "type": "uint256"
                    },
                    {
                      "name": "maxNumChequesPaidPerPeriod",
                      "type": "uint256"
                    },
                    {
                      "name": "payCooldownBlocks",
                      "type": "uint256"
                    },
                    {
                      "name": "perPeriodCreatedUsdCap",
                      "type": "uint256"
                    },
                    {
                      "name": "maxNumChequesCreatedPerPeriod",
                      "type": "uint256"
                    },
                    {
                      "name": "createCooldownBlocks",
                      "type": "uint256"
                    },
                    {
                      "name": "periodLength",
                      "type": "uint256"
                    },
                    {
                      "name": "expensiveDelayBlocks",
                      "type": "uint256"
                    },
                    {
                      "name": "defaultExpiryBlocks",
                      "type": "uint256"
                    },
                    {
                      "name": "allowedAssets",
                      "type": "address[]"
                    },
                    {
                      "name": "canManagersCreateCheques",
                      "type": "bool"
                    },
                    {
                      "name": "canManagerPay",
                      "type": "bool"
                    },
                    {
                      "name": "canBePulled",
                      "type": "bool"
                    }
                  ]
                },
                {
                  "name": "chequeData",
                  "type": "tuple",
                  "components": [
                    {
                      "name": "numChequesPaidInPeriod",
                      "type": "uint256"
                    },
                    {
                      "name": "totalUsdValuePaidInPeriod",
                      "type": "uint256"
                    },
                    {
                      "name": "totalNumChequesPaid",
                      "type": "uint256"
                    },
                    {
                      "name": "totalUsdValuePaid",
                      "type": "uint256"
                    },
                    {
                      "name": "lastChequePaidBlock",
                      "type": "uint256"
                    },
                    {
                      "name": "numChequesCreatedInPeriod",
                      "type": "uint256"
                    },
                    {
                      "name": "totalUsdValueCreatedInPeriod",
                      "type": "uint256"
                    },
                    {
                      "name": "totalNumChequesCreated",
                      "type": "uint256"
                    },
                    {
                      "name": "totalUsdValueCreated",
                      "type": "uint256"
                    },
                    {
                      "name": "lastChequeCreatedBlock",
                      "type": "uint256"
                    },
                    {
                      "name": "periodStartBlock",
                      "type": "uint256"
                    }
                  ]
                },
                {
                  "name": "isExistingCheque",
                  "type": "bool"
                },
                {
                  "name": "numActiveCheques",
                  "type": "uint256"
                },
                {
                  "name": "isExistingPayee",
                  "type": "bool"
                },
                {
                  "name": "timeLock",
                  "type": "uint256"
                }
              ]
            }
          ]
        },
        {
          "stateMutability": "view",
          "type": "function",
          "name": "createDefaultChequeSettings",
          "inputs": [
            {
              "name": "_maxNumActiveCheques",
              "type": "uint256"
            },
            {
              "name": "_instantUsdThreshold",
              "type": "uint256"
            },
            {
              "name": "_periodLength",
              "type": "uint256"
            },
            {
              "name": "_expensiveDelayBlocks",
              "type": "uint256"
            },
            {
              "name": "_defaultExpiryBlocks",
              "type": "uint256"
            }
          ],
          "outputs": [
            {
              "name": "",
              "type": "tuple",
              "components": [
                {
                  "name": "maxNumActiveCheques",
                  "type": "uint256"
                },
                {
                  "name": "maxChequeUsdValue",
                  "type": "uint256"
                },
                {
                  "name": "instantUsdThreshold",
                  "type": "uint256"
                },
                {
                  "name": "perPeriodPaidUsdCap",
                  "type": "uint256"
                },
                {
                  "name": "maxNumChequesPaidPerPeriod",
                  "type": "uint256"
                },
                {
                  "name": "payCooldownBlocks",
                  "type": "uint256"
                },
                {
                  "name": "perPeriodCreatedUsdCap",
                  "type": "uint256"
                },
                {
                  "name": "maxNumChequesCreatedPerPeriod",
                  "type": "uint256"
                },
                {
                  "name": "createCooldownBlocks",
                  "type": "uint256"
                },
                {
                  "name": "periodLength",
                  "type": "uint256"
                },
                {
                  "name": "expensiveDelayBlocks",
                  "type": "uint256"
                },
                {
                  "name": "defaultExpiryBlocks",
                  "type": "uint256"
                },
                {
                  "name": "allowedAssets",
                  "type": "address[]"
                },
                {
                  "name": "canManagersCreateCheques",
                  "type": "bool"
                },
                {
                  "name": "canManagerPay",
                  "type": "bool"
                },
                {
                  "name": "canBePulled",
                  "type": "bool"
                }
              ]
            }
          ]
        },
        {
          "stateMutability": "view",
          "type": "function",
          "name": "UNDY_HQ",
          "inputs": [],
          "outputs": [
            {
              "name": "",
              "type": "address"
            }
          ]
        },
        {
          "stateMutability": "view",
          "type": "function",
          "name": "MIN_CHEQUE_PERIOD",
          "inputs": [],
          "outputs": [
            {
              "name": "",
              "type": "uint256"
            }
          ]
        },
        {
          "stateMutability": "view",
          "type": "function",
          "name": "MAX_CHEQUE_PERIOD",
          "inputs": [],
          "outputs": [
            {
              "name": "",
              "type": "uint256"
            }
          ]
        },
        {
          "stateMutability": "view",
          "type": "function",
          "name": "MIN_EXPENSIVE_CHEQUE_DELAY",
          "inputs": [],
          "outputs": [
            {
              "name": "",
              "type": "uint256"
            }
          ]
        },
        {
          "stateMutability": "view",
          "type": "function",
          "name": "MAX_UNLOCK_BLOCKS",
          "inputs": [],
          "outputs": [
            {
              "name": "",
              "type": "uint256"
            }
          ]
        },
        {
          "stateMutability": "view",
          "type": "function",
          "name": "MAX_EXPIRY_BLOCKS",
          "inputs": [],
          "outputs": [
            {
              "name": "",
              "type": "uint256"
            }
          ]
        },
        {
          "stateMutability": "nonpayable",
          "type": "constructor",
          "inputs": [
            {
              "name": "_undyHq",
              "type": "address"
            },
            {
              "name": "_minChequePeriod",
              "type": "uint256"
            },
            {
              "name": "_maxChequePeriod",
              "type": "uint256"
            },
            {
              "name": "_minExpensiveChequeDelay",
              "type": "uint256"
            },
            {
              "name": "_maxUnlockBlocks",
              "type": "uint256"
            },
            {
              "name": "_maxExpiryBlocks",
              "type": "uint256"
            }
          ],
          "outputs": []
        }
      ],
      "solc_json": {
        "language": "Vyper",
        "sources": {
          "interfaces/WalletConfigStructs.vyi": {
            "content": "# @version 0.4.3\n\nMAX_CONFIG_ASSETS: constant(uint256) = 40\nMAX_CONFIG_LEGOS: constant(uint256) = 25\nMAX_ALLOWED_PAYEES: constant(uint256) = 40\n\nflag WhitelistAction:\n    ADD_PENDING\n    CONFIRM_WHITELIST\n    CANCEL_WHITELIST\n    REMOVE_WHITELIST\n\nflag BackpackType:\n    WALLET_KERNEL\n    WALLET_SENTINEL\n    WALLET_HIGH_COMMAND\n    WALLET_PAYMASTER\n    WALLET_CHEQUE_BOOK\n    WALLET_MIGRATOR\n\n# payees\n\nstruct PayeeData:\n    numTxsInPeriod: uint256\n    totalUnitsInPeriod: uint256\n    totalUsdValueInPeriod: uint256\n    totalNumTxs: uint256\n    totalUnits: uint256\n    totalUsdValue: uint256\n    lastTxBlock: uint256\n    periodStartBlock: uint256\n\nstruct PayeeSettings:\n    startBlock: uint256\n    expiryBlock: uint256\n    canPull: bool\n    periodLength: uint256\n    maxNumTxsPerPeriod: uint256\n    txCooldownBlocks: uint256\n    failOnZeroPrice: bool\n    primaryAsset: address\n    onlyPrimaryAsset: bool\n    unitLimits: PayeeLimits\n    usdLimits: PayeeLimits\n\nstruct GlobalPayeeSettings:\n    defaultPeriodLength: uint256\n    startDelay: uint256\n    activationLength: uint256\n    maxNumTxsPerPeriod: uint256\n    txCooldownBlocks: uint256\n    failOnZeroPrice: bool\n    usdLimits: PayeeLimits\n    canPayOwner: bool\n    canPull: bool\n\nstruct PayeeLimits:\n    perTxCap: uint256\n    perPeriodCap: uint256\n    lifetimeCap: uint256\n\nstruct PendingPayee:\n    settings: PayeeSettings\n    initiatedBlock: uint256\n    confirmBlock: uint256\n    currentOwner: address\n\nstruct PayeeManagementBundle:\n    owner: address\n    wallet: address\n    isRegisteredPayee: bool\n    isWhitelisted: bool\n    isExistingCheque: bool\n    payeeSettings: PayeeSettings\n    globalPayeeSettings: GlobalPayeeSettings\n    timeLock: uint256\n    walletConfig: address\n\nstruct RecipientConfigBundle:\n    isWhitelisted: bool\n    isOwner: bool\n    isPayee: bool\n    config: PayeeSettings\n    globalConfig: GlobalPayeeSettings\n    data: PayeeData\n\nstruct WhitelistConfigBundle:\n    owner: address\n    wallet: address\n    isWhitelisted: bool\n    pendingWhitelist: PendingWhitelist\n    isExistingPayee: bool\n    isExistingCheque: bool\n    timeLock: uint256\n    walletConfig: address\n    isManager: bool\n    isOwner: bool\n    whitelistPerms: WhitelistPerms\n    globalWhitelistPerms: WhitelistPerms\n\nstruct PendingWhitelist:\n    initiatedBlock: uint256\n    confirmBlock: uint256\n    currentOwner: address\n\n# cheques\n\nstruct Cheque:\n    recipient: address\n    asset: address\n    amount: uint256\n    creationBlock: uint256\n    unlockBlock: uint256\n    expiryBlock: uint256\n    usdValueOnCreation: uint256\n    canManagerPay: bool\n    canBePulled: bool\n    creator: address\n    active: bool\n\nstruct ChequeSettings:\n    maxNumActiveCheques: uint256\n    maxChequeUsdValue: uint256\n    instantUsdThreshold: uint256\n    perPeriodPaidUsdCap: uint256\n    maxNumChequesPaidPerPeriod: uint256\n    payCooldownBlocks: uint256\n    perPeriodCreatedUsdCap: uint256\n    maxNumChequesCreatedPerPeriod: uint256\n    createCooldownBlocks: uint256\n    periodLength: uint256\n    expensiveDelayBlocks: uint256\n    defaultExpiryBlocks: uint256\n    allowedAssets: DynArray[address, MAX_CONFIG_ASSETS]\n    canManagersCreateCheques: bool\n    canManagerPay: bool\n    canBePulled: bool\n\nstruct ChequeData:\n    numChequesPaidInPeriod: uint256\n    totalUsdValuePaidInPeriod: uint256\n    totalNumChequesPaid: uint256\n    totalUsdValuePaid: uint256\n    lastChequePaidBlock: uint256\n    numChequesCreatedInPeriod: uint256\n    totalUsdValueCreatedInPeriod: uint256\n    totalNumChequesCreated: uint256\n    totalUsdValueCreated: uint256\n    lastChequeCreatedBlock: uint256\n    periodStartBlock: uint256\n\nstruct ChequeManagementBundle:\n    wallet: address\n    walletConfig: address\n    owner: address\n    isRecipientOnWhitelist: bool\n    isCreatorManager: bool\n    managerSettings: ManagerSettings\n    chequeSettings: ChequeSettings\n    chequeData: ChequeData\n    isExistingCheque: bool\n    numActiveCheques: uint256\n    isExistingPayee: bool\n    timeLock: uint256\n\n# managers\n\nstruct ManagerData:\n    numTxsInPeriod: uint256\n    totalUsdValueInPeriod: uint256\n    totalNumTxs: uint256\n    totalUsdValue: uint256\n    lastTxBlock: uint256\n    periodStartBlock: uint256\n    numSwapsInPeriod: uint256\n\nstruct ManagerSettings:\n    startBlock: uint256\n    expiryBlock: uint256\n    limits: ManagerLimits\n    legoPerms: LegoPerms\n    swapPerms: SwapPerms\n    whitelistPerms: WhitelistPerms\n    transferPerms: TransferPerms\n    allowedAssets: DynArray[address, MAX_CONFIG_ASSETS]\n    canClaimLoot: bool\n\nstruct GlobalManagerSettings:\n    managerPeriod: uint256\n    startDelay: uint256\n    activationLength: uint256\n    canOwnerManage: bool\n    limits: ManagerLimits\n    legoPerms: LegoPerms\n    swapPerms: SwapPerms\n    whitelistPerms: WhitelistPerms\n    transferPerms: TransferPerms\n    allowedAssets: DynArray[address, MAX_CONFIG_ASSETS]\n\nstruct ManagerLimits:\n    maxUsdValuePerTx: uint256\n    maxUsdValuePerPeriod: uint256\n    maxUsdValueLifetime: uint256\n    maxNumTxsPerPeriod: uint256\n    txCooldownBlocks: uint256\n    failOnZeroPrice: bool\n\nstruct LegoPerms:\n    canManageYield: bool\n    canBuyAndSell: bool\n    canManageDebt: bool\n    canManageLiq: bool\n    canClaimRewards: bool\n    onlyApprovedYieldOpps: bool\n    allowedLegos: DynArray[uint256, MAX_CONFIG_LEGOS]\n\nstruct SwapPerms:\n    mustHaveUsdValue: bool\n    maxNumSwapsPerPeriod: uint256\n    maxSlippage: uint256\n\nstruct WhitelistPerms:\n    canAddPending: bool\n    canConfirm: bool\n    canCancel: bool\n    canRemove: bool\n\nstruct TransferPerms:\n    canTransfer: bool\n    canCreateCheque: bool\n    canAddPendingPayee: bool\n    allowedPayees: DynArray[address, MAX_ALLOWED_PAYEES]\n\nstruct ManagerConfigBundle:\n    isOwner: bool\n    isManager: bool\n    config: ManagerSettings\n    globalConfig: GlobalManagerSettings\n    data: ManagerData\n    payee: address\n\nstruct ManagerSettingsBundle:\n    owner: address\n    isManager: bool\n    timeLock: uint256\n    walletConfig: address\n    legoBook: address\n    globalManagerSettings: GlobalManagerSettings\n\n# migration\n\nstruct MigrationConfigBundle:\n    owner: address\n    isFrozen: bool\n    numPayees: uint256\n    numWhitelisted: uint256\n    numManagers: uint256\n    startingAgent: address\n    startingAgentIndex: uint256\n    hasPendingOwnerChange: bool\n    groupId: uint256\n    numActiveCheques: uint256\n",
            "sha256sum": "31165468feeac632a1376c70970ce5124f8951392c4deaa01a26176c7f26718a"
          },
          "contracts/core/walletBackpack/ChequeBook.vy": {
            "content": "#    \u2513 \u250f  \u2513\u2513   \n#    \u2503\u2503\u2503\u250f\u2513\u2503\u2503\u250f\u2513\u254b\n#    \u2517\u253b\u251b\u2517\u253b\u2517\u2517\u2517 \u2517\n#     ______   __  __   ______   ______   __  __   ______       ______   ______   ______   __  __    \n#    /\\  ___\\ /\\ \\_\\ \\ /\\  ___\\ /\\  __ \\ /\\ \\/\\ \\ /\\  ___\\     /\\  == \\ /\\  __ \\ /\\  __ \\ /\\ \\/ /    \n#    \\ \\ \\____\\ \\  __ \\\\ \\  __\\ \\ \\ \\/\\_\\\\ \\ \\_\\ \\\\ \\  __\\     \\ \\  __< \\ \\ \\/\\ \\\\ \\ \\/\\ \\\\ \\  _\"-.  \n#     \\ \\_____\\\\ \\_\\ \\_\\\\ \\_____\\\\ \\___\\_\\\\ \\_____\\\\ \\_____\\    \\ \\_____\\\\ \\_____\\\\ \\_____\\\\ \\_\\ \\_\\ \n#      \\/_____/ \\/_/\\/_/ \\/_____/ \\/___/_/ \\/_____/ \\/_____/     \\/_____/ \\/_____/ \\/_____/ \\/_/\\/_/ \n#                                                                                                \n#     \u2554\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2557\n#     \u2551  ** Cheque Book **                           \u2551\n#     \u2551  Cheque book functionality for user wallets  \u2551\n#     \u255a\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u255d\n#\n#     Underscore Protocol License: https://github.com/underscore-finance/underscore-protocol/blob/master/LICENSE.md\n\n# @version 0.4.3\n\nfrom interfaces import WalletConfigStructs as wcs\n\ninterface UserWalletConfig:\n    def createCheque(_recipient: address, _cheque: wcs.Cheque, _chequeData: wcs.ChequeData, _isExistingCheque: bool): nonpayable\n    def managerSettings(_addr: address) -> wcs.ManagerSettings: view\n    def setChequeSettings(_config: wcs.ChequeSettings): nonpayable\n    def indexOfWhitelist(_addr: address) -> uint256: view\n    def cheques(_recipient: address) -> wcs.Cheque: view\n    def cancelCheque(_recipient: address): nonpayable\n    def indexOfManager(_addr: address) -> uint256: view\n    def indexOfPayee(_addr: address) -> uint256: view\n    def chequeSettings() -> wcs.ChequeSettings: view\n    def chequePeriodData() -> wcs.ChequeData: view\n    def numActiveCheques() -> uint256: view\n    def timeLock() -> uint256: view\n    def owner() -> address: view\n\ninterface Appraiser:\n    def updatePriceAndGetUsdValue(_asset: address, _amount: uint256, _missionControl: address = empty(address), _legoBook: address = empty(address)) -> uint256: nonpayable\n\ninterface MissionControl:\n    def canPerformSecurityAction(_addr: address) -> bool: view\n\ninterface Ledger:\n    def isUserWallet(_user: address) -> bool: view\n\ninterface Registry:\n    def getAddr(_regId: uint256) -> address: view\n\ninterface UserWallet:\n    def walletConfig() -> address: view\n\nevent ChequeCreated:\n    user: indexed(address)\n    recipient: indexed(address)\n    asset: address\n    amount: uint256\n    usdValue: uint256\n    unlockBlock: uint256\n    expiryBlock: uint256\n    canManagerPay: bool\n    canBePulled: bool\n    creator: indexed(address)\n\nevent ChequeCancelled:\n    user: indexed(address)\n    recipient: indexed(address)\n    asset: address\n    amount: uint256\n    usdValue: uint256\n    unlockBlock: uint256\n    expiryBlock: uint256\n    canManagerPay: bool\n    canBePulled: bool\n    cancelledBy: indexed(address)\n\nevent ChequeSettingsModified:\n    user: indexed(address)\n    maxNumActiveCheques: uint256\n    maxChequeUsdValue: uint256\n    instantUsdThreshold: uint256\n    perPeriodPaidUsdCap: uint256\n    maxNumChequesPaidPerPeriod: uint256\n    payCooldownBlocks: uint256\n    perPeriodCreatedUsdCap: uint256\n    maxNumChequesCreatedPerPeriod: uint256\n    createCooldownBlocks: uint256\n    periodLength: uint256\n    expensiveDelayBlocks: uint256\n    defaultExpiryBlocks: uint256\n    canManagersCreateCheques: bool\n    canManagerPay: bool\n    canBePulled: bool\n\nUNDY_HQ: public(immutable(address))\nLEDGER_ID: constant(uint256) = 1\nMISSION_CONTROL_ID: constant(uint256) = 2\nAPPRAISER_ID: constant(uint256) = 7\nMAX_CONFIG_ASSETS: constant(uint256) = 40\n\nMIN_CHEQUE_PERIOD: public(immutable(uint256))\nMAX_CHEQUE_PERIOD: public(immutable(uint256))\nMIN_EXPENSIVE_CHEQUE_DELAY: public(immutable(uint256))\nMAX_UNLOCK_BLOCKS: public(immutable(uint256))\nMAX_EXPIRY_BLOCKS: public(immutable(uint256))\n\n\n@deploy\ndef __init__(\n    _undyHq: address,\n    _minChequePeriod: uint256,\n    _maxChequePeriod: uint256,\n    _minExpensiveChequeDelay: uint256,\n    _maxUnlockBlocks: uint256,\n    _maxExpiryBlocks: uint256,\n):\n    assert _undyHq != empty(address) # dev: invalid undy hq\n    UNDY_HQ = _undyHq\n\n    assert _minChequePeriod != 0 and _minChequePeriod < _maxChequePeriod # dev: invalid cheque period\n    MIN_CHEQUE_PERIOD = _minChequePeriod\n    MAX_CHEQUE_PERIOD = _maxChequePeriod\n\n    assert _minExpensiveChequeDelay != 0 # dev: invalid expensive cheque delay\n    MIN_EXPENSIVE_CHEQUE_DELAY = _minExpensiveChequeDelay\n\n    assert _maxUnlockBlocks != 0 # dev: invalid unlock blocks\n    MAX_UNLOCK_BLOCKS = _maxUnlockBlocks\n\n    assert _maxExpiryBlocks != 0 # dev: invalid expiry blocks\n    MAX_EXPIRY_BLOCKS = _maxExpiryBlocks\n\n\n#####################\n# Cheque Management #\n#####################\n\n\n@external\ndef createCheque(\n    _userWallet: address,\n    _recipient: address,\n    _asset: address,\n    _amount: uint256,\n    _unlockNumBlocks: uint256,\n    _expiryNumBlocks: uint256,\n    _canManagerPay: bool,\n    _canBePulled: bool,\n) -> bool:\n    assert self._isValidUserWallet(_userWallet) # dev: invalid user wallet\n\n    # get cheque config / data\n    config: wcs.ChequeManagementBundle = self._getChequeConfig(_userWallet, msg.sender, _recipient)\n\n    # check if caller can create cheques\n    assert self._canCreateCheque(\n        config.owner == msg.sender,\n        config.isCreatorManager,\n        config.chequeSettings.canManagersCreateCheques,\n        config.managerSettings,\n    ) # dev: not authorized to create cheques\n\n    # get USD value\n    appraiser: address = staticcall Registry(UNDY_HQ).getAddr(APPRAISER_ID)\n    usdValue: uint256 = extcall Appraiser(appraiser).updatePriceAndGetUsdValue(_asset, _amount)\n\n    # validate and create cheque\n    isValid: bool = False\n    cheque: wcs.Cheque = empty(wcs.Cheque)\n    updatedChequeData: wcs.ChequeData = empty(wcs.ChequeData)\n    isValid, cheque, updatedChequeData = self._isValidNewCheque(\n        config.wallet,\n        config.walletConfig,\n        config.owner,\n        config.isRecipientOnWhitelist,\n        config.chequeSettings,\n        config.chequeData,\n        config.isExistingCheque,\n        config.numActiveCheques,\n        config.isExistingPayee,\n        config.timeLock,\n        _recipient,\n        _asset,\n        _amount,\n        _unlockNumBlocks,\n        _expiryNumBlocks,\n        _canManagerPay,\n        _canBePulled,\n        msg.sender,\n        usdValue,\n    )\n    assert isValid # dev: invalid cheque\n\n    # save cheque\n    extcall UserWalletConfig(config.walletConfig).createCheque(_recipient, cheque, updatedChequeData, config.isExistingCheque)\n    log ChequeCreated(\n        user = _userWallet,\n        recipient = _recipient,\n        asset = _asset,\n        amount = _amount,\n        usdValue = usdValue,\n        unlockBlock = cheque.unlockBlock,\n        expiryBlock = cheque.expiryBlock,\n        canManagerPay = _canManagerPay,\n        canBePulled = _canBePulled,\n        creator = msg.sender,\n    )\n    return True\n\n\n# can create cheque\n\n\n@view\n@external\ndef canCreateCheque(\n    _isCreatorOwner: bool,\n    _isCreatorManager: bool,\n    _canManagersCreateCheques: bool,\n    _managerSettings: wcs.ManagerSettings,\n) -> bool:\n    return self._canCreateCheque(\n        _isCreatorOwner,\n        _isCreatorManager,\n        _canManagersCreateCheques,\n        _managerSettings,\n    )\n\n\n@view\n@internal\ndef _canCreateCheque(\n    _isCreatorOwner: bool,\n    _isCreatorManager: bool,\n    _canManagersCreateCheques: bool,\n    _managerSettings: wcs.ManagerSettings,\n) -> bool:\n\n    # owner can always create cheques\n    if _isCreatorOwner:\n        return True\n\n    # if not owner, must be a manager\n    if not _isCreatorManager:\n        return False\n\n    # check global setting - can managers create cheques\n    if not _canManagersCreateCheques:\n        return False\n\n    # check manager's specific transfer permissions\n    if not _managerSettings.transferPerms.canCreateCheque:\n        return False\n\n    # check if manager is active (within start/expiry blocks)\n    if _managerSettings.startBlock > block.number:\n        return False\n    if _managerSettings.expiryBlock != 0 and _managerSettings.expiryBlock <= block.number:\n        return False\n\n    return True\n\n\n# is valid new cheque\n\n\n@view\n@external\ndef isValidNewCheque(\n    _wallet: address,\n    _walletConfig: address,\n    _owner: address,\n    _isRecipientOnWhitelist: bool,\n    _chequeSettings: wcs.ChequeSettings,\n    _chequeData: wcs.ChequeData,\n    _isExistingCheque: bool,\n    _numActiveCheques: uint256,\n    _isExistingPayee: bool,\n    _timeLock: uint256,\n    _recipient: address,\n    _asset: address,\n    _amount: uint256,\n    _unlockNumBlocks: uint256,\n    _expiryNumBlocks: uint256,\n    _canManagerPay: bool,\n    _canBePulled: bool,\n    _creator: address,\n    _usdValue: uint256,\n) -> bool:\n    isValid: bool = False\n    cheque: wcs.Cheque = empty(wcs.Cheque)\n    chequeData: wcs.ChequeData = empty(wcs.ChequeData)    \n    isValid, cheque, chequeData = self._isValidNewCheque(\n        _wallet,\n        _walletConfig,\n        _owner,\n        _isRecipientOnWhitelist,\n        _chequeSettings,\n        _chequeData,\n        _isExistingCheque,\n        _numActiveCheques,\n        _isExistingPayee,\n        _timeLock,\n        _recipient,\n        _asset,\n        _amount,\n        _unlockNumBlocks,\n        _expiryNumBlocks,\n        _canManagerPay,\n        _canBePulled,\n        _creator,\n        _usdValue,\n    )\n    return isValid\n\n\n@view\n@internal\ndef _isValidNewCheque(\n    _wallet: address,\n    _walletConfig: address,\n    _owner: address,\n    _isRecipientOnWhitelist: bool,\n    _chequeSettings: wcs.ChequeSettings,\n    _chequeData: wcs.ChequeData,\n    _isExistingCheque: bool,\n    _numActiveCheques: uint256,\n    _isExistingPayee: bool,\n    _timeLock: uint256,\n    _recipient: address,\n    _asset: address,\n    _amount: uint256,\n    _unlockNumBlocks: uint256,\n    _expiryNumBlocks: uint256,\n    _canManagerPay: bool,\n    _canBePulled: bool,\n    _creator: address,\n    _usdValue: uint256,\n) -> (bool, wcs.Cheque, wcs.ChequeData):\n\n    # validate recipient\n    if _recipient == empty(address):\n        return False, empty(wcs.Cheque), empty(wcs.ChequeData)\n    if _recipient in [_wallet, _walletConfig, _owner]:\n        return False, empty(wcs.Cheque), empty(wcs.ChequeData)\n\n    # cheque recipients can't be whitelisted\n    if _isRecipientOnWhitelist:\n        return False, empty(wcs.Cheque), empty(wcs.ChequeData)\n\n    # cheque recipients can't be existing payees\n    if _isExistingPayee:\n        return False, empty(wcs.Cheque), empty(wcs.ChequeData)\n\n    # validate asset and amount\n    if _asset == empty(address):\n        return False, empty(wcs.Cheque), empty(wcs.ChequeData)\n    if _amount == 0:\n        return False, empty(wcs.Cheque), empty(wcs.ChequeData)\n\n    # check if asset is allowed\n    if len(_chequeSettings.allowedAssets) != 0:\n        if _asset not in _chequeSettings.allowedAssets:\n            return False, empty(wcs.Cheque), empty(wcs.ChequeData)\n\n    # validate canBePulled and canManagerPay against global settings\n    if _canBePulled and not _chequeSettings.canBePulled:\n        return False, empty(wcs.Cheque), empty(wcs.ChequeData)\n    if _canManagerPay and not _chequeSettings.canManagerPay:\n        return False, empty(wcs.Cheque), empty(wcs.ChequeData)\n\n    # check max number of active cheques (only if creating new cheque, not replacing)\n    if not _isExistingCheque and _chequeSettings.maxNumActiveCheques != 0:\n        if _numActiveCheques >= _chequeSettings.maxNumActiveCheques:\n            return False, empty(wcs.Cheque), empty(wcs.ChequeData)\n\n    # get latest cheque data (with period reset if needed)\n    chequeData: wcs.ChequeData = self._getLatestChequeData(_chequeData, _chequeSettings.periodLength)\n\n    # check creation cooldown\n    if _chequeSettings.createCooldownBlocks != 0 and chequeData.lastChequeCreatedBlock != 0:\n        if block.number < chequeData.lastChequeCreatedBlock + _chequeSettings.createCooldownBlocks:\n            return False, empty(wcs.Cheque), empty(wcs.ChequeData)\n\n    # check max num cheques created per period\n    if _chequeSettings.maxNumChequesCreatedPerPeriod != 0:\n        if chequeData.numChequesCreatedInPeriod >= _chequeSettings.maxNumChequesCreatedPerPeriod:\n            return False, empty(wcs.Cheque), empty(wcs.ChequeData)\n\n    # if no usd value, return False\n    if _usdValue == 0:\n        return False, empty(wcs.Cheque), empty(wcs.ChequeData)\n\n    # check max cheque USD value\n    if _chequeSettings.maxChequeUsdValue != 0:\n        if _usdValue > _chequeSettings.maxChequeUsdValue:\n            return False, empty(wcs.Cheque), empty(wcs.ChequeData)\n\n    # check per period created USD cap\n    if _chequeSettings.perPeriodCreatedUsdCap != 0:\n        if chequeData.totalUsdValueCreatedInPeriod + _usdValue > _chequeSettings.perPeriodCreatedUsdCap:\n            return False, empty(wcs.Cheque), empty(wcs.ChequeData)\n\n    # cannot be too long\n    if _unlockNumBlocks > MAX_UNLOCK_BLOCKS:\n        return False, empty(wcs.Cheque), empty(wcs.ChequeData)\n\n    # calculate unlock block\n    unlockBlock: uint256 = block.number + _unlockNumBlocks\n\n    # apply time lock if USD value exceeds instant threshold\n    if _chequeSettings.instantUsdThreshold != 0 and _usdValue > _chequeSettings.instantUsdThreshold:\n        if _chequeSettings.expensiveDelayBlocks != 0:\n            unlockBlock = max(unlockBlock, block.number + _chequeSettings.expensiveDelayBlocks)\n        else:\n            unlockBlock = max(unlockBlock, block.number + _timeLock)\n\n    # calculate expiry block\n    expiryBlock: uint256 = 0\n    if _expiryNumBlocks != 0:\n        expiryBlock = unlockBlock + _expiryNumBlocks\n    elif _chequeSettings.defaultExpiryBlocks != 0:\n        expiryBlock = unlockBlock + _chequeSettings.defaultExpiryBlocks\n    else:\n        expiryBlock = unlockBlock + _timeLock\n\n    # cannot be too long (active duration)\n    activeDuration: uint256 = expiryBlock - unlockBlock\n    if activeDuration > MAX_EXPIRY_BLOCKS:\n        return False, empty(wcs.Cheque), empty(wcs.ChequeData)\n\n    # create cheque\n    cheque: wcs.Cheque = wcs.Cheque(\n        recipient = _recipient,\n        asset = _asset,\n        amount = _amount,\n        creationBlock = block.number,\n        unlockBlock = unlockBlock,\n        expiryBlock = expiryBlock,\n        usdValueOnCreation = _usdValue,\n        canManagerPay = _canManagerPay,\n        canBePulled = _canBePulled,\n        creator = _creator,\n        active = True,\n    )\n\n    # update cheque data\n    chequeData.numChequesCreatedInPeriod += 1\n    chequeData.totalUsdValueCreatedInPeriod += _usdValue\n    chequeData.totalNumChequesCreated += 1\n    chequeData.totalUsdValueCreated += _usdValue\n    chequeData.lastChequeCreatedBlock = block.number\n\n    return True, cheque, chequeData\n\n\n# get latest cheque data (period reset)\n\n\n@view\n@internal\ndef _getLatestChequeData(_chequeData: wcs.ChequeData, _periodLength: uint256) -> wcs.ChequeData:\n    chequeData: wcs.ChequeData = _chequeData\n\n    # initialize period if first cheque\n    if chequeData.periodStartBlock == 0:\n        chequeData.periodStartBlock = block.number\n\n    # check if current period has ended\n    elif _periodLength != 0 and block.number >= chequeData.periodStartBlock + _periodLength:\n\n        # reset paid period data\n        chequeData.numChequesPaidInPeriod = 0\n        chequeData.totalUsdValuePaidInPeriod = 0\n\n        # reset created period data\n        chequeData.numChequesCreatedInPeriod = 0\n        chequeData.totalUsdValueCreatedInPeriod = 0\n        chequeData.periodStartBlock = block.number\n\n    return chequeData\n\n\n# cancel cheque\n\n\n@external\ndef cancelCheque(_userWallet: address, _recipient: address) -> bool:\n    assert self._isValidUserWallet(_userWallet) # dev: invalid user wallet\n\n    # get wallet config\n    walletConfig: address = staticcall UserWallet(_userWallet).walletConfig()\n    owner: address = staticcall UserWalletConfig(walletConfig).owner()\n\n    # check permissions - only owner or security action can cancel\n    if msg.sender != owner:\n        assert self._canPerformSecurityAction(msg.sender) # dev: no perms\n\n    # check if cheque exists\n    cheque: wcs.Cheque = staticcall UserWalletConfig(walletConfig).cheques(_recipient)\n    assert cheque.active # dev: no active cheque\n\n    # cancel the cheque\n    extcall UserWalletConfig(walletConfig).cancelCheque(_recipient)\n    log ChequeCancelled(\n        user = _userWallet,\n        recipient = _recipient,\n        asset = cheque.asset,\n        amount = cheque.amount,\n        usdValue = cheque.usdValueOnCreation,\n        unlockBlock = cheque.unlockBlock,\n        expiryBlock = cheque.expiryBlock,\n        canManagerPay = cheque.canManagerPay,\n        canBePulled = cheque.canBePulled,\n        cancelledBy = msg.sender,\n    )\n    return True\n\n\n###################\n# Cheque Settings #\n###################\n\n\n# set cheque settings\n\n\n@external\ndef setChequeSettings(\n    _userWallet: address,\n    _maxNumActiveCheques: uint256,\n    _maxChequeUsdValue: uint256,\n    _instantUsdThreshold: uint256,\n    _perPeriodPaidUsdCap: uint256,\n    _maxNumChequesPaidPerPeriod: uint256,\n    _payCooldownBlocks: uint256,\n    _perPeriodCreatedUsdCap: uint256,\n    _maxNumChequesCreatedPerPeriod: uint256,\n    _createCooldownBlocks: uint256,\n    _periodLength: uint256,\n    _expensiveDelayBlocks: uint256,\n    _defaultExpiryBlocks: uint256,\n    _allowedAssets: DynArray[address, MAX_CONFIG_ASSETS],\n    _canManagersCreateCheques: bool,\n    _canManagerPay: bool,\n    _canBePulled: bool,\n) -> bool:\n    assert self._isValidUserWallet(_userWallet) # dev: invalid user wallet\n\n    # only owner can set cheque settings\n    walletConfig: address = staticcall UserWallet(_userWallet).walletConfig()\n    assert msg.sender == staticcall UserWalletConfig(walletConfig).owner() # dev: no perms\n\n    # validate cheque settings with timelock\n    assert self._isValidChequeSettings(\n        _maxNumActiveCheques,\n        _maxChequeUsdValue,\n        _instantUsdThreshold,\n        _perPeriodPaidUsdCap,\n        _maxNumChequesPaidPerPeriod,\n        _payCooldownBlocks,\n        _perPeriodCreatedUsdCap,\n        _maxNumChequesCreatedPerPeriod,\n        _createCooldownBlocks,\n        _periodLength,\n        _expensiveDelayBlocks,\n        _defaultExpiryBlocks,\n        staticcall UserWalletConfig(walletConfig).timeLock(),\n    ) # dev: invalid cheque settings\n\n    # create settings\n    settings: wcs.ChequeSettings = wcs.ChequeSettings(\n        maxNumActiveCheques = _maxNumActiveCheques,\n        maxChequeUsdValue = _maxChequeUsdValue,\n        instantUsdThreshold = _instantUsdThreshold,\n        perPeriodPaidUsdCap = _perPeriodPaidUsdCap,\n        maxNumChequesPaidPerPeriod = _maxNumChequesPaidPerPeriod,\n        payCooldownBlocks = _payCooldownBlocks,\n        perPeriodCreatedUsdCap = _perPeriodCreatedUsdCap,\n        maxNumChequesCreatedPerPeriod = _maxNumChequesCreatedPerPeriod,\n        createCooldownBlocks = _createCooldownBlocks,\n        periodLength = _periodLength,\n        expensiveDelayBlocks = _expensiveDelayBlocks,\n        defaultExpiryBlocks = _defaultExpiryBlocks,\n        allowedAssets = _allowedAssets,\n        canManagersCreateCheques = _canManagersCreateCheques,\n        canManagerPay = _canManagerPay,\n        canBePulled = _canBePulled,\n    )\n\n    # update settings\n    extcall UserWalletConfig(walletConfig).setChequeSettings(settings)\n    log ChequeSettingsModified(\n        user = _userWallet,\n        maxNumActiveCheques = _maxNumActiveCheques,\n        maxChequeUsdValue = _maxChequeUsdValue,\n        instantUsdThreshold = _instantUsdThreshold,\n        perPeriodPaidUsdCap = _perPeriodPaidUsdCap,\n        maxNumChequesPaidPerPeriod = _maxNumChequesPaidPerPeriod,\n        payCooldownBlocks = _payCooldownBlocks,\n        perPeriodCreatedUsdCap = _perPeriodCreatedUsdCap,\n        maxNumChequesCreatedPerPeriod = _maxNumChequesCreatedPerPeriod,\n        createCooldownBlocks = _createCooldownBlocks,\n        periodLength = _periodLength,\n        expensiveDelayBlocks = _expensiveDelayBlocks,\n        defaultExpiryBlocks = _defaultExpiryBlocks,\n        canManagersCreateCheques = _canManagersCreateCheques,\n        canManagerPay = _canManagerPay,\n        canBePulled = _canBePulled,\n    )\n    return True\n\n\n# cheque settings validation\n\n\n@view\n@external\ndef isValidChequeSettings(\n    _maxNumActiveCheques: uint256,\n    _maxChequeUsdValue: uint256,\n    _instantUsdThreshold: uint256,\n    _perPeriodPaidUsdCap: uint256,\n    _maxNumChequesPaidPerPeriod: uint256,\n    _payCooldownBlocks: uint256,\n    _perPeriodCreatedUsdCap: uint256,\n    _maxNumChequesCreatedPerPeriod: uint256,\n    _createCooldownBlocks: uint256,\n    _periodLength: uint256,\n    _expensiveDelayBlocks: uint256,\n    _defaultExpiryBlocks: uint256,\n    _timeLock: uint256,\n) -> bool:\n    return self._isValidChequeSettings(\n        _maxNumActiveCheques,\n        _maxChequeUsdValue,\n        _instantUsdThreshold,\n        _perPeriodPaidUsdCap,\n        _maxNumChequesPaidPerPeriod,\n        _payCooldownBlocks,\n        _perPeriodCreatedUsdCap,\n        _maxNumChequesCreatedPerPeriod,\n        _createCooldownBlocks,\n        _periodLength,\n        _expensiveDelayBlocks,\n        _defaultExpiryBlocks,\n        _timeLock,\n    )\n\n\n@view\n@internal\ndef _isValidChequeSettings(\n    _maxNumActiveCheques: uint256,\n    _maxChequeUsdValue: uint256,\n    _instantUsdThreshold: uint256,\n    _perPeriodPaidUsdCap: uint256,\n    _maxNumChequesPaidPerPeriod: uint256,\n    _payCooldownBlocks: uint256,\n    _perPeriodCreatedUsdCap: uint256,\n    _maxNumChequesCreatedPerPeriod: uint256,\n    _createCooldownBlocks: uint256,\n    _periodLength: uint256,\n    _expensiveDelayBlocks: uint256,\n    _defaultExpiryBlocks: uint256,\n    _timeLock: uint256,\n) -> bool:\n\n    # validate period length\n    if not self._isValidChequePeriod(_periodLength):\n        return False\n\n    # validate cooldowns\n    if not self._isValidChequeCooldowns(_payCooldownBlocks, _createCooldownBlocks, _periodLength):\n        return False\n\n    # validate expensive delay\n    if not self._isValidExpensiveDelay(_expensiveDelayBlocks, _timeLock):\n        return False\n\n    # validate USD caps consistency\n    if not self._isValidChequeUsdCaps(_maxChequeUsdValue, _perPeriodPaidUsdCap, _perPeriodCreatedUsdCap):\n        return False\n\n    # validate instant threshold configuration\n    if not self._isValidInstantThreshold(_instantUsdThreshold, _expensiveDelayBlocks):\n        return False\n\n    # validate expiry blocks\n    if not self._isValidExpiryBlocks(_defaultExpiryBlocks, _timeLock):\n        return False\n\n    return True\n\n\n# validate cheque period\n\n\n@view\n@internal\ndef _isValidChequePeriod(_periodLength: uint256) -> bool:\n    # period length cannot be zero\n    if _periodLength == 0:\n        return False\n    return _periodLength >= MIN_CHEQUE_PERIOD and _periodLength <= MAX_CHEQUE_PERIOD\n\n\n# validate cheque cooldowns\n\n\n@view\n@internal\ndef _isValidChequeCooldowns(_payCooldownBlocks: uint256, _createCooldownBlocks: uint256, _periodLength: uint256) -> bool:\n    # cooldowns cannot exceed period length\n    if _payCooldownBlocks > _periodLength:\n        return False\n    if _createCooldownBlocks > _periodLength:\n        return False\n\n    return True\n\n\n# validate expensive delay\n\n\n@view\n@internal\ndef _isValidExpensiveDelay(_expensiveDelayBlocks: uint256, _timeLock: uint256) -> bool:\n    # NOTE: When set to zero, expensive cheque delay will use UserWalletConfig.timeLock()\n    if _expensiveDelayBlocks == 0:\n        return True\n\n    # must meet minimum and cannot be less than current timelock\n    if _expensiveDelayBlocks < MIN_EXPENSIVE_CHEQUE_DELAY:\n        return False\n    if _expensiveDelayBlocks < _timeLock:\n        return False\n\n    # cannot exceed maximum unlock blocks\n    if _expensiveDelayBlocks > MAX_UNLOCK_BLOCKS:\n        return False\n    return True\n\n\n# validate cheque USD caps consistency\n\n\n@view\n@internal\ndef _isValidChequeUsdCaps(_maxChequeUsdValue: uint256, _perPeriodPaidUsdCap: uint256, _perPeriodCreatedUsdCap: uint256) -> bool:\n    if _maxChequeUsdValue == 0:\n        return True\n\n    # per-cheque cap should not exceed period caps\n    if _perPeriodPaidUsdCap != 0 and _maxChequeUsdValue > _perPeriodPaidUsdCap:\n        return False\n    if _perPeriodCreatedUsdCap != 0 and _maxChequeUsdValue > _perPeriodCreatedUsdCap:\n        return False\n\n    return True\n\n\n# validate instant threshold configuration\n\n\n@view\n@internal\ndef _isValidInstantThreshold(_instantUsdThreshold: uint256, _expensiveDelayBlocks: uint256) -> bool:\n    # instant threshold cannot be zero\n    if _instantUsdThreshold == 0:\n        return False\n    # if instant threshold is set, expensive delay must be set\n    if _expensiveDelayBlocks == 0:\n        return False\n    return True\n\n\n# validate expiry blocks\n\n\n@view\n@internal\ndef _isValidExpiryBlocks(_defaultExpiryBlocks: uint256, _timeLock: uint256) -> bool:\n    # NOTE: When set to zero, expiry blocks will use UserWalletConfig.timeLock()\n    if _defaultExpiryBlocks == 0:\n        return True\n    if _defaultExpiryBlocks > MAX_EXPIRY_BLOCKS:\n        return False\n    if _defaultExpiryBlocks < _timeLock:\n        return False\n    return True\n\n\n#############\n# Utilities #\n#############\n\n# get cheque management bundle\n\n\n@view\n@external\ndef getChequeConfig(_userWallet: address, _creator: address, _recipient: address) -> wcs.ChequeManagementBundle:\n    return self._getChequeConfig(_userWallet, _creator, _recipient)\n\n\n@view\n@internal\ndef _getChequeConfig(_userWallet: address, _creator: address, _recipient: address) -> wcs.ChequeManagementBundle:\n    walletConfig: address = staticcall UserWallet(_userWallet).walletConfig()\n    cheque: wcs.Cheque = staticcall UserWalletConfig(walletConfig).cheques(_recipient)\n    return wcs.ChequeManagementBundle(\n        wallet = _userWallet,\n        walletConfig = walletConfig,\n        owner = staticcall UserWalletConfig(walletConfig).owner(),\n        isRecipientOnWhitelist = staticcall UserWalletConfig(walletConfig).indexOfWhitelist(_recipient) != 0,\n        isCreatorManager = staticcall UserWalletConfig(walletConfig).indexOfManager(_creator) != 0,\n        managerSettings = staticcall UserWalletConfig(walletConfig).managerSettings(_creator),\n        chequeSettings = staticcall UserWalletConfig(walletConfig).chequeSettings(),\n        chequeData = staticcall UserWalletConfig(walletConfig).chequePeriodData(),\n        isExistingCheque = cheque.active,\n        numActiveCheques = staticcall UserWalletConfig(walletConfig).numActiveCheques(),\n        isExistingPayee = staticcall UserWalletConfig(walletConfig).indexOfPayee(_recipient) != 0,\n        timeLock = staticcall UserWalletConfig(walletConfig).timeLock(),\n    )\n\n\n# is valid user wallet\n\n\n@view\n@internal\ndef _isValidUserWallet(_userWallet: address) -> bool:\n    ledger: address = staticcall Registry(UNDY_HQ).getAddr(LEDGER_ID)\n    return staticcall Ledger(ledger).isUserWallet(_userWallet)\n\n\n# can perform security action\n\n\n@view\n@internal\ndef _canPerformSecurityAction(_addr: address) -> bool:\n    missionControl: address = staticcall Registry(UNDY_HQ).getAddr(MISSION_CONTROL_ID)\n    if missionControl == empty(address):\n        return False\n    return staticcall MissionControl(missionControl).canPerformSecurityAction(_addr)\n\n\n# default cheque settings\n\n\n@view\n@external\ndef createDefaultChequeSettings(\n    _maxNumActiveCheques: uint256,\n    _instantUsdThreshold: uint256,\n    _periodLength: uint256,\n    _expensiveDelayBlocks: uint256,\n    _defaultExpiryBlocks: uint256,\n) -> wcs.ChequeSettings:\n    return wcs.ChequeSettings(\n        maxNumActiveCheques = _maxNumActiveCheques,\n        maxChequeUsdValue = 0,\n        instantUsdThreshold = _instantUsdThreshold,\n        perPeriodPaidUsdCap = 0,\n        maxNumChequesPaidPerPeriod = 0,\n        payCooldownBlocks = 0,\n        perPeriodCreatedUsdCap = 0,\n        maxNumChequesCreatedPerPeriod = 0,\n        createCooldownBlocks = 0,\n        periodLength = _periodLength,\n        expensiveDelayBlocks = _expensiveDelayBlocks,\n        defaultExpiryBlocks = _defaultExpiryBlocks,\n        allowedAssets = [],\n        canManagersCreateCheques = False,\n        canManagerPay = True,\n        canBePulled = False,\n    )",
            "sha256sum": "26e52a721a6cba0c3de21ae50c76ac64d827b3aa0bea0549083890377b679f94"
          }
        },
        "settings": {
          "outputSelection": {
            "contracts/core/walletBackpack/ChequeBook.vy": [
              "*"
            ]
          },
          "search_paths": [
            "."
          ]
        },
        "compiler_version": "v0.4.3+commit.bff19ea2",
        "integrity": "bb900d595c10a84a25a3afb3463d4066a4545e88c44e7783026c0c46b59b8b5f"
      },
      "args": "00000000000000000000000044cf3c4f000dfd76a35d03298049d37be688d6f9000000000000000000000000000000000000000000000000000000000000a8c00000000000000000000000000000000000000000000000000000000000f099c00000000000000000000000000000000000000000000000000000000000005460000000000000000000000000000000000000000000000000000000000013c68000000000000000000000000000000000000000000000000000000000003b5380",
      "file": "contracts/core/walletBackpack/ChequeBook.vy"
    },
    "Migrator": {
      "address": "0xe008114992187138a7C341Db0CD900F88BC0169a",
      "abi": [
        {
          "name": "FundsMigrated",
          "inputs": [
            {
              "name": "fromWallet",
              "type": "address",
              "indexed": true
            },
            {
              "name": "toWallet",
              "type": "address",
              "indexed": true
            },
            {
              "name": "numAssetsMigrated",
              "type": "uint256",
              "indexed": false
            },
            {
              "name": "totalUsdValue",
              "type": "uint256",
              "indexed": false
            }
          ],
          "anonymous": false,
          "type": "event"
        },
        {
          "name": "ConfigCloned",
          "inputs": [
            {
              "name": "fromWallet",
              "type": "address",
              "indexed": true
            },
            {
              "name": "toWallet",
              "type": "address",
              "indexed": true
            },
            {
              "name": "numManagersCopied",
              "type": "uint256",
              "indexed": false
            },
            {
              "name": "numPayeesCopied",
              "type": "uint256",
              "indexed": false
            },
            {
              "name": "numWhitelistCopied",
              "type": "uint256",
              "indexed": false
            }
          ],
          "anonymous": false,
          "type": "event"
        },
        {
          "stateMutability": "nonpayable",
          "type": "function",
          "name": "migrateAll",
          "inputs": [
            {
              "name": "_fromWallet",
              "type": "address"
            },
            {
              "name": "_toWallet",
              "type": "address"
            }
          ],
          "outputs": [
            {
              "name": "",
              "type": "uint256"
            },
            {
              "name": "",
              "type": "bool"
            }
          ]
        },
        {
          "stateMutability": "nonpayable",
          "type": "function",
          "name": "migrateFunds",
          "inputs": [
            {
              "name": "_fromWallet",
              "type": "address"
            },
            {
              "name": "_toWallet",
              "type": "address"
            }
          ],
          "outputs": [
            {
              "name": "",
              "type": "uint256"
            }
          ]
        },
        {
          "stateMutability": "view",
          "type": "function",
          "name": "canMigrateFundsToNewWallet",
          "inputs": [
            {
              "name": "_fromWallet",
              "type": "address"
            },
            {
              "name": "_toWallet",
              "type": "address"
            },
            {
              "name": "_caller",
              "type": "address"
            }
          ],
          "outputs": [
            {
              "name": "",
              "type": "bool"
            }
          ]
        },
        {
          "stateMutability": "nonpayable",
          "type": "function",
          "name": "cloneConfig",
          "inputs": [
            {
              "name": "_fromWallet",
              "type": "address"
            },
            {
              "name": "_toWallet",
              "type": "address"
            }
          ],
          "outputs": [
            {
              "name": "",
              "type": "bool"
            }
          ]
        },
        {
          "stateMutability": "view",
          "type": "function",
          "name": "canCopyWalletConfig",
          "inputs": [
            {
              "name": "_fromWallet",
              "type": "address"
            },
            {
              "name": "_toWallet",
              "type": "address"
            },
            {
              "name": "_caller",
              "type": "address"
            }
          ],
          "outputs": [
            {
              "name": "",
              "type": "bool"
            }
          ]
        },
        {
          "stateMutability": "view",
          "type": "function",
          "name": "getMigrationConfigBundle",
          "inputs": [
            {
              "name": "_userWallet",
              "type": "address"
            }
          ],
          "outputs": [
            {
              "name": "",
              "type": "tuple",
              "components": [
                {
                  "name": "owner",
                  "type": "address"
                },
                {
                  "name": "isFrozen",
                  "type": "bool"
                },
                {
                  "name": "numPayees",
                  "type": "uint256"
                },
                {
                  "name": "numWhitelisted",
                  "type": "uint256"
                },
                {
                  "name": "numManagers",
                  "type": "uint256"
                },
                {
                  "name": "startingAgent",
                  "type": "address"
                },
                {
                  "name": "startingAgentIndex",
                  "type": "uint256"
                },
                {
                  "name": "hasPendingOwnerChange",
                  "type": "bool"
                },
                {
                  "name": "groupId",
                  "type": "uint256"
                },
                {
                  "name": "numActiveCheques",
                  "type": "uint256"
                }
              ]
            }
          ]
        },
        {
          "stateMutability": "view",
          "type": "function",
          "name": "UNDY_HQ",
          "inputs": [],
          "outputs": [
            {
              "name": "",
              "type": "address"
            }
          ]
        },
        {
          "stateMutability": "nonpayable",
          "type": "constructor",
          "inputs": [
            {
              "name": "_undyHq",
              "type": "address"
            }
          ],
          "outputs": []
        }
      ],
      "solc_json": {
        "language": "Vyper",
        "sources": {
          "interfaces/WalletStructs.vyi": {
            "content": "# @version 0.4.3\n\nflag ActionType:\n    TRANSFER\n    EARN_DEPOSIT\n    EARN_WITHDRAW\n    EARN_REBALANCE\n    SWAP\n    MINT_REDEEM\n    CONFIRM_MINT_REDEEM\n    ADD_COLLATERAL\n    REMOVE_COLLATERAL\n    BORROW\n    REPAY_DEBT\n    REWARDS\n    ETH_TO_WETH\n    WETH_TO_ETH\n    ADD_LIQ\n    REMOVE_LIQ\n    ADD_LIQ_CONC\n    REMOVE_LIQ_CONC\n    PAY_CHEQUE\n\nstruct WalletAssetData:\n    assetBalance: uint256\n    usdValue: uint256\n    isYieldAsset: bool\n    lastPricePerShare: uint256\n\nstruct ActionData:\n    ledger: address\n    missionControl: address\n    legoBook: address\n    hatchery: address\n    lootDistributor: address\n    appraiser: address\n    billing: address\n    vaultRegistry: address\n    wallet: address\n    walletConfig: address\n    walletOwner: address\n    inEjectMode: bool\n    isFrozen: bool\n    lastTotalUsdValue: uint256\n    signer: address\n    isManager: bool\n    legoId: uint256\n    legoAddr: address\n    eth: address\n    weth: address\n\nstruct MiniAddys:\n    ledger: address\n    missionControl: address\n    legoBook: address\n    appraiser: address",
            "sha256sum": "466493c129135c95470aaf70eeddc936632f7b0f813396e5a7ddc03bea9da518"
          },
          "interfaces/WalletConfigStructs.vyi": {
            "content": "# @version 0.4.3\n\nMAX_CONFIG_ASSETS: constant(uint256) = 40\nMAX_CONFIG_LEGOS: constant(uint256) = 25\nMAX_ALLOWED_PAYEES: constant(uint256) = 40\n\nflag WhitelistAction:\n    ADD_PENDING\n    CONFIRM_WHITELIST\n    CANCEL_WHITELIST\n    REMOVE_WHITELIST\n\nflag BackpackType:\n    WALLET_KERNEL\n    WALLET_SENTINEL\n    WALLET_HIGH_COMMAND\n    WALLET_PAYMASTER\n    WALLET_CHEQUE_BOOK\n    WALLET_MIGRATOR\n\n# payees\n\nstruct PayeeData:\n    numTxsInPeriod: uint256\n    totalUnitsInPeriod: uint256\n    totalUsdValueInPeriod: uint256\n    totalNumTxs: uint256\n    totalUnits: uint256\n    totalUsdValue: uint256\n    lastTxBlock: uint256\n    periodStartBlock: uint256\n\nstruct PayeeSettings:\n    startBlock: uint256\n    expiryBlock: uint256\n    canPull: bool\n    periodLength: uint256\n    maxNumTxsPerPeriod: uint256\n    txCooldownBlocks: uint256\n    failOnZeroPrice: bool\n    primaryAsset: address\n    onlyPrimaryAsset: bool\n    unitLimits: PayeeLimits\n    usdLimits: PayeeLimits\n\nstruct GlobalPayeeSettings:\n    defaultPeriodLength: uint256\n    startDelay: uint256\n    activationLength: uint256\n    maxNumTxsPerPeriod: uint256\n    txCooldownBlocks: uint256\n    failOnZeroPrice: bool\n    usdLimits: PayeeLimits\n    canPayOwner: bool\n    canPull: bool\n\nstruct PayeeLimits:\n    perTxCap: uint256\n    perPeriodCap: uint256\n    lifetimeCap: uint256\n\nstruct PendingPayee:\n    settings: PayeeSettings\n    initiatedBlock: uint256\n    confirmBlock: uint256\n    currentOwner: address\n\nstruct PayeeManagementBundle:\n    owner: address\n    wallet: address\n    isRegisteredPayee: bool\n    isWhitelisted: bool\n    isExistingCheque: bool\n    payeeSettings: PayeeSettings\n    globalPayeeSettings: GlobalPayeeSettings\n    timeLock: uint256\n    walletConfig: address\n\nstruct RecipientConfigBundle:\n    isWhitelisted: bool\n    isOwner: bool\n    isPayee: bool\n    config: PayeeSettings\n    globalConfig: GlobalPayeeSettings\n    data: PayeeData\n\nstruct WhitelistConfigBundle:\n    owner: address\n    wallet: address\n    isWhitelisted: bool\n    pendingWhitelist: PendingWhitelist\n    isExistingPayee: bool\n    isExistingCheque: bool\n    timeLock: uint256\n    walletConfig: address\n    isManager: bool\n    isOwner: bool\n    whitelistPerms: WhitelistPerms\n    globalWhitelistPerms: WhitelistPerms\n\nstruct PendingWhitelist:\n    initiatedBlock: uint256\n    confirmBlock: uint256\n    currentOwner: address\n\n# cheques\n\nstruct Cheque:\n    recipient: address\n    asset: address\n    amount: uint256\n    creationBlock: uint256\n    unlockBlock: uint256\n    expiryBlock: uint256\n    usdValueOnCreation: uint256\n    canManagerPay: bool\n    canBePulled: bool\n    creator: address\n    active: bool\n\nstruct ChequeSettings:\n    maxNumActiveCheques: uint256\n    maxChequeUsdValue: uint256\n    instantUsdThreshold: uint256\n    perPeriodPaidUsdCap: uint256\n    maxNumChequesPaidPerPeriod: uint256\n    payCooldownBlocks: uint256\n    perPeriodCreatedUsdCap: uint256\n    maxNumChequesCreatedPerPeriod: uint256\n    createCooldownBlocks: uint256\n    periodLength: uint256\n    expensiveDelayBlocks: uint256\n    defaultExpiryBlocks: uint256\n    allowedAssets: DynArray[address, MAX_CONFIG_ASSETS]\n    canManagersCreateCheques: bool\n    canManagerPay: bool\n    canBePulled: bool\n\nstruct ChequeData:\n    numChequesPaidInPeriod: uint256\n    totalUsdValuePaidInPeriod: uint256\n    totalNumChequesPaid: uint256\n    totalUsdValuePaid: uint256\n    lastChequePaidBlock: uint256\n    numChequesCreatedInPeriod: uint256\n    totalUsdValueCreatedInPeriod: uint256\n    totalNumChequesCreated: uint256\n    totalUsdValueCreated: uint256\n    lastChequeCreatedBlock: uint256\n    periodStartBlock: uint256\n\nstruct ChequeManagementBundle:\n    wallet: address\n    walletConfig: address\n    owner: address\n    isRecipientOnWhitelist: bool\n    isCreatorManager: bool\n    managerSettings: ManagerSettings\n    chequeSettings: ChequeSettings\n    chequeData: ChequeData\n    isExistingCheque: bool\n    numActiveCheques: uint256\n    isExistingPayee: bool\n    timeLock: uint256\n\n# managers\n\nstruct ManagerData:\n    numTxsInPeriod: uint256\n    totalUsdValueInPeriod: uint256\n    totalNumTxs: uint256\n    totalUsdValue: uint256\n    lastTxBlock: uint256\n    periodStartBlock: uint256\n    numSwapsInPeriod: uint256\n\nstruct ManagerSettings:\n    startBlock: uint256\n    expiryBlock: uint256\n    limits: ManagerLimits\n    legoPerms: LegoPerms\n    swapPerms: SwapPerms\n    whitelistPerms: WhitelistPerms\n    transferPerms: TransferPerms\n    allowedAssets: DynArray[address, MAX_CONFIG_ASSETS]\n    canClaimLoot: bool\n\nstruct GlobalManagerSettings:\n    managerPeriod: uint256\n    startDelay: uint256\n    activationLength: uint256\n    canOwnerManage: bool\n    limits: ManagerLimits\n    legoPerms: LegoPerms\n    swapPerms: SwapPerms\n    whitelistPerms: WhitelistPerms\n    transferPerms: TransferPerms\n    allowedAssets: DynArray[address, MAX_CONFIG_ASSETS]\n\nstruct ManagerLimits:\n    maxUsdValuePerTx: uint256\n    maxUsdValuePerPeriod: uint256\n    maxUsdValueLifetime: uint256\n    maxNumTxsPerPeriod: uint256\n    txCooldownBlocks: uint256\n    failOnZeroPrice: bool\n\nstruct LegoPerms:\n    canManageYield: bool\n    canBuyAndSell: bool\n    canManageDebt: bool\n    canManageLiq: bool\n    canClaimRewards: bool\n    onlyApprovedYieldOpps: bool\n    allowedLegos: DynArray[uint256, MAX_CONFIG_LEGOS]\n\nstruct SwapPerms:\n    mustHaveUsdValue: bool\n    maxNumSwapsPerPeriod: uint256\n    maxSlippage: uint256\n\nstruct WhitelistPerms:\n    canAddPending: bool\n    canConfirm: bool\n    canCancel: bool\n    canRemove: bool\n\nstruct TransferPerms:\n    canTransfer: bool\n    canCreateCheque: bool\n    canAddPendingPayee: bool\n    allowedPayees: DynArray[address, MAX_ALLOWED_PAYEES]\n\nstruct ManagerConfigBundle:\n    isOwner: bool\n    isManager: bool\n    config: ManagerSettings\n    globalConfig: GlobalManagerSettings\n    data: ManagerData\n    payee: address\n\nstruct ManagerSettingsBundle:\n    owner: address\n    isManager: bool\n    timeLock: uint256\n    walletConfig: address\n    legoBook: address\n    globalManagerSettings: GlobalManagerSettings\n\n# migration\n\nstruct MigrationConfigBundle:\n    owner: address\n    isFrozen: bool\n    numPayees: uint256\n    numWhitelisted: uint256\n    numManagers: uint256\n    startingAgent: address\n    startingAgentIndex: uint256\n    hasPendingOwnerChange: bool\n    groupId: uint256\n    numActiveCheques: uint256\n",
            "sha256sum": "31165468feeac632a1376c70970ce5124f8951392c4deaa01a26176c7f26718a"
          },
          "contracts/core/walletBackpack/Migrator.vy": {
            "content": "#    \u2513 \u250f  \u2513\u2513   \n#    \u2503\u2503\u2503\u250f\u2513\u2503\u2503\u250f\u2513\u254b\n#    \u2517\u253b\u251b\u2517\u253b\u2517\u2517\u2517 \u2517\n#     __    __   __   ______   ______   ______   ______  ______   ______    \n#    /\\ \"-./  \\ /\\ \\ /\\  ___\\ /\\  == \\ /\\  __ \\ /\\__  _\\/\\  __ \\ /\\  == \\   \n#    \\ \\ \\-./\\ \\\\ \\ \\\\ \\ \\__ \\\\ \\  __< \\ \\  __ \\\\/_/\\ \\/\\ \\ \\/\\ \\\\ \\  __<   \n#     \\ \\_\\ \\ \\_\\\\ \\_\\\\ \\_____\\\\ \\_\\ \\_\\\\ \\_\\ \\_\\  \\ \\_\\ \\ \\_____\\\\ \\_\\ \\_\\ \n#      \\/_/  \\/_/ \\/_/ \\/_____/ \\/_/ /_/ \\/_/\\/_/   \\/_/  \\/_____/ \\/_/ /_/ \n#                                                         \n#     \u2554\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2557\n#     \u2551  ** Migrator **                                   \u2551\n#     \u2551  Migrate funds and config between user wallets.   \u2551\n#     \u255a\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u255d\n#\n#     Underscore Protocol License: https://github.com/underscore-finance/underscore-protocol/blob/master/LICENSE.md\n\n# @version 0.4.3\n\nfrom interfaces import WalletStructs as ws\nfrom interfaces import WalletConfigStructs as wcs\nfrom ethereum.ercs import IERC20\n\ninterface UserWalletConfig:\n    def setGlobalManagerSettings(_config: wcs.GlobalManagerSettings): nonpayable\n    def migrateFunds(_toWallet: address, _asset: address) -> uint256: nonpayable\n    def addManager(_manager: address, _config: wcs.ManagerSettings): nonpayable\n    def setGlobalPayeeSettings(_config: wcs.GlobalPayeeSettings): nonpayable\n    def addPayee(_payee: address, _config: wcs.PayeeSettings): nonpayable\n    def managerSettings(_manager: address) -> wcs.ManagerSettings: view\n    def globalManagerSettings() -> wcs.GlobalManagerSettings: view\n    def payeeSettings(_payee: address) -> wcs.PayeeSettings: view\n    def addWhitelistAddrViaMigrator(_addr: address): nonpayable\n    def globalPayeeSettings() -> wcs.GlobalPayeeSettings: view\n    def deregisterAsset(_asset: address) -> bool: nonpayable\n    def indexOfManager(_addr: address) -> uint256: view\n    def whitelistAddr(i: uint256) -> address: view\n    def managers(i: uint256) -> address: view\n    def hasPendingOwnerChange() -> bool: view\n    def payees(i: uint256) -> address: view\n    def numActiveCheques() -> uint256: view\n    def numWhitelisted() -> uint256: view\n    def startingAgent() -> address: view\n    def numManagers() -> uint256: view\n    def numPayees() -> uint256: view\n    def groupId() -> uint256: view\n    def owner() -> address: view\n    def isFrozen() -> bool: view\n\ninterface UserWallet:\n    def assetData(_asset: address) -> ws.WalletAssetData: view\n    def assets(i: uint256) -> address: view\n    def walletConfig() -> address: view\n    def numAssets() -> uint256: view\n\ninterface Ledger:\n    def isUserWallet(_user: address) -> bool: view\n\ninterface Registry:\n    def getAddr(_regId: uint256) -> address: view\n\nevent FundsMigrated:\n    fromWallet: indexed(address)\n    toWallet: indexed(address)\n    numAssetsMigrated: uint256\n    totalUsdValue: uint256\n\nevent ConfigCloned:\n    fromWallet: indexed(address)\n    toWallet: indexed(address)\n    numManagersCopied: uint256\n    numPayeesCopied: uint256\n    numWhitelistCopied: uint256\n\nUNDY_HQ: public(immutable(address))\nLEDGER_ID: constant(uint256) = 1\nMAX_DEREGISTER_ASSETS: constant(uint256) = 25\n\n\n@deploy\ndef __init__(_undyHq: address):\n    assert _undyHq != empty(address) # dev: invalid undy hq\n    UNDY_HQ = _undyHq\n\n\n############################\n# Migrate - Funds & Config #\n############################\n\n\n@external\ndef migrateAll(_fromWallet: address, _toWallet: address) -> (uint256, bool):\n\n    # migrate funds\n    numFundsMigrated: uint256 = 0\n    if self._canMigrateFundsToNewWallet(_fromWallet, _toWallet, msg.sender):\n        numAssets: uint256 = staticcall UserWallet(_fromWallet).numAssets()\n        if numAssets > 1:\n            numFundsMigrated = self._migrateFunds(_fromWallet, _toWallet, numAssets)\n            assert numFundsMigrated != 0 # dev: no assets migrated\n\n    # migrate config\n    didMigrateConfig: bool = False\n    if self._canCopyWalletConfig(_fromWallet, _toWallet, msg.sender):\n        didMigrateConfig = self._cloneConfig(_fromWallet, _toWallet)\n\n    assert numFundsMigrated != 0 or didMigrateConfig # dev: no funds or config to migrate\n    return numFundsMigrated, didMigrateConfig\n\n\n#################\n# Migrate Funds #\n#################\n\n\n@external\ndef migrateFunds(_fromWallet: address, _toWallet: address) -> uint256:\n    assert self._canMigrateFundsToNewWallet(_fromWallet, _toWallet, msg.sender) # dev: invalid migration\n\n    # validate fromWallet has assets to migrate\n    numAssets: uint256 = staticcall UserWallet(_fromWallet).numAssets()\n    assert numAssets > 1 # dev: no assets to migrate\n\n    # migrate funds\n    numMigrated: uint256 = self._migrateFunds(_fromWallet, _toWallet, numAssets)\n    assert numMigrated != 0 # dev: no assets migrated\n\n    return numMigrated\n\n\n@internal\ndef _migrateFunds(_fromWallet: address, _toWallet: address, _numAssets: uint256) -> uint256:\n\n    # get wallet config\n    walletConfig: address = staticcall UserWallet(_fromWallet).walletConfig()\n\n    # migrate funds\n    numMigrated: uint256 = 0\n    usdValue: uint256 = 0\n    assetsToDeregister: DynArray[address, MAX_DEREGISTER_ASSETS] = []\n    for i: uint256 in range(1, _numAssets, bound=max_value(uint256)):\n        asset: address = staticcall UserWallet(_fromWallet).assets(i)\n        if asset == empty(address):\n            continue\n\n        # check balance\n        balance: uint256 = staticcall IERC20(asset).balanceOf(_fromWallet)\n        if balance == 0:\n            continue\n\n        # get last usd value\n        data: ws.WalletAssetData = staticcall UserWallet(_fromWallet).assetData(asset)\n\n        # transfer funds\n        amount: uint256 = extcall UserWalletConfig(walletConfig).migrateFunds(_toWallet, asset)\n        if amount != 0:\n            numMigrated += 1\n            usdValue += data.usdValue\n\n            if len(assetsToDeregister) < MAX_DEREGISTER_ASSETS:\n                assetsToDeregister.append(asset)\n\n    # deregister assets\n    if len(assetsToDeregister) != 0:\n        for asset: address in assetsToDeregister:\n            extcall UserWalletConfig(walletConfig).deregisterAsset(asset)\n\n    log FundsMigrated(fromWallet = _fromWallet, toWallet = _toWallet, numAssetsMigrated = numMigrated, totalUsdValue = usdValue)\n    return numMigrated\n\n\n# validation\n\n\n@view\n@external\ndef canMigrateFundsToNewWallet(_fromWallet: address, _toWallet: address, _caller: address) -> bool:\n    return self._canMigrateFundsToNewWallet(_fromWallet, _toWallet, _caller)\n\n\n@view\n@internal\ndef _canMigrateFundsToNewWallet(_fromWallet: address, _toWallet: address, _caller: address) -> bool:\n    ledger: address = staticcall Registry(UNDY_HQ).getAddr(LEDGER_ID)\n\n    # validate fromWallet is Underscore wallet\n    if not staticcall Ledger(ledger).isUserWallet(_fromWallet):\n        return False\n\n    # validate toWallet is Underscore wallet\n    if not staticcall Ledger(ledger).isUserWallet(_toWallet):\n        return False\n\n    # get fromWallet data\n    fromData: wcs.MigrationConfigBundle = self._getMigrationConfigBundle(_fromWallet)\n\n    # validate caller is owner of fromWallet\n    if _caller != fromData.owner:\n        return False\n\n    # cannot migrate if fromWallet is frozen\n    if fromData.isFrozen:\n        return False\n\n    # cannot migrate if fromWallet has pending owner change\n    if fromData.hasPendingOwnerChange:\n        return False\n\n    # toWallet bundle\n    toData: wcs.MigrationConfigBundle = self._getMigrationConfigBundle(_toWallet)\n\n    # owners must be the same\n    if fromData.owner != toData.owner:\n        return False\n\n    # cannot migrate if toWallet has pending owner change\n    if toData.hasPendingOwnerChange:\n        return False\n\n    # group id must be the same\n    if fromData.groupId != toData.groupId:\n        return False\n\n    # cannot migrate if toWallet is frozen\n    if toData.isFrozen:\n        return False\n\n    # toWallet cannot have any payees\n    if toData.numPayees > 1:\n        return False\n\n    # toWallet cannot have any whitelisted addresses\n    if toData.numWhitelisted > 1:\n        return False\n\n    # toWallet cannot have any active cheques\n    if toData.numActiveCheques != 0:\n        return False\n\n    # cannot have managers (if starting agent is not set)\n    if toData.startingAgent == empty(address) and toData.numManagers > 1:\n        return False\n\n    # cannot have managers other than starting agent\n    if toData.startingAgent != empty(address):\n        if toData.startingAgentIndex != 1:\n            return False\n        if toData.numManagers > 2:\n            return False\n\n    return True\n\n\n################\n# Clone Config #\n################\n\n\n@external\ndef cloneConfig(_fromWallet: address, _toWallet: address) -> bool:\n    assert self._canCopyWalletConfig(_fromWallet, _toWallet, msg.sender) # dev: cannot copy config\n    return self._cloneConfig(_fromWallet, _toWallet)\n\n\n@internal\ndef _cloneConfig(_fromWallet: address, _toWallet: address) -> bool:\n    fromConfig: address = staticcall UserWallet(_fromWallet).walletConfig()\n    toConfig: address = staticcall UserWallet(_toWallet).walletConfig()\n\n    # 1. copy global manager settings\n    globalManagerSettings: wcs.GlobalManagerSettings = staticcall UserWalletConfig(fromConfig).globalManagerSettings()\n    extcall UserWalletConfig(toConfig).setGlobalManagerSettings(globalManagerSettings)\n\n    # get starting agent from source wallet to skip it during copy\n    fromStartingAgent: address = staticcall UserWalletConfig(fromConfig).startingAgent()\n\n    # 2. copy all managers (except starting agent)\n    managersCopied: uint256 = 0\n    numManagers: uint256 = staticcall UserWalletConfig(fromConfig).numManagers()\n    if numManagers > 1:\n        for i: uint256 in range(1, numManagers, bound=max_value(uint256)):\n            manager: address = staticcall UserWalletConfig(fromConfig).managers(i)\n            if manager == empty(address):\n                continue\n\n            # skip the starting agent from source wallet\n            if manager == fromStartingAgent:\n                continue\n\n            managerSettings: wcs.ManagerSettings = staticcall UserWalletConfig(fromConfig).managerSettings(manager)\n            if managerSettings.startBlock != 0:\n                extcall UserWalletConfig(toConfig).addManager(manager, managerSettings)\n                managersCopied += 1\n\n    # 3. copy global payee settings\n    globalPayeeSettings: wcs.GlobalPayeeSettings = staticcall UserWalletConfig(fromConfig).globalPayeeSettings()\n    extcall UserWalletConfig(toConfig).setGlobalPayeeSettings(globalPayeeSettings)\n\n    # 4. copy all payees\n    payeesCopied: uint256 = 0\n    numPayees: uint256 = staticcall UserWalletConfig(fromConfig).numPayees()\n    if numPayees > 1:\n        for i: uint256 in range(1, numPayees, bound=max_value(uint256)):\n            payee: address = staticcall UserWalletConfig(fromConfig).payees(i)\n            if payee == empty(address):\n                continue\n\n            payeeSettings: wcs.PayeeSettings = staticcall UserWalletConfig(fromConfig).payeeSettings(payee)\n            if payeeSettings.startBlock != 0:\n                extcall UserWalletConfig(toConfig).addPayee(payee, payeeSettings)\n                payeesCopied += 1\n\n    # 5. copy all whitelisted addresses\n    whitelistCopied: uint256 = 0\n    numWhitelisted: uint256 = staticcall UserWalletConfig(fromConfig).numWhitelisted()\n    if numWhitelisted > 1:\n        for i: uint256 in range(1, numWhitelisted, bound=max_value(uint256)):\n            addr: address = staticcall UserWalletConfig(fromConfig).whitelistAddr(i)\n            if addr != empty(address):\n                extcall UserWalletConfig(toConfig).addWhitelistAddrViaMigrator(addr)\n                whitelistCopied += 1\n\n    # NOTE (FIX L-04): Cheque settings are NOT migrated - destination wallet uses default settings\n    # Individual cheques are also NOT migrated - users must manually recreate them\n    # Validation ensures destination has no active cheques before migration\n\n    log ConfigCloned(\n        fromWallet = _fromWallet,\n        toWallet = _toWallet,\n        numManagersCopied = managersCopied,\n        numPayeesCopied = payeesCopied,\n        numWhitelistCopied = whitelistCopied\n    )\n    return True\n\n\n# validation\n\n\n@view\n@external\ndef canCopyWalletConfig(_fromWallet: address, _toWallet: address, _caller: address) -> bool:\n    return self._canCopyWalletConfig(_fromWallet, _toWallet, _caller)\n\n\n@view\n@internal\ndef _canCopyWalletConfig(_fromWallet: address, _toWallet: address, _caller: address) -> bool:\n    ledger: address = staticcall Registry(UNDY_HQ).getAddr(LEDGER_ID)\n\n    # validate fromWallet is Underscore wallet\n    if not staticcall Ledger(ledger).isUserWallet(_fromWallet):\n        return False\n\n    # validate toWallet is Underscore wallet\n    if not staticcall Ledger(ledger).isUserWallet(_toWallet):\n        return False\n\n    # get toWallet data\n    toData: wcs.MigrationConfigBundle = self._getMigrationConfigBundle(_toWallet)\n\n    # validate caller is owner of toWallet\n    if _caller != toData.owner:\n        return False\n\n    # cannot copy if toWallet has pending owner change\n    if toData.hasPendingOwnerChange:\n        return False\n\n    # cannot copy if toWallet is frozen\n    if toData.isFrozen:\n        return False\n\n    # toWallet cannot have any payees\n    if toData.numPayees > 1:\n        return False\n\n    # toWallet cannot have any whitelisted addresses\n    if toData.numWhitelisted > 1:\n        return False\n\n    # toWallet cannot have any active cheques\n    if toData.numActiveCheques != 0:\n        return False\n\n    # cannot have managers (if starting agent is not set)\n    if toData.startingAgent == empty(address) and toData.numManagers > 1:\n        return False\n\n    # cannot have managers other than starting agent\n    if toData.startingAgent != empty(address):\n        if toData.startingAgentIndex != 1:\n            return False\n        if toData.numManagers > 2:\n            return False\n\n    # fromWallet bundle\n    fromData: wcs.MigrationConfigBundle = self._getMigrationConfigBundle(_fromWallet)\n\n    # cannot copy if fromWallet is frozen\n    if fromData.isFrozen:\n        return False\n\n    # owners must be the same\n    if fromData.owner != toData.owner:\n        return False\n\n    # group id must be the same\n    if fromData.groupId != toData.groupId:\n        return False\n\n    # cannot copy if fromWallet has pending owner change\n    if fromData.hasPendingOwnerChange:\n        return False\n\n    return True\n\n\n#############\n# Utilities #\n#############\n\n\n@view\n@external\ndef getMigrationConfigBundle(_userWallet: address) -> wcs.MigrationConfigBundle:\n    return self._getMigrationConfigBundle(_userWallet)\n\n\n@view\n@internal\ndef _getMigrationConfigBundle(_userWallet: address) -> wcs.MigrationConfigBundle:\n    walletConfig: address = staticcall UserWallet(_userWallet).walletConfig()\n    startingAgent: address = staticcall UserWalletConfig(walletConfig).startingAgent()\n    return wcs.MigrationConfigBundle(\n        owner = staticcall UserWalletConfig(walletConfig).owner(),\n        isFrozen = staticcall UserWalletConfig(walletConfig).isFrozen(),\n        numPayees = staticcall UserWalletConfig(walletConfig).numPayees(),\n        numWhitelisted = staticcall UserWalletConfig(walletConfig).numWhitelisted(),\n        numManagers = staticcall UserWalletConfig(walletConfig).numManagers(),\n        startingAgent = startingAgent,\n        startingAgentIndex = staticcall UserWalletConfig(walletConfig).indexOfManager(startingAgent),\n        hasPendingOwnerChange = staticcall UserWalletConfig(walletConfig).hasPendingOwnerChange(),\n        groupId = staticcall UserWalletConfig(walletConfig).groupId(),\n        numActiveCheques = staticcall UserWalletConfig(walletConfig).numActiveCheques(),\n    )\n",
            "sha256sum": "a2186c7cafbda6c82d9b4df284645bad28131b40e639b102b2dc4cc61f27c331"
          }
        },
        "settings": {
          "outputSelection": {
            "contracts/core/walletBackpack/Migrator.vy": [
              "*"
            ]
          },
          "search_paths": [
            "."
          ]
        },
        "compiler_version": "v0.4.3+commit.bff19ea2",
        "integrity": "9f24e0f2309513f17d7a4af6dc45b2ce6f80d14f920d919d30222d7c4e1acc8c"
      },
      "args": "00000000000000000000000044cf3c4f000dfd76a35d03298049d37be688d6f9",
      "file": "contracts/core/walletBackpack/Migrator.vy"
    },
    "Sentinel": {
      "address": "0xCCe9B58b7d377631e58d3Bd95f12a35cF49F667b",
      "abi": [
        {
          "stateMutability": "view",
          "type": "function",
          "name": "canSignerPerformAction",
          "inputs": [
            {
              "name": "_user",
              "type": "address"
            },
            {
              "name": "_signer",
              "type": "address"
            },
            {
              "name": "_action",
              "type": "uint256"
            }
          ],
          "outputs": [
            {
              "name": "",
              "type": "bool"
            }
          ]
        },
        {
          "stateMutability": "view",
          "type": "function",
          "name": "canSignerPerformAction",
          "inputs": [
            {
              "name": "_user",
              "type": "address"
            },
            {
              "name": "_signer",
              "type": "address"
            },
            {
              "name": "_action",
              "type": "uint256"
            },
            {
              "name": "_assets",
              "type": "address[]"
            }
          ],
          "outputs": [
            {
              "name": "",
              "type": "bool"
            }
          ]
        },
        {
          "stateMutability": "view",
          "type": "function",
          "name": "canSignerPerformAction",
          "inputs": [
            {
              "name": "_user",
              "type": "address"
            },
            {
              "name": "_signer",
              "type": "address"
            },
            {
              "name": "_action",
              "type": "uint256"
            },
            {
              "name": "_assets",
              "type": "address[]"
            },
            {
              "name": "_legoIds",
              "type": "uint256[]"
            }
          ],
          "outputs": [
            {
              "name": "",
              "type": "bool"
            }
          ]
        },
        {
          "stateMutability": "view",
          "type": "function",
          "name": "canSignerPerformAction",
          "inputs": [
            {
              "name": "_user",
              "type": "address"
            },
            {
              "name": "_signer",
              "type": "address"
            },
            {
              "name": "_action",
              "type": "uint256"
            },
            {
              "name": "_assets",
              "type": "address[]"
            },
            {
              "name": "_legoIds",
              "type": "uint256[]"
            },
            {
              "name": "_txRecipient",
              "type": "address"
            }
          ],
          "outputs": [
            {
              "name": "",
              "type": "bool"
            }
          ]
        },
        {
          "stateMutability": "view",
          "type": "function",
          "name": "canSignerPerformActionWithConfig",
          "inputs": [
            {
              "name": "_isOwner",
              "type": "bool"
            },
            {
              "name": "_isManager",
              "type": "bool"
            },
            {
              "name": "_managerData",
              "type": "tuple",
              "components": [
                {
                  "name": "numTxsInPeriod",
                  "type": "uint256"
                },
                {
                  "name": "totalUsdValueInPeriod",
                  "type": "uint256"
                },
                {
                  "name": "totalNumTxs",
                  "type": "uint256"
                },
                {
                  "name": "totalUsdValue",
                  "type": "uint256"
                },
                {
                  "name": "lastTxBlock",
                  "type": "uint256"
                },
                {
                  "name": "periodStartBlock",
                  "type": "uint256"
                },
                {
                  "name": "numSwapsInPeriod",
                  "type": "uint256"
                }
              ]
            },
            {
              "name": "_config",
              "type": "tuple",
              "components": [
                {
                  "name": "startBlock",
                  "type": "uint256"
                },
                {
                  "name": "expiryBlock",
                  "type": "uint256"
                },
                {
                  "name": "limits",
                  "type": "tuple",
                  "components": [
                    {
                      "name": "maxUsdValuePerTx",
                      "type": "uint256"
                    },
                    {
                      "name": "maxUsdValuePerPeriod",
                      "type": "uint256"
                    },
                    {
                      "name": "maxUsdValueLifetime",
                      "type": "uint256"
                    },
                    {
                      "name": "maxNumTxsPerPeriod",
                      "type": "uint256"
                    },
                    {
                      "name": "txCooldownBlocks",
                      "type": "uint256"
                    },
                    {
                      "name": "failOnZeroPrice",
                      "type": "bool"
                    }
                  ]
                },
                {
                  "name": "legoPerms",
                  "type": "tuple",
                  "components": [
                    {
                      "name": "canManageYield",
                      "type": "bool"
                    },
                    {
                      "name": "canBuyAndSell",
                      "type": "bool"
                    },
                    {
                      "name": "canManageDebt",
                      "type": "bool"
                    },
                    {
                      "name": "canManageLiq",
                      "type": "bool"
                    },
                    {
                      "name": "canClaimRewards",
                      "type": "bool"
                    },
                    {
                      "name": "onlyApprovedYieldOpps",
                      "type": "bool"
                    },
                    {
                      "name": "allowedLegos",
                      "type": "uint256[]"
                    }
                  ]
                },
                {
                  "name": "swapPerms",
                  "type": "tuple",
                  "components": [
                    {
                      "name": "mustHaveUsdValue",
                      "type": "bool"
                    },
                    {
                      "name": "maxNumSwapsPerPeriod",
                      "type": "uint256"
                    },
                    {
                      "name": "maxSlippage",
                      "type": "uint256"
                    }
                  ]
                },
                {
                  "name": "whitelistPerms",
                  "type": "tuple",
                  "components": [
                    {
                      "name": "canAddPending",
                      "type": "bool"
                    },
                    {
                      "name": "canConfirm",
                      "type": "bool"
                    },
                    {
                      "name": "canCancel",
                      "type": "bool"
                    },
                    {
                      "name": "canRemove",
                      "type": "bool"
                    }
                  ]
                },
                {
                  "name": "transferPerms",
                  "type": "tuple",
                  "components": [
                    {
                      "name": "canTransfer",
                      "type": "bool"
                    },
                    {
                      "name": "canCreateCheque",
                      "type": "bool"
                    },
                    {
                      "name": "canAddPendingPayee",
                      "type": "bool"
                    },
                    {
                      "name": "allowedPayees",
                      "type": "address[]"
                    }
                  ]
                },
                {
                  "name": "allowedAssets",
                  "type": "address[]"
                },
                {
                  "name": "canClaimLoot",
                  "type": "bool"
                }
              ]
            },
            {
              "name": "_globalConfig",
              "type": "tuple",
              "components": [
                {
                  "name": "managerPeriod",
                  "type": "uint256"
                },
                {
                  "name": "startDelay",
                  "type": "uint256"
                },
                {
                  "name": "activationLength",
                  "type": "uint256"
                },
                {
                  "name": "canOwnerManage",
                  "type": "bool"
                },
                {
                  "name": "limits",
                  "type": "tuple",
                  "components": [
                    {
                      "name": "maxUsdValuePerTx",
                      "type": "uint256"
                    },
                    {
                      "name": "maxUsdValuePerPeriod",
                      "type": "uint256"
                    },
                    {
                      "name": "maxUsdValueLifetime",
                      "type": "uint256"
                    },
                    {
                      "name": "maxNumTxsPerPeriod",
                      "type": "uint256"
                    },
                    {
                      "name": "txCooldownBlocks",
                      "type": "uint256"
                    },
                    {
                      "name": "failOnZeroPrice",
                      "type": "bool"
                    }
                  ]
                },
                {
                  "name": "legoPerms",
                  "type": "tuple",
                  "components": [
                    {
                      "name": "canManageYield",
                      "type": "bool"
                    },
                    {
                      "name": "canBuyAndSell",
                      "type": "bool"
                    },
                    {
                      "name": "canManageDebt",
                      "type": "bool"
                    },
                    {
                      "name": "canManageLiq",
                      "type": "bool"
                    },
                    {
                      "name": "canClaimRewards",
                      "type": "bool"
                    },
                    {
                      "name": "onlyApprovedYieldOpps",
                      "type": "bool"
                    },
                    {
                      "name": "allowedLegos",
                      "type": "uint256[]"
                    }
                  ]
                },
                {
                  "name": "swapPerms",
                  "type": "tuple",
                  "components": [
                    {
                      "name": "mustHaveUsdValue",
                      "type": "bool"
                    },
                    {
                      "name": "maxNumSwapsPerPeriod",
                      "type": "uint256"
                    },
                    {
                      "name": "maxSlippage",
                      "type": "uint256"
                    }
                  ]
                },
                {
                  "name": "whitelistPerms",
                  "type": "tuple",
                  "components": [
                    {
                      "name": "canAddPending",
                      "type": "bool"
                    },
                    {
                      "name": "canConfirm",
                      "type": "bool"
                    },
                    {
                      "name": "canCancel",
                      "type": "bool"
                    },
                    {
                      "name": "canRemove",
                      "type": "bool"
                    }
                  ]
                },
                {
                  "name": "transferPerms",
                  "type": "tuple",
                  "components": [
                    {
                      "name": "canTransfer",
                      "type": "bool"
                    },
                    {
                      "name": "canCreateCheque",
                      "type": "bool"
                    },
                    {
                      "name": "canAddPendingPayee",
                      "type": "bool"
                    },
                    {
                      "name": "allowedPayees",
                      "type": "address[]"
                    }
                  ]
                },
                {
                  "name": "allowedAssets",
                  "type": "address[]"
                }
              ]
            },
            {
              "name": "_action",
              "type": "uint256"
            }
          ],
          "outputs": [
            {
              "name": "",
              "type": "bool"
            }
          ]
        },
        {
          "stateMutability": "view",
          "type": "function",
          "name": "canSignerPerformActionWithConfig",
          "inputs": [
            {
              "name": "_isOwner",
              "type": "bool"
            },
            {
              "name": "_isManager",
              "type": "bool"
            },
            {
              "name": "_managerData",
              "type": "tuple",
              "components": [
                {
                  "name": "numTxsInPeriod",
                  "type": "uint256"
                },
                {
                  "name": "totalUsdValueInPeriod",
                  "type": "uint256"
                },
                {
                  "name": "totalNumTxs",
                  "type": "uint256"
                },
                {
                  "name": "totalUsdValue",
                  "type": "uint256"
                },
                {
                  "name": "lastTxBlock",
                  "type": "uint256"
                },
                {
                  "name": "periodStartBlock",
                  "type": "uint256"
                },
                {
                  "name": "numSwapsInPeriod",
                  "type": "uint256"
                }
              ]
            },
            {
              "name": "_config",
              "type": "tuple",
              "components": [
                {
                  "name": "startBlock",
                  "type": "uint256"
                },
                {
                  "name": "expiryBlock",
                  "type": "uint256"
                },
                {
                  "name": "limits",
                  "type": "tuple",
                  "components": [
                    {
                      "name": "maxUsdValuePerTx",
                      "type": "uint256"
                    },
                    {
                      "name": "maxUsdValuePerPeriod",
                      "type": "uint256"
                    },
                    {
                      "name": "maxUsdValueLifetime",
                      "type": "uint256"
                    },
                    {
                      "name": "maxNumTxsPerPeriod",
                      "type": "uint256"
                    },
                    {
                      "name": "txCooldownBlocks",
                      "type": "uint256"
                    },
                    {
                      "name": "failOnZeroPrice",
                      "type": "bool"
                    }
                  ]
                },
                {
                  "name": "legoPerms",
                  "type": "tuple",
                  "components": [
                    {
                      "name": "canManageYield",
                      "type": "bool"
                    },
                    {
                      "name": "canBuyAndSell",
                      "type": "bool"
                    },
                    {
                      "name": "canManageDebt",
                      "type": "bool"
                    },
                    {
                      "name": "canManageLiq",
                      "type": "bool"
                    },
                    {
                      "name": "canClaimRewards",
                      "type": "bool"
                    },
                    {
                      "name": "onlyApprovedYieldOpps",
                      "type": "bool"
                    },
                    {
                      "name": "allowedLegos",
                      "type": "uint256[]"
                    }
                  ]
                },
                {
                  "name": "swapPerms",
                  "type": "tuple",
                  "components": [
                    {
                      "name": "mustHaveUsdValue",
                      "type": "bool"
                    },
                    {
                      "name": "maxNumSwapsPerPeriod",
                      "type": "uint256"
                    },
                    {
                      "name": "maxSlippage",
                      "type": "uint256"
                    }
                  ]
                },
                {
                  "name": "whitelistPerms",
                  "type": "tuple",
                  "components": [
                    {
                      "name": "canAddPending",
                      "type": "bool"
                    },
                    {
                      "name": "canConfirm",
                      "type": "bool"
                    },
                    {
                      "name": "canCancel",
                      "type": "bool"
                    },
                    {
                      "name": "canRemove",
                      "type": "bool"
                    }
                  ]
                },
                {
                  "name": "transferPerms",
                  "type": "tuple",
                  "components": [
                    {
                      "name": "canTransfer",
                      "type": "bool"
                    },
                    {
                      "name": "canCreateCheque",
                      "type": "bool"
                    },
                    {
                      "name": "canAddPendingPayee",
                      "type": "bool"
                    },
                    {
                      "name": "allowedPayees",
                      "type": "address[]"
                    }
                  ]
                },
                {
                  "name": "allowedAssets",
                  "type": "address[]"
                },
                {
                  "name": "canClaimLoot",
                  "type": "bool"
                }
              ]
            },
            {
              "name": "_globalConfig",
              "type": "tuple",
              "components": [
                {
                  "name": "managerPeriod",
                  "type": "uint256"
                },
                {
                  "name": "startDelay",
                  "type": "uint256"
                },
                {
                  "name": "activationLength",
                  "type": "uint256"
                },
                {
                  "name": "canOwnerManage",
                  "type": "bool"
                },
                {
                  "name": "limits",
                  "type": "tuple",
                  "components": [
                    {
                      "name": "maxUsdValuePerTx",
                      "type": "uint256"
                    },
                    {
                      "name": "maxUsdValuePerPeriod",
                      "type": "uint256"
                    },
                    {
                      "name": "maxUsdValueLifetime",
                      "type": "uint256"
                    },
                    {
                      "name": "maxNumTxsPerPeriod",
                      "type": "uint256"
                    },
                    {
                      "name": "txCooldownBlocks",
                      "type": "uint256"
                    },
                    {
                      "name": "failOnZeroPrice",
                      "type": "bool"
                    }
                  ]
                },
                {
                  "name": "legoPerms",
                  "type": "tuple",
                  "components": [
                    {
                      "name": "canManageYield",
                      "type": "bool"
                    },
                    {
                      "name": "canBuyAndSell",
                      "type": "bool"
                    },
                    {
                      "name": "canManageDebt",
                      "type": "bool"
                    },
                    {
                      "name": "canManageLiq",
                      "type": "bool"
                    },
                    {
                      "name": "canClaimRewards",
                      "type": "bool"
                    },
                    {
                      "name": "onlyApprovedYieldOpps",
                      "type": "bool"
                    },
                    {
                      "name": "allowedLegos",
                      "type": "uint256[]"
                    }
                  ]
                },
                {
                  "name": "swapPerms",
                  "type": "tuple",
                  "components": [
                    {
                      "name": "mustHaveUsdValue",
                      "type": "bool"
                    },
                    {
                      "name": "maxNumSwapsPerPeriod",
                      "type": "uint256"
                    },
                    {
                      "name": "maxSlippage",
                      "type": "uint256"
                    }
                  ]
                },
                {
                  "name": "whitelistPerms",
                  "type": "tuple",
                  "components": [
                    {
                      "name": "canAddPending",
                      "type": "bool"
                    },
                    {
                      "name": "canConfirm",
                      "type": "bool"
                    },
                    {
                      "name": "canCancel",
                      "type": "bool"
                    },
                    {
                      "name": "canRemove",
                      "type": "bool"
                    }
                  ]
                },
                {
                  "name": "transferPerms",
                  "type": "tuple",
                  "components": [
                    {
                      "name": "canTransfer",
                      "type": "bool"
                    },
                    {
                      "name": "canCreateCheque",
                      "type": "bool"
                    },
                    {
                      "name": "canAddPendingPayee",
                      "type": "bool"
                    },
                    {
                      "name": "allowedPayees",
                      "type": "address[]"
                    }
                  ]
                },
                {
                  "name": "allowedAssets",
                  "type": "address[]"
                }
              ]
            },
            {
              "name": "_action",
              "type": "uint256"
            },
            {
              "name": "_assets",
              "type": "address[]"
            }
          ],
          "outputs": [
            {
              "name": "",
              "type": "bool"
            }
          ]
        },
        {
          "stateMutability": "view",
          "type": "function",
          "name": "canSignerPerformActionWithConfig",
          "inputs": [
            {
              "name": "_isOwner",
              "type": "bool"
            },
            {
              "name": "_isManager",
              "type": "bool"
            },
            {
              "name": "_managerData",
              "type": "tuple",
              "components": [
                {
                  "name": "numTxsInPeriod",
                  "type": "uint256"
                },
                {
                  "name": "totalUsdValueInPeriod",
                  "type": "uint256"
                },
                {
                  "name": "totalNumTxs",
                  "type": "uint256"
                },
                {
                  "name": "totalUsdValue",
                  "type": "uint256"
                },
                {
                  "name": "lastTxBlock",
                  "type": "uint256"
                },
                {
                  "name": "periodStartBlock",
                  "type": "uint256"
                },
                {
                  "name": "numSwapsInPeriod",
                  "type": "uint256"
                }
              ]
            },
            {
              "name": "_config",
              "type": "tuple",
              "components": [
                {
                  "name": "startBlock",
                  "type": "uint256"
                },
                {
                  "name": "expiryBlock",
                  "type": "uint256"
                },
                {
                  "name": "limits",
                  "type": "tuple",
                  "components": [
                    {
                      "name": "maxUsdValuePerTx",
                      "type": "uint256"
                    },
                    {
                      "name": "maxUsdValuePerPeriod",
                      "type": "uint256"
                    },
                    {
                      "name": "maxUsdValueLifetime",
                      "type": "uint256"
                    },
                    {
                      "name": "maxNumTxsPerPeriod",
                      "type": "uint256"
                    },
                    {
                      "name": "txCooldownBlocks",
                      "type": "uint256"
                    },
                    {
                      "name": "failOnZeroPrice",
                      "type": "bool"
                    }
                  ]
                },
                {
                  "name": "legoPerms",
                  "type": "tuple",
                  "components": [
                    {
                      "name": "canManageYield",
                      "type": "bool"
                    },
                    {
                      "name": "canBuyAndSell",
                      "type": "bool"
                    },
                    {
                      "name": "canManageDebt",
                      "type": "bool"
                    },
                    {
                      "name": "canManageLiq",
                      "type": "bool"
                    },
                    {
                      "name": "canClaimRewards",
                      "type": "bool"
                    },
                    {
                      "name": "onlyApprovedYieldOpps",
                      "type": "bool"
                    },
                    {
                      "name": "allowedLegos",
                      "type": "uint256[]"
                    }
                  ]
                },
                {
                  "name": "swapPerms",
                  "type": "tuple",
                  "components": [
                    {
                      "name": "mustHaveUsdValue",
                      "type": "bool"
                    },
                    {
                      "name": "maxNumSwapsPerPeriod",
                      "type": "uint256"
                    },
                    {
                      "name": "maxSlippage",
                      "type": "uint256"
                    }
                  ]
                },
                {
                  "name": "whitelistPerms",
                  "type": "tuple",
                  "components": [
                    {
                      "name": "canAddPending",
                      "type": "bool"
                    },
                    {
                      "name": "canConfirm",
                      "type": "bool"
                    },
                    {
                      "name": "canCancel",
                      "type": "bool"
                    },
                    {
                      "name": "canRemove",
                      "type": "bool"
                    }
                  ]
                },
                {
                  "name": "transferPerms",
                  "type": "tuple",
                  "components": [
                    {
                      "name": "canTransfer",
                      "type": "bool"
                    },
                    {
                      "name": "canCreateCheque",
                      "type": "bool"
                    },
                    {
                      "name": "canAddPendingPayee",
                      "type": "bool"
                    },
                    {
                      "name": "allowedPayees",
                      "type": "address[]"
                    }
                  ]
                },
                {
                  "name": "allowedAssets",
                  "type": "address[]"
                },
                {
                  "name": "canClaimLoot",
                  "type": "bool"
                }
              ]
            },
            {
              "name": "_globalConfig",
              "type": "tuple",
              "components": [
                {
                  "name": "managerPeriod",
                  "type": "uint256"
                },
                {
                  "name": "startDelay",
                  "type": "uint256"
                },
                {
                  "name": "activationLength",
                  "type": "uint256"
                },
                {
                  "name": "canOwnerManage",
                  "type": "bool"
                },
                {
                  "name": "limits",
                  "type": "tuple",
                  "components": [
                    {
                      "name": "maxUsdValuePerTx",
                      "type": "uint256"
                    },
                    {
                      "name": "maxUsdValuePerPeriod",
                      "type": "uint256"
                    },
                    {
                      "name": "maxUsdValueLifetime",
                      "type": "uint256"
                    },
                    {
                      "name": "maxNumTxsPerPeriod",
                      "type": "uint256"
                    },
                    {
                      "name": "txCooldownBlocks",
                      "type": "uint256"
                    },
                    {
                      "name": "failOnZeroPrice",
                      "type": "bool"
                    }
                  ]
                },
                {
                  "name": "legoPerms",
                  "type": "tuple",
                  "components": [
                    {
                      "name": "canManageYield",
                      "type": "bool"
                    },
                    {
                      "name": "canBuyAndSell",
                      "type": "bool"
                    },
                    {
                      "name": "canManageDebt",
                      "type": "bool"
                    },
                    {
                      "name": "canManageLiq",
                      "type": "bool"
                    },
                    {
                      "name": "canClaimRewards",
                      "type": "bool"
                    },
                    {
                      "name": "onlyApprovedYieldOpps",
                      "type": "bool"
                    },
                    {
                      "name": "allowedLegos",
                      "type": "uint256[]"
                    }
                  ]
                },
                {
                  "name": "swapPerms",
                  "type": "tuple",
                  "components": [
                    {
                      "name": "mustHaveUsdValue",
                      "type": "bool"
                    },
                    {
                      "name": "maxNumSwapsPerPeriod",
                      "type": "uint256"
                    },
                    {
                      "name": "maxSlippage",
                      "type": "uint256"
                    }
                  ]
                },
                {
                  "name": "whitelistPerms",
                  "type": "tuple",
                  "components": [
                    {
                      "name": "canAddPending",
                      "type": "bool"
                    },
                    {
                      "name": "canConfirm",
                      "type": "bool"
                    },
                    {
                      "name": "canCancel",
                      "type": "bool"
                    },
                    {
                      "name": "canRemove",
                      "type": "bool"
                    }
                  ]
                },
                {
                  "name": "transferPerms",
                  "type": "tuple",
                  "components": [
                    {
                      "name": "canTransfer",
                      "type": "bool"
                    },
                    {
                      "name": "canCreateCheque",
                      "type": "bool"
                    },
                    {
                      "name": "canAddPendingPayee",
                      "type": "bool"
                    },
                    {
                      "name": "allowedPayees",
                      "type": "address[]"
                    }
                  ]
                },
                {
                  "name": "allowedAssets",
                  "type": "address[]"
                }
              ]
            },
            {
              "name": "_action",
              "type": "uint256"
            },
            {
              "name": "_assets",
              "type": "address[]"
            },
            {
              "name": "_legoIds",
              "type": "uint256[]"
            }
          ],
          "outputs": [
            {
              "name": "",
              "type": "bool"
            }
          ]
        },
        {
          "stateMutability": "view",
          "type": "function",
          "name": "canSignerPerformActionWithConfig",
          "inputs": [
            {
              "name": "_isOwner",
              "type": "bool"
            },
            {
              "name": "_isManager",
              "type": "bool"
            },
            {
              "name": "_managerData",
              "type": "tuple",
              "components": [
                {
                  "name": "numTxsInPeriod",
                  "type": "uint256"
                },
                {
                  "name": "totalUsdValueInPeriod",
                  "type": "uint256"
                },
                {
                  "name": "totalNumTxs",
                  "type": "uint256"
                },
                {
                  "name": "totalUsdValue",
                  "type": "uint256"
                },
                {
                  "name": "lastTxBlock",
                  "type": "uint256"
                },
                {
                  "name": "periodStartBlock",
                  "type": "uint256"
                },
                {
                  "name": "numSwapsInPeriod",
                  "type": "uint256"
                }
              ]
            },
            {
              "name": "_config",
              "type": "tuple",
              "components": [
                {
                  "name": "startBlock",
                  "type": "uint256"
                },
                {
                  "name": "expiryBlock",
                  "type": "uint256"
                },
                {
                  "name": "limits",
                  "type": "tuple",
                  "components": [
                    {
                      "name": "maxUsdValuePerTx",
                      "type": "uint256"
                    },
                    {
                      "name": "maxUsdValuePerPeriod",
                      "type": "uint256"
                    },
                    {
                      "name": "maxUsdValueLifetime",
                      "type": "uint256"
                    },
                    {
                      "name": "maxNumTxsPerPeriod",
                      "type": "uint256"
                    },
                    {
                      "name": "txCooldownBlocks",
                      "type": "uint256"
                    },
                    {
                      "name": "failOnZeroPrice",
                      "type": "bool"
                    }
                  ]
                },
                {
                  "name": "legoPerms",
                  "type": "tuple",
                  "components": [
                    {
                      "name": "canManageYield",
                      "type": "bool"
                    },
                    {
                      "name": "canBuyAndSell",
                      "type": "bool"
                    },
                    {
                      "name": "canManageDebt",
                      "type": "bool"
                    },
                    {
                      "name": "canManageLiq",
                      "type": "bool"
                    },
                    {
                      "name": "canClaimRewards",
                      "type": "bool"
                    },
                    {
                      "name": "onlyApprovedYieldOpps",
                      "type": "bool"
                    },
                    {
                      "name": "allowedLegos",
                      "type": "uint256[]"
                    }
                  ]
                },
                {
                  "name": "swapPerms",
                  "type": "tuple",
                  "components": [
                    {
                      "name": "mustHaveUsdValue",
                      "type": "bool"
                    },
                    {
                      "name": "maxNumSwapsPerPeriod",
                      "type": "uint256"
                    },
                    {
                      "name": "maxSlippage",
                      "type": "uint256"
                    }
                  ]
                },
                {
                  "name": "whitelistPerms",
                  "type": "tuple",
                  "components": [
                    {
                      "name": "canAddPending",
                      "type": "bool"
                    },
                    {
                      "name": "canConfirm",
                      "type": "bool"
                    },
                    {
                      "name": "canCancel",
                      "type": "bool"
                    },
                    {
                      "name": "canRemove",
                      "type": "bool"
                    }
                  ]
                },
                {
                  "name": "transferPerms",
                  "type": "tuple",
                  "components": [
                    {
                      "name": "canTransfer",
                      "type": "bool"
                    },
                    {
                      "name": "canCreateCheque",
                      "type": "bool"
                    },
                    {
                      "name": "canAddPendingPayee",
                      "type": "bool"
                    },
                    {
                      "name": "allowedPayees",
                      "type": "address[]"
                    }
                  ]
                },
                {
                  "name": "allowedAssets",
                  "type": "address[]"
                },
                {
                  "name": "canClaimLoot",
                  "type": "bool"
                }
              ]
            },
            {
              "name": "_globalConfig",
              "type": "tuple",
              "components": [
                {
                  "name": "managerPeriod",
                  "type": "uint256"
                },
                {
                  "name": "startDelay",
                  "type": "uint256"
                },
                {
                  "name": "activationLength",
                  "type": "uint256"
                },
                {
                  "name": "canOwnerManage",
                  "type": "bool"
                },
                {
                  "name": "limits",
                  "type": "tuple",
                  "components": [
                    {
                      "name": "maxUsdValuePerTx",
                      "type": "uint256"
                    },
                    {
                      "name": "maxUsdValuePerPeriod",
                      "type": "uint256"
                    },
                    {
                      "name": "maxUsdValueLifetime",
                      "type": "uint256"
                    },
                    {
                      "name": "maxNumTxsPerPeriod",
                      "type": "uint256"
                    },
                    {
                      "name": "txCooldownBlocks",
                      "type": "uint256"
                    },
                    {
                      "name": "failOnZeroPrice",
                      "type": "bool"
                    }
                  ]
                },
                {
                  "name": "legoPerms",
                  "type": "tuple",
                  "components": [
                    {
                      "name": "canManageYield",
                      "type": "bool"
                    },
                    {
                      "name": "canBuyAndSell",
                      "type": "bool"
                    },
                    {
                      "name": "canManageDebt",
                      "type": "bool"
                    },
                    {
                      "name": "canManageLiq",
                      "type": "bool"
                    },
                    {
                      "name": "canClaimRewards",
                      "type": "bool"
                    },
                    {
                      "name": "onlyApprovedYieldOpps",
                      "type": "bool"
                    },
                    {
                      "name": "allowedLegos",
                      "type": "uint256[]"
                    }
                  ]
                },
                {
                  "name": "swapPerms",
                  "type": "tuple",
                  "components": [
                    {
                      "name": "mustHaveUsdValue",
                      "type": "bool"
                    },
                    {
                      "name": "maxNumSwapsPerPeriod",
                      "type": "uint256"
                    },
                    {
                      "name": "maxSlippage",
                      "type": "uint256"
                    }
                  ]
                },
                {
                  "name": "whitelistPerms",
                  "type": "tuple",
                  "components": [
                    {
                      "name": "canAddPending",
                      "type": "bool"
                    },
                    {
                      "name": "canConfirm",
                      "type": "bool"
                    },
                    {
                      "name": "canCancel",
                      "type": "bool"
                    },
                    {
                      "name": "canRemove",
                      "type": "bool"
                    }
                  ]
                },
                {
                  "name": "transferPerms",
                  "type": "tuple",
                  "components": [
                    {
                      "name": "canTransfer",
                      "type": "bool"
                    },
                    {
                      "name": "canCreateCheque",
                      "type": "bool"
                    },
                    {
                      "name": "canAddPendingPayee",
                      "type": "bool"
                    },
                    {
                      "name": "allowedPayees",
                      "type": "address[]"
                    }
                  ]
                },
                {
                  "name": "allowedAssets",
                  "type": "address[]"
                }
              ]
            },
            {
              "name": "_action",
              "type": "uint256"
            },
            {
              "name": "_assets",
              "type": "address[]"
            },
            {
              "name": "_legoIds",
              "type": "uint256[]"
            },
            {
              "name": "_txRecipient",
              "type": "address"
            }
          ],
          "outputs": [
            {
              "name": "",
              "type": "bool"
            }
          ]
        },
        {
          "stateMutability": "view",
          "type": "function",
          "name": "canManagerFinishTx",
          "inputs": [
            {
              "name": "_user",
              "type": "address"
            },
            {
              "name": "_manager",
              "type": "address"
            },
            {
              "name": "_txUsdValue",
              "type": "uint256"
            },
            {
              "name": "_underlyingAsset",
              "type": "address"
            },
            {
              "name": "_vaultToken",
              "type": "address"
            },
            {
              "name": "_shouldCheckSwap",
              "type": "bool"
            },
            {
              "name": "_specificSwapPerms",
              "type": "tuple",
              "components": [
                {
                  "name": "mustHaveUsdValue",
                  "type": "bool"
                },
                {
                  "name": "maxNumSwapsPerPeriod",
                  "type": "uint256"
                },
                {
                  "name": "maxSlippage",
                  "type": "uint256"
                }
              ]
            },
            {
              "name": "_globalSwapPerms",
              "type": "tuple",
              "components": [
                {
                  "name": "mustHaveUsdValue",
                  "type": "bool"
                },
                {
                  "name": "maxNumSwapsPerPeriod",
                  "type": "uint256"
                },
                {
                  "name": "maxSlippage",
                  "type": "uint256"
                }
              ]
            },
            {
              "name": "_fromAssetUsdValue",
              "type": "uint256"
            },
            {
              "name": "_toAssetUsdValue",
              "type": "uint256"
            },
            {
              "name": "_vaultRegistry",
              "type": "address"
            }
          ],
          "outputs": [
            {
              "name": "",
              "type": "bool"
            }
          ]
        },
        {
          "stateMutability": "view",
          "type": "function",
          "name": "checkManagerLimitsPostTx",
          "inputs": [
            {
              "name": "_txUsdValue",
              "type": "uint256"
            },
            {
              "name": "_specificLimits",
              "type": "tuple",
              "components": [
                {
                  "name": "maxUsdValuePerTx",
                  "type": "uint256"
                },
                {
                  "name": "maxUsdValuePerPeriod",
                  "type": "uint256"
                },
                {
                  "name": "maxUsdValueLifetime",
                  "type": "uint256"
                },
                {
                  "name": "maxNumTxsPerPeriod",
                  "type": "uint256"
                },
                {
                  "name": "txCooldownBlocks",
                  "type": "uint256"
                },
                {
                  "name": "failOnZeroPrice",
                  "type": "bool"
                }
              ]
            },
            {
              "name": "_globalLimits",
              "type": "tuple",
              "components": [
                {
                  "name": "maxUsdValuePerTx",
                  "type": "uint256"
                },
                {
                  "name": "maxUsdValuePerPeriod",
                  "type": "uint256"
                },
                {
                  "name": "maxUsdValueLifetime",
                  "type": "uint256"
                },
                {
                  "name": "maxNumTxsPerPeriod",
                  "type": "uint256"
                },
                {
                  "name": "txCooldownBlocks",
                  "type": "uint256"
                },
                {
                  "name": "failOnZeroPrice",
                  "type": "bool"
                }
              ]
            },
            {
              "name": "_managerPeriod",
              "type": "uint256"
            },
            {
              "name": "_managerData",
              "type": "tuple",
              "components": [
                {
                  "name": "numTxsInPeriod",
                  "type": "uint256"
                },
                {
                  "name": "totalUsdValueInPeriod",
                  "type": "uint256"
                },
                {
                  "name": "totalNumTxs",
                  "type": "uint256"
                },
                {
                  "name": "totalUsdValue",
                  "type": "uint256"
                },
                {
                  "name": "lastTxBlock",
                  "type": "uint256"
                },
                {
                  "name": "periodStartBlock",
                  "type": "uint256"
                },
                {
                  "name": "numSwapsInPeriod",
                  "type": "uint256"
                }
              ]
            },
            {
              "name": "_requiresVaultApproval",
              "type": "bool"
            },
            {
              "name": "_underlyingAsset",
              "type": "address"
            },
            {
              "name": "_vaultToken",
              "type": "address"
            },
            {
              "name": "_shouldCheckSwap",
              "type": "bool"
            },
            {
              "name": "_specificSwapPerms",
              "type": "tuple",
              "components": [
                {
                  "name": "mustHaveUsdValue",
                  "type": "bool"
                },
                {
                  "name": "maxNumSwapsPerPeriod",
                  "type": "uint256"
                },
                {
                  "name": "maxSlippage",
                  "type": "uint256"
                }
              ]
            },
            {
              "name": "_globalSwapPerms",
              "type": "tuple",
              "components": [
                {
                  "name": "mustHaveUsdValue",
                  "type": "bool"
                },
                {
                  "name": "maxNumSwapsPerPeriod",
                  "type": "uint256"
                },
                {
                  "name": "maxSlippage",
                  "type": "uint256"
                }
              ]
            },
            {
              "name": "_fromAssetUsdValue",
              "type": "uint256"
            },
            {
              "name": "_toAssetUsdValue",
              "type": "uint256"
            },
            {
              "name": "_vaultRegistry",
              "type": "address"
            }
          ],
          "outputs": [
            {
              "name": "",
              "type": "bool"
            },
            {
              "name": "",
              "type": "tuple",
              "components": [
                {
                  "name": "numTxsInPeriod",
                  "type": "uint256"
                },
                {
                  "name": "totalUsdValueInPeriod",
                  "type": "uint256"
                },
                {
                  "name": "totalNumTxs",
                  "type": "uint256"
                },
                {
                  "name": "totalUsdValue",
                  "type": "uint256"
                },
                {
                  "name": "lastTxBlock",
                  "type": "uint256"
                },
                {
                  "name": "periodStartBlock",
                  "type": "uint256"
                },
                {
                  "name": "numSwapsInPeriod",
                  "type": "uint256"
                }
              ]
            }
          ]
        },
        {
          "stateMutability": "view",
          "type": "function",
          "name": "isValidPayee",
          "inputs": [
            {
              "name": "_user",
              "type": "address"
            },
            {
              "name": "_recipient",
              "type": "address"
            },
            {
              "name": "_asset",
              "type": "address"
            },
            {
              "name": "_amount",
              "type": "uint256"
            },
            {
              "name": "_txUsdValue",
              "type": "uint256"
            }
          ],
          "outputs": [
            {
              "name": "",
              "type": "bool"
            }
          ]
        },
        {
          "stateMutability": "view",
          "type": "function",
          "name": "isValidPayeeAndGetData",
          "inputs": [
            {
              "name": "_isWhitelisted",
              "type": "bool"
            },
            {
              "name": "_isOwner",
              "type": "bool"
            },
            {
              "name": "_isPayee",
              "type": "bool"
            },
            {
              "name": "_asset",
              "type": "address"
            },
            {
              "name": "_amount",
              "type": "uint256"
            },
            {
              "name": "_txUsdValue",
              "type": "uint256"
            },
            {
              "name": "_config",
              "type": "tuple",
              "components": [
                {
                  "name": "startBlock",
                  "type": "uint256"
                },
                {
                  "name": "expiryBlock",
                  "type": "uint256"
                },
                {
                  "name": "canPull",
                  "type": "bool"
                },
                {
                  "name": "periodLength",
                  "type": "uint256"
                },
                {
                  "name": "maxNumTxsPerPeriod",
                  "type": "uint256"
                },
                {
                  "name": "txCooldownBlocks",
                  "type": "uint256"
                },
                {
                  "name": "failOnZeroPrice",
                  "type": "bool"
                },
                {
                  "name": "primaryAsset",
                  "type": "address"
                },
                {
                  "name": "onlyPrimaryAsset",
                  "type": "bool"
                },
                {
                  "name": "unitLimits",
                  "type": "tuple",
                  "components": [
                    {
                      "name": "perTxCap",
                      "type": "uint256"
                    },
                    {
                      "name": "perPeriodCap",
                      "type": "uint256"
                    },
                    {
                      "name": "lifetimeCap",
                      "type": "uint256"
                    }
                  ]
                },
                {
                  "name": "usdLimits",
                  "type": "tuple",
                  "components": [
                    {
                      "name": "perTxCap",
                      "type": "uint256"
                    },
                    {
                      "name": "perPeriodCap",
                      "type": "uint256"
                    },
                    {
                      "name": "lifetimeCap",
                      "type": "uint256"
                    }
                  ]
                }
              ]
            },
            {
              "name": "_globalConfig",
              "type": "tuple",
              "components": [
                {
                  "name": "defaultPeriodLength",
                  "type": "uint256"
                },
                {
                  "name": "startDelay",
                  "type": "uint256"
                },
                {
                  "name": "activationLength",
                  "type": "uint256"
                },
                {
                  "name": "maxNumTxsPerPeriod",
                  "type": "uint256"
                },
                {
                  "name": "txCooldownBlocks",
                  "type": "uint256"
                },
                {
                  "name": "failOnZeroPrice",
                  "type": "bool"
                },
                {
                  "name": "usdLimits",
                  "type": "tuple",
                  "components": [
                    {
                      "name": "perTxCap",
                      "type": "uint256"
                    },
                    {
                      "name": "perPeriodCap",
                      "type": "uint256"
                    },
                    {
                      "name": "lifetimeCap",
                      "type": "uint256"
                    }
                  ]
                },
                {
                  "name": "canPayOwner",
                  "type": "bool"
                },
                {
                  "name": "canPull",
                  "type": "bool"
                }
              ]
            },
            {
              "name": "_payeeData",
              "type": "tuple",
              "components": [
                {
                  "name": "numTxsInPeriod",
                  "type": "uint256"
                },
                {
                  "name": "totalUnitsInPeriod",
                  "type": "uint256"
                },
                {
                  "name": "totalUsdValueInPeriod",
                  "type": "uint256"
                },
                {
                  "name": "totalNumTxs",
                  "type": "uint256"
                },
                {
                  "name": "totalUnits",
                  "type": "uint256"
                },
                {
                  "name": "totalUsdValue",
                  "type": "uint256"
                },
                {
                  "name": "lastTxBlock",
                  "type": "uint256"
                },
                {
                  "name": "periodStartBlock",
                  "type": "uint256"
                }
              ]
            }
          ],
          "outputs": [
            {
              "name": "",
              "type": "bool"
            },
            {
              "name": "",
              "type": "tuple",
              "components": [
                {
                  "name": "numTxsInPeriod",
                  "type": "uint256"
                },
                {
                  "name": "totalUnitsInPeriod",
                  "type": "uint256"
                },
                {
                  "name": "totalUsdValueInPeriod",
                  "type": "uint256"
                },
                {
                  "name": "totalNumTxs",
                  "type": "uint256"
                },
                {
                  "name": "totalUnits",
                  "type": "uint256"
                },
                {
                  "name": "totalUsdValue",
                  "type": "uint256"
                },
                {
                  "name": "lastTxBlock",
                  "type": "uint256"
                },
                {
                  "name": "periodStartBlock",
                  "type": "uint256"
                }
              ]
            }
          ]
        },
        {
          "stateMutability": "view",
          "type": "function",
          "name": "isValidChequeAndGetData",
          "inputs": [
            {
              "name": "_asset",
              "type": "address"
            },
            {
              "name": "_amount",
              "type": "uint256"
            },
            {
              "name": "_txUsdValue",
              "type": "uint256"
            },
            {
              "name": "_cheque",
              "type": "tuple",
              "components": [
                {
                  "name": "recipient",
                  "type": "address"
                },
                {
                  "name": "asset",
                  "type": "address"
                },
                {
                  "name": "amount",
                  "type": "uint256"
                },
                {
                  "name": "creationBlock",
                  "type": "uint256"
                },
                {
                  "name": "unlockBlock",
                  "type": "uint256"
                },
                {
                  "name": "expiryBlock",
                  "type": "uint256"
                },
                {
                  "name": "usdValueOnCreation",
                  "type": "uint256"
                },
                {
                  "name": "canManagerPay",
                  "type": "bool"
                },
                {
                  "name": "canBePulled",
                  "type": "bool"
                },
                {
                  "name": "creator",
                  "type": "address"
                },
                {
                  "name": "active",
                  "type": "bool"
                }
              ]
            },
            {
              "name": "_globalConfig",
              "type": "tuple",
              "components": [
                {
                  "name": "maxNumActiveCheques",
                  "type": "uint256"
                },
                {
                  "name": "maxChequeUsdValue",
                  "type": "uint256"
                },
                {
                  "name": "instantUsdThreshold",
                  "type": "uint256"
                },
                {
                  "name": "perPeriodPaidUsdCap",
                  "type": "uint256"
                },
                {
                  "name": "maxNumChequesPaidPerPeriod",
                  "type": "uint256"
                },
                {
                  "name": "payCooldownBlocks",
                  "type": "uint256"
                },
                {
                  "name": "perPeriodCreatedUsdCap",
                  "type": "uint256"
                },
                {
                  "name": "maxNumChequesCreatedPerPeriod",
                  "type": "uint256"
                },
                {
                  "name": "createCooldownBlocks",
                  "type": "uint256"
                },
                {
                  "name": "periodLength",
                  "type": "uint256"
                },
                {
                  "name": "expensiveDelayBlocks",
                  "type": "uint256"
                },
                {
                  "name": "defaultExpiryBlocks",
                  "type": "uint256"
                },
                {
                  "name": "allowedAssets",
                  "type": "address[]"
                },
                {
                  "name": "canManagersCreateCheques",
                  "type": "bool"
                },
                {
                  "name": "canManagerPay",
                  "type": "bool"
                },
                {
                  "name": "canBePulled",
                  "type": "bool"
                }
              ]
            },
            {
              "name": "_chequeData",
              "type": "tuple",
              "components": [
                {
                  "name": "numChequesPaidInPeriod",
                  "type": "uint256"
                },
                {
                  "name": "totalUsdValuePaidInPeriod",
                  "type": "uint256"
                },
                {
                  "name": "totalNumChequesPaid",
                  "type": "uint256"
                },
                {
                  "name": "totalUsdValuePaid",
                  "type": "uint256"
                },
                {
                  "name": "lastChequePaidBlock",
                  "type": "uint256"
                },
                {
                  "name": "numChequesCreatedInPeriod",
                  "type": "uint256"
                },
                {
                  "name": "totalUsdValueCreatedInPeriod",
                  "type": "uint256"
                },
                {
                  "name": "totalNumChequesCreated",
                  "type": "uint256"
                },
                {
                  "name": "totalUsdValueCreated",
                  "type": "uint256"
                },
                {
                  "name": "lastChequeCreatedBlock",
                  "type": "uint256"
                },
                {
                  "name": "periodStartBlock",
                  "type": "uint256"
                }
              ]
            },
            {
              "name": "_isManager",
              "type": "bool"
            }
          ],
          "outputs": [
            {
              "name": "",
              "type": "bool"
            },
            {
              "name": "",
              "type": "tuple",
              "components": [
                {
                  "name": "numChequesPaidInPeriod",
                  "type": "uint256"
                },
                {
                  "name": "totalUsdValuePaidInPeriod",
                  "type": "uint256"
                },
                {
                  "name": "totalNumChequesPaid",
                  "type": "uint256"
                },
                {
                  "name": "totalUsdValuePaid",
                  "type": "uint256"
                },
                {
                  "name": "lastChequePaidBlock",
                  "type": "uint256"
                },
                {
                  "name": "numChequesCreatedInPeriod",
                  "type": "uint256"
                },
                {
                  "name": "totalUsdValueCreatedInPeriod",
                  "type": "uint256"
                },
                {
                  "name": "totalNumChequesCreated",
                  "type": "uint256"
                },
                {
                  "name": "totalUsdValueCreated",
                  "type": "uint256"
                },
                {
                  "name": "lastChequeCreatedBlock",
                  "type": "uint256"
                },
                {
                  "name": "periodStartBlock",
                  "type": "uint256"
                }
              ]
            }
          ]
        },
        {
          "stateMutability": "nonpayable",
          "type": "constructor",
          "inputs": [],
          "outputs": []
        }
      ],
      "solc_json": {
        "language": "Vyper",
        "sources": {
          "interfaces/WalletStructs.vyi": {
            "content": "# @version 0.4.3\n\nflag ActionType:\n    TRANSFER\n    EARN_DEPOSIT\n    EARN_WITHDRAW\n    EARN_REBALANCE\n    SWAP\n    MINT_REDEEM\n    CONFIRM_MINT_REDEEM\n    ADD_COLLATERAL\n    REMOVE_COLLATERAL\n    BORROW\n    REPAY_DEBT\n    REWARDS\n    ETH_TO_WETH\n    WETH_TO_ETH\n    ADD_LIQ\n    REMOVE_LIQ\n    ADD_LIQ_CONC\n    REMOVE_LIQ_CONC\n    PAY_CHEQUE\n\nstruct WalletAssetData:\n    assetBalance: uint256\n    usdValue: uint256\n    isYieldAsset: bool\n    lastPricePerShare: uint256\n\nstruct ActionData:\n    ledger: address\n    missionControl: address\n    legoBook: address\n    hatchery: address\n    lootDistributor: address\n    appraiser: address\n    billing: address\n    vaultRegistry: address\n    wallet: address\n    walletConfig: address\n    walletOwner: address\n    inEjectMode: bool\n    isFrozen: bool\n    lastTotalUsdValue: uint256\n    signer: address\n    isManager: bool\n    legoId: uint256\n    legoAddr: address\n    eth: address\n    weth: address\n\nstruct MiniAddys:\n    ledger: address\n    missionControl: address\n    legoBook: address\n    appraiser: address",
            "sha256sum": "466493c129135c95470aaf70eeddc936632f7b0f813396e5a7ddc03bea9da518"
          },
          "interfaces/WalletConfigStructs.vyi": {
            "content": "# @version 0.4.3\n\nMAX_CONFIG_ASSETS: constant(uint256) = 40\nMAX_CONFIG_LEGOS: constant(uint256) = 25\nMAX_ALLOWED_PAYEES: constant(uint256) = 40\n\nflag WhitelistAction:\n    ADD_PENDING\n    CONFIRM_WHITELIST\n    CANCEL_WHITELIST\n    REMOVE_WHITELIST\n\nflag BackpackType:\n    WALLET_KERNEL\n    WALLET_SENTINEL\n    WALLET_HIGH_COMMAND\n    WALLET_PAYMASTER\n    WALLET_CHEQUE_BOOK\n    WALLET_MIGRATOR\n\n# payees\n\nstruct PayeeData:\n    numTxsInPeriod: uint256\n    totalUnitsInPeriod: uint256\n    totalUsdValueInPeriod: uint256\n    totalNumTxs: uint256\n    totalUnits: uint256\n    totalUsdValue: uint256\n    lastTxBlock: uint256\n    periodStartBlock: uint256\n\nstruct PayeeSettings:\n    startBlock: uint256\n    expiryBlock: uint256\n    canPull: bool\n    periodLength: uint256\n    maxNumTxsPerPeriod: uint256\n    txCooldownBlocks: uint256\n    failOnZeroPrice: bool\n    primaryAsset: address\n    onlyPrimaryAsset: bool\n    unitLimits: PayeeLimits\n    usdLimits: PayeeLimits\n\nstruct GlobalPayeeSettings:\n    defaultPeriodLength: uint256\n    startDelay: uint256\n    activationLength: uint256\n    maxNumTxsPerPeriod: uint256\n    txCooldownBlocks: uint256\n    failOnZeroPrice: bool\n    usdLimits: PayeeLimits\n    canPayOwner: bool\n    canPull: bool\n\nstruct PayeeLimits:\n    perTxCap: uint256\n    perPeriodCap: uint256\n    lifetimeCap: uint256\n\nstruct PendingPayee:\n    settings: PayeeSettings\n    initiatedBlock: uint256\n    confirmBlock: uint256\n    currentOwner: address\n\nstruct PayeeManagementBundle:\n    owner: address\n    wallet: address\n    isRegisteredPayee: bool\n    isWhitelisted: bool\n    isExistingCheque: bool\n    payeeSettings: PayeeSettings\n    globalPayeeSettings: GlobalPayeeSettings\n    timeLock: uint256\n    walletConfig: address\n\nstruct RecipientConfigBundle:\n    isWhitelisted: bool\n    isOwner: bool\n    isPayee: bool\n    config: PayeeSettings\n    globalConfig: GlobalPayeeSettings\n    data: PayeeData\n\nstruct WhitelistConfigBundle:\n    owner: address\n    wallet: address\n    isWhitelisted: bool\n    pendingWhitelist: PendingWhitelist\n    isExistingPayee: bool\n    isExistingCheque: bool\n    timeLock: uint256\n    walletConfig: address\n    isManager: bool\n    isOwner: bool\n    whitelistPerms: WhitelistPerms\n    globalWhitelistPerms: WhitelistPerms\n\nstruct PendingWhitelist:\n    initiatedBlock: uint256\n    confirmBlock: uint256\n    currentOwner: address\n\n# cheques\n\nstruct Cheque:\n    recipient: address\n    asset: address\n    amount: uint256\n    creationBlock: uint256\n    unlockBlock: uint256\n    expiryBlock: uint256\n    usdValueOnCreation: uint256\n    canManagerPay: bool\n    canBePulled: bool\n    creator: address\n    active: bool\n\nstruct ChequeSettings:\n    maxNumActiveCheques: uint256\n    maxChequeUsdValue: uint256\n    instantUsdThreshold: uint256\n    perPeriodPaidUsdCap: uint256\n    maxNumChequesPaidPerPeriod: uint256\n    payCooldownBlocks: uint256\n    perPeriodCreatedUsdCap: uint256\n    maxNumChequesCreatedPerPeriod: uint256\n    createCooldownBlocks: uint256\n    periodLength: uint256\n    expensiveDelayBlocks: uint256\n    defaultExpiryBlocks: uint256\n    allowedAssets: DynArray[address, MAX_CONFIG_ASSETS]\n    canManagersCreateCheques: bool\n    canManagerPay: bool\n    canBePulled: bool\n\nstruct ChequeData:\n    numChequesPaidInPeriod: uint256\n    totalUsdValuePaidInPeriod: uint256\n    totalNumChequesPaid: uint256\n    totalUsdValuePaid: uint256\n    lastChequePaidBlock: uint256\n    numChequesCreatedInPeriod: uint256\n    totalUsdValueCreatedInPeriod: uint256\n    totalNumChequesCreated: uint256\n    totalUsdValueCreated: uint256\n    lastChequeCreatedBlock: uint256\n    periodStartBlock: uint256\n\nstruct ChequeManagementBundle:\n    wallet: address\n    walletConfig: address\n    owner: address\n    isRecipientOnWhitelist: bool\n    isCreatorManager: bool\n    managerSettings: ManagerSettings\n    chequeSettings: ChequeSettings\n    chequeData: ChequeData\n    isExistingCheque: bool\n    numActiveCheques: uint256\n    isExistingPayee: bool\n    timeLock: uint256\n\n# managers\n\nstruct ManagerData:\n    numTxsInPeriod: uint256\n    totalUsdValueInPeriod: uint256\n    totalNumTxs: uint256\n    totalUsdValue: uint256\n    lastTxBlock: uint256\n    periodStartBlock: uint256\n    numSwapsInPeriod: uint256\n\nstruct ManagerSettings:\n    startBlock: uint256\n    expiryBlock: uint256\n    limits: ManagerLimits\n    legoPerms: LegoPerms\n    swapPerms: SwapPerms\n    whitelistPerms: WhitelistPerms\n    transferPerms: TransferPerms\n    allowedAssets: DynArray[address, MAX_CONFIG_ASSETS]\n    canClaimLoot: bool\n\nstruct GlobalManagerSettings:\n    managerPeriod: uint256\n    startDelay: uint256\n    activationLength: uint256\n    canOwnerManage: bool\n    limits: ManagerLimits\n    legoPerms: LegoPerms\n    swapPerms: SwapPerms\n    whitelistPerms: WhitelistPerms\n    transferPerms: TransferPerms\n    allowedAssets: DynArray[address, MAX_CONFIG_ASSETS]\n\nstruct ManagerLimits:\n    maxUsdValuePerTx: uint256\n    maxUsdValuePerPeriod: uint256\n    maxUsdValueLifetime: uint256\n    maxNumTxsPerPeriod: uint256\n    txCooldownBlocks: uint256\n    failOnZeroPrice: bool\n\nstruct LegoPerms:\n    canManageYield: bool\n    canBuyAndSell: bool\n    canManageDebt: bool\n    canManageLiq: bool\n    canClaimRewards: bool\n    onlyApprovedYieldOpps: bool\n    allowedLegos: DynArray[uint256, MAX_CONFIG_LEGOS]\n\nstruct SwapPerms:\n    mustHaveUsdValue: bool\n    maxNumSwapsPerPeriod: uint256\n    maxSlippage: uint256\n\nstruct WhitelistPerms:\n    canAddPending: bool\n    canConfirm: bool\n    canCancel: bool\n    canRemove: bool\n\nstruct TransferPerms:\n    canTransfer: bool\n    canCreateCheque: bool\n    canAddPendingPayee: bool\n    allowedPayees: DynArray[address, MAX_ALLOWED_PAYEES]\n\nstruct ManagerConfigBundle:\n    isOwner: bool\n    isManager: bool\n    config: ManagerSettings\n    globalConfig: GlobalManagerSettings\n    data: ManagerData\n    payee: address\n\nstruct ManagerSettingsBundle:\n    owner: address\n    isManager: bool\n    timeLock: uint256\n    walletConfig: address\n    legoBook: address\n    globalManagerSettings: GlobalManagerSettings\n\n# migration\n\nstruct MigrationConfigBundle:\n    owner: address\n    isFrozen: bool\n    numPayees: uint256\n    numWhitelisted: uint256\n    numManagers: uint256\n    startingAgent: address\n    startingAgentIndex: uint256\n    hasPendingOwnerChange: bool\n    groupId: uint256\n    numActiveCheques: uint256\n",
            "sha256sum": "31165468feeac632a1376c70970ce5124f8951392c4deaa01a26176c7f26718a"
          },
          "contracts/core/walletBackpack/Sentinel.vy": {
            "content": "#    \u2513 \u250f  \u2513\u2513   \n#    \u2503\u2503\u2503\u250f\u2513\u2503\u2503\u250f\u2513\u254b\n#    \u2517\u253b\u251b\u2517\u253b\u2517\u2517\u2517 \u2517\n#     ______   ______   __   __   ______  __   __   __   ______   __        \n#    /\\  ___\\ /\\  ___\\ /\\ \"-.\\ \\ /\\__  _\\/\\ \\ /\\ \"-.\\ \\ /\\  ___\\ /\\ \\       \n#    \\ \\___  \\\\ \\  __\\ \\ \\ \\-.  \\\\/_/\\ \\/\\ \\ \\\\ \\ \\-.  \\\\ \\  __\\ \\ \\ \\____  \n#     \\/\\_____\\\\ \\_____\\\\ \\_\\\\\"\\_\\  \\ \\_\\ \\ \\_\\\\ \\_\\\\\"\\_\\\\ \\_____\\\\ \\_____\\ \n#      \\/_____/ \\/_____/ \\/_/ \\/_/   \\/_/  \\/_/ \\/_/ \\/_/ \\/_____/ \\/_____/ \n#                                                                                                \n#     \u2554\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2557\n#     \u2551  ** Sentinel **                        \u2551\n#     \u2551  Validation on user wallet activity.   \u2551\n#     \u255a\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u255d\n#\n#     Underscore Protocol License: https://github.com/underscore-finance/underscore-protocol/blob/master/LICENSE.md\n\n# @version 0.4.3\n\nfrom interfaces import WalletStructs as ws\nfrom interfaces import WalletConfigStructs as wcs\n\ninterface UserWalletConfig:\n    def managerSettings(_addr: address) -> wcs.ManagerSettings: view\n    def managerPeriodData(_addr: address) -> wcs.ManagerData: view\n    def globalManagerSettings() -> wcs.GlobalManagerSettings: view\n    def payeeSettings(_addr: address) -> wcs.PayeeSettings: view\n    def payeePeriodData(_addr: address) -> wcs.PayeeData: view\n    def globalPayeeSettings() -> wcs.GlobalPayeeSettings: view\n    def indexOfWhitelist(_addr: address) -> uint256: view\n    def indexOfManager(_addr: address) -> uint256: view\n    def indexOfPayee(_addr: address) -> uint256: view\n    def owner() -> address: view\n\ninterface VaultRegistry:\n    def isApprovedVaultTokenForAsset(_underlyingAsset: address, _vaultToken: address) -> bool: view\n\ninterface UserWallet:\n    def walletConfig() -> address: view\n\nMAX_CONFIG_ASSETS: constant(uint256) = 40\nMAX_ASSETS: constant(uint256) = 10\nMAX_LEGOS: constant(uint256) = 10\nHUNDRED_PERCENT: constant(uint256) = 100_00\n\n\n@deploy\ndef __init__():\n    pass\n\n\n###################################\n# Manager Validation - Pre Action #\n###################################\n\n\n@view\n@external\ndef canSignerPerformAction(\n    _user: address,\n    _signer: address,\n    _action: ws.ActionType,\n    _assets: DynArray[address, MAX_ASSETS] = [],\n    _legoIds: DynArray[uint256, MAX_LEGOS] = [],\n    _txRecipient: address = empty(address),\n) -> bool:\n    c: wcs.ManagerConfigBundle = self._getManagerConfigBundle(_user, _signer, _txRecipient)\n    return self._canSignerPerformAction(c.isOwner, c.isManager, c.data, c.config, c.globalConfig, _action, _assets, _legoIds, c.payee)\n\n\n@view\n@external\ndef canSignerPerformActionWithConfig(\n    _isOwner: bool,\n    _isManager: bool,\n    _managerData: wcs.ManagerData,\n    _config: wcs.ManagerSettings,\n    _globalConfig: wcs.GlobalManagerSettings,\n    _action: ws.ActionType,\n    _assets: DynArray[address, MAX_ASSETS] = [],\n    _legoIds: DynArray[uint256, MAX_LEGOS] = [],\n    _txRecipient: address = empty(address),\n) -> bool:\n    return self._canSignerPerformAction(_isOwner, _isManager, _managerData, _config, _globalConfig, _action, _assets, _legoIds, _txRecipient)\n\n\n# core logic -- manager access control\n\n\n@view\n@internal\ndef _canSignerPerformAction(\n    _isOwner: bool,\n    _isManager: bool,\n    _managerData: wcs.ManagerData,\n    _managerConfig: wcs.ManagerSettings,\n    _globalConfig: wcs.GlobalManagerSettings,\n    _action: ws.ActionType,\n    _assets: DynArray[address, MAX_ASSETS],\n    _legoIds: DynArray[uint256, MAX_LEGOS],\n    _txRecipient: address,\n) -> bool:\n    # check if signer is the owner, and if owner can manage\n    if _isOwner and _globalConfig.canOwnerManage:\n        return True\n\n    # check if signer is a manager\n    if not _isManager:\n        return False\n\n    # get latest manager data\n    managerData: wcs.ManagerData = self._getLatestManagerData(_managerData, _globalConfig.managerPeriod)\n\n    # manager is not active\n    if _managerConfig.startBlock > block.number or _managerConfig.expiryBlock <= block.number:\n        return False\n\n    # specific manager\n    if not self._checkManagerPermsAndLimitsPreAction(managerData, _action, _assets, _legoIds, _txRecipient, _managerConfig.limits, _managerConfig.legoPerms, _managerConfig.transferPerms, _managerConfig.allowedAssets):\n        return False\n\n    # global manager settings\n    if not self._checkManagerPermsAndLimitsPreAction(managerData, _action, _assets, _legoIds, _txRecipient, _globalConfig.limits, _globalConfig.legoPerms, _globalConfig.transferPerms, _globalConfig.allowedAssets):\n        return False\n\n    return True\n\n\n# latest manager data\n\n\n@view\n@internal\ndef _getLatestManagerData(_managerData: wcs.ManagerData, _managerPeriod: uint256) -> wcs.ManagerData:\n    managerData: wcs.ManagerData = _managerData\n\n    # initialize period if first transaction\n    if managerData.periodStartBlock == 0:\n        managerData.periodStartBlock = block.number\n\n    # check if current period has ended\n    elif block.number >= managerData.periodStartBlock + _managerPeriod:\n        managerData.numTxsInPeriod = 0\n        managerData.totalUsdValueInPeriod = 0\n        managerData.numSwapsInPeriod = 0\n        managerData.periodStartBlock = block.number\n\n    return managerData\n\n\n# manager permissions and limits\n\n\n@view\n@internal\ndef _checkManagerPermsAndLimitsPreAction(\n    _managerData: wcs.ManagerData,\n    _txAction: ws.ActionType,\n    _txAssets: DynArray[address, MAX_ASSETS],\n    _txLegoIds: DynArray[uint256, MAX_LEGOS],\n    _txRecipient: address,\n    _limits: wcs.ManagerLimits,\n    _legoPerms: wcs.LegoPerms,\n    _transferPerms: wcs.TransferPerms,\n    _allowedAssets: DynArray[address, MAX_CONFIG_ASSETS],\n) -> bool:\n\n    # only checking tx limits right now (pre transaction)\n    if not self._checkTransactionLimits(_limits.maxNumTxsPerPeriod, _limits.txCooldownBlocks, _managerData.numTxsInPeriod, _managerData.lastTxBlock):\n        return False\n\n    # check allowed assets\n    if len(_allowedAssets) != 0:\n        for a: address in _txAssets:\n            if a != empty(address) and a not in _allowedAssets:\n                return False\n\n    # check allowed lego ids\n    if len(_legoPerms.allowedLegos) != 0:\n        for lid: uint256 in _txLegoIds:\n            if lid != 0 and lid not in _legoPerms.allowedLegos:\n                return False\n\n    # check allowed payees\n    if _txRecipient != empty(address) and len(_transferPerms.allowedPayees) != 0:\n        if _txRecipient not in _transferPerms.allowedPayees:\n            return False\n\n    # check action permissions\n    if _txAction in (ws.ActionType.TRANSFER | ws.ActionType.PAY_CHEQUE):\n        return _transferPerms.canTransfer\n    elif _txAction in (ws.ActionType.EARN_DEPOSIT | ws.ActionType.EARN_WITHDRAW | ws.ActionType.EARN_REBALANCE):\n        return _legoPerms.canManageYield\n    elif _txAction in (ws.ActionType.SWAP | ws.ActionType.MINT_REDEEM | ws.ActionType.CONFIRM_MINT_REDEEM):\n        return _legoPerms.canBuyAndSell\n    elif _txAction in (ws.ActionType.ADD_COLLATERAL | ws.ActionType.REMOVE_COLLATERAL | ws.ActionType.BORROW | ws.ActionType.REPAY_DEBT):\n        return _legoPerms.canManageDebt\n    elif _txAction in (ws.ActionType.ADD_LIQ | ws.ActionType.REMOVE_LIQ | ws.ActionType.ADD_LIQ_CONC | ws.ActionType.REMOVE_LIQ_CONC):\n        return _legoPerms.canManageLiq\n    elif _txAction == ws.ActionType.REWARDS:\n        return _legoPerms.canClaimRewards\n    else:\n        return True\n\n\n# check transaction limits\n\n\n@view\n@internal\ndef _checkTransactionLimits(\n    _maxNumTxsPerPeriod: uint256,\n    _txCooldownBlocks: uint256,\n    _numTxsInPeriod: uint256,\n    _lastTxBlock: uint256,\n) -> bool:\n    if _maxNumTxsPerPeriod != 0:\n        if _numTxsInPeriod >= _maxNumTxsPerPeriod:\n            return False\n\n    if _txCooldownBlocks != 0 and _lastTxBlock != 0:\n        if _lastTxBlock + _txCooldownBlocks > block.number:\n            return False\n\n    return True\n\n\n####################################\n# Manager Validation - Post Action #\n####################################\n\n\n@view\n@external\ndef canManagerFinishTx(\n    _user: address,\n    _manager: address,\n    _txUsdValue: uint256,\n    _underlyingAsset: address,\n    _vaultToken: address,\n    _shouldCheckSwap: bool,\n    _specificSwapPerms: wcs.SwapPerms,\n    _globalSwapPerms: wcs.SwapPerms,\n    _fromAssetUsdValue: uint256,\n    _toAssetUsdValue: uint256,\n    _vaultRegistry: address,\n) -> bool:\n    c: wcs.ManagerConfigBundle = self._getManagerConfigBundle(_user, _manager)\n    canFinishTx: bool = False\n    na: wcs.ManagerData = empty(wcs.ManagerData)\n    requiresVaultApproval: bool = (c.config.legoPerms.onlyApprovedYieldOpps or c.globalConfig.legoPerms.onlyApprovedYieldOpps)\n    canFinishTx, na = self._checkManagerLimitsPostTx(_txUsdValue, c.config.limits, c.globalConfig.limits, c.globalConfig.managerPeriod, c.data, requiresVaultApproval, _underlyingAsset, _vaultToken, _shouldCheckSwap, c.config.swapPerms, c.globalConfig.swapPerms, _fromAssetUsdValue, _toAssetUsdValue, _vaultRegistry)\n    return canFinishTx\n\n\n@view\n@external\ndef checkManagerLimitsPostTx(\n    _txUsdValue: uint256,\n    _specificLimits: wcs.ManagerLimits,\n    _globalLimits: wcs.ManagerLimits,\n    _managerPeriod: uint256,\n    _managerData: wcs.ManagerData,\n    _requiresVaultApproval: bool,\n    _underlyingAsset: address,\n    _vaultToken: address,\n    _shouldCheckSwap: bool,\n    _specificSwapPerms: wcs.SwapPerms,\n    _globalSwapPerms: wcs.SwapPerms,\n    _fromAssetUsdValue: uint256,\n    _toAssetUsdValue: uint256,\n    _vaultRegistry: address,\n) -> (bool, wcs.ManagerData):\n    return self._checkManagerLimitsPostTx(_txUsdValue, _specificLimits, _globalLimits, _managerPeriod, _managerData, _requiresVaultApproval, _underlyingAsset, _vaultToken, _shouldCheckSwap, _specificSwapPerms, _globalSwapPerms, _fromAssetUsdValue, _toAssetUsdValue, _vaultRegistry)\n\n\n@view\n@internal\ndef _checkManagerLimitsPostTx(\n    _txUsdValue: uint256,\n    _specificLimits: wcs.ManagerLimits,\n    _globalLimits: wcs.ManagerLimits,\n    _managerPeriod: uint256,\n    _managerData: wcs.ManagerData,\n    _requiresVaultApproval: bool,\n    _underlyingAsset: address,\n    _vaultToken: address,\n    _shouldCheckSwap: bool,\n    _specificSwapPerms: wcs.SwapPerms,\n    _globalSwapPerms: wcs.SwapPerms,\n    _fromAssetUsdValue: uint256,\n    _toAssetUsdValue: uint256,\n    _vaultRegistry: address,\n) -> (bool, wcs.ManagerData):\n    managerData: wcs.ManagerData = self._getLatestManagerData(_managerData, _managerPeriod)\n\n    # manager usd value limits\n    if not self._checkManagerUsdLimits(_txUsdValue, _specificLimits, managerData):\n        return False, empty(wcs.ManagerData)\n\n    # global usd value limits\n    if not self._checkManagerUsdLimits(_txUsdValue, _globalLimits, managerData):\n        return False, empty(wcs.ManagerData)\n\n    # vault token approval\n    if _requiresVaultApproval and empty(address) not in [_underlyingAsset, _vaultToken, _vaultRegistry]:\n        if not staticcall VaultRegistry(_vaultRegistry).isApprovedVaultTokenForAsset(_underlyingAsset, _vaultToken):\n            return False, empty(wcs.ManagerData)\n\n    # swap-specific validations\n    if _shouldCheckSwap:\n\n        # check if USD values are required and present (non-zero)\n        if not self._checkSwapHasUsdValue(_specificSwapPerms, _globalSwapPerms, _fromAssetUsdValue, _toAssetUsdValue):\n            return False, empty(wcs.ManagerData)\n\n        # check swap count limit\n        if not self._checkSwapCountLimit(_specificSwapPerms, _globalSwapPerms, managerData):\n            return False, empty(wcs.ManagerData)\n\n        # check slippage (loss prevention)\n        if not self._hasAcceptableSlippage(_specificSwapPerms, _globalSwapPerms, _fromAssetUsdValue, _toAssetUsdValue):\n            return False, empty(wcs.ManagerData)\n\n        # Increment swap counter\n        managerData.numSwapsInPeriod += 1\n\n    # update manager data\n    managerData.numTxsInPeriod += 1\n    managerData.totalUsdValueInPeriod += _txUsdValue\n    managerData.totalNumTxs += 1\n    managerData.totalUsdValue += _txUsdValue\n    managerData.lastTxBlock = block.number\n\n    return True, managerData\n\n\n# check manager usd limits\n\n\n@pure\n@internal\ndef _checkManagerUsdLimits(_txUsdValue: uint256, _limits: wcs.ManagerLimits, _managerData: wcs.ManagerData) -> bool:\n\n    # check zero price\n    if _txUsdValue == 0 and _limits.failOnZeroPrice:\n        return False\n\n    # check max usd value per tx\n    if _limits.maxUsdValuePerTx != 0:\n        if _txUsdValue > _limits.maxUsdValuePerTx:\n            return False\n\n    # check max usd value per period\n    if _limits.maxUsdValuePerPeriod != 0:\n        if _managerData.totalUsdValueInPeriod + _txUsdValue > _limits.maxUsdValuePerPeriod:\n            return False\n\n    # check max usd value lifetime\n    if _limits.maxUsdValueLifetime != 0:\n        if _managerData.totalUsdValue + _txUsdValue > _limits.maxUsdValueLifetime:\n            return False\n\n    return True\n\n\n# check swap has usd value\n\n\n@pure\n@internal\ndef _checkSwapHasUsdValue(_specific: wcs.SwapPerms, _global: wcs.SwapPerms, _fromUsdValue: uint256, _toUsdValue: uint256) -> bool:\n\n    # if either manager-specific or global requires USD values, enforce it\n    mustHaveUsdValue: bool = _specific.mustHaveUsdValue or _global.mustHaveUsdValue\n    if not mustHaveUsdValue:\n        return True # no requirement for USD values\n\n    # from and to assets must have USD values (non-zero)\n    return _fromUsdValue != 0 and _toUsdValue != 0\n\n\n# check swap count limit\n\n\n@pure\n@internal\ndef _checkSwapCountLimit(_specific: wcs.SwapPerms, _global: wcs.SwapPerms, _data: wcs.ManagerData) -> bool:\n    # use manager-specific limit if set, otherwise use global\n    limit: uint256 = _specific.maxNumSwapsPerPeriod if _specific.maxNumSwapsPerPeriod != 0 else _global.maxNumSwapsPerPeriod\n    if limit == 0:\n        return True # no limit\n    return _data.numSwapsInPeriod < limit\n\n\n# check swap slippage (loss prevention)\n\n\n@pure\n@internal\ndef _hasAcceptableSlippage(_specific: wcs.SwapPerms, _global: wcs.SwapPerms, _fromUsdValue: uint256, _toUsdValue: uint256) -> bool:\n    # use tighter (lower) slippage limit between manager and global\n    slippage: uint256 = _specific.maxSlippage\n    if slippage == 0 or (_global.maxSlippage != 0 and _global.maxSlippage < slippage):\n        slippage = _global.maxSlippage\n\n    if slippage == 0:\n        return True # no limit\n\n    # calculate minimum acceptable value (loss prevention)\n    # Formula: toUsdValue >= fromUsdValue * (10000 - slippage) / 10000\n    # Note: USD values are guaranteed to be non-zero here because:\n    #   - If slippage > 0, config validation requires mustHaveUsdValue = True\n    #   - If mustHaveUsdValue = True, _checkSwapHasUsdValue enforces non-zero USD values\n    acceptablePercentage: uint256 = HUNDRED_PERCENT - slippage\n    minAcceptableValue: uint256 = (_fromUsdValue * acceptablePercentage) // HUNDRED_PERCENT\n    return _toUsdValue >= minAcceptableValue\n\n\n####################\n# Payee Validation #\n####################\n\n\n# is valid payee\n\n\n@view\n@external\ndef isValidPayee(\n    _user: address,\n    _recipient: address,\n    _asset: address,\n    _amount: uint256,\n    _txUsdValue: uint256,\n) -> bool:\n    c: wcs.RecipientConfigBundle = self._getPayeeConfigs(_user, _recipient)\n    canPay: bool = False\n    na: wcs.PayeeData = empty(wcs.PayeeData)\n    canPay, na = self._isValidPayeeAndGetData(c.isWhitelisted, c.isOwner, c.isPayee, _asset, _amount, _txUsdValue, c.config, c.globalConfig, c.data)\n    return canPay\n\n\n# is valid payee (with config)\n\n\n@view\n@external\ndef isValidPayeeAndGetData(\n    _isWhitelisted: bool,\n    _isOwner: bool,\n    _isPayee: bool,\n    _asset: address,\n    _amount: uint256,\n    _txUsdValue: uint256,\n    _config: wcs.PayeeSettings,\n    _globalConfig: wcs.GlobalPayeeSettings,\n    _payeeData: wcs.PayeeData,\n) -> (bool, wcs.PayeeData):\n    return self._isValidPayeeAndGetData(_isWhitelisted, _isOwner, _isPayee, _asset, _amount, _txUsdValue, _config, _globalConfig, _payeeData)\n\n\n# core logic -- is valid payee\n\n\n@view\n@internal\ndef _isValidPayeeAndGetData(\n    _isWhitelisted: bool,\n    _isOwner: bool,\n    _isPayee: bool,\n    _asset: address,\n    _amount: uint256,\n    _txUsdValue: uint256,\n    _payeeConfig: wcs.PayeeSettings,\n    _globalConfig: wcs.GlobalPayeeSettings,\n    _payeeData: wcs.PayeeData,\n) -> (bool, wcs.PayeeData):\n\n    # whitelisted\n    if _isWhitelisted:\n        return True, empty(wcs.PayeeData)\n\n    # check if recipient is owner\n    if _isOwner and _globalConfig.canPayOwner:\n        return True, empty(wcs.PayeeData)\n\n    # registered payee\n    if not _isPayee:\n        return False, empty(wcs.PayeeData)\n\n    # get payee data\n    payeeData: wcs.PayeeData = self._getLatestPayeeData(_payeeData, _payeeConfig.periodLength)\n\n    # check specific payee settings\n    if not self._checkSpecificPayeeSettings(_asset, _amount, _txUsdValue, payeeData, _payeeConfig):\n        return False, empty(wcs.PayeeData)\n\n    # check global payee settings\n    if not self._checkGlobalPayeeSettings(_txUsdValue, payeeData, _globalConfig):\n        return False, empty(wcs.PayeeData)\n\n    # update payee data\n    payeeData.numTxsInPeriod += 1\n    payeeData.totalUsdValueInPeriod += _txUsdValue\n    payeeData.totalNumTxs += 1\n    payeeData.totalUsdValue += _txUsdValue\n    payeeData.lastTxBlock = block.number\n\n    # update unit amounts if this is the primary asset\n    if _payeeConfig.primaryAsset == _asset:\n        payeeData.totalUnitsInPeriod += _amount\n        payeeData.totalUnits += _amount\n\n    return True, payeeData\n\n\n# specific payee settings\n\n\n@view\n@internal\ndef _checkSpecificPayeeSettings(\n    _asset: address,\n    _amount: uint256,\n    _txUsdValue: uint256,\n    _payeeData: wcs.PayeeData,\n    _payeeConfig: wcs.PayeeSettings,\n) -> bool:\n\n    # check zero price\n    if _txUsdValue == 0 and _payeeConfig.failOnZeroPrice:\n        return False\n\n    # is payee active\n    if _payeeConfig.startBlock > block.number or _payeeConfig.expiryBlock <= block.number:\n        return False\n\n    # check if asset is allowed\n    if _payeeConfig.onlyPrimaryAsset and _payeeConfig.primaryAsset != empty(address):\n        if _payeeConfig.primaryAsset != _asset:\n            return False\n\n    # check transaction limits\n    if not self._checkTransactionLimits(_payeeConfig.maxNumTxsPerPeriod, _payeeConfig.txCooldownBlocks, _payeeData.numTxsInPeriod, _payeeData.lastTxBlock):\n        return False\n\n    # check USD limits \n    if not self._checkUsdLimits(_txUsdValue, _payeeConfig.usdLimits, _payeeData):\n        return False\n\n    # check unit limits if this is the primary asset\n    if _payeeConfig.primaryAsset == _asset:\n        if not self._checkUnitLimits(_amount, _payeeConfig.unitLimits, _payeeData):\n            return False\n\n    return True\n\n\n# global payee settings\n\n\n@view\n@internal\ndef _checkGlobalPayeeSettings(\n    _txUsdValue: uint256,\n    _payeeData: wcs.PayeeData,\n    _globalConfig: wcs.GlobalPayeeSettings,\n) -> bool:\n\n    # check zero price\n    if _txUsdValue == 0 and _globalConfig.failOnZeroPrice:\n        return False\n\n    # check transaction limits\n    if not self._checkTransactionLimits(_globalConfig.maxNumTxsPerPeriod, _globalConfig.txCooldownBlocks, _payeeData.numTxsInPeriod, _payeeData.lastTxBlock):\n        return False\n\n    # check USD limits\n    if not self._checkUsdLimits(_txUsdValue, _globalConfig.usdLimits, _payeeData):\n        return False\n\n    return True\n\n\n# get latest payee data (period reset)\n\n\n@view\n@internal\ndef _getLatestPayeeData(_payeeData: wcs.PayeeData, _periodLength: uint256) -> wcs.PayeeData:\n    payeeData: wcs.PayeeData = _payeeData\n\n    # initialize period if first transaction\n    if payeeData.periodStartBlock == 0:\n        payeeData.periodStartBlock = block.number\n\n    # check if current period has ended\n    elif block.number >= payeeData.periodStartBlock + _periodLength:\n        payeeData.numTxsInPeriod = 0\n        payeeData.totalUnitsInPeriod = 0\n        payeeData.totalUsdValueInPeriod = 0\n        payeeData.periodStartBlock = block.number\n\n    return payeeData\n\n\n# check USD limits\n\n\n@view\n@internal\ndef _checkUsdLimits(_txUsdValue: uint256, _limits: wcs.PayeeLimits, _payeeData: wcs.PayeeData) -> bool:\n    if _limits.perTxCap != 0:\n        if _txUsdValue > _limits.perTxCap:\n            return False\n\n    if _limits.perPeriodCap != 0:\n        if _payeeData.totalUsdValueInPeriod + _txUsdValue > _limits.perPeriodCap:\n            return False\n\n    if _limits.lifetimeCap != 0:\n        if _payeeData.totalUsdValue + _txUsdValue > _limits.lifetimeCap:\n            return False\n\n    return True\n\n\n# check unit limits\n\n\n@view\n@internal\ndef _checkUnitLimits(_amount: uint256, _limits: wcs.PayeeLimits, _payeeData: wcs.PayeeData) -> bool:\n    if _limits.perTxCap != 0:\n        if _amount > _limits.perTxCap:\n            return False\n\n    if _limits.perPeriodCap != 0:\n        if _payeeData.totalUnitsInPeriod + _amount > _limits.perPeriodCap:\n            return False\n\n    if _limits.lifetimeCap != 0:\n        if _payeeData.totalUnits + _amount > _limits.lifetimeCap:\n            return False\n\n    return True\n\n\n#####################\n# Cheque Validation #\n#####################\n\n\n@view\n@external\ndef isValidChequeAndGetData(\n    _asset: address,\n    _amount: uint256,\n    _txUsdValue: uint256,\n    _cheque: wcs.Cheque,\n    _globalConfig: wcs.ChequeSettings,\n    _chequeData: wcs.ChequeData,\n    _isManager: bool,\n) -> (bool, wcs.ChequeData):\n\n    # check if cheque is active\n    if not _cheque.active:\n        return False, empty(wcs.ChequeData)\n\n    # check if within expiry and unlock blocks\n    if block.number >= _cheque.expiryBlock or block.number < _cheque.unlockBlock:\n        return False, empty(wcs.ChequeData)\n\n    # no recipient or asset\n    if empty(address) in [_cheque.recipient, _cheque.asset]:\n        return False, empty(wcs.ChequeData)\n\n    # check asset matches\n    if _cheque.asset != _asset:\n        return False, empty(wcs.ChequeData)\n\n    # check amount matches cheque amount\n    if _amount != _cheque.amount:\n        return False, empty(wcs.ChequeData)\n\n    # check if asset is allowed in global config\n    if len(_globalConfig.allowedAssets) != 0:\n        if _asset not in _globalConfig.allowedAssets:\n            return False, empty(wcs.ChequeData)\n\n    # check if USD value is zero\n    if _txUsdValue == 0:\n        return False, empty(wcs.ChequeData)\n\n    # check max cheque USD value\n    if _globalConfig.maxChequeUsdValue != 0:\n        if _txUsdValue > _globalConfig.maxChequeUsdValue:\n            return False, empty(wcs.ChequeData)\n\n    # check if manager can pay\n    if _isManager:\n        if not _globalConfig.canManagerPay or not _cheque.canManagerPay:\n            return False, empty(wcs.ChequeData)\n\n    # get latest cheque data\n    chequeData: wcs.ChequeData = self._getLatestChequeData(_chequeData, _globalConfig.periodLength)\n\n    # check pay cooldown\n    if _globalConfig.payCooldownBlocks != 0:\n        if block.number < chequeData.lastChequePaidBlock + _globalConfig.payCooldownBlocks:\n            return False, empty(wcs.ChequeData)\n\n    # check max num cheques paid per period\n    if _globalConfig.maxNumChequesPaidPerPeriod != 0:\n        if chequeData.numChequesPaidInPeriod >= _globalConfig.maxNumChequesPaidPerPeriod:\n            return False, empty(wcs.ChequeData)\n\n    # check per period paid USD cap\n    if _globalConfig.perPeriodPaidUsdCap != 0:\n        if chequeData.totalUsdValuePaidInPeriod + _txUsdValue > _globalConfig.perPeriodPaidUsdCap:\n            return False, empty(wcs.ChequeData)\n\n    # update cheque data\n    chequeData.numChequesPaidInPeriod += 1\n    chequeData.totalUsdValuePaidInPeriod += _txUsdValue\n    chequeData.totalNumChequesPaid += 1\n    chequeData.totalUsdValuePaid += _txUsdValue\n    chequeData.lastChequePaidBlock = block.number\n\n    return True, chequeData\n\n\n# get latest cheque data (period reset)\n\n\n@view\n@internal\ndef _getLatestChequeData(_chequeData: wcs.ChequeData, _periodLength: uint256) -> wcs.ChequeData:\n    chequeData: wcs.ChequeData = _chequeData\n\n    # initialize period if first cheque\n    if chequeData.periodStartBlock == 0:\n        chequeData.periodStartBlock = block.number\n\n    # check if current period has ended\n    elif _periodLength != 0 and block.number >= chequeData.periodStartBlock + _periodLength:\n\n        # reset paid period data\n        chequeData.numChequesPaidInPeriod = 0\n        chequeData.totalUsdValuePaidInPeriod = 0\n\n        # reset created period data\n        chequeData.numChequesCreatedInPeriod = 0\n        chequeData.totalUsdValueCreatedInPeriod = 0\n        chequeData.periodStartBlock = block.number\n\n    return chequeData\n\n\n#############\n# Utilities #\n#############\n\n\n@view\n@internal\ndef _getManagerConfigBundle(_userWallet: address, _signer: address, _txRecipient: address = empty(address)) -> wcs.ManagerConfigBundle:\n    userWalletConfig: address = staticcall UserWallet(_userWallet).walletConfig()\n\n    payee: address = _txRecipient\n    if _txRecipient != empty(address) and staticcall UserWalletConfig(userWalletConfig).indexOfWhitelist(_txRecipient) != 0:\n        payee = empty(address)\n\n    return wcs.ManagerConfigBundle(\n        isOwner = _signer == staticcall UserWalletConfig(userWalletConfig).owner(),\n        isManager = staticcall UserWalletConfig(userWalletConfig).indexOfManager(_signer) != 0,\n        config = staticcall UserWalletConfig(userWalletConfig).managerSettings(_signer),\n        globalConfig = staticcall UserWalletConfig(userWalletConfig).globalManagerSettings(),\n        data = staticcall UserWalletConfig(userWalletConfig).managerPeriodData(_signer),\n        payee = payee,\n    )\n\n\n@view\n@internal\ndef _getPayeeConfigs(_userWallet: address, _recipient: address) -> wcs.RecipientConfigBundle:\n    userWalletConfig: address = staticcall UserWallet(_userWallet).walletConfig()\n    isWhitelisted: bool = staticcall UserWalletConfig(userWalletConfig).indexOfWhitelist(_recipient) != 0\n\n    isOwner: bool = False\n    isPayee: bool = False\n    config: wcs.PayeeSettings = empty(wcs.PayeeSettings)\n    globalConfig: wcs.GlobalPayeeSettings = empty(wcs.GlobalPayeeSettings)\n    data: wcs.PayeeData = empty(wcs.PayeeData)\n    if not isWhitelisted:\n        isOwner = _recipient == staticcall UserWalletConfig(userWalletConfig).owner()\n        isPayee = staticcall UserWalletConfig(userWalletConfig).indexOfPayee(_recipient) != 0\n        config = staticcall UserWalletConfig(userWalletConfig).payeeSettings(_recipient)\n        globalConfig = staticcall UserWalletConfig(userWalletConfig).globalPayeeSettings()\n        data = staticcall UserWalletConfig(userWalletConfig).payeePeriodData(_recipient)\n\n    return wcs.RecipientConfigBundle(\n        isWhitelisted = isWhitelisted,\n        isOwner = isOwner,\n        isPayee = isPayee,\n        config = config,\n        globalConfig = globalConfig,\n        data = data,\n    )\n",
            "sha256sum": "34a0bc14ad98ca1e59419fa57a0e06e6197657bc572ea993b30643f6f8fb92c1"
          }
        },
        "settings": {
          "outputSelection": {
            "contracts/core/walletBackpack/Sentinel.vy": [
              "*"
            ]
          },
          "search_paths": [
            "."
          ]
        },
        "compiler_version": "v0.4.3+commit.bff19ea2",
        "integrity": "a0375253682be0fcf68456178d6914b4d3f811a22ccfe9133dc09d70d87240cb"
      },
      "args": "",
      "file": "contracts/core/walletBackpack/Sentinel.vy"
    }
  }
}